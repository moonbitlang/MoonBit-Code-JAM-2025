# Meowbloom（云海下的花园）

Meowbloom 是一个小型种田玩具。你将扮演一只在 16×16 像素格子上巡视的猫，播种稻米或番茄、自动收割成熟作物、完成轮换任务并跟踪获得的金币。游戏还提供脚本控制台，让你用简单命令排程猫咪的动作。

## 开始游戏
- 点击遮罩层上的 **Start Game** 按钮，猫咪才会被创建，同时解锁库存、任务、种植与脚本控制台等系统。

## 手动操作
- **移动**：使用 `WASD` 或方向键。猫以 120 px/s 的速度在画布范围内移动。
- **背包热键**：数字键 `1`‒`8` 选择槽位。初始时槽位 1、2 分别放有稻米与番茄种子，其余为空。
- **种植**：选中种子后，把猫移动到目标格子并左键点击。已有作物的格子无法再次种植。
- **收割**：走到成熟作物上方即可立即收获，作物会闪现果实贴图 0.5 秒后消失。
- **HUD**：左上角显示稻米/番茄累计收成、金币总数与当前任务描述。

## 植物成长
所有作物都会经历「种子 → 嫩芽 → 成长 → 成熟 → 果实」阶段，其中前四个阶段按类型拥有不同计时：

| 作物 | 种子→嫩芽 | 嫩芽→成长 | 成长→成熟 |
|------|-----------|-----------|-----------|
| 稻米 | 2.0 秒    | 5.0 秒    | 6.0 秒    |
| 番茄 | 2.5 秒    | 5.5 秒    | 6.5 秒    |

成熟阶段会无限等待，直到猫咪收割。被收割后植物进入 0.5 秒的果实展示时间，随后实体被销毁，格子再次空闲。

## 任务与金币
- HUD 始终保持一个任务，按顺序循环：收割 5 份稻米（奖励 10 金币）→ 收割 3 份番茄（奖励 12 金币）→ 收割任意 10 份作物（奖励 20 金币）。
- 每次收割都会更新任务进度，同时递增稻米/番茄统计。
- 金币目前仅用于表示成就感，但能让你直观了解自己的效率。

## 代码控制台
按 `C` 键可显示/隐藏右侧代码控制台。点击面板以获取输入焦点，支持输入字母、数字与空格，`Enter` 换行。按 **Run** 执行脚本，**Clear** 清空文本并终止正在运行的脚本。未点击 Start Game 之前无法运行脚本。

可用命令（每行一条）：

```
move <方向> [步数]        # 方向：up/down/left/right 或 north/south/west/east，也支持中文“上/下/左/右”。步数以格子为单位，默认 1。
plant [rice|tomato]       # 可指定作物类型；若省略则使用当前选中的槽位。
select rice|tomato        # 切换到含有对应种子的槽位。
select slot <n> / slot <n>  # 选择第 n 个背包槽位（脚本里的编号从 1 开始）。
```

示例脚本：

```
select rice
move right 4
plant
select tomato
move down 2
plant tomato
```

脚本执行器会顺序运行命令，并在移动结束后才继续下一条。若出现缺少种子、槽位无效等情况，脚本会立即停止并在状态栏提示原因。

## 小技巧
- 每个格子 16×16 像素，所以脚本的每一步恰好移动一个种植位。
- 通过底部背包槽的高亮可以快速确认当前选择的种子。
- 收割是自动触发的，沿着种植行快速穿行即可迅速清空产量，然后再开始下一轮种植。

## 技术特色
- MoonBit + Selene 实时玩法：依靠 MoonBit 语言与 Selene 框架构建，组合 ECS、画布渲染与输入系，60 FPS、1024×720 画布，展示该语言生态下的完整游戏循环。
- 脚本化自动化：自研代码控制台可解析 move/plant/select 等 DSL，支持英/中双语指令、动态状态提示，并驱动猫的移动、种植与背包操作，是个小型脚本执行器范例。
- 状态驱动 UI：HUD、背包、控制台等界面全部通过 @style.add_widget + sprite 自绘，配合 hud_dirty、inventory_dirty 等标志实现脏检查刷新，体现自定义 UI 流程。
- 任务与作物系统：植物成长通过状态机+计时器驱动，收割后进入短暂 Fruit 状态；任务系统按索引生成循环目标，结合金币 reward，展示在 HUD 中。
- 猫 AI 控制：平时由玩家控制；脚本运行时通过 cat_script_move_to/cat_is_script_moving 接口自动移动，并自动收割脚下成熟作物，体现输入层与“脚本层”解耦的控制架构。

## 团队信息
- 团队名称：一次不够买够五次
- 作品名称：meowbloom
- 联系方式: 2980060097@qq.com
- b站视频链接：【Meowbloom（云海下的花园）】 https://www.bilibili.com/video/BV1FuCMBaEed/?share_source=copy_web&vd_source=7b37e97cc5f4160f327cd6cf7393ee10
- 仓库链接: https://github.com/Penguinsltp/meowbloom
