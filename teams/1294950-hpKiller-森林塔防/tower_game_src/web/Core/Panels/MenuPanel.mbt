///|
/// Create the panel data instance with all the provided data
/// åœ¨æŽ§åˆ¶å™¨ä¸­æ›´æ”¹ æ•°æ® 
pub fn create_panel_data(level : Int) -> PanelData {
  // Create tower data
  let towers = create_panel_data_tower(level)
  let enemies = create_panel_data_enemy(level)

  // Create neutrals with additional duplicate entries as shown in the data
  let neutrals = create_panel_data_neutral_elements(level)
  PanelData::new(towers, enemies, neutrals)
}

///|
fn create_panel_data_tower(level : Int) -> Array[TowerData] {
  let all_config_tower = [
    TowerData::new(
      "èœœèœ‚å¡”",
      @Tower.BeeTower,
      "å•ä½“",
      @Tower.BEETOWER_COST.to_int(),
      @Tower.BEETOWER_COST_UP2.to_int(),
      @Tower.BEETOWER_COST_UP3.to_int(),
      "é™„åŠ ä¸­æ¯’æ•ˆæžœ",
      "åˆç†å®‰æŽ’è·ç¦»ä½¿ä¸­æ¯’æ•ˆæžœæœ€å¤§åŒ–",
      Stats::new(70, 80),
      [
        Attribute::new("â™¥", "é™„åŠ ä¸­æ¯’æ•ˆæžœ"),
        Attribute::new("âš¡", "æ”»é€Ÿå¿«"),
      ],
    ),
    TowerData::new(
      "èƒ½é‡å¡”",
      @Tower.ChargeJarTower,
      "å•ä½“",
      @Tower.CHARGEJARTOWER_COST.to_int(),
      @Tower.CHARGEJARTOWER_COST_UP2.to_int(),
      @Tower.CHARGEJARTOWER_COST_UP3.to_int(),
      "å‘å°„ç«çƒï¼Œå¯¹å•ä¸ªæ•Œäººé€ æˆæŒç»­ç‡ƒçƒ§ä¼¤å®³ã€‚",
      "é€‚åˆæ”¾åœ¨æ•Œäººè·¯å¾„çš„æ‹è§’å¤„ï¼Œæœ€å¤§åŒ–ä¼¤å®³è¾“å‡ºã€‚",
      Stats::new(90, 50),
      [
        Attribute::new("â™¥", "ä¼¤å®³æžé«˜"),
        Attribute::new("âš¡", "æ”»é€Ÿæ…¢"),
      ],
    ),
    TowerData::new(
      "é»˜è®¤å¡”",
      @Tower.CurveTower,
      "æŽ§åˆ¶",
      @Tower.CURVETOWER_COST.to_int(),
      @Tower.CURVETOWER_COST_UP2.to_int(),
      @Tower.CURVETOWER_COST_UP3.to_int(),
      "å‘å°„å†°é”¥ï¼Œå‡ç¼“æ•Œäººçš„ç§»åŠ¨é€Ÿåº¦ã€‚",
      "é…åˆé«˜ä¼¤å®³ç‚®å¡”ä½¿ç”¨æ•ˆæžœæœ€ä½³ã€‚",
      Stats::new(40, 70),
      [Attribute::new("â„", "å‡é€Ÿå¼º"), Attribute::new("âš¡", "æ”»é€Ÿä¸­")],
    ),
    TowerData::new(
      "é—ªç”µå¡”",
      @Tower.LightningTower,
      "ç¾¤ä½“",
      @Tower.LIGHTNINGTOWER_COST.to_int(),
      @Tower.LIGHTNINGTOWER_COST_UP2.to_int(),
      @Tower.LIGHTNINGTOWER_COST_UP3.to_int(),
      "é‡Šæ”¾é—ªç”µé“¾ï¼Œå¯è·³è·ƒæ”»å‡»å¤šä¸ªæ•Œäººã€‚",
      "åœ¨æ•Œäººå¯†é›†åŒºåŸŸæ”¾ç½®æ•ˆæžœæœ€ä½³ã€‚",
      Stats::new(60, 60),
      [Attribute::new("âš¡", "èŒƒå›´å¹¿"), Attribute::new("âš¡", "æ”»é€Ÿä¸­")],
    ),
    TowerData::new(
      "è´Ÿç£å¡”",
      @Tower.NegativeMagneticTower,
      "å•ä½“",
      @Tower.NEGATIVEMAGNETICTOWER_COST.to_int(),
      @Tower.NEGATIVEMAGNETICTOWER_COST_UP2.to_int(),
      @Tower.NEGATIVEMAGNETICTOWER_COST_UP3.to_int(),
      "ä¸Žæ­£ç£å¡”é…åˆï¼Œä¼šäº§ç”Ÿç£åœº",
      "ä¸Žæ­£ç£å¡”åˆ†åˆ«æ”¾åˆ°é“è·¯çš„ä¸¤ä¾§",
      Stats::new(60, 60),
      [Attribute::new("âš¡", "èŒƒå›´å¹¿"), Attribute::new("âš¡", "æ”»é€Ÿä¸­")],
    ),
    TowerData::new(
      "æ­£ç£å¡”",
      @Tower.PositiveMagneticTower,
      "å•ä½“",
      @Tower.POSITIVEMAGNETICTOWER_COST.to_int(),
      @Tower.POSITIVEMAGNETICTOWER_COST_UP2.to_int(),
      @Tower.POSITIVEMAGNETICTOWER_COST_UP3.to_int(),
      "ä¸Žæ­£ç£å¡”é…åˆï¼Œä¼šäº§ç”Ÿç£åœº",
      "ä¸Žè´Ÿç£å¡”åˆ†åˆ«æ”¾åˆ°é“è·¯çš„ä¸¤ä¾§",
      Stats::new(60, 60),
      [Attribute::new("âš¡", "èŒƒå›´å¹¿"), Attribute::new("âš¡", "æ”»é€Ÿä¸­")],
    ),
    TowerData::new(
      "è´Ÿç£å¡”",
      @Tower.PlasmaTower,
      "ç¾¤ä½“",
      @Tower.PLASMATOWER_COST.to_int(),
      @Tower.PLASMATOWER_COST_UP2.to_int(),
      @Tower.PLASMATOWER_COST_UP3.to_int(),
      "é‡Šæ”¾é—ªç”µé“¾ï¼Œå¯è·³è·ƒæ”»å‡»å¤šä¸ªæ•Œäººã€‚",
      "åœ¨æ•Œäººå¯†é›†åŒºåŸŸæ”¾ç½®æ•ˆæžœæœ€ä½³ã€‚",
      Stats::new(60, 60),
      [Attribute::new("âš¡", "èŒƒå›´å¹¿"), Attribute::new("âš¡", "æ”»é€Ÿä¸­")],
    ),
    TowerData::new(
      "é›ªèŠ±å¡”",
      @Tower.SnowflakeTower,
      "ç¾¤ä½“",
      @Tower.SNOWFLAKETOWER_COST.to_int(),
      @Tower.SNOWFLAKETOWER_COST_UP2.to_int(),
      @Tower.SNOWFLAKETOWER_COST_UP3.to_int(),
      "æ”»å‡»é™„å¸¦å‡é€Ÿæ•ˆæžœ",
      "",
      Stats::new(60, 60),
      [Attribute::new("âš¡", "èŒƒå›´å¹¿"), Attribute::new("âš¡", "æ”»é€Ÿä¸­")],
    ),
    TowerData::new(
      "æ¿€å…‰å¡”",
      @Tower.LaserTower,
      "ç¾¤ä½“",
      @Tower.LASERTOWER_COST.to_int(),
      @Tower.LASERTOWER_COST_UP2.to_int(),
      @Tower.LASERTOWER_COST_UP3.to_int(),
      "å­å¼¹ç©¿åˆº",
      "",
      Stats::new(60, 60),
      [Attribute::new("âš¡", "èŒƒå›´å¹¿"), Attribute::new("âš¡", "æ”»é€Ÿä¸­")],
    ),
    TowerData::new(
      "å†°å†»å¡”",
      @Tower.FrozenTower,
      "å†°å†»",
      @Tower.FROZENTOWER_COST.to_int(),
      @Tower.FROZENTOWER_COST_UP2.to_int(),
      @Tower.FROZENTOWER_COST_UP3.to_int(),
      "ä¸ªä½“å†°å†»",
      "",
      Stats::new(60, 60),
      [Attribute::new("âš¡", "èŒƒå›´å¹¿"), Attribute::new("âš¡", "æ”»é€Ÿä¸­")],
    ),
    TowerData::new(
      "æ—¥é£Ÿå¡”",
      @Tower.DecayTower,
      "å¼¹å°„",
      @Tower.DECAYTOWER_COST.to_int(),
      @Tower.DECAYTOWER_COST_UP2.to_int(),
      @Tower.DECAYTOWER_COST_UP3.to_int(),
      "æ”»å‡»è¶Šä¹…ä¼¤å®³è¶Šé«˜",
      "",
      Stats::new(60, 60),
      [Attribute::new("âš¡", "èŒƒå›´å¹¿"), Attribute::new("âš¡", "æ”»é€Ÿä¸­")],
    ),
    TowerData::new(
      "é“¾å­å¡”",
      @Tower.ChainTower,
      "è¾…åŠ©",
      @Tower.CHAINTOWER_COST.to_int(),
      @Tower.CHAINTOWER_COST_UP2.to_int(),
      @Tower.CHAINTOWER_COST_UP3.to_int(),
      "æ²¡ä¼¤å®³,å¢žåŠ å‹å†›æ”»é€Ÿ",
      "",
      Stats::new(60, 60),
      [Attribute::new("âš¡", "èŒƒå›´å¹¿"), Attribute::new("âš¡", "æ”»é€Ÿä¸­")],
    ),
    TowerData::new(
      "æ”»é€Ÿå¡”",
      @Tower.SpeedTower,
      "è¾…åŠ©",
      @Tower.SPEEDTOWER_COST.to_int(),
      @Tower.SPEEDTOWER_COST_UP2.to_int(),
      @Tower.SPEEDTOWER_COST_UP3.to_int(),
      "æ²¡ä¼¤å®³,å¢žåŠ å‹å†›æ”»é€Ÿ",
      "",
      Stats::new(60, 60),
      [Attribute::new("âš¡", "èŒƒå›´å¹¿"), Attribute::new("âš¡", "æ”»é€Ÿä¸­")],
    ),
    TowerData::new(
      "ç©¿äº‘å¡”",
      @Tower.SkyTower,
      "å¯¹ç©º",
      @Tower.SKYTOWER_COST.to_int(),
      @Tower.SKYTOWER_COST_UP2.to_int(),
      @Tower.SKYTOWER_COST_UP3.to_int(),
      "æ”»å‡»å¤©ç©ºä¸­çš„æ•Œäºº,å•ä½“",
      "",
      Stats::new(60, 60),
      [Attribute::new("âš¡", "èŒƒå›´å¹¿"), Attribute::new("âš¡", "æ”»é€Ÿä¸­")],
    ),
    TowerData::new(
      "é›·ç”µå¡”",
      @Tower.ThunderTower,
      "å¯¹ç©º",
      @Tower.THUNDERTOWER_COST.to_int(),
      @Tower.THUNDERTOWER_COST_UP2.to_int(),
      @Tower.THUNDERTOWER_COST_UP3.to_int(),
      "æ”»å‡»å¤©ç©ºä¸­çš„æ•Œäºº,å•ä½“",
      "",
      Stats::new(60, 60),
      [Attribute::new("âš¡", "èŒƒå›´å¹¿"), Attribute::new("âš¡", "æ”»é€Ÿä¸­")],
    ),
    TowerData::new(
      "å®è—å¡”",
      @Tower.TreasureTower,
      "å¯¹ç©º",
      @Tower.TREASURETOWER_COST.to_int(),
      @Tower.TREASURETOWER_COST_UP2.to_int(),
      @Tower.TREASURETOWER_COST_UP3.to_int(),
      "æ”»å‡»æ—¶èƒ½äº§ç”Ÿè€Œå¤–çš„é’±",
      "",
      Stats::new(60, 60),
      [Attribute::new("âš¡", "èŒƒå›´å¹¿"), Attribute::new("âš¡", "æ”»é€Ÿä¸­")],
    ),
  ]
  let m = @Map.get_map_by_level(level)
  let available_towers = []
  for t in m.available_tower {
    for act in all_config_tower {
      if act.icon == t {
        available_towers.push(act)
      }
    }
  }
  available_towers
}

///|
fn[T : Eq] deduplicate(arr : Array[T]) -> Array[T] {
  let result = Array::new()
  for item in arr {
    let mut found = false
    for existing in result {
      if item == existing {
        found = true
        break
      }
    }
    if !found {
      result.push(item)
    }
  }
  result
}

///|
fn create_panel_data_enemy(level : Int) -> Array[EnemiesData] {
  let all_config_enemis = [
    EnemiesData::new(
      "ç—…æ¯’",
      @Enemy.VirusEnemy,
      "åˆ†è£‚",
      "æ­»äº¡åŽä¼šåˆ†è£‚ä¸ºä¸¤ä¸ªå°ç—…æ¯’",
      "å°ç—…æ¯’è¡€é‡ï¼Œç§»åŠ¨å¿«",
      [
        Attribute::new("â™¥", "ç”Ÿå‘½å°‘"),
        Attribute::new("âš¡", "é€Ÿåº¦å¿«"),
        Attribute::new("ðŸ›¡", "æ— æŠ¤ç”²"),
      ],
    ),
    EnemiesData::new(
      "çŒŽè±¹",
      @Enemy.CheetahEnemy,
      "å¿«é€Ÿç§»åŠ¨",
      "",
      "å…¨åœºè·‘å¾—æœ€å¿«çš„ä»”",
      [
        Attribute::new("â™¥", "ç”Ÿå‘½å°‘"),
        Attribute::new("âš¡", "é€Ÿåº¦å¿«"),
        Attribute::new("ðŸ›¡", "æ— æŠ¤ç”²"),
      ],
    ),
    EnemiesData::new(
      "è¢‹é¼ ",
      @Enemy.KangarooEnemy,
      "è·³è·ƒ",
      "",
      "å…¨åœºè·‘å¾—æœ€å¿«çš„ä»”",
      [
        Attribute::new("â™¥", "ç”Ÿå‘½å°‘"),
        Attribute::new("âš¡", "é€Ÿåº¦å¿«"),
        Attribute::new("ðŸ›¡", "æ— æŠ¤ç”²"),
      ],
    ),
    EnemiesData::new(
      "å°é¸Ÿ",
      @Enemy.FlyingEnemy,
      "é£žè¡Œ",
      "",
      "å…¨åœºè·‘å¾—æœ€å¿«çš„ä»”",
      [
        Attribute::new("â™¥", "ç”Ÿå‘½å°‘"),
        Attribute::new("âš¡", "é€Ÿåº¦å¿«"),
        Attribute::new("ðŸ›¡", "æ— æŠ¤ç”²"),
      ],
    ),
    EnemiesData::new(
      "å¤§é¸Ÿ",
      @Enemy.EggsEnemy,
      "é£žè¡Œ",
      "",
      "æ­»äº¡åŽä¼šç•™ä¸‹åŽä»£",
      [
        Attribute::new("â™¥", "ç”Ÿå‘½å°‘"),
        Attribute::new("âš¡", "é€Ÿåº¦å¿«"),
        Attribute::new("ðŸ›¡", "æ— æŠ¤ç”²"),
      ],
    ),
    EnemiesData::new(
      "åœ°é¼ ",
      @Enemy.GroundEnemy,
      "é£žè¡Œ",
      "",
      "æ­»äº¡åŽä¼šç•™ä¸‹åŽä»£",
      [
        Attribute::new("â™¥", "ç”Ÿå‘½å°‘"),
        Attribute::new("âš¡", "é€Ÿåº¦å¿«"),
        Attribute::new("ðŸ›¡", "æ— æŠ¤ç”²"),
      ],
    ),
    EnemiesData::new(
      "ä¹Œé¾Ÿ",
      @Enemy.TurtleEnemy,
      "",
      "",
      "æ­»äº¡åŽä¼šç•™ä¸‹åŽä»£",
      [
        Attribute::new("â™¥", "ç”Ÿå‘½å¤š"),
        Attribute::new("âš¡", "é€Ÿåº¦æ…¢"),
        Attribute::new("ðŸ›¡", "æœ‰æŠ¤ç”²"),
      ],
    ),
    EnemiesData::new(
      "æ¯›æ¯›è™«",
      @Enemy.CaterpillarEnemy,
      "æ£®æž—ä¸­çš„æ¯›æ¯›è™«",
      "",
      "å¹³å¹³æ— å¥‡çš„æ•Œäºº",
      [
        Attribute::new("â™¥", "ç”Ÿå‘½å°‘"),
        Attribute::new("âš¡", "é€Ÿåº¦æ…¢"),
        Attribute::new("ðŸ›¡", "æ— æŠ¤ç”²"),
      ],
    ),
    EnemiesData::new(
      "æœºç”²æ€ª",
      @Enemy.MechaEnemy,
      "",
      "",
      "ä»Žæœºç”²å†…äº§ç”Ÿæ•Œäºº",
      [
        Attribute::new("â™¥", "ç”Ÿå‘½å°‘"),
        Attribute::new("âš¡", "é€Ÿåº¦æ…¢"),
        Attribute::new("ðŸ›¡", "æœ‰æŠ¤ç”²"),
      ],
    ),
    EnemiesData::new(
      "UFO",
      @Enemy.UFOEnemy,
      "",
      "",
      "éšæœºå¸èµ°ä¸€ä¸ªé˜²å¾¡å¡”",
      [
        Attribute::new("â™¥", "ç”Ÿå‘½å°‘"),
        Attribute::new("âš¡", "é€Ÿåº¦æ…¢"),
        Attribute::new("ðŸ›¡", "æœ‰æŠ¤ç”²"),
      ],
    ),
    EnemiesData::new(
      "å¤§ç†Š",
      @Enemy.BearEnemy,
      "",
      "",
      "å¯¹é˜²å¾¡å¡”è¿›è¡Œå˜²è®½ï¼Œå¼ºåˆ¶é˜²å¾¡å¡”æ”»å‡»",
      [
        Attribute::new("â™¥", "ç”Ÿå‘½å°‘"),
        Attribute::new("âš¡", "é€Ÿåº¦æ…¢"),
        Attribute::new("ðŸ›¡", "æœ‰æŠ¤ç”²"),
      ],
    ),
  ]
  let m = @Map.get_map_by_level(level)
  let available_enemies = []

  // get all type enemy 
  let types = []
  for c in m.enemy_path_waves {
    for w in c.waves {
      types.push(w.enemy_type)
    }
  }
  let et = deduplicate(types)
  for t in et {
    for act in all_config_enemis {
      if act.icon == t {
        available_enemies.push(act)
      }
    }
  }
  available_enemies
}

///|
fn create_panel_data_neutral_elements(
  level : Int,
) -> Array[NeutralElementsData] {
  let all_config_neutral_element = [
    NeutralElementsData::new(
      "çŸ³å¤´",
      @NeutralElement.StoneNeutralElement,
      "å¹³å¹³æ— å¥‡",
      "æ­»äº¡åŽä¼šåˆ†è£‚ä¸ºä¸¤ä¸ªå°ç—…æ¯’",
      "å°ç—…æ¯’è¡€é‡ï¼Œç§»åŠ¨å¿«",
      [
        Attribute::new("â™¥", "ç”Ÿå‘½å°‘"),
        Attribute::new("âš¡", "é€Ÿåº¦å¿«"),
        Attribute::new("ðŸ›¡", "æ— æŠ¤ç”²"),
      ],
    ),
    NeutralElementsData::new(
      "å½©ç¥¨æœº",
      @NeutralElement.SlotMachineNeutralElement,
      "æŠ½å¥–",
      "æ­»äº¡åŽä¼šåˆ†è£‚ä¸ºä¸¤ä¸ªå°ç—…æ¯’",
      "å°ç—…æ¯’è¡€é‡ï¼Œç§»åŠ¨å¿«",
      [
        Attribute::new("â™¥", "ç”Ÿå‘½å°‘"),
        Attribute::new("âš¡", "é€Ÿåº¦å¿«"),
        Attribute::new("ðŸ›¡", "æ— æŠ¤ç”²"),
      ],
    ),
    NeutralElementsData::new(
      "å®è—",
      @NeutralElement.TreasureChestNeutralElement,
      "æŠ½å¥–",
      "æ­»äº¡åŽèŽ·å¾—ä¸€å¤§ç¬”è´¢å¯Œ",
      "å°ç—…æ¯’è¡€é‡ï¼Œç§»åŠ¨å¿«",
      [
        Attribute::new("â™¥", "ç”Ÿå‘½å°‘"),
        Attribute::new("âš¡", "é€Ÿåº¦å¿«"),
        Attribute::new("ðŸ›¡", "æ— æŠ¤ç”²"),
      ],
    ),
    NeutralElementsData::new(
      "å°è‰",
      @NeutralElement.WeedNeutralElement,
      "å¹³å¹³æ— å¥‡",
      "æ­»äº¡åŽèŽ·å¾—ä¸€å¤§ç¬”è´¢å¯Œ",
      "å°ç—…æ¯’è¡€é‡ï¼Œç§»åŠ¨å¿«",
      [
        Attribute::new("â™¥", "ç”Ÿå‘½å°‘"),
        Attribute::new("âš¡", "é€Ÿåº¦å¿«"),
        Attribute::new("ðŸ›¡", "æ— æŠ¤ç”²"),
      ],
    ),
    NeutralElementsData::new(
      "ä¼ é€å¸¦",
      @NeutralElement.ConveyorBeltNeutralElement,
      "å¹³å¹³æ— å¥‡",
      "æ­»äº¡åŽèŽ·å¾—ä¸€å¤§ç¬”è´¢å¯Œ",
      "å°ç—…æ¯’è¡€é‡ï¼Œç§»åŠ¨å¿«",
      [
        Attribute::new("â™¥", "ç”Ÿå‘½å°‘"),
        Attribute::new("âš¡", "é€Ÿåº¦å¿«"),
        Attribute::new("ðŸ›¡", "æ— æŠ¤ç”²"),
      ],
    ),
    NeutralElementsData::new(
      "æŽ¢ç…§ç¯",
      @NeutralElement.SearchLightNeutralElement,
      "å¹³å¹³æ— å¥‡",
      "æ­»äº¡åŽèŽ·å¾—ä¸€å¤§ç¬”è´¢å¯Œ",
      "å°ç—…æ¯’è¡€é‡ï¼Œç§»åŠ¨å¿«",
      [
        Attribute::new("â™¥", "ç”Ÿå‘½å°‘"),
        Attribute::new("âš¡", "é€Ÿåº¦å¿«"),
        Attribute::new("ðŸ›¡", "æ— æŠ¤ç”²"),
      ],
    ),
    NeutralElementsData::new(
      "èƒ½é‡ç¯",
      @NeutralElement.EnergyLightNeutralElement,
      "å¹³å¹³æ— å¥‡",
      "æ­»äº¡åŽèŽ·å¾—ä¸€å¤§ç¬”è´¢å¯Œ",
      "å°ç—…æ¯’è¡€é‡ï¼Œç§»åŠ¨å¿«",
      [
        Attribute::new("â™¥", "ç”Ÿå‘½å°‘"),
        Attribute::new("âš¡", "é€Ÿåº¦å¿«"),
        Attribute::new("ðŸ›¡", "æ— æŠ¤ç”²"),
      ],
    ),
  ]
  let available_neutral = []
  let m = @Map.get_map_by_level(level)
  for t in all_config_neutral_element {
    for c in m.neutral_element {
      if c.neutralElement_type() == t.icon {
        available_neutral.push(t)
      }
    }
  }
  available_neutral
}

///|
/// Attribute structure for displaying icon and text pairs
pub(all) struct Attribute {
  icon : String
  text : String
}

///|
/// Constructor for Attribute
pub fn Attribute::new(icon : String, text : String) -> Attribute {
  Attribute::{ icon, text }
}

///|
/// Stats structure for damage and speed values
pub(all) struct Stats {
  damage : Int
  speed : Int
}

///|
/// Constructor for Stats
pub fn Stats::new(damage : Int, speed : Int) -> Stats {
  Stats::{ damage, speed }
}

///|
/// Tower data structure
pub(all) struct TowerData {
  name : String
  icon : @Tower.TowerType
  tower_type : String // "ç¾¤ä½“", "å•ä½“", "æŽ§åˆ¶", etc.
  cost : Int
  upgrade2 : Int
  upgrade_max : Int
  description : String
  tips : String
  stats : Stats
  attributes : Array[Attribute]
}

///|
/// Constructor for TowerData
pub fn TowerData::new(
  name : String,
  icon : @Tower.TowerType,
  tower_type : String,
  cost : Int,
  upgrade2 : Int,
  upgrade_max : Int,
  description : String,
  tips : String,
  stats : Stats,
  attributes : Array[Attribute],
) -> TowerData {
  TowerData::{
    name,
    icon,
    tower_type,
    cost,
    upgrade2,
    upgrade_max,
    description,
    tips,
    stats,
    attributes,
  }
}

///|
/// Entity data structure (for enemies, characters, and neutrals)
pub(all) struct EntityData {
  name : String
  icon : String
  entity_type : String // "æ™®é€š", "å¿«é€Ÿ", "å¦å…‹", "é¦–é¢†", etc.
  intro : String
  tips : String
  attributes : Array[Attribute]
}

///|
pub(all) struct EnemiesData {
  name : String
  icon : @Enemy.EnemyType
  entity_type : String // "æ™®é€š", "å¿«é€Ÿ", "å¦å…‹", "é¦–é¢†", etc.
  intro : String
  tips : String
  attributes : Array[Attribute]
}

///|
pub(all) struct NeutralElementsData {
  name : String
  icon : @NeutralElement.NeutralElementType
  entity_type : String // "æ™®é€š", "å¿«é€Ÿ", "å¦å…‹", "é¦–é¢†", etc.
  intro : String
  tips : String
  attributes : Array[Attribute]
}

///|
pub fn NeutralElementsData::new(
  name : String,
  icon : @NeutralElement.NeutralElementType,
  entity_type : String,
  intro : String,
  tips : String,
  attributes : Array[Attribute],
) -> NeutralElementsData {
  NeutralElementsData::{ name, icon, entity_type, intro, tips, attributes }
}

///|
pub fn EnemiesData::new(
  name : String,
  icon : @Enemy.EnemyType,
  entity_type : String,
  intro : String,
  tips : String,
  attributes : Array[Attribute],
) -> EnemiesData {
  EnemiesData::{ name, icon, entity_type, intro, tips, attributes }
}

///|
pub(all) struct NeutralsData {
  name : String
  icon : @NeutralElement.NeutralElementType
  entity_type : String // "æ™®é€š", "å¿«é€Ÿ", "å¦å…‹", "é¦–é¢†", etc.
  intro : String
  tips : String
  attributes : Array[Attribute]
}

///|
/// Constructor for EntityData
pub fn EntityData::new(
  name : String,
  icon : String,
  entity_type : String,
  intro : String,
  tips : String,
  attributes : Array[Attribute],
) -> EntityData {
  EntityData::{ name, icon, entity_type, intro, tips, attributes }
}

///|
/// Main panel data structure containing all categories
pub(all) struct PanelData {
  towers : Array[TowerData] // ç‚®å¡”
  enemies : Array[EnemiesData] // æ•Œäºº
  neutrals : Array[NeutralElementsData] // ä¸­ç«‹
}

///|
/// Constructor for PanelData
pub fn PanelData::new(
  towers : Array[TowerData],
  enemies : Array[EnemiesData],
  neutrals : Array[NeutralElementsData],
) -> PanelData {
  PanelData::{ towers, enemies, neutrals }
}

///|
pub(all) struct MenuPanel {
  mut is_open : Bool
  mut x : Double
  mut y : Double
  mut w : Double
  mut h : Double
  // Button dimensions
  mut button_width : Double
  mut button_height : Double
  mut large_button_width : Double
  mut large_button_height : Double
  // Slider dimensions
  mut slider_width : Double
  mut slider_height : Double
  mut slider_y_offset : Double
  // Audio settings
  mut sound_volume : Double // 0-1
  mut music_volume : Double // 0-1
  mut dragging_sound_slider : Bool
  mut dragging_music_slider : Bool
  // Button positions
  mut exit_button_x : Double
  mut exit_button_y : Double
  mut help_button_x : Double
  mut help_button_y : Double
  mut restart_button_x : Double
  mut restart_button_y : Double
  mut continue_button_x : Double
  mut continue_button_y : Double
  mut sound_slider_x : Double
  mut sound_logo_x : Double
  mut music_slider_x : Double
  mut music_logo_x : Double
  mut slider_y : Double
  mut clear_cache_x : Double
  mut clear_cache_y : Double
  mut data : PanelData
  // help Panel
  mut show_help_Panel : Bool
}

///|
/// Constructor for MenuPanel
pub fn MenuPanel::new() -> MenuPanel {
  let w = 800.0
  let h = 600.0
  let x = (@Core.map.width - w) / 2.0
  let y = (@Core.map.height - h) / 2.0

  // Button dimensions
  let button_width = 60.0
  let button_height = 60.0
  let large_button_width = 400.0
  let large_button_height = 80.0

  // Slider dimensions
  let slider_width = 200.0
  let slider_height = 20.0
  let slider_y_offset = 120.0

  // Calculate button positions
  let button_gap = 80.0
  let total_button_width = 4.0 * button_width + 3.0 * button_gap
  let start_x = x + (w - total_button_width) / 2.0
  let exit_button_x = start_x
  let help_button_x = start_x + button_width + button_gap
  let restart_button_x = help_button_x + button_width + button_gap
  let clear_cache_x = restart_button_x + button_width + button_gap
  let exit_button_y = y + 250.0
  let help_button_y = y + 250.0
  let restart_button_y = y + 250.0
  let clear_cache_y = y + 250.0
  let continue_button_x = x + 200.0
  let continue_button_y = y + 400.0

  // Slider positions
  let sound_slider_x = x + 150.0
  let music_slider_x = x + 450.0
  let slider_y = y + 100.0

  // ä»Žæœ¬åœ°å­˜å‚¨åŠ è½½éŸ³é‡è®¾ç½®
  let saved_sound_volume = @Audio.get_sound_volume()
  // println("saved_sound_volume:\{saved_sound_volume}")
  let saved_music_volume = @Audio.get_music_volume()
  // println("saved_music_volume:\{saved_music_volume}")
  let parse_volume = fn(str : String) -> Double {

    // Simple string to double conversion for volume parsing
    if str == "0" {
      0.0
    } else if str == "0.1" {
      0.1
    } else if str == "0.2" {
      0.2
    } else if str == "0.3" {
      0.3
    } else if str == "0.4" {
      0.4
    } else if str == "0.5" {
      0.5
    } else if str == "0.6" {
      0.6
    } else if str == "0.7" {
      0.7
    } else if str == "0.8" {
      0.8
    } else if str == "0.9" {
      0.9
    } else if str == "1" {
      1.0
    } else {
      0.5
    } // default value
  }
  MenuPanel::{
    is_open: false,
    x,
    y,
    w,
    h,
    button_width,
    button_height,
    large_button_width,
    large_button_height,
    slider_width,
    slider_height,
    slider_y_offset,
    sound_volume: if saved_sound_volume != "" {
      parse_volume(saved_sound_volume)
    } else {
      0.5
    },
    music_volume: if saved_music_volume != "" {
      parse_volume(saved_music_volume)
    } else {
      0.5
    },
    dragging_sound_slider: false,
    dragging_music_slider: false,
    exit_button_x,
    exit_button_y,
    help_button_x,
    help_button_y,
    restart_button_x,
    restart_button_y,
    continue_button_x,
    continue_button_y,
    sound_slider_x,
    sound_logo_x: sound_slider_x,
    music_slider_x,
    music_logo_x: music_slider_x,
    slider_y,
    clear_cache_x,
    clear_cache_y,
    data: create_panel_data(1),
    show_help_Panel: false,
  }
}

///|
/// Singleton instance management
let menuPanelInstance : Ref[MenuPanel?] = Ref::new(None)

///|
pub let menuPanelSingleton : MenuPanel = MenuPanel::get_instance()

///|
pub fn MenuPanel::get_instance() -> MenuPanel {
  match menuPanelInstance.val {
    Some(panel) => panel
    None => {
      let new_instance = MenuPanel::new()
      menuPanelInstance.val = Some(new_instance)
      new_instance
    }
  }
}

///|
/// Open and close methods
pub fn MenuPanel::open(self : MenuPanel) -> Unit {
  self.is_open = true
}

///|
pub fn MenuPanel::close(self : MenuPanel) -> Unit {
  self.is_open = false
  self.dragging_sound_slider = false
  self.dragging_music_slider = false
  self.show_help_Panel = false
}

///|
pub fn MenuPanel::toggle(self : MenuPanel) -> Unit {
  if self.is_open {
    self.close()
  } else {
    self.open()
  }
}

///|
/// Volume control methods
pub fn MenuPanel::get_sound_volume(self : MenuPanel) -> Double {
  self.sound_volume
}

///|
pub fn MenuPanel::get_music_volume(self : MenuPanel) -> Double {
  self.music_volume
}

///|
pub fn MenuPanel::set_sound_volume(self : MenuPanel, volume : Double) -> Unit {
  self.sound_volume = @cmp.maximum(0.0, @cmp.minimum(1.0, volume))
  @Audio.set_sound_volume(self.sound_volume)
}

///|
pub fn MenuPanel::set_music_volume(self : MenuPanel, volume : Double) -> Unit {
  self.music_volume = @cmp.maximum(0.0, @cmp.minimum(1.0, volume))
  // åº”ç”¨éŸ³é‡åˆ°éŸ³é¢‘ç³»ç»Ÿ
  @Audio.set_music_volume(self.music_volume)
}

///|
/// Check if panel should handle input
pub fn MenuPanel::should_handle_input(self : MenuPanel) -> Bool {
  self.is_open
}

///|
/// Get panel bounds for rendering
pub fn MenuPanel::get_bounds(
  self : MenuPanel,
) -> (Double, Double, Double, Double) {
  (self.x, self.y, self.w, self.h)
}
