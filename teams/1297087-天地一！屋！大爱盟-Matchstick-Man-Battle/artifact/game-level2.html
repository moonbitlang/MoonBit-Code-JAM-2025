<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>我的游戏 - Level 2</title>

    <script type="text/javascript">const min = Math.min;</script>

    <!-- 保留旧项目的 jQuery（若其它脚本依赖） -->
    <script type="text/javascript" src="./lib/jquery-1.4.2.min.js" ></script>
    <script type="text/javascript">
    jQuery.noConflict();
    Object.extend = jQuery.extend;
    </script>
    <script src="lib/jquery.svg.min.js"></script>

    <link rel="stylesheet" href="./shared-ui.css">
    <script src="./assets/navigation.js"></script>
    <!-- 注意：不要在 head 中提前加载 p5 / box2d / game 脚本，
        它们会在 body 底部按正确顺序加载（p5 -> box2d -> game）以避免符号未定义或重复声明的问题。 -->
</head>

<body>
    <div class="top-controls">
        <button id="back-to-menu">返回菜单</button>
    </div>

    <!-- 主布局：左侧面板 + 中央游戏 + 右侧面板 -->
    <div id="game-layout">
        <!-- 左侧控制面板 -->
        <aside class="side-panel" id="left-panel">
            <section>
                <h3>🎵 音效控制</h3>
                <div class="control-item">
                    <label for="volume-slider">音量</label>
                    <input type="range" id="volume-slider" min="0" max="100" value="50">
                    <div class="volume-display" id="volume-display">50%</div>
                </div>
                <div class="control-item">
                    <label>
                        <input type="checkbox" id="mute-toggle" style="margin-right: 6px;">
                        静音
                    </label>
                </div>
            </section>
            
            <section>
                <h3>⚙️ 游戏设置</h3>
                <button class="btn btn-secondary" id="btn-instructions">📖 查看说明</button>
                <button class="btn btn-danger" id="btn-clear">🗑️ 清空记录</button>
                <button class="btn btn-secondary" id="btn-close">❌ 关闭</button>
            </section>
        </aside>

        <!-- 中央游戏区域 -->
        <div id="game-center">
            <!-- HUD：玩家状态面板（移到画布外部） -->
            <div id="hud" aria-live="polite">
            <div id="player-0" class="player-panel pp-left" role="region" aria-label="Player 0">
                <div class="avatar" id="p0-avatar">👤</div>
                <div class="meta">
                    <div class="name" id="p0-name">玩家 0</div>
                    <div class="sub hp"><div class="bar"><div class="fill" id="p0-hp-fill" style="width:100%"></div></div><div class="value" id="p0-hp-text">100/100</div></div>
                </div>
                <div style="margin-left:auto; text-align:right; display:flex; flex-direction:column; gap:6px;">
                    <div class="stat">弹药: <span id="p0-ammo">—</span></div>
                    <div class="stat">分数: <span id="p0-score">—</span></div>
                </div>
            </div>

            <div id="player-1" class="player-panel pp-right" role="region" aria-label="Player 1">
                <div style="display:flex; flex-direction:column; gap:6px; text-align:left;">
                    <div class="stat">分数: <span id="p1-score">—</span></div>
                    <div class="stat">弹药: <span id="p1-ammo">—</span></div>
                </div>
                <div style="margin-left:12px; text-align:left;" class="meta">
                    <div class="name" id="p1-name">玩家 1</div>
                    <div class="sub hp"><div class="bar"><div class="fill" id="p1-hp-fill" style="width:100%"></div></div><div class="value" id="p1-hp-text">100/100</div></div>
                </div>
                <div class="avatar" id="p1-avatar">🤖</div>
            </div>
        </div>

        <!-- Stage wrapper: 用于放置发光边框与粒子特效 -->
        <div id="stage-wrapper">
            <!-- 粒子动画层（canvas） -->
            <canvas id="fx-canvas" style="position:absolute;inset:0;width:100%;height:100%;pointer-events:none;z-index:0;display:block;"></canvas>
            <div class="scanlines" aria-hidden="true" style="z-index:4;"></div>
            <div id="fx-flash" aria-hidden="true" style="z-index:6;pointer-events:none;position:absolute;inset:0;opacity:0;transition:opacity 220ms ease;mix-blend-mode:screen;"></div>

            <!-- 游戏画布容器 -->
            <div id="game-container">
                <canvas id="canvas" style="display:block;" height="32" width="32"></canvas>
            </div>
        </div>
    </div>

    <!-- 右侧状态面板 -->
    <aside class="side-panel" id="right-panel">
        <section>
            <h3>🏆 游戏统计</h3>
            <div class="stat-item">
                <span class="stat-label">最高分</span>
                <span class="stat-value" id="high-score">9</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">最大连击</span>
                <span class="stat-value" id="max-combo">6</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">总局数</span>
                <span class="stat-value" id="total-games">0</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">胜率</span>
                <span class="stat-value" id="win-rate">0%</span>
            </div>
        </section>
        
        <section>
            <h3>📊 当前状态</h3>
            <div class="stat-item">
                <span class="stat-label">游戏时长</span>
                <span class="stat-value" id="game-time">0:00</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">本局击杀</span>
                <span class="stat-value" id="current-kills">0</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">连击数</span>
                <span class="stat-value" id="current-combo">0</span>
            </div>
        </section>
    </aside>
</div>

    <!-- 先加载运行时依赖（CDN），再加载本地构建的游戏脚本 -->
    <script src="./p5.js"></script>

    <!-- 使用本地 box2d.js（替代被阻止的 CDN 版本） -->
    <script src="./box2d.js"></script>

    <!-- 运行时检测（如果 Box2D 未定义，打印警告） -->
    <script src="./target/js/release/build/game-level2/game-level2.js"></script>
    <script src="./auto_hooks/level2_runtime_hook.js"></script>
    <script src="./shared-ui.js"></script>
</body>

</html>