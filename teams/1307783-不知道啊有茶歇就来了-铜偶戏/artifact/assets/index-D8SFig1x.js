import{T as Wh,a as Gl,b as hd,L as gd,c as tr,F as Ma,M as Ls,V as $n,C as ls,d as Cs,S as nn,e as Kh,P as hi,D as vs,f as Uo,g as Be,I as bd,Q as Li,h as Jh,O as yd,i as Ii,j as Xh,B as nr,k as Yh,l as wd,N as Zh,m as Qh,n as e0,o as Rl,p as vd,R as Vs,q as t0,r as n0,s as s0,t as sl,u as o0,v as Ut,w as Cn,x as Bt,y as i0,z as Sd,A as r0,E as Mt,G as a0,H as c0,J as l0,K as u0,U as ss,W as Nr,X as kd,Y as _0,Z as $0,_ as d0,$ as p0,a0 as m0,a1 as Md,a2 as f0,a3 as v_,a4 as S_,a5 as k_,a6 as M_,a7 as Ol,a8 as h0,a9 as g0,aa as pn,ab as b0,ac as y0,ad as bs,ae as ec,af as tc,ag as nc,ah as w0,ai as v0,aj as bi,ak as gi,al as C_,am as S0,an as Cd,ao as fr,ap as Dl,aq as Ca,ar as k0,as as M0,at as C0,au as x0,av as x_,aw as Nl,ax as P0,ay as P_}from"./three-DALeLLf3.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&o(r)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();const L0="release";function f(...e){switch(L0){case"debug":console.log(...e);break}}/**
* @vue/shared v3.5.22
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function wu(e){const t=Object.create(null);for(const n of e.split(","))t[n]=1;return n=>n in t}const ft={},yi=[],is=()=>{},xd=()=>!1,sc=e=>e.charCodeAt(0)===111&&e.charCodeAt(1)===110&&(e.charCodeAt(2)>122||e.charCodeAt(2)<97),vu=e=>e.startsWith("onUpdate:"),Xt=Object.assign,Su=(e,t)=>{const n=e.indexOf(t);n>-1&&e.splice(n,1)},I0=Object.prototype.hasOwnProperty,at=(e,t)=>I0.call(e,t),De=Array.isArray,wi=e=>oc(e)==="[object Map]",Pd=e=>oc(e)==="[object Set]",ze=e=>typeof e=="function",At=e=>typeof e=="string",ko=e=>typeof e=="symbol",kt=e=>e!==null&&typeof e=="object",Ld=e=>(kt(e)||ze(e))&&ze(e.then)&&ze(e.catch),Id=Object.prototype.toString,oc=e=>Id.call(e),T0=e=>oc(e).slice(8,-1),Td=e=>oc(e)==="[object Object]",ku=e=>At(e)&&e!=="NaN"&&e[0]!=="-"&&""+parseInt(e,10)===e,sr=wu(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),ic=e=>{const t=Object.create(null);return n=>t[n]||(t[n]=e(n))},E0=/-\w/g,fo=ic(e=>e.replace(E0,t=>t.slice(1).toUpperCase())),A0=/\B([A-Z])/g,Qo=ic(e=>e.replace(A0,"-$1").toLowerCase()),Ed=ic(e=>e.charAt(0).toUpperCase()+e.slice(1)),ol=ic(e=>e?`on${Ed(e)}`:""),uo=(e,t)=>!Object.is(e,t),il=(e,...t)=>{for(let n=0;n<e.length;n++)e[n](...t)},Ad=(e,t,n,o=!1)=>{Object.defineProperty(e,t,{configurable:!0,enumerable:!1,writable:o,value:n})},G0=e=>{const t=parseFloat(e);return isNaN(t)?e:t},R0=e=>{const t=At(e)?Number(e):NaN;return isNaN(t)?e:t};let L_;const rc=()=>L_||(L_=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function zn(e){if(De(e)){const t={};for(let n=0;n<e.length;n++){const o=e[n],s=At(o)?j0(o):zn(o);if(s)for(const i in s)t[i]=s[i]}return t}else if(At(e)||kt(e))return e}const O0=/;(?![^(]*\))/g,D0=/:([^]+)/,N0=/\/\*[^]*?\*\//g;function j0(e){const t={};return e.replace(N0,"").split(O0).forEach(n=>{if(n){const o=n.split(D0);o.length>1&&(t[o[0].trim()]=o[1].trim())}}),t}function St(e){let t="";if(At(e))t=e;else if(De(e))for(let n=0;n<e.length;n++){const o=St(e[n]);o&&(t+=o+" ")}else if(kt(e))for(const n in e)e[n]&&(t+=n+" ");return t.trim()}const H0="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",F0=wu(H0);function Gd(e){return!!e||e===""}const Rd=e=>!!(e&&e.__v_isRef===!0),ae=e=>At(e)?e:e==null?"":De(e)||kt(e)&&(e.toString===Id||!ze(e.toString))?Rd(e)?ae(e.value):JSON.stringify(e,Od,2):String(e),Od=(e,t)=>Rd(t)?Od(e,t.value):wi(t)?{[`Map(${t.size})`]:[...t.entries()].reduce((n,[o,s],i)=>(n[rl(o,i)+" =>"]=s,n),{})}:Pd(t)?{[`Set(${t.size})`]:[...t.values()].map(n=>rl(n))}:ko(t)?rl(t):kt(t)&&!De(t)&&!Td(t)?String(t):t,rl=(e,t="")=>{var n;return ko(e)?`Symbol(${(n=e.description)!=null?n:t})`:e};function U0(e){return e==null?"initial":typeof e=="string"?e===""?" ":e:String(e)}/**
* @vue/reactivity v3.5.22
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let vn;class B0{constructor(t=!1){this.detached=t,this._active=!0,this._on=0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=vn,!t&&vn&&(this.index=(vn.scopes||(vn.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let t,n;if(this.scopes)for(t=0,n=this.scopes.length;t<n;t++)this.scopes[t].pause();for(t=0,n=this.effects.length;t<n;t++)this.effects[t].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let t,n;if(this.scopes)for(t=0,n=this.scopes.length;t<n;t++)this.scopes[t].resume();for(t=0,n=this.effects.length;t<n;t++)this.effects[t].resume()}}run(t){if(this._active){const n=vn;try{return vn=this,t()}finally{vn=n}}}on(){++this._on===1&&(this.prevScope=vn,vn=this)}off(){this._on>0&&--this._on===0&&(vn=this.prevScope,this.prevScope=void 0)}stop(t){if(this._active){this._active=!1;let n,o;for(n=0,o=this.effects.length;n<o;n++)this.effects[n].stop();for(this.effects.length=0,n=0,o=this.cleanups.length;n<o;n++)this.cleanups[n]();if(this.cleanups.length=0,this.scopes){for(n=0,o=this.scopes.length;n<o;n++)this.scopes[n].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!t){const s=this.parent.scopes.pop();s&&s!==this&&(this.parent.scopes[this.index]=s,s.index=this.index)}this.parent=void 0}}}function z0(){return vn}let yt;const al=new WeakSet;class Dd{constructor(t){this.fn=t,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,vn&&vn.active&&vn.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,al.has(this)&&(al.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||jd(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,I_(this),Hd(this);const t=yt,n=rs;yt=this,rs=!0;try{return this.fn()}finally{Fd(this),yt=t,rs=n,this.flags&=-3}}stop(){if(this.flags&1){for(let t=this.deps;t;t=t.nextDep)xu(t);this.deps=this.depsTail=void 0,I_(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?al.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){jl(this)&&this.run()}get dirty(){return jl(this)}}let Nd=0,or,ir;function jd(e,t=!1){if(e.flags|=8,t){e.next=ir,ir=e;return}e.next=or,or=e}function Mu(){Nd++}function Cu(){if(--Nd>0)return;if(ir){let t=ir;for(ir=void 0;t;){const n=t.next;t.next=void 0,t.flags&=-9,t=n}}let e;for(;or;){let t=or;for(or=void 0;t;){const n=t.next;if(t.next=void 0,t.flags&=-9,t.flags&1)try{t.trigger()}catch(o){e||(e=o)}t=n}}if(e)throw e}function Hd(e){for(let t=e.deps;t;t=t.nextDep)t.version=-1,t.prevActiveLink=t.dep.activeLink,t.dep.activeLink=t}function Fd(e){let t,n=e.depsTail,o=n;for(;o;){const s=o.prevDep;o.version===-1?(o===n&&(n=s),xu(o),V0(o)):t=o,o.dep.activeLink=o.prevActiveLink,o.prevActiveLink=void 0,o=s}e.deps=t,e.depsTail=n}function jl(e){for(let t=e.deps;t;t=t.nextDep)if(t.dep.version!==t.version||t.dep.computed&&(Ud(t.dep.computed)||t.dep.version!==t.version))return!0;return!!e._dirty}function Ud(e){if(e.flags&4&&!(e.flags&16)||(e.flags&=-17,e.globalVersion===hr)||(e.globalVersion=hr,!e.isSSR&&e.flags&128&&(!e.deps&&!e._dirty||!jl(e))))return;e.flags|=2;const t=e.dep,n=yt,o=rs;yt=e,rs=!0;try{Hd(e);const s=e.fn(e._value);(t.version===0||uo(s,e._value))&&(e.flags|=128,e._value=s,t.version++)}catch(s){throw t.version++,s}finally{yt=n,rs=o,Fd(e),e.flags&=-3}}function xu(e,t=!1){const{dep:n,prevSub:o,nextSub:s}=e;if(o&&(o.nextSub=s,e.prevSub=void 0),s&&(s.prevSub=o,e.nextSub=void 0),n.subs===e&&(n.subs=o,!o&&n.computed)){n.computed.flags&=-5;for(let i=n.computed.deps;i;i=i.nextDep)xu(i,!0)}!t&&!--n.sc&&n.map&&n.map.delete(n.key)}function V0(e){const{prevDep:t,nextDep:n}=e;t&&(t.nextDep=n,e.prevDep=void 0),n&&(n.prevDep=t,e.nextDep=void 0)}let rs=!0;const Bd=[];function qs(){Bd.push(rs),rs=!1}function Ws(){const e=Bd.pop();rs=e===void 0?!0:e}function I_(e){const{cleanup:t}=e;if(e.cleanup=void 0,t){const n=yt;yt=void 0;try{t()}finally{yt=n}}}let hr=0;class q0{constructor(t,n){this.sub=t,this.dep=n,this.version=n.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class Pu{constructor(t){this.computed=t,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0,this.__v_skip=!0}track(t){if(!yt||!rs||yt===this.computed)return;let n=this.activeLink;if(n===void 0||n.sub!==yt)n=this.activeLink=new q0(yt,this),yt.deps?(n.prevDep=yt.depsTail,yt.depsTail.nextDep=n,yt.depsTail=n):yt.deps=yt.depsTail=n,zd(n);else if(n.version===-1&&(n.version=this.version,n.nextDep)){const o=n.nextDep;o.prevDep=n.prevDep,n.prevDep&&(n.prevDep.nextDep=o),n.prevDep=yt.depsTail,n.nextDep=void 0,yt.depsTail.nextDep=n,yt.depsTail=n,yt.deps===n&&(yt.deps=o)}return n}trigger(t){this.version++,hr++,this.notify(t)}notify(t){Mu();try{for(let n=this.subs;n;n=n.prevSub)n.sub.notify()&&n.sub.dep.notify()}finally{Cu()}}}function zd(e){if(e.dep.sc++,e.sub.flags&4){const t=e.dep.computed;if(t&&!e.dep.subs){t.flags|=20;for(let o=t.deps;o;o=o.nextDep)zd(o)}const n=e.dep.subs;n!==e&&(e.prevSub=n,n&&(n.nextSub=e)),e.dep.subs=e}}const Hl=new WeakMap,Bo=Symbol(""),Fl=Symbol(""),gr=Symbol("");function tn(e,t,n){if(rs&&yt){let o=Hl.get(e);o||Hl.set(e,o=new Map);let s=o.get(n);s||(o.set(n,s=new Pu),s.map=o,s.key=n),s.track()}}function Fs(e,t,n,o,s,i){const r=Hl.get(e);if(!r){hr++;return}const a=c=>{c&&c.trigger()};if(Mu(),t==="clear")r.forEach(a);else{const c=De(e),l=c&&ku(n);if(c&&n==="length"){const u=Number(o);r.forEach((_,$)=>{($==="length"||$===gr||!ko($)&&$>=u)&&a(_)})}else switch((n!==void 0||r.has(void 0))&&a(r.get(n)),l&&a(r.get(gr)),t){case"add":c?l&&a(r.get("length")):(a(r.get(Bo)),wi(e)&&a(r.get(Fl)));break;case"delete":c||(a(r.get(Bo)),wi(e)&&a(r.get(Fl)));break;case"set":wi(e)&&a(r.get(Bo));break}}Cu()}function ci(e){const t=it(e);return t===e?t:(tn(t,"iterate",gr),Yn(e)?t:t.map(Jt))}function ac(e){return tn(e=it(e),"iterate",gr),e}const W0={__proto__:null,[Symbol.iterator](){return cl(this,Symbol.iterator,Jt)},concat(...e){return ci(this).concat(...e.map(t=>De(t)?ci(t):t))},entries(){return cl(this,"entries",e=>(e[1]=Jt(e[1]),e))},every(e,t){return Ds(this,"every",e,t,void 0,arguments)},filter(e,t){return Ds(this,"filter",e,t,n=>n.map(Jt),arguments)},find(e,t){return Ds(this,"find",e,t,Jt,arguments)},findIndex(e,t){return Ds(this,"findIndex",e,t,void 0,arguments)},findLast(e,t){return Ds(this,"findLast",e,t,Jt,arguments)},findLastIndex(e,t){return Ds(this,"findLastIndex",e,t,void 0,arguments)},forEach(e,t){return Ds(this,"forEach",e,t,void 0,arguments)},includes(...e){return ll(this,"includes",e)},indexOf(...e){return ll(this,"indexOf",e)},join(e){return ci(this).join(e)},lastIndexOf(...e){return ll(this,"lastIndexOf",e)},map(e,t){return Ds(this,"map",e,t,void 0,arguments)},pop(){return Fi(this,"pop")},push(...e){return Fi(this,"push",e)},reduce(e,...t){return T_(this,"reduce",e,t)},reduceRight(e,...t){return T_(this,"reduceRight",e,t)},shift(){return Fi(this,"shift")},some(e,t){return Ds(this,"some",e,t,void 0,arguments)},splice(...e){return Fi(this,"splice",e)},toReversed(){return ci(this).toReversed()},toSorted(e){return ci(this).toSorted(e)},toSpliced(...e){return ci(this).toSpliced(...e)},unshift(...e){return Fi(this,"unshift",e)},values(){return cl(this,"values",Jt)}};function cl(e,t,n){const o=ac(e),s=o[t]();return o!==e&&!Yn(e)&&(s._next=s.next,s.next=()=>{const i=s._next();return i.done||(i.value=n(i.value)),i}),s}const K0=Array.prototype;function Ds(e,t,n,o,s,i){const r=ac(e),a=r!==e&&!Yn(e),c=r[t];if(c!==K0[t]){const _=c.apply(e,i);return a?Jt(_):_}let l=n;r!==e&&(a?l=function(_,$){return n.call(this,Jt(_),$,e)}:n.length>2&&(l=function(_,$){return n.call(this,_,$,e)}));const u=c.call(r,l,o);return a&&s?s(u):u}function T_(e,t,n,o){const s=ac(e);let i=n;return s!==e&&(Yn(e)?n.length>3&&(i=function(r,a,c){return n.call(this,r,a,c,e)}):i=function(r,a,c){return n.call(this,r,Jt(a),c,e)}),s[t](i,...o)}function ll(e,t,n){const o=it(e);tn(o,"iterate",gr);const s=o[t](...n);return(s===-1||s===!1)&&Eu(n[0])?(n[0]=it(n[0]),o[t](...n)):s}function Fi(e,t,n=[]){qs(),Mu();const o=it(e)[t].apply(e,n);return Cu(),Ws(),o}const J0=wu("__proto__,__v_isRef,__isVue"),Vd=new Set(Object.getOwnPropertyNames(Symbol).filter(e=>e!=="arguments"&&e!=="caller").map(e=>Symbol[e]).filter(ko));function X0(e){ko(e)||(e=String(e));const t=it(this);return tn(t,"has",e),t.hasOwnProperty(e)}class qd{constructor(t=!1,n=!1){this._isReadonly=t,this._isShallow=n}get(t,n,o){if(n==="__v_skip")return t.__v_skip;const s=this._isReadonly,i=this._isShallow;if(n==="__v_isReactive")return!s;if(n==="__v_isReadonly")return s;if(n==="__v_isShallow")return i;if(n==="__v_raw")return o===(s?i?rg:Xd:i?Jd:Kd).get(t)||Object.getPrototypeOf(t)===Object.getPrototypeOf(o)?t:void 0;const r=De(t);if(!s){let c;if(r&&(c=W0[n]))return c;if(n==="hasOwnProperty")return X0}const a=Reflect.get(t,n,ln(t)?t:o);if((ko(n)?Vd.has(n):J0(n))||(s||tn(t,"get",n),i))return a;if(ln(a)){const c=r&&ku(n)?a:a.value;return s&&kt(c)?Bl(c):c}return kt(a)?s?Bl(a):Iu(a):a}}class Wd extends qd{constructor(t=!1){super(!1,t)}set(t,n,o,s){let i=t[n];if(!this._isShallow){const c=ho(i);if(!Yn(o)&&!ho(o)&&(i=it(i),o=it(o)),!De(t)&&ln(i)&&!ln(o))return c||(i.value=o),!0}const r=De(t)&&ku(n)?Number(n)<t.length:at(t,n),a=Reflect.set(t,n,o,ln(t)?t:s);return t===it(s)&&(r?uo(o,i)&&Fs(t,"set",n,o):Fs(t,"add",n,o)),a}deleteProperty(t,n){const o=at(t,n);t[n];const s=Reflect.deleteProperty(t,n);return s&&o&&Fs(t,"delete",n,void 0),s}has(t,n){const o=Reflect.has(t,n);return(!ko(n)||!Vd.has(n))&&tn(t,"has",n),o}ownKeys(t){return tn(t,"iterate",De(t)?"length":Bo),Reflect.ownKeys(t)}}class Y0 extends qd{constructor(t=!1){super(!0,t)}set(t,n){return!0}deleteProperty(t,n){return!0}}const Z0=new Wd,Q0=new Y0,eg=new Wd(!0);const Ul=e=>e,Yr=e=>Reflect.getPrototypeOf(e);function tg(e,t,n){return function(...o){const s=this.__v_raw,i=it(s),r=wi(i),a=e==="entries"||e===Symbol.iterator&&r,c=e==="keys"&&r,l=s[e](...o),u=n?Ul:t?xa:Jt;return!t&&tn(i,"iterate",c?Fl:Bo),{next(){const{value:_,done:$}=l.next();return $?{value:_,done:$}:{value:a?[u(_[0]),u(_[1])]:u(_),done:$}},[Symbol.iterator](){return this}}}}function Zr(e){return function(...t){return e==="delete"?!1:e==="clear"?void 0:this}}function ng(e,t){const n={get(s){const i=this.__v_raw,r=it(i),a=it(s);e||(uo(s,a)&&tn(r,"get",s),tn(r,"get",a));const{has:c}=Yr(r),l=t?Ul:e?xa:Jt;if(c.call(r,s))return l(i.get(s));if(c.call(r,a))return l(i.get(a));i!==r&&i.get(s)},get size(){const s=this.__v_raw;return!e&&tn(it(s),"iterate",Bo),s.size},has(s){const i=this.__v_raw,r=it(i),a=it(s);return e||(uo(s,a)&&tn(r,"has",s),tn(r,"has",a)),s===a?i.has(s):i.has(s)||i.has(a)},forEach(s,i){const r=this,a=r.__v_raw,c=it(a),l=t?Ul:e?xa:Jt;return!e&&tn(c,"iterate",Bo),a.forEach((u,_)=>s.call(i,l(u),l(_),r))}};return Xt(n,e?{add:Zr("add"),set:Zr("set"),delete:Zr("delete"),clear:Zr("clear")}:{add(s){!t&&!Yn(s)&&!ho(s)&&(s=it(s));const i=it(this);return Yr(i).has.call(i,s)||(i.add(s),Fs(i,"add",s,s)),this},set(s,i){!t&&!Yn(i)&&!ho(i)&&(i=it(i));const r=it(this),{has:a,get:c}=Yr(r);let l=a.call(r,s);l||(s=it(s),l=a.call(r,s));const u=c.call(r,s);return r.set(s,i),l?uo(i,u)&&Fs(r,"set",s,i):Fs(r,"add",s,i),this},delete(s){const i=it(this),{has:r,get:a}=Yr(i);let c=r.call(i,s);c||(s=it(s),c=r.call(i,s)),a&&a.call(i,s);const l=i.delete(s);return c&&Fs(i,"delete",s,void 0),l},clear(){const s=it(this),i=s.size!==0,r=s.clear();return i&&Fs(s,"clear",void 0,void 0),r}}),["keys","values","entries",Symbol.iterator].forEach(s=>{n[s]=tg(s,e,t)}),n}function Lu(e,t){const n=ng(e,t);return(o,s,i)=>s==="__v_isReactive"?!e:s==="__v_isReadonly"?e:s==="__v_raw"?o:Reflect.get(at(n,s)&&s in o?n:o,s,i)}const sg={get:Lu(!1,!1)},og={get:Lu(!1,!0)},ig={get:Lu(!0,!1)};const Kd=new WeakMap,Jd=new WeakMap,Xd=new WeakMap,rg=new WeakMap;function ag(e){switch(e){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function cg(e){return e.__v_skip||!Object.isExtensible(e)?0:ag(T0(e))}function Iu(e){return ho(e)?e:Tu(e,!1,Z0,sg,Kd)}function lg(e){return Tu(e,!1,eg,og,Jd)}function Bl(e){return Tu(e,!0,Q0,ig,Xd)}function Tu(e,t,n,o,s){if(!kt(e)||e.__v_raw&&!(t&&e.__v_isReactive))return e;const i=cg(e);if(i===0)return e;const r=s.get(e);if(r)return r;const a=new Proxy(e,i===2?o:n);return s.set(e,a),a}function vi(e){return ho(e)?vi(e.__v_raw):!!(e&&e.__v_isReactive)}function ho(e){return!!(e&&e.__v_isReadonly)}function Yn(e){return!!(e&&e.__v_isShallow)}function Eu(e){return e?!!e.__v_raw:!1}function it(e){const t=e&&e.__v_raw;return t?it(t):e}function ug(e){return!at(e,"__v_skip")&&Object.isExtensible(e)&&Ad(e,"__v_skip",!0),e}const Jt=e=>kt(e)?Iu(e):e,xa=e=>kt(e)?Bl(e):e;function ln(e){return e?e.__v_isRef===!0:!1}function se(e){return _g(e,!1)}function _g(e,t){return ln(e)?e:new $g(e,t)}class $g{constructor(t,n){this.dep=new Pu,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=n?t:it(t),this._value=n?t:Jt(t),this.__v_isShallow=n}get value(){return this.dep.track(),this._value}set value(t){const n=this._rawValue,o=this.__v_isShallow||Yn(t)||ho(t);t=o?t:it(t),uo(t,n)&&(this._rawValue=t,this._value=o?t:Jt(t),this.dep.trigger())}}function we(e){return ln(e)?e.value:e}const dg={get:(e,t,n)=>t==="__v_raw"?e:we(Reflect.get(e,t,n)),set:(e,t,n,o)=>{const s=e[t];return ln(s)&&!ln(n)?(s.value=n,!0):Reflect.set(e,t,n,o)}};function Yd(e){return vi(e)?e:new Proxy(e,dg)}class pg{constructor(t,n,o){this.fn=t,this.setter=n,this._value=void 0,this.dep=new Pu(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=hr-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!n,this.isSSR=o}notify(){if(this.flags|=16,!(this.flags&8)&&yt!==this)return jd(this,!0),!0}get value(){const t=this.dep.track();return Ud(this),t&&(t.version=this.dep.version),this._value}set value(t){this.setter&&this.setter(t)}}function mg(e,t,n=!1){let o,s;return ze(e)?o=e:(o=e.get,s=e.set),new pg(o,s,n)}const Qr={},Pa=new WeakMap;let Ao;function fg(e,t=!1,n=Ao){if(n){let o=Pa.get(n);o||Pa.set(n,o=[]),o.push(e)}}function hg(e,t,n=ft){const{immediate:o,deep:s,once:i,scheduler:r,augmentJob:a,call:c}=n,l=w=>s?w:Yn(w)||s===!1||s===0?Us(w,1):Us(w);let u,_,$,d,p=!1,b=!1;if(ln(e)?(_=()=>e.value,p=Yn(e)):vi(e)?(_=()=>l(e),p=!0):De(e)?(b=!0,p=e.some(w=>vi(w)||Yn(w)),_=()=>e.map(w=>{if(ln(w))return w.value;if(vi(w))return l(w);if(ze(w))return c?c(w,2):w()})):ze(e)?t?_=c?()=>c(e,2):e:_=()=>{if($){qs();try{$()}finally{Ws()}}const w=Ao;Ao=u;try{return c?c(e,3,[d]):e(d)}finally{Ao=w}}:_=is,t&&s){const w=_,k=s===!0?1/0:s;_=()=>Us(w(),k)}const g=z0(),m=()=>{u.stop(),g&&g.active&&Su(g.effects,u)};if(i&&t){const w=t;t=(...k)=>{w(...k),m()}}let v=b?new Array(e.length).fill(Qr):Qr;const y=w=>{if(!(!(u.flags&1)||!u.dirty&&!w))if(t){const k=u.run();if(s||p||(b?k.some((L,P)=>uo(L,v[P])):uo(k,v))){$&&$();const L=Ao;Ao=u;try{const P=[k,v===Qr?void 0:b&&v[0]===Qr?[]:v,d];v=k,c?c(t,3,P):t(...P)}finally{Ao=L}}}else u.run()};return a&&a(y),u=new Dd(_),u.scheduler=r?()=>r(y,!1):y,d=w=>fg(w,!1,u),$=u.onStop=()=>{const w=Pa.get(u);if(w){if(c)c(w,4);else for(const k of w)k();Pa.delete(u)}},t?o?y(!0):v=u.run():r?r(y.bind(null,!0),!0):u.run(),m.pause=u.pause.bind(u),m.resume=u.resume.bind(u),m.stop=m,m}function Us(e,t=1/0,n){if(t<=0||!kt(e)||e.__v_skip||(n=n||new Map,(n.get(e)||0)>=t))return e;if(n.set(e,t),t--,ln(e))Us(e.value,t,n);else if(De(e))for(let o=0;o<e.length;o++)Us(e[o],t,n);else if(Pd(e)||wi(e))e.forEach(o=>{Us(o,t,n)});else if(Td(e)){for(const o in e)Us(e[o],t,n);for(const o of Object.getOwnPropertySymbols(e))Object.prototype.propertyIsEnumerable.call(e,o)&&Us(e[o],t,n)}return e}/**
* @vue/runtime-core v3.5.22
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function jr(e,t,n,o){try{return o?e(...o):e()}catch(s){cc(s,t,n)}}function us(e,t,n,o){if(ze(e)){const s=jr(e,t,n,o);return s&&Ld(s)&&s.catch(i=>{cc(i,t,n)}),s}if(De(e)){const s=[];for(let i=0;i<e.length;i++)s.push(us(e[i],t,n,o));return s}}function cc(e,t,n,o=!0){const s=t?t.vnode:null,{errorHandler:i,throwUnhandledErrorInProduction:r}=t&&t.appContext.config||ft;if(t){let a=t.parent;const c=t.proxy,l=`https://vuejs.org/error-reference/#runtime-${n}`;for(;a;){const u=a.ec;if(u){for(let _=0;_<u.length;_++)if(u[_](e,c,l)===!1)return}a=a.parent}if(i){qs(),jr(i,null,10,[e,c,l]),Ws();return}}gg(e,n,s,o,r)}function gg(e,t,n,o=!0,s=!1){if(s)throw e;console.error(e)}const mn=[];let hs=-1;const Si=[];let to=null,$i=0;const Zd=Promise.resolve();let La=null;function br(e){const t=La||Zd;return e?t.then(this?e.bind(this):e):t}function bg(e){let t=hs+1,n=mn.length;for(;t<n;){const o=t+n>>>1,s=mn[o],i=yr(s);i<e||i===e&&s.flags&2?t=o+1:n=o}return t}function Au(e){if(!(e.flags&1)){const t=yr(e),n=mn[mn.length-1];!n||!(e.flags&2)&&t>=yr(n)?mn.push(e):mn.splice(bg(t),0,e),e.flags|=1,Qd()}}function Qd(){La||(La=Zd.then(np))}function ep(e){De(e)?Si.push(...e):to&&e.id===-1?to.splice($i+1,0,e):e.flags&1||(Si.push(e),e.flags|=1),Qd()}function E_(e,t,n=hs+1){for(;n<mn.length;n++){const o=mn[n];if(o&&o.flags&2){if(e&&o.id!==e.uid)continue;mn.splice(n,1),n--,o.flags&4&&(o.flags&=-2),o(),o.flags&4||(o.flags&=-2)}}}function tp(e){if(Si.length){const t=[...new Set(Si)].sort((n,o)=>yr(n)-yr(o));if(Si.length=0,to){to.push(...t);return}for(to=t,$i=0;$i<to.length;$i++){const n=to[$i];n.flags&4&&(n.flags&=-2),n.flags&8||n(),n.flags&=-2}to=null,$i=0}}const yr=e=>e.id==null?e.flags&2?-1:1/0:e.id;function np(e){try{for(hs=0;hs<mn.length;hs++){const t=mn[hs];t&&!(t.flags&8)&&(t.flags&4&&(t.flags&=-2),jr(t,t.i,t.i?15:14),t.flags&4||(t.flags&=-2))}}finally{for(;hs<mn.length;hs++){const t=mn[hs];t&&(t.flags&=-2)}hs=-1,mn.length=0,tp(),La=null,(mn.length||Si.length)&&np()}}let Wn=null,sp=null;function Ia(e){const t=Wn;return Wn=e,sp=e&&e.type.__scopeId||null,t}function op(e,t=Wn,n){if(!t||e._n)return e;const o=(...s)=>{o._d&&Aa(-1);const i=Ia(t);let r;try{r=e(...s)}finally{Ia(i),o._d&&Aa(1)}return r};return o._n=!0,o._c=!0,o._d=!0,o}function ip(e,t){if(Wn===null)return e;const n=dc(Wn),o=e.dirs||(e.dirs=[]);for(let s=0;s<t.length;s++){let[i,r,a,c=ft]=t[s];i&&(ze(i)&&(i={mounted:i,updated:i}),i.deep&&Us(r),o.push({dir:i,instance:n,value:r,oldValue:void 0,arg:a,modifiers:c}))}return e}function xo(e,t,n,o){const s=e.dirs,i=t&&t.dirs;for(let r=0;r<s.length;r++){const a=s[r];i&&(a.oldValue=i[r].value);let c=a.dir[o];c&&(qs(),us(c,n,8,[e.el,a,e,t]),Ws())}}const rp=Symbol("_vte"),ap=e=>e.__isTeleport,rr=e=>e&&(e.disabled||e.disabled===""),A_=e=>e&&(e.defer||e.defer===""),G_=e=>typeof SVGElement<"u"&&e instanceof SVGElement,R_=e=>typeof MathMLElement=="function"&&e instanceof MathMLElement,zl=(e,t)=>{const n=e&&e.to;return At(n)?t?t(n):null:n},cp={name:"Teleport",__isTeleport:!0,process(e,t,n,o,s,i,r,a,c,l){const{mc:u,pc:_,pbc:$,o:{insert:d,querySelector:p,createText:b,createComment:g}}=l,m=rr(t.props);let{shapeFlag:v,children:y,dynamicChildren:w}=t;if(e==null){const k=t.el=b(""),L=t.anchor=b("");d(k,n,o),d(L,n,o);const P=(I,U)=>{v&16&&u(y,I,U,s,i,r,a,c)},G=()=>{const I=t.target=zl(t.props,p),U=up(I,t,b,d);I&&(r!=="svg"&&G_(I)?r="svg":r!=="mathml"&&R_(I)&&(r="mathml"),s&&s.isCE&&(s.ce._teleportTargets||(s.ce._teleportTargets=new Set)).add(I),m||(P(I,U),da(t,!1)))};m&&(P(n,L),da(t,!0)),A_(t.props)?(t.el.__isMounted=!1,dn(()=>{G(),delete t.el.__isMounted},i)):G()}else{if(A_(t.props)&&e.el.__isMounted===!1){dn(()=>{cp.process(e,t,n,o,s,i,r,a,c,l)},i);return}t.el=e.el,t.targetStart=e.targetStart;const k=t.anchor=e.anchor,L=t.target=e.target,P=t.targetAnchor=e.targetAnchor,G=rr(e.props),I=G?n:L,U=G?k:P;if(r==="svg"||G_(L)?r="svg":(r==="mathml"||R_(L))&&(r="mathml"),w?($(e.dynamicChildren,w,I,s,i,r,a),Du(e,t,!0)):c||_(e,t,I,U,s,i,r,a,!1),m)G?t.props&&e.props&&t.props.to!==e.props.to&&(t.props.to=e.props.to):ea(t,n,k,l,1);else if((t.props&&t.props.to)!==(e.props&&e.props.to)){const R=t.target=zl(t.props,p);R&&ea(t,R,null,l,0)}else G&&ea(t,L,P,l,1);da(t,m)}},remove(e,t,n,{um:o,o:{remove:s}},i){const{shapeFlag:r,children:a,anchor:c,targetStart:l,targetAnchor:u,target:_,props:$}=e;if(_&&(s(l),s(u)),i&&s(c),r&16){const d=i||!rr($);for(let p=0;p<a.length;p++){const b=a[p];o(b,t,n,d,!!b.dynamicChildren)}}},move:ea,hydrate:yg};function ea(e,t,n,{o:{insert:o},m:s},i=2){i===0&&o(e.targetAnchor,t,n);const{el:r,anchor:a,shapeFlag:c,children:l,props:u}=e,_=i===2;if(_&&o(r,t,n),(!_||rr(u))&&c&16)for(let $=0;$<l.length;$++)s(l[$],t,n,2);_&&o(a,t,n)}function yg(e,t,n,o,s,i,{o:{nextSibling:r,parentNode:a,querySelector:c,insert:l,createText:u}},_){function $(b,g,m,v){g.anchor=_(r(b),g,a(b),n,o,s,i),g.targetStart=m,g.targetAnchor=v}const d=t.target=zl(t.props,c),p=rr(t.props);if(d){const b=d._lpa||d.firstChild;if(t.shapeFlag&16)if(p)$(e,t,b,b&&r(b));else{t.anchor=r(e);let g=b;for(;g;){if(g&&g.nodeType===8){if(g.data==="teleport start anchor")t.targetStart=g;else if(g.data==="teleport anchor"){t.targetAnchor=g,d._lpa=t.targetAnchor&&r(t.targetAnchor);break}}g=r(g)}t.targetAnchor||up(d,t,u,l),_(b&&r(b),t,d,n,o,s,i)}da(t,p)}else p&&t.shapeFlag&16&&$(e,t,e,r(e));return t.anchor&&r(t.anchor)}const lp=cp;function da(e,t){const n=e.ctx;if(n&&n.ut){let o,s;for(t?(o=e.el,s=e.anchor):(o=e.targetStart,s=e.targetAnchor);o&&o!==s;)o.nodeType===1&&o.setAttribute("data-v-owner",n.uid),o=o.nextSibling;n.ut()}}function up(e,t,n,o){const s=t.targetStart=n(""),i=t.targetAnchor=n("");return s[rp]=i,e&&(o(s,e),o(i,e)),i}const Hs=Symbol("_leaveCb"),ta=Symbol("_enterCb");function wg(){const e={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return gn(()=>{e.isMounted=!0}),Is(()=>{e.isUnmounting=!0}),e}const Un=[Function,Array],_p={mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:Un,onEnter:Un,onAfterEnter:Un,onEnterCancelled:Un,onBeforeLeave:Un,onLeave:Un,onAfterLeave:Un,onLeaveCancelled:Un,onBeforeAppear:Un,onAppear:Un,onAfterAppear:Un,onAppearCancelled:Un},$p=e=>{const t=e.subTree;return t.component?$p(t.component):t},vg={name:"BaseTransition",props:_p,setup(e,{slots:t}){const n=ju(),o=wg();return()=>{const s=t.default&&mp(t.default(),!0);if(!s||!s.length)return;const i=dp(s),r=it(e),{mode:a}=r;if(o.isLeaving)return ul(i);const c=O_(i);if(!c)return ul(i);let l=Vl(c,r,o,n,_=>l=_);c.type!==fn&&wr(c,l);let u=n.subTree&&O_(n.subTree);if(u&&u.type!==fn&&!No(u,c)&&$p(n).type!==fn){let _=Vl(u,r,o,n);if(wr(u,_),a==="out-in"&&c.type!==fn)return o.isLeaving=!0,_.afterLeave=()=>{o.isLeaving=!1,n.job.flags&8||n.update(),delete _.afterLeave,u=void 0},ul(i);a==="in-out"&&c.type!==fn?_.delayLeave=($,d,p)=>{const b=pp(o,u);b[String(u.key)]=u,$[Hs]=()=>{d(),$[Hs]=void 0,delete l.delayedLeave,u=void 0},l.delayedLeave=()=>{p(),delete l.delayedLeave,u=void 0}}:u=void 0}else u&&(u=void 0);return i}}};function dp(e){let t=e[0];if(e.length>1){for(const n of e)if(n.type!==fn){t=n;break}}return t}const Sg=vg;function pp(e,t){const{leavingVNodes:n}=e;let o=n.get(t.type);return o||(o=Object.create(null),n.set(t.type,o)),o}function Vl(e,t,n,o,s){const{appear:i,mode:r,persisted:a=!1,onBeforeEnter:c,onEnter:l,onAfterEnter:u,onEnterCancelled:_,onBeforeLeave:$,onLeave:d,onAfterLeave:p,onLeaveCancelled:b,onBeforeAppear:g,onAppear:m,onAfterAppear:v,onAppearCancelled:y}=t,w=String(e.key),k=pp(n,e),L=(I,U)=>{I&&us(I,o,9,U)},P=(I,U)=>{const R=U[1];L(I,U),De(I)?I.every(M=>M.length<=1)&&R():I.length<=1&&R()},G={mode:r,persisted:a,beforeEnter(I){let U=c;if(!n.isMounted)if(i)U=g||c;else return;I[Hs]&&I[Hs](!0);const R=k[w];R&&No(e,R)&&R.el[Hs]&&R.el[Hs](),L(U,[I])},enter(I){let U=l,R=u,M=_;if(!n.isMounted)if(i)U=m||l,R=v||u,M=y||_;else return;let B=!1;const de=I[ta]=oe=>{B||(B=!0,oe?L(M,[I]):L(R,[I]),G.delayedLeave&&G.delayedLeave(),I[ta]=void 0)};U?P(U,[I,de]):de()},leave(I,U){const R=String(e.key);if(I[ta]&&I[ta](!0),n.isUnmounting)return U();L($,[I]);let M=!1;const B=I[Hs]=de=>{M||(M=!0,U(),de?L(b,[I]):L(p,[I]),I[Hs]=void 0,k[R]===e&&delete k[R])};k[R]=e,d?P(d,[I,B]):B()},clone(I){const U=Vl(I,t,n,o,s);return s&&s(U),U}};return G}function ul(e){if(lc(e))return e=go(e),e.children=null,e}function O_(e){if(!lc(e))return ap(e.type)&&e.children?dp(e.children):e;if(e.component)return e.component.subTree;const{shapeFlag:t,children:n}=e;if(n){if(t&16)return n[0];if(t&32&&ze(n.default))return n.default()}}function wr(e,t){e.shapeFlag&6&&e.component?(e.transition=t,wr(e.component.subTree,t)):e.shapeFlag&128?(e.ssContent.transition=t.clone(e.ssContent),e.ssFallback.transition=t.clone(e.ssFallback)):e.transition=t}function mp(e,t=!1,n){let o=[],s=0;for(let i=0;i<e.length;i++){let r=e[i];const a=n==null?r.key:String(n)+String(r.key!=null?r.key:i);r.type===ht?(r.patchFlag&128&&s++,o=o.concat(mp(r.children,t,a))):(t||r.type!==fn)&&o.push(a!=null?go(r,{key:a}):r)}if(s>1)for(let i=0;i<o.length;i++)o[i].patchFlag=-2;return o}function fp(e){e.ids=[e.ids[0]+e.ids[2]+++"-",0,0]}const Ta=new WeakMap;function ar(e,t,n,o,s=!1){if(De(e)){e.forEach((p,b)=>ar(p,t&&(De(t)?t[b]:t),n,o,s));return}if(cr(o)&&!s){o.shapeFlag&512&&o.type.__asyncResolved&&o.component.subTree.component&&ar(e,t,n,o.component.subTree);return}const i=o.shapeFlag&4?dc(o.component):o.el,r=s?null:i,{i:a,r:c}=e,l=t&&t.r,u=a.refs===ft?a.refs={}:a.refs,_=a.setupState,$=it(_),d=_===ft?xd:p=>at($,p);if(l!=null&&l!==c){if(D_(t),At(l))u[l]=null,d(l)&&(_[l]=null);else if(ln(l)){l.value=null;const p=t;p.k&&(u[p.k]=null)}}if(ze(c))jr(c,a,12,[r,u]);else{const p=At(c),b=ln(c);if(p||b){const g=()=>{if(e.f){const m=p?d(c)?_[c]:u[c]:c.value;if(s)De(m)&&Su(m,i);else if(De(m))m.includes(i)||m.push(i);else if(p)u[c]=[i],d(c)&&(_[c]=u[c]);else{const v=[i];c.value=v,e.k&&(u[e.k]=v)}}else p?(u[c]=r,d(c)&&(_[c]=r)):b&&(c.value=r,e.k&&(u[e.k]=r))};if(r){const m=()=>{g(),Ta.delete(e)};m.id=-1,Ta.set(e,m),dn(m,n)}else D_(e),g()}}}function D_(e){const t=Ta.get(e);t&&(t.flags|=8,Ta.delete(e))}rc().requestIdleCallback;rc().cancelIdleCallback;const cr=e=>!!e.type.__asyncLoader,lc=e=>e.type.__isKeepAlive;function kg(e,t){hp(e,"a",t)}function Mg(e,t){hp(e,"da",t)}function hp(e,t,n=hn){const o=e.__wdc||(e.__wdc=()=>{let s=n;for(;s;){if(s.isDeactivated)return;s=s.parent}return e()});if(uc(t,o,n),n){let s=n.parent;for(;s&&s.parent;)lc(s.parent.vnode)&&Cg(o,t,n,s),s=s.parent}}function Cg(e,t,n,o){const s=uc(t,e,o,!0);Gu(()=>{Su(o[t],s)},n)}function uc(e,t,n=hn,o=!1){if(n){const s=n[e]||(n[e]=[]),i=t.__weh||(t.__weh=(...r)=>{qs();const a=Hr(n),c=us(t,n,e,r);return a(),Ws(),c});return o?s.unshift(i):s.push(i),i}}const Ks=e=>(t,n=hn)=>{(!Sr||e==="sp")&&uc(e,(...o)=>t(...o),n)},xg=Ks("bm"),gn=Ks("m"),gp=Ks("bu"),Pg=Ks("u"),Is=Ks("bum"),Gu=Ks("um"),Lg=Ks("sp"),Ig=Ks("rtg"),Tg=Ks("rtc");function Eg(e,t=hn){uc("ec",e,t)}const Ag=Symbol.for("v-ndc");function Zn(e,t,n,o){let s;const i=n,r=De(e);if(r||At(e)){const a=r&&vi(e);let c=!1,l=!1;a&&(c=!Yn(e),l=ho(e),e=ac(e)),s=new Array(e.length);for(let u=0,_=e.length;u<_;u++)s[u]=t(c?l?xa(Jt(e[u])):Jt(e[u]):e[u],u,void 0,i)}else if(typeof e=="number"){s=new Array(e);for(let a=0;a<e;a++)s[a]=t(a+1,a,void 0,i)}else if(kt(e))if(e[Symbol.iterator])s=Array.from(e,(a,c)=>t(a,c,void 0,i));else{const a=Object.keys(e);s=new Array(a.length);for(let c=0,l=a.length;c<l;c++){const u=a[c];s[c]=t(e[u],u,c,i)}}else s=[];return s}const ql=e=>e?Dp(e)?dc(e):ql(e.parent):null,lr=Xt(Object.create(null),{$:e=>e,$el:e=>e.vnode.el,$data:e=>e.data,$props:e=>e.props,$attrs:e=>e.attrs,$slots:e=>e.slots,$refs:e=>e.refs,$parent:e=>ql(e.parent),$root:e=>ql(e.root),$host:e=>e.ce,$emit:e=>e.emit,$options:e=>yp(e),$forceUpdate:e=>e.f||(e.f=()=>{Au(e.update)}),$nextTick:e=>e.n||(e.n=br.bind(e.proxy)),$watch:e=>tb.bind(e)}),_l=(e,t)=>e!==ft&&!e.__isScriptSetup&&at(e,t),Gg={get({_:e},t){if(t==="__v_skip")return!0;const{ctx:n,setupState:o,data:s,props:i,accessCache:r,type:a,appContext:c}=e;let l;if(t[0]!=="$"){const d=r[t];if(d!==void 0)switch(d){case 1:return o[t];case 2:return s[t];case 4:return n[t];case 3:return i[t]}else{if(_l(o,t))return r[t]=1,o[t];if(s!==ft&&at(s,t))return r[t]=2,s[t];if((l=e.propsOptions[0])&&at(l,t))return r[t]=3,i[t];if(n!==ft&&at(n,t))return r[t]=4,n[t];Wl&&(r[t]=0)}}const u=lr[t];let _,$;if(u)return t==="$attrs"&&tn(e.attrs,"get",""),u(e);if((_=a.__cssModules)&&(_=_[t]))return _;if(n!==ft&&at(n,t))return r[t]=4,n[t];if($=c.config.globalProperties,at($,t))return $[t]},set({_:e},t,n){const{data:o,setupState:s,ctx:i}=e;return _l(s,t)?(s[t]=n,!0):o!==ft&&at(o,t)?(o[t]=n,!0):at(e.props,t)||t[0]==="$"&&t.slice(1)in e?!1:(i[t]=n,!0)},has({_:{data:e,setupState:t,accessCache:n,ctx:o,appContext:s,propsOptions:i,type:r}},a){let c,l;return!!(n[a]||e!==ft&&a[0]!=="$"&&at(e,a)||_l(t,a)||(c=i[0])&&at(c,a)||at(o,a)||at(lr,a)||at(s.config.globalProperties,a)||(l=r.__cssModules)&&l[a])},defineProperty(e,t,n){return n.get!=null?e._.accessCache[t]=0:at(n,"value")&&this.set(e,t,n.value,null),Reflect.defineProperty(e,t,n)}};function N_(e){return De(e)?e.reduce((t,n)=>(t[n]=null,t),{}):e}let Wl=!0;function Rg(e){const t=yp(e),n=e.proxy,o=e.ctx;Wl=!1,t.beforeCreate&&j_(t.beforeCreate,e,"bc");const{data:s,computed:i,methods:r,watch:a,provide:c,inject:l,created:u,beforeMount:_,mounted:$,beforeUpdate:d,updated:p,activated:b,deactivated:g,beforeDestroy:m,beforeUnmount:v,destroyed:y,unmounted:w,render:k,renderTracked:L,renderTriggered:P,errorCaptured:G,serverPrefetch:I,expose:U,inheritAttrs:R,components:M,directives:B,filters:de}=t;if(l&&Og(l,o,null),r)for(const K in r){const A=r[K];ze(A)&&(o[K]=A.bind(n))}if(s){const K=s.call(n,n);kt(K)&&(e.data=Iu(K))}if(Wl=!0,i)for(const K in i){const A=i[K],Q=ze(A)?A.bind(n,n):ze(A.get)?A.get.bind(n,n):is,F=!ze(A)&&ze(A.set)?A.set.bind(n):is,D=Je({get:Q,set:F});Object.defineProperty(o,K,{enumerable:!0,configurable:!0,get:()=>D.value,set:X=>D.value=X})}if(a)for(const K in a)bp(a[K],o,n,K);if(c){const K=ze(c)?c.call(n):c;Reflect.ownKeys(K).forEach(A=>{Ug(A,K[A])})}u&&j_(u,e,"c");function be(K,A){De(A)?A.forEach(Q=>K(Q.bind(n))):A&&K(A.bind(n))}if(be(xg,_),be(gn,$),be(gp,d),be(Pg,p),be(kg,b),be(Mg,g),be(Eg,G),be(Tg,L),be(Ig,P),be(Is,v),be(Gu,w),be(Lg,I),De(U))if(U.length){const K=e.exposed||(e.exposed={});U.forEach(A=>{Object.defineProperty(K,A,{get:()=>n[A],set:Q=>n[A]=Q,enumerable:!0})})}else e.exposed||(e.exposed={});k&&e.render===is&&(e.render=k),R!=null&&(e.inheritAttrs=R),M&&(e.components=M),B&&(e.directives=B),I&&fp(e)}function Og(e,t,n=is){De(e)&&(e=Kl(e));for(const o in e){const s=e[o];let i;kt(s)?"default"in s?i=pa(s.from||o,s.default,!0):i=pa(s.from||o):i=pa(s),ln(i)?Object.defineProperty(t,o,{enumerable:!0,configurable:!0,get:()=>i.value,set:r=>i.value=r}):t[o]=i}}function j_(e,t,n){us(De(e)?e.map(o=>o.bind(t.proxy)):e.bind(t.proxy),t,n)}function bp(e,t,n,o){let s=o.includes(".")?Ep(n,o):()=>n[o];if(At(e)){const i=t[e];ze(i)&&Ln(s,i)}else if(ze(e))Ln(s,e.bind(n));else if(kt(e))if(De(e))e.forEach(i=>bp(i,t,n,o));else{const i=ze(e.handler)?e.handler.bind(n):t[e.handler];ze(i)&&Ln(s,i,e)}}function yp(e){const t=e.type,{mixins:n,extends:o}=t,{mixins:s,optionsCache:i,config:{optionMergeStrategies:r}}=e.appContext,a=i.get(t);let c;return a?c=a:!s.length&&!n&&!o?c=t:(c={},s.length&&s.forEach(l=>Ea(c,l,r,!0)),Ea(c,t,r)),kt(t)&&i.set(t,c),c}function Ea(e,t,n,o=!1){const{mixins:s,extends:i}=t;i&&Ea(e,i,n,!0),s&&s.forEach(r=>Ea(e,r,n,!0));for(const r in t)if(!(o&&r==="expose")){const a=Dg[r]||n&&n[r];e[r]=a?a(e[r],t[r]):t[r]}return e}const Dg={data:H_,props:F_,emits:F_,methods:Ki,computed:Ki,beforeCreate:_n,created:_n,beforeMount:_n,mounted:_n,beforeUpdate:_n,updated:_n,beforeDestroy:_n,beforeUnmount:_n,destroyed:_n,unmounted:_n,activated:_n,deactivated:_n,errorCaptured:_n,serverPrefetch:_n,components:Ki,directives:Ki,watch:jg,provide:H_,inject:Ng};function H_(e,t){return t?e?function(){return Xt(ze(e)?e.call(this,this):e,ze(t)?t.call(this,this):t)}:t:e}function Ng(e,t){return Ki(Kl(e),Kl(t))}function Kl(e){if(De(e)){const t={};for(let n=0;n<e.length;n++)t[e[n]]=e[n];return t}return e}function _n(e,t){return e?[...new Set([].concat(e,t))]:t}function Ki(e,t){return e?Xt(Object.create(null),e,t):t}function F_(e,t){return e?De(e)&&De(t)?[...new Set([...e,...t])]:Xt(Object.create(null),N_(e),N_(t??{})):t}function jg(e,t){if(!e)return t;if(!t)return e;const n=Xt(Object.create(null),e);for(const o in t)n[o]=_n(e[o],t[o]);return n}function wp(){return{app:null,config:{isNativeTag:xd,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let Hg=0;function Fg(e,t){return function(o,s=null){ze(o)||(o=Xt({},o)),s!=null&&!kt(s)&&(s=null);const i=wp(),r=new WeakSet,a=[];let c=!1;const l=i.app={_uid:Hg++,_component:o,_props:s,_container:null,_context:i,_instance:null,version:Sb,get config(){return i.config},set config(u){},use(u,..._){return r.has(u)||(u&&ze(u.install)?(r.add(u),u.install(l,..._)):ze(u)&&(r.add(u),u(l,..._))),l},mixin(u){return i.mixins.includes(u)||i.mixins.push(u),l},component(u,_){return _?(i.components[u]=_,l):i.components[u]},directive(u,_){return _?(i.directives[u]=_,l):i.directives[u]},mount(u,_,$){if(!c){const d=l._ceVNode||Pt(o,s);return d.appContext=i,$===!0?$="svg":$===!1&&($=void 0),e(d,u,$),c=!0,l._container=u,u.__vue_app__=l,dc(d.component)}},onUnmount(u){a.push(u)},unmount(){c&&(us(a,l._instance,16),e(null,l._container),delete l._container.__vue_app__)},provide(u,_){return i.provides[u]=_,l},runWithContext(u){const _=ki;ki=l;try{return u()}finally{ki=_}}};return l}}let ki=null;function Ug(e,t){if(hn){let n=hn.provides;const o=hn.parent&&hn.parent.provides;o===n&&(n=hn.provides=Object.create(o)),n[e]=t}}function pa(e,t,n=!1){const o=ju();if(o||ki){let s=ki?ki._context.provides:o?o.parent==null||o.ce?o.vnode.appContext&&o.vnode.appContext.provides:o.parent.provides:void 0;if(s&&e in s)return s[e];if(arguments.length>1)return n&&ze(t)?t.call(o&&o.proxy):t}}const vp={},Sp=()=>Object.create(vp),kp=e=>Object.getPrototypeOf(e)===vp;function Bg(e,t,n,o=!1){const s={},i=Sp();e.propsDefaults=Object.create(null),Mp(e,t,s,i);for(const r in e.propsOptions[0])r in s||(s[r]=void 0);n?e.props=o?s:lg(s):e.type.props?e.props=s:e.props=i,e.attrs=i}function zg(e,t,n,o){const{props:s,attrs:i,vnode:{patchFlag:r}}=e,a=it(s),[c]=e.propsOptions;let l=!1;if((o||r>0)&&!(r&16)){if(r&8){const u=e.vnode.dynamicProps;for(let _=0;_<u.length;_++){let $=u[_];if(_c(e.emitsOptions,$))continue;const d=t[$];if(c)if(at(i,$))d!==i[$]&&(i[$]=d,l=!0);else{const p=fo($);s[p]=Jl(c,a,p,d,e,!1)}else d!==i[$]&&(i[$]=d,l=!0)}}}else{Mp(e,t,s,i)&&(l=!0);let u;for(const _ in a)(!t||!at(t,_)&&((u=Qo(_))===_||!at(t,u)))&&(c?n&&(n[_]!==void 0||n[u]!==void 0)&&(s[_]=Jl(c,a,_,void 0,e,!0)):delete s[_]);if(i!==a)for(const _ in i)(!t||!at(t,_))&&(delete i[_],l=!0)}l&&Fs(e.attrs,"set","")}function Mp(e,t,n,o){const[s,i]=e.propsOptions;let r=!1,a;if(t)for(let c in t){if(sr(c))continue;const l=t[c];let u;s&&at(s,u=fo(c))?!i||!i.includes(u)?n[u]=l:(a||(a={}))[u]=l:_c(e.emitsOptions,c)||(!(c in o)||l!==o[c])&&(o[c]=l,r=!0)}if(i){const c=it(n),l=a||ft;for(let u=0;u<i.length;u++){const _=i[u];n[_]=Jl(s,c,_,l[_],e,!at(l,_))}}return r}function Jl(e,t,n,o,s,i){const r=e[n];if(r!=null){const a=at(r,"default");if(a&&o===void 0){const c=r.default;if(r.type!==Function&&!r.skipFactory&&ze(c)){const{propsDefaults:l}=s;if(n in l)o=l[n];else{const u=Hr(s);o=l[n]=c.call(null,t),u()}}else o=c;s.ce&&s.ce._setProp(n,o)}r[0]&&(i&&!a?o=!1:r[1]&&(o===""||o===Qo(n))&&(o=!0))}return o}const Vg=new WeakMap;function Cp(e,t,n=!1){const o=n?Vg:t.propsCache,s=o.get(e);if(s)return s;const i=e.props,r={},a=[];let c=!1;if(!ze(e)){const u=_=>{c=!0;const[$,d]=Cp(_,t,!0);Xt(r,$),d&&a.push(...d)};!n&&t.mixins.length&&t.mixins.forEach(u),e.extends&&u(e.extends),e.mixins&&e.mixins.forEach(u)}if(!i&&!c)return kt(e)&&o.set(e,yi),yi;if(De(i))for(let u=0;u<i.length;u++){const _=fo(i[u]);U_(_)&&(r[_]=ft)}else if(i)for(const u in i){const _=fo(u);if(U_(_)){const $=i[u],d=r[_]=De($)||ze($)?{type:$}:Xt({},$),p=d.type;let b=!1,g=!0;if(De(p))for(let m=0;m<p.length;++m){const v=p[m],y=ze(v)&&v.name;if(y==="Boolean"){b=!0;break}else y==="String"&&(g=!1)}else b=ze(p)&&p.name==="Boolean";d[0]=b,d[1]=g,(b||at(d,"default"))&&a.push(_)}}const l=[r,a];return kt(e)&&o.set(e,l),l}function U_(e){return e[0]!=="$"&&!sr(e)}const Ru=e=>e==="_"||e==="_ctx"||e==="$stable",Ou=e=>De(e)?e.map(ys):[ys(e)],qg=(e,t,n)=>{if(t._n)return t;const o=op((...s)=>Ou(t(...s)),n);return o._c=!1,o},xp=(e,t,n)=>{const o=e._ctx;for(const s in e){if(Ru(s))continue;const i=e[s];if(ze(i))t[s]=qg(s,i,o);else if(i!=null){const r=Ou(i);t[s]=()=>r}}},Pp=(e,t)=>{const n=Ou(t);e.slots.default=()=>n},Lp=(e,t,n)=>{for(const o in t)(n||!Ru(o))&&(e[o]=t[o])},Wg=(e,t,n)=>{const o=e.slots=Sp();if(e.vnode.shapeFlag&32){const s=t._;s?(Lp(o,t,n),n&&Ad(o,"_",s,!0)):xp(t,o)}else t&&Pp(e,t)},Kg=(e,t,n)=>{const{vnode:o,slots:s}=e;let i=!0,r=ft;if(o.shapeFlag&32){const a=t._;a?n&&a===1?i=!1:Lp(s,t,n):(i=!t.$stable,xp(t,s)),r=t}else t&&(Pp(e,t),r={default:1});if(i)for(const a in s)!Ru(a)&&r[a]==null&&delete s[a]},dn=lb;function Jg(e){return Xg(e)}function Xg(e,t){const n=rc();n.__VUE__=!0;const{insert:o,remove:s,patchProp:i,createElement:r,createText:a,createComment:c,setText:l,setElementText:u,parentNode:_,nextSibling:$,setScopeId:d=is,insertStaticContent:p}=e,b=(x,T,z,N=null,Z=null,J=null,ue=void 0,le=null,ie=!!T.dynamicChildren)=>{if(x===T)return;x&&!No(x,T)&&(N=He(x),X(x,Z,J,!0),x=null),T.patchFlag===-2&&(ie=!1,T.dynamicChildren=null);const{type:Y,ref:Se,shapeFlag:fe}=T;switch(Y){case $c:g(x,T,z,N);break;case fn:m(x,T,z,N);break;case ur:x==null&&v(T,z,N,ue);break;case ht:M(x,T,z,N,Z,J,ue,le,ie);break;default:fe&1?k(x,T,z,N,Z,J,ue,le,ie):fe&6?B(x,T,z,N,Z,J,ue,le,ie):(fe&64||fe&128)&&Y.process(x,T,z,N,Z,J,ue,le,ie,$t)}Se!=null&&Z?ar(Se,x&&x.ref,J,T||x,!T):Se==null&&x&&x.ref!=null&&ar(x.ref,null,J,x,!0)},g=(x,T,z,N)=>{if(x==null)o(T.el=a(T.children),z,N);else{const Z=T.el=x.el;T.children!==x.children&&l(Z,T.children)}},m=(x,T,z,N)=>{x==null?o(T.el=c(T.children||""),z,N):T.el=x.el},v=(x,T,z,N)=>{[x.el,x.anchor]=p(x.children,T,z,N,x.el,x.anchor)},y=({el:x,anchor:T},z,N)=>{let Z;for(;x&&x!==T;)Z=$(x),o(x,z,N),x=Z;o(T,z,N)},w=({el:x,anchor:T})=>{let z;for(;x&&x!==T;)z=$(x),s(x),x=z;s(T)},k=(x,T,z,N,Z,J,ue,le,ie)=>{T.type==="svg"?ue="svg":T.type==="math"&&(ue="mathml"),x==null?L(T,z,N,Z,J,ue,le,ie):I(x,T,Z,J,ue,le,ie)},L=(x,T,z,N,Z,J,ue,le)=>{let ie,Y;const{props:Se,shapeFlag:fe,transition:ve,dirs:Te}=x;if(ie=x.el=r(x.type,J,Se&&Se.is,Se),fe&8?u(ie,x.children):fe&16&&G(x.children,ie,null,N,Z,$l(x,J),ue,le),Te&&xo(x,null,N,"created"),P(ie,x,x.scopeId,ue,N),Se){for(const Xe in Se)Xe!=="value"&&!sr(Xe)&&i(ie,Xe,null,Se[Xe],J,N);"value"in Se&&i(ie,"value",null,Se.value,J),(Y=Se.onVnodeBeforeMount)&&$s(Y,N,x)}Te&&xo(x,null,N,"beforeMount");const Re=Yg(Z,ve);Re&&ve.beforeEnter(ie),o(ie,T,z),((Y=Se&&Se.onVnodeMounted)||Re||Te)&&dn(()=>{Y&&$s(Y,N,x),Re&&ve.enter(ie),Te&&xo(x,null,N,"mounted")},Z)},P=(x,T,z,N,Z)=>{if(z&&d(x,z),N)for(let J=0;J<N.length;J++)d(x,N[J]);if(Z){let J=Z.subTree;if(T===J||Gp(J.type)&&(J.ssContent===T||J.ssFallback===T)){const ue=Z.vnode;P(x,ue,ue.scopeId,ue.slotScopeIds,Z.parent)}}},G=(x,T,z,N,Z,J,ue,le,ie=0)=>{for(let Y=ie;Y<x.length;Y++){const Se=x[Y]=le?no(x[Y]):ys(x[Y]);b(null,Se,T,z,N,Z,J,ue,le)}},I=(x,T,z,N,Z,J,ue)=>{const le=T.el=x.el;let{patchFlag:ie,dynamicChildren:Y,dirs:Se}=T;ie|=x.patchFlag&16;const fe=x.props||ft,ve=T.props||ft;let Te;if(z&&Po(z,!1),(Te=ve.onVnodeBeforeUpdate)&&$s(Te,z,T,x),Se&&xo(T,x,z,"beforeUpdate"),z&&Po(z,!0),(fe.innerHTML&&ve.innerHTML==null||fe.textContent&&ve.textContent==null)&&u(le,""),Y?U(x.dynamicChildren,Y,le,z,N,$l(T,Z),J):ue||A(x,T,le,null,z,N,$l(T,Z),J,!1),ie>0){if(ie&16)R(le,fe,ve,z,Z);else if(ie&2&&fe.class!==ve.class&&i(le,"class",null,ve.class,Z),ie&4&&i(le,"style",fe.style,ve.style,Z),ie&8){const Re=T.dynamicProps;for(let Xe=0;Xe<Re.length;Xe++){const Me=Re[Xe],Ye=fe[Me],ye=ve[Me];(ye!==Ye||Me==="value")&&i(le,Me,Ye,ye,Z,z)}}ie&1&&x.children!==T.children&&u(le,T.children)}else!ue&&Y==null&&R(le,fe,ve,z,Z);((Te=ve.onVnodeUpdated)||Se)&&dn(()=>{Te&&$s(Te,z,T,x),Se&&xo(T,x,z,"updated")},N)},U=(x,T,z,N,Z,J,ue)=>{for(let le=0;le<T.length;le++){const ie=x[le],Y=T[le],Se=ie.el&&(ie.type===ht||!No(ie,Y)||ie.shapeFlag&198)?_(ie.el):z;b(ie,Y,Se,null,N,Z,J,ue,!0)}},R=(x,T,z,N,Z)=>{if(T!==z){if(T!==ft)for(const J in T)!sr(J)&&!(J in z)&&i(x,J,T[J],null,Z,N);for(const J in z){if(sr(J))continue;const ue=z[J],le=T[J];ue!==le&&J!=="value"&&i(x,J,le,ue,Z,N)}"value"in z&&i(x,"value",T.value,z.value,Z)}},M=(x,T,z,N,Z,J,ue,le,ie)=>{const Y=T.el=x?x.el:a(""),Se=T.anchor=x?x.anchor:a("");let{patchFlag:fe,dynamicChildren:ve,slotScopeIds:Te}=T;Te&&(le=le?le.concat(Te):Te),x==null?(o(Y,z,N),o(Se,z,N),G(T.children||[],z,Se,Z,J,ue,le,ie)):fe>0&&fe&64&&ve&&x.dynamicChildren?(U(x.dynamicChildren,ve,z,Z,J,ue,le),(T.key!=null||Z&&T===Z.subTree)&&Du(x,T,!0)):A(x,T,z,Se,Z,J,ue,le,ie)},B=(x,T,z,N,Z,J,ue,le,ie)=>{T.slotScopeIds=le,x==null?T.shapeFlag&512?Z.ctx.activate(T,z,N,ue,ie):de(T,z,N,Z,J,ue,ie):oe(x,T,ie)},de=(x,T,z,N,Z,J,ue)=>{const le=x.component=fb(x,N,Z);if(lc(x)&&(le.ctx.renderer=$t),hb(le,!1,ue),le.asyncDep){if(Z&&Z.registerDep(le,be,ue),!x.el){const ie=le.subTree=Pt(fn);m(null,ie,T,z),x.placeholder=ie.el}}else be(le,x,T,z,Z,J,ue)},oe=(x,T,z)=>{const N=T.component=x.component;if(ab(x,T,z))if(N.asyncDep&&!N.asyncResolved){K(N,T,z);return}else N.next=T,N.update();else T.el=x.el,N.vnode=T},be=(x,T,z,N,Z,J,ue)=>{const le=()=>{if(x.isMounted){let{next:fe,bu:ve,u:Te,parent:Re,vnode:Xe}=x;{const pt=Ip(x);if(pt){fe&&(fe.el=Xe.el,K(x,fe,ue)),pt.asyncDep.then(()=>{x.isUnmounted||le()});return}}let Me=fe,Ye;Po(x,!1),fe?(fe.el=Xe.el,K(x,fe,ue)):fe=Xe,ve&&il(ve),(Ye=fe.props&&fe.props.onVnodeBeforeUpdate)&&$s(Ye,Re,fe,Xe),Po(x,!0);const ye=z_(x),dt=x.subTree;x.subTree=ye,b(dt,ye,_(dt.el),He(dt),x,Z,J),fe.el=ye.el,Me===null&&cb(x,ye.el),Te&&dn(Te,Z),(Ye=fe.props&&fe.props.onVnodeUpdated)&&dn(()=>$s(Ye,Re,fe,Xe),Z)}else{let fe;const{el:ve,props:Te}=T,{bm:Re,m:Xe,parent:Me,root:Ye,type:ye}=x,dt=cr(T);Po(x,!1),Re&&il(Re),!dt&&(fe=Te&&Te.onVnodeBeforeMount)&&$s(fe,Me,T),Po(x,!0);{Ye.ce&&Ye.ce._def.shadowRoot!==!1&&Ye.ce._injectChildStyle(ye);const pt=x.subTree=z_(x);b(null,pt,z,N,x,Z,J),T.el=pt.el}if(Xe&&dn(Xe,Z),!dt&&(fe=Te&&Te.onVnodeMounted)){const pt=T;dn(()=>$s(fe,Me,pt),Z)}(T.shapeFlag&256||Me&&cr(Me.vnode)&&Me.vnode.shapeFlag&256)&&x.a&&dn(x.a,Z),x.isMounted=!0,T=z=N=null}};x.scope.on();const ie=x.effect=new Dd(le);x.scope.off();const Y=x.update=ie.run.bind(ie),Se=x.job=ie.runIfDirty.bind(ie);Se.i=x,Se.id=x.uid,ie.scheduler=()=>Au(Se),Po(x,!0),Y()},K=(x,T,z)=>{T.component=x;const N=x.vnode.props;x.vnode=T,x.next=null,zg(x,T.props,N,z),Kg(x,T.children,z),qs(),E_(x),Ws()},A=(x,T,z,N,Z,J,ue,le,ie=!1)=>{const Y=x&&x.children,Se=x?x.shapeFlag:0,fe=T.children,{patchFlag:ve,shapeFlag:Te}=T;if(ve>0){if(ve&128){F(Y,fe,z,N,Z,J,ue,le,ie);return}else if(ve&256){Q(Y,fe,z,N,Z,J,ue,le,ie);return}}Te&8?(Se&16&&qe(Y,Z,J),fe!==Y&&u(z,fe)):Se&16?Te&16?F(Y,fe,z,N,Z,J,ue,le,ie):qe(Y,Z,J,!0):(Se&8&&u(z,""),Te&16&&G(fe,z,N,Z,J,ue,le,ie))},Q=(x,T,z,N,Z,J,ue,le,ie)=>{x=x||yi,T=T||yi;const Y=x.length,Se=T.length,fe=Math.min(Y,Se);let ve;for(ve=0;ve<fe;ve++){const Te=T[ve]=ie?no(T[ve]):ys(T[ve]);b(x[ve],Te,z,null,Z,J,ue,le,ie)}Y>Se?qe(x,Z,J,!0,!1,fe):G(T,z,N,Z,J,ue,le,ie,fe)},F=(x,T,z,N,Z,J,ue,le,ie)=>{let Y=0;const Se=T.length;let fe=x.length-1,ve=Se-1;for(;Y<=fe&&Y<=ve;){const Te=x[Y],Re=T[Y]=ie?no(T[Y]):ys(T[Y]);if(No(Te,Re))b(Te,Re,z,null,Z,J,ue,le,ie);else break;Y++}for(;Y<=fe&&Y<=ve;){const Te=x[fe],Re=T[ve]=ie?no(T[ve]):ys(T[ve]);if(No(Te,Re))b(Te,Re,z,null,Z,J,ue,le,ie);else break;fe--,ve--}if(Y>fe){if(Y<=ve){const Te=ve+1,Re=Te<Se?T[Te].el:N;for(;Y<=ve;)b(null,T[Y]=ie?no(T[Y]):ys(T[Y]),z,Re,Z,J,ue,le,ie),Y++}}else if(Y>ve)for(;Y<=fe;)X(x[Y],Z,J,!0),Y++;else{const Te=Y,Re=Y,Xe=new Map;for(Y=Re;Y<=ve;Y++){const It=T[Y]=ie?no(T[Y]):ys(T[Y]);It.key!=null&&Xe.set(It.key,Y)}let Me,Ye=0;const ye=ve-Re+1;let dt=!1,pt=0;const Yt=new Array(ye);for(Y=0;Y<ye;Y++)Yt[Y]=0;for(Y=Te;Y<=fe;Y++){const It=x[Y];if(Ye>=ye){X(It,Z,J,!0);continue}let Zt;if(It.key!=null)Zt=Xe.get(It.key);else for(Me=Re;Me<=ve;Me++)if(Yt[Me-Re]===0&&No(It,T[Me])){Zt=Me;break}Zt===void 0?X(It,Z,J,!0):(Yt[Zt-Re]=Y+1,Zt>=pt?pt=Zt:dt=!0,b(It,T[Zt],z,null,Z,J,ue,le,ie),Ye++)}const Hn=dt?Zg(Yt):yi;for(Me=Hn.length-1,Y=ye-1;Y>=0;Y--){const It=Re+Y,Zt=T[It],Fn=T[It+1],Os=It+1<Se?Fn.el||Fn.placeholder:N;Yt[Y]===0?b(null,Zt,z,Os,Z,J,ue,le,ie):dt&&(Me<0||Y!==Hn[Me]?D(Zt,z,Os,2):Me--)}}},D=(x,T,z,N,Z=null)=>{const{el:J,type:ue,transition:le,children:ie,shapeFlag:Y}=x;if(Y&6){D(x.component.subTree,T,z,N);return}if(Y&128){x.suspense.move(T,z,N);return}if(Y&64){ue.move(x,T,z,$t);return}if(ue===ht){o(J,T,z);for(let fe=0;fe<ie.length;fe++)D(ie[fe],T,z,N);o(x.anchor,T,z);return}if(ue===ur){y(x,T,z);return}if(N!==2&&Y&1&&le)if(N===0)le.beforeEnter(J),o(J,T,z),dn(()=>le.enter(J),Z);else{const{leave:fe,delayLeave:ve,afterLeave:Te}=le,Re=()=>{x.ctx.isUnmounted?s(J):o(J,T,z)},Xe=()=>{J._isLeaving&&J[Hs](!0),fe(J,()=>{Re(),Te&&Te()})};ve?ve(J,Re,Xe):Xe()}else o(J,T,z)},X=(x,T,z,N=!1,Z=!1)=>{const{type:J,props:ue,ref:le,children:ie,dynamicChildren:Y,shapeFlag:Se,patchFlag:fe,dirs:ve,cacheIndex:Te}=x;if(fe===-2&&(Z=!1),le!=null&&(qs(),ar(le,null,z,x,!0),Ws()),Te!=null&&(T.renderCache[Te]=void 0),Se&256){T.ctx.deactivate(x);return}const Re=Se&1&&ve,Xe=!cr(x);let Me;if(Xe&&(Me=ue&&ue.onVnodeBeforeUnmount)&&$s(Me,T,x),Se&6)Ge(x.component,z,N);else{if(Se&128){x.suspense.unmount(z,N);return}Re&&xo(x,null,T,"beforeUnmount"),Se&64?x.type.remove(x,T,z,$t,N):Y&&!Y.hasOnce&&(J!==ht||fe>0&&fe&64)?qe(Y,T,z,!1,!0):(J===ht&&fe&384||!Z&&Se&16)&&qe(ie,T,z),N&&q(x)}(Xe&&(Me=ue&&ue.onVnodeUnmounted)||Re)&&dn(()=>{Me&&$s(Me,T,x),Re&&xo(x,null,T,"unmounted")},z)},q=x=>{const{type:T,el:z,anchor:N,transition:Z}=x;if(T===ht){he(z,N);return}if(T===ur){w(x);return}const J=()=>{s(z),Z&&!Z.persisted&&Z.afterLeave&&Z.afterLeave()};if(x.shapeFlag&1&&Z&&!Z.persisted){const{leave:ue,delayLeave:le}=Z,ie=()=>ue(z,J);le?le(x.el,J,ie):ie()}else J()},he=(x,T)=>{let z;for(;x!==T;)z=$(x),s(x),x=z;s(T)},Ge=(x,T,z)=>{const{bum:N,scope:Z,job:J,subTree:ue,um:le,m:ie,a:Y}=x;B_(ie),B_(Y),N&&il(N),Z.stop(),J&&(J.flags|=8,X(ue,x,T,z)),le&&dn(le,T),dn(()=>{x.isUnmounted=!0},T)},qe=(x,T,z,N=!1,Z=!1,J=0)=>{for(let ue=J;ue<x.length;ue++)X(x[ue],T,z,N,Z)},He=x=>{if(x.shapeFlag&6)return He(x.component.subTree);if(x.shapeFlag&128)return x.suspense.next();const T=$(x.anchor||x.el),z=T&&T[rp];return z?$(z):T};let rt=!1;const bt=(x,T,z)=>{x==null?T._vnode&&X(T._vnode,null,null,!0):b(T._vnode||null,x,T,null,null,null,z),T._vnode=x,rt||(rt=!0,E_(),tp(),rt=!1)},$t={p:b,um:X,m:D,r:q,mt:de,mc:G,pc:A,pbc:U,n:He,o:e};return{render:bt,hydrate:void 0,createApp:Fg(bt)}}function $l({type:e,props:t},n){return n==="svg"&&e==="foreignObject"||n==="mathml"&&e==="annotation-xml"&&t&&t.encoding&&t.encoding.includes("html")?void 0:n}function Po({effect:e,job:t},n){n?(e.flags|=32,t.flags|=4):(e.flags&=-33,t.flags&=-5)}function Yg(e,t){return(!e||e&&!e.pendingBranch)&&t&&!t.persisted}function Du(e,t,n=!1){const o=e.children,s=t.children;if(De(o)&&De(s))for(let i=0;i<o.length;i++){const r=o[i];let a=s[i];a.shapeFlag&1&&!a.dynamicChildren&&((a.patchFlag<=0||a.patchFlag===32)&&(a=s[i]=no(s[i]),a.el=r.el),!n&&a.patchFlag!==-2&&Du(r,a)),a.type===$c&&a.patchFlag!==-1&&(a.el=r.el),a.type===fn&&!a.el&&(a.el=r.el)}}function Zg(e){const t=e.slice(),n=[0];let o,s,i,r,a;const c=e.length;for(o=0;o<c;o++){const l=e[o];if(l!==0){if(s=n[n.length-1],e[s]<l){t[o]=s,n.push(o);continue}for(i=0,r=n.length-1;i<r;)a=i+r>>1,e[n[a]]<l?i=a+1:r=a;l<e[n[i]]&&(i>0&&(t[o]=n[i-1]),n[i]=o)}}for(i=n.length,r=n[i-1];i-- >0;)n[i]=r,r=t[r];return n}function Ip(e){const t=e.subTree.component;if(t)return t.asyncDep&&!t.asyncResolved?t:Ip(t)}function B_(e){if(e)for(let t=0;t<e.length;t++)e[t].flags|=8}const Qg=Symbol.for("v-scx"),eb=()=>pa(Qg);function Ln(e,t,n){return Tp(e,t,n)}function Tp(e,t,n=ft){const{immediate:o,deep:s,flush:i,once:r}=n,a=Xt({},n),c=t&&o||!t&&i!=="post";let l;if(Sr){if(i==="sync"){const d=eb();l=d.__watcherHandles||(d.__watcherHandles=[])}else if(!c){const d=()=>{};return d.stop=is,d.resume=is,d.pause=is,d}}const u=hn;a.call=(d,p,b)=>us(d,u,p,b);let _=!1;i==="post"?a.scheduler=d=>{dn(d,u&&u.suspense)}:i!=="sync"&&(_=!0,a.scheduler=(d,p)=>{p?d():Au(d)}),a.augmentJob=d=>{t&&(d.flags|=4),_&&(d.flags|=2,u&&(d.id=u.uid,d.i=u))};const $=hg(e,t,a);return Sr&&(l?l.push($):c&&$()),$}function tb(e,t,n){const o=this.proxy,s=At(e)?e.includes(".")?Ep(o,e):()=>o[e]:e.bind(o,o);let i;ze(t)?i=t:(i=t.handler,n=t);const r=Hr(this),a=Tp(s,i.bind(o),n);return r(),a}function Ep(e,t){const n=t.split(".");return()=>{let o=e;for(let s=0;s<n.length&&o;s++)o=o[n[s]];return o}}const nb=(e,t)=>t==="modelValue"||t==="model-value"?e.modelModifiers:e[`${t}Modifiers`]||e[`${fo(t)}Modifiers`]||e[`${Qo(t)}Modifiers`];function sb(e,t,...n){if(e.isUnmounted)return;const o=e.vnode.props||ft;let s=n;const i=t.startsWith("update:"),r=i&&nb(o,t.slice(7));r&&(r.trim&&(s=n.map(u=>At(u)?u.trim():u)),r.number&&(s=n.map(G0)));let a,c=o[a=ol(t)]||o[a=ol(fo(t))];!c&&i&&(c=o[a=ol(Qo(t))]),c&&us(c,e,6,s);const l=o[a+"Once"];if(l){if(!e.emitted)e.emitted={};else if(e.emitted[a])return;e.emitted[a]=!0,us(l,e,6,s)}}const ob=new WeakMap;function Ap(e,t,n=!1){const o=n?ob:t.emitsCache,s=o.get(e);if(s!==void 0)return s;const i=e.emits;let r={},a=!1;if(!ze(e)){const c=l=>{const u=Ap(l,t,!0);u&&(a=!0,Xt(r,u))};!n&&t.mixins.length&&t.mixins.forEach(c),e.extends&&c(e.extends),e.mixins&&e.mixins.forEach(c)}return!i&&!a?(kt(e)&&o.set(e,null),null):(De(i)?i.forEach(c=>r[c]=null):Xt(r,i),kt(e)&&o.set(e,r),r)}function _c(e,t){return!e||!sc(t)?!1:(t=t.slice(2).replace(/Once$/,""),at(e,t[0].toLowerCase()+t.slice(1))||at(e,Qo(t))||at(e,t))}function z_(e){const{type:t,vnode:n,proxy:o,withProxy:s,propsOptions:[i],slots:r,attrs:a,emit:c,render:l,renderCache:u,props:_,data:$,setupState:d,ctx:p,inheritAttrs:b}=e,g=Ia(e);let m,v;try{if(n.shapeFlag&4){const w=s||o,k=w;m=ys(l.call(k,w,u,_,d,$,p)),v=a}else{const w=t;m=ys(w.length>1?w(_,{attrs:a,slots:r,emit:c}):w(_,null)),v=t.props?a:ib(a)}}catch(w){_r.length=0,cc(w,e,1),m=Pt(fn)}let y=m;if(v&&b!==!1){const w=Object.keys(v),{shapeFlag:k}=y;w.length&&k&7&&(i&&w.some(vu)&&(v=rb(v,i)),y=go(y,v,!1,!0))}return n.dirs&&(y=go(y,null,!1,!0),y.dirs=y.dirs?y.dirs.concat(n.dirs):n.dirs),n.transition&&wr(y,n.transition),m=y,Ia(g),m}const ib=e=>{let t;for(const n in e)(n==="class"||n==="style"||sc(n))&&((t||(t={}))[n]=e[n]);return t},rb=(e,t)=>{const n={};for(const o in e)(!vu(o)||!(o.slice(9)in t))&&(n[o]=e[o]);return n};function ab(e,t,n){const{props:o,children:s,component:i}=e,{props:r,children:a,patchFlag:c}=t,l=i.emitsOptions;if(t.dirs||t.transition)return!0;if(n&&c>=0){if(c&1024)return!0;if(c&16)return o?V_(o,r,l):!!r;if(c&8){const u=t.dynamicProps;for(let _=0;_<u.length;_++){const $=u[_];if(r[$]!==o[$]&&!_c(l,$))return!0}}}else return(s||a)&&(!a||!a.$stable)?!0:o===r?!1:o?r?V_(o,r,l):!0:!!r;return!1}function V_(e,t,n){const o=Object.keys(t);if(o.length!==Object.keys(e).length)return!0;for(let s=0;s<o.length;s++){const i=o[s];if(t[i]!==e[i]&&!_c(n,i))return!0}return!1}function cb({vnode:e,parent:t},n){for(;t;){const o=t.subTree;if(o.suspense&&o.suspense.activeBranch===e&&(o.el=e.el),o===e)(e=t.vnode).el=n,t=t.parent;else break}}const Gp=e=>e.__isSuspense;function lb(e,t){t&&t.pendingBranch?De(e)?t.effects.push(...e):t.effects.push(e):ep(e)}const ht=Symbol.for("v-fgt"),$c=Symbol.for("v-txt"),fn=Symbol.for("v-cmt"),ur=Symbol.for("v-stc"),_r=[];let Rn=null;function W(e=!1){_r.push(Rn=e?null:[])}function ub(){_r.pop(),Rn=_r[_r.length-1]||null}let vr=1;function Aa(e,t=!1){vr+=e,e<0&&Rn&&t&&(Rn.hasOnce=!0)}function Rp(e){return e.dynamicChildren=vr>0?Rn||yi:null,ub(),vr>0&&Rn&&Rn.push(e),e}function te(e,t,n,o,s,i){return Rp(h(e,t,n,o,s,i,!0))}function Mn(e,t,n,o,s){return Rp(Pt(e,t,n,o,s,!0))}function Ga(e){return e?e.__v_isVNode===!0:!1}function No(e,t){return e.type===t.type&&e.key===t.key}const Op=({key:e})=>e??null,ma=({ref:e,ref_key:t,ref_for:n})=>(typeof e=="number"&&(e=""+e),e!=null?At(e)||ln(e)||ze(e)?{i:Wn,r:e,k:t,f:!!n}:e:null);function h(e,t=null,n=null,o=0,s=null,i=e===ht?0:1,r=!1,a=!1){const c={__v_isVNode:!0,__v_skip:!0,type:e,props:t,key:t&&Op(t),ref:t&&ma(t),scopeId:sp,slotScopeIds:null,children:n,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:i,patchFlag:o,dynamicProps:s,dynamicChildren:null,appContext:null,ctx:Wn};return a?(Nu(c,n),i&128&&e.normalize(c)):n&&(c.shapeFlag|=At(n)?8:16),vr>0&&!r&&Rn&&(c.patchFlag>0||i&6)&&c.patchFlag!==32&&Rn.push(c),c}const Pt=_b;function _b(e,t=null,n=null,o=0,s=null,i=!1){if((!e||e===Ag)&&(e=fn),Ga(e)){const a=go(e,t,!0);return n&&Nu(a,n),vr>0&&!i&&Rn&&(a.shapeFlag&6?Rn[Rn.indexOf(e)]=a:Rn.push(a)),a.patchFlag=-2,a}if(wb(e)&&(e=e.__vccOpts),t){t=$b(t);let{class:a,style:c}=t;a&&!At(a)&&(t.class=St(a)),kt(c)&&(Eu(c)&&!De(c)&&(c=Xt({},c)),t.style=zn(c))}const r=At(e)?1:Gp(e)?128:ap(e)?64:kt(e)?4:ze(e)?2:0;return h(e,t,n,o,s,r,i,!0)}function $b(e){return e?Eu(e)||kp(e)?Xt({},e):e:null}function go(e,t,n=!1,o=!1){const{props:s,ref:i,patchFlag:r,children:a,transition:c}=e,l=t?db(s||{},t):s,u={__v_isVNode:!0,__v_skip:!0,type:e.type,props:l,key:l&&Op(l),ref:t&&t.ref?n&&i?De(i)?i.concat(ma(t)):[i,ma(t)]:ma(t):i,scopeId:e.scopeId,slotScopeIds:e.slotScopeIds,children:a,target:e.target,targetStart:e.targetStart,targetAnchor:e.targetAnchor,staticCount:e.staticCount,shapeFlag:e.shapeFlag,patchFlag:t&&e.type!==ht?r===-1?16:r|16:r,dynamicProps:e.dynamicProps,dynamicChildren:e.dynamicChildren,appContext:e.appContext,dirs:e.dirs,transition:c,component:e.component,suspense:e.suspense,ssContent:e.ssContent&&go(e.ssContent),ssFallback:e.ssFallback&&go(e.ssFallback),placeholder:e.placeholder,el:e.el,anchor:e.anchor,ctx:e.ctx,ce:e.ce};return c&&o&&wr(u,c.clone(u)),u}function Wo(e=" ",t=0){return Pt($c,null,e,t)}function Ra(e,t){const n=Pt(ur,null,e);return n.staticCount=t,n}function Ie(e="",t=!1){return t?(W(),Mn(fn,null,e)):Pt(fn,null,e)}function ys(e){return e==null||typeof e=="boolean"?Pt(fn):De(e)?Pt(ht,null,e.slice()):Ga(e)?no(e):Pt($c,null,String(e))}function no(e){return e.el===null&&e.patchFlag!==-1||e.memo?e:go(e)}function Nu(e,t){let n=0;const{shapeFlag:o}=e;if(t==null)t=null;else if(De(t))n=16;else if(typeof t=="object")if(o&65){const s=t.default;s&&(s._c&&(s._d=!1),Nu(e,s()),s._c&&(s._d=!0));return}else{n=32;const s=t._;!s&&!kp(t)?t._ctx=Wn:s===3&&Wn&&(Wn.slots._===1?t._=1:(t._=2,e.patchFlag|=1024))}else ze(t)?(t={default:t,_ctx:Wn},n=32):(t=String(t),o&64?(n=16,t=[Wo(t)]):n=8);e.children=t,e.shapeFlag|=n}function db(...e){const t={};for(let n=0;n<e.length;n++){const o=e[n];for(const s in o)if(s==="class")t.class!==o.class&&(t.class=St([t.class,o.class]));else if(s==="style")t.style=zn([t.style,o.style]);else if(sc(s)){const i=t[s],r=o[s];r&&i!==r&&!(De(i)&&i.includes(r))&&(t[s]=i?[].concat(i,r):r)}else s!==""&&(t[s]=o[s])}return t}function $s(e,t,n,o=null){us(e,t,7,[n,o])}const pb=wp();let mb=0;function fb(e,t,n){const o=e.type,s=(t?t.appContext:e.appContext)||pb,i={uid:mb++,vnode:e,type:o,parent:t,appContext:s,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new B0(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:t?t.provides:Object.create(s.provides),ids:t?t.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:Cp(o,s),emitsOptions:Ap(o,s),emit:null,emitted:null,propsDefaults:ft,inheritAttrs:o.inheritAttrs,ctx:ft,data:ft,props:ft,attrs:ft,slots:ft,refs:ft,setupState:ft,setupContext:null,suspense:n,suspenseId:n?n.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return i.ctx={_:i},i.root=t?t.root:i,i.emit=sb.bind(null,i),e.ce&&e.ce(i),i}let hn=null;const ju=()=>hn||Wn;let Oa,Xl;{const e=rc(),t=(n,o)=>{let s;return(s=e[n])||(s=e[n]=[]),s.push(o),i=>{s.length>1?s.forEach(r=>r(i)):s[0](i)}};Oa=t("__VUE_INSTANCE_SETTERS__",n=>hn=n),Xl=t("__VUE_SSR_SETTERS__",n=>Sr=n)}const Hr=e=>{const t=hn;return Oa(e),e.scope.on(),()=>{e.scope.off(),Oa(t)}},q_=()=>{hn&&hn.scope.off(),Oa(null)};function Dp(e){return e.vnode.shapeFlag&4}let Sr=!1;function hb(e,t=!1,n=!1){t&&Xl(t);const{props:o,children:s}=e.vnode,i=Dp(e);Bg(e,o,i,t),Wg(e,s,n||t);const r=i?gb(e,t):void 0;return t&&Xl(!1),r}function gb(e,t){const n=e.type;e.accessCache=Object.create(null),e.proxy=new Proxy(e.ctx,Gg);const{setup:o}=n;if(o){qs();const s=e.setupContext=o.length>1?yb(e):null,i=Hr(e),r=jr(o,e,0,[e.props,s]),a=Ld(r);if(Ws(),i(),(a||e.sp)&&!cr(e)&&fp(e),a){if(r.then(q_,q_),t)return r.then(c=>{W_(e,c)}).catch(c=>{cc(c,e,0)});e.asyncDep=r}else W_(e,r)}else Np(e)}function W_(e,t,n){ze(t)?e.type.__ssrInlineRender?e.ssrRender=t:e.render=t:kt(t)&&(e.setupState=Yd(t)),Np(e)}function Np(e,t,n){const o=e.type;e.render||(e.render=o.render||is);{const s=Hr(e);qs();try{Rg(e)}finally{Ws(),s()}}}const bb={get(e,t){return tn(e,"get",""),e[t]}};function yb(e){const t=n=>{e.exposed=n||{}};return{attrs:new Proxy(e.attrs,bb),slots:e.slots,emit:e.emit,expose:t}}function dc(e){return e.exposed?e.exposeProxy||(e.exposeProxy=new Proxy(Yd(ug(e.exposed)),{get(t,n){if(n in t)return t[n];if(n in lr)return lr[n](e)},has(t,n){return n in t||n in lr}})):e.proxy}function wb(e){return ze(e)&&"__vccOpts"in e}const Je=(e,t)=>mg(e,t,Sr);function vb(e,t,n){try{Aa(-1);const o=arguments.length;return o===2?kt(t)&&!De(t)?Ga(t)?Pt(e,null,[t]):Pt(e,t):Pt(e,null,t):(o>3?n=Array.prototype.slice.call(arguments,2):o===3&&Ga(n)&&(n=[n]),Pt(e,t,n))}finally{Aa(1)}}const Sb="3.5.22";/**
* @vue/runtime-dom v3.5.22
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let Yl;const K_=typeof window<"u"&&window.trustedTypes;if(K_)try{Yl=K_.createPolicy("vue",{createHTML:e=>e})}catch{}const jp=Yl?e=>Yl.createHTML(e):e=>e,kb="http://www.w3.org/2000/svg",Mb="http://www.w3.org/1998/Math/MathML",js=typeof document<"u"?document:null,J_=js&&js.createElement("template"),Cb={insert:(e,t,n)=>{t.insertBefore(e,n||null)},remove:e=>{const t=e.parentNode;t&&t.removeChild(e)},createElement:(e,t,n,o)=>{const s=t==="svg"?js.createElementNS(kb,e):t==="mathml"?js.createElementNS(Mb,e):n?js.createElement(e,{is:n}):js.createElement(e);return e==="select"&&o&&o.multiple!=null&&s.setAttribute("multiple",o.multiple),s},createText:e=>js.createTextNode(e),createComment:e=>js.createComment(e),setText:(e,t)=>{e.nodeValue=t},setElementText:(e,t)=>{e.textContent=t},parentNode:e=>e.parentNode,nextSibling:e=>e.nextSibling,querySelector:e=>js.querySelector(e),setScopeId(e,t){e.setAttribute(t,"")},insertStaticContent(e,t,n,o,s,i){const r=n?n.previousSibling:t.lastChild;if(s&&(s===i||s.nextSibling))for(;t.insertBefore(s.cloneNode(!0),n),!(s===i||!(s=s.nextSibling)););else{J_.innerHTML=jp(o==="svg"?`<svg>${e}</svg>`:o==="mathml"?`<math>${e}</math>`:e);const a=J_.content;if(o==="svg"||o==="mathml"){const c=a.firstChild;for(;c.firstChild;)a.appendChild(c.firstChild);a.removeChild(c)}t.insertBefore(a,n)}return[r?r.nextSibling:t.firstChild,n?n.previousSibling:t.lastChild]}},Ys="transition",Ui="animation",kr=Symbol("_vtc"),Hp={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String},xb=Xt({},_p,Hp),Pb=e=>(e.displayName="Transition",e.props=xb,e),Lb=Pb((e,{slots:t})=>vb(Sg,Ib(e),t)),Lo=(e,t=[])=>{De(e)?e.forEach(n=>n(...t)):e&&e(...t)},X_=e=>e?De(e)?e.some(t=>t.length>1):e.length>1:!1;function Ib(e){const t={};for(const M in e)M in Hp||(t[M]=e[M]);if(e.css===!1)return t;const{name:n="v",type:o,duration:s,enterFromClass:i=`${n}-enter-from`,enterActiveClass:r=`${n}-enter-active`,enterToClass:a=`${n}-enter-to`,appearFromClass:c=i,appearActiveClass:l=r,appearToClass:u=a,leaveFromClass:_=`${n}-leave-from`,leaveActiveClass:$=`${n}-leave-active`,leaveToClass:d=`${n}-leave-to`}=e,p=Tb(s),b=p&&p[0],g=p&&p[1],{onBeforeEnter:m,onEnter:v,onEnterCancelled:y,onLeave:w,onLeaveCancelled:k,onBeforeAppear:L=m,onAppear:P=v,onAppearCancelled:G=y}=t,I=(M,B,de,oe)=>{M._enterCancelled=oe,Io(M,B?u:a),Io(M,B?l:r),de&&de()},U=(M,B)=>{M._isLeaving=!1,Io(M,_),Io(M,d),Io(M,$),B&&B()},R=M=>(B,de)=>{const oe=M?P:v,be=()=>I(B,M,de);Lo(oe,[B,be]),Y_(()=>{Io(B,M?c:i),Ns(B,M?u:a),X_(oe)||Z_(B,o,b,be)})};return Xt(t,{onBeforeEnter(M){Lo(m,[M]),Ns(M,i),Ns(M,r)},onBeforeAppear(M){Lo(L,[M]),Ns(M,c),Ns(M,l)},onEnter:R(!1),onAppear:R(!0),onLeave(M,B){M._isLeaving=!0;const de=()=>U(M,B);Ns(M,_),M._enterCancelled?(Ns(M,$),t$(M)):(t$(M),Ns(M,$)),Y_(()=>{M._isLeaving&&(Io(M,_),Ns(M,d),X_(w)||Z_(M,o,g,de))}),Lo(w,[M,de])},onEnterCancelled(M){I(M,!1,void 0,!0),Lo(y,[M])},onAppearCancelled(M){I(M,!0,void 0,!0),Lo(G,[M])},onLeaveCancelled(M){U(M),Lo(k,[M])}})}function Tb(e){if(e==null)return null;if(kt(e))return[dl(e.enter),dl(e.leave)];{const t=dl(e);return[t,t]}}function dl(e){return R0(e)}function Ns(e,t){t.split(/\s+/).forEach(n=>n&&e.classList.add(n)),(e[kr]||(e[kr]=new Set)).add(t)}function Io(e,t){t.split(/\s+/).forEach(o=>o&&e.classList.remove(o));const n=e[kr];n&&(n.delete(t),n.size||(e[kr]=void 0))}function Y_(e){requestAnimationFrame(()=>{requestAnimationFrame(e)})}let Eb=0;function Z_(e,t,n,o){const s=e._endId=++Eb,i=()=>{s===e._endId&&o()};if(n!=null)return setTimeout(i,n);const{type:r,timeout:a,propCount:c}=Ab(e,t);if(!r)return o();const l=r+"end";let u=0;const _=()=>{e.removeEventListener(l,$),i()},$=d=>{d.target===e&&++u>=c&&_()};setTimeout(()=>{u<c&&_()},a+1),e.addEventListener(l,$)}function Ab(e,t){const n=window.getComputedStyle(e),o=p=>(n[p]||"").split(", "),s=o(`${Ys}Delay`),i=o(`${Ys}Duration`),r=Q_(s,i),a=o(`${Ui}Delay`),c=o(`${Ui}Duration`),l=Q_(a,c);let u=null,_=0,$=0;t===Ys?r>0&&(u=Ys,_=r,$=i.length):t===Ui?l>0&&(u=Ui,_=l,$=c.length):(_=Math.max(r,l),u=_>0?r>l?Ys:Ui:null,$=u?u===Ys?i.length:c.length:0);const d=u===Ys&&/\b(?:transform|all)(?:,|$)/.test(o(`${Ys}Property`).toString());return{type:u,timeout:_,propCount:$,hasTransform:d}}function Q_(e,t){for(;e.length<t.length;)e=e.concat(e);return Math.max(...t.map((n,o)=>e$(n)+e$(e[o])))}function e$(e){return e==="auto"?0:Number(e.slice(0,-1).replace(",","."))*1e3}function t$(e){return(e?e.ownerDocument:document).body.offsetHeight}function Gb(e,t,n){const o=e[kr];o&&(t=(t?[t,...o]:[...o]).join(" ")),t==null?e.removeAttribute("class"):n?e.setAttribute("class",t):e.className=t}const Da=Symbol("_vod"),Fp=Symbol("_vsh"),Up={name:"show",beforeMount(e,{value:t},{transition:n}){e[Da]=e.style.display==="none"?"":e.style.display,n&&t?n.beforeEnter(e):Bi(e,t)},mounted(e,{value:t},{transition:n}){n&&t&&n.enter(e)},updated(e,{value:t,oldValue:n},{transition:o}){!t!=!n&&(o?t?(o.beforeEnter(e),Bi(e,!0),o.enter(e)):o.leave(e,()=>{Bi(e,!1)}):Bi(e,t))},beforeUnmount(e,{value:t}){Bi(e,t)}};function Bi(e,t){e.style.display=t?e[Da]:"none",e[Fp]=!t}const Bp=Symbol("");function es(e){const t=ju();if(!t)return;const n=t.ut=(s=e(t.proxy))=>{Array.from(document.querySelectorAll(`[data-v-owner="${t.uid}"]`)).forEach(i=>Na(i,s))},o=()=>{const s=e(t.proxy);t.ce?Na(t.ce,s):Zl(t.subTree,s),n(s)};gp(()=>{ep(o)}),gn(()=>{Ln(o,is,{flush:"post"});const s=new MutationObserver(o);s.observe(t.subTree.el.parentNode,{childList:!0}),Gu(()=>s.disconnect())})}function Zl(e,t){if(e.shapeFlag&128){const n=e.suspense;e=n.activeBranch,n.pendingBranch&&!n.isHydrating&&n.effects.push(()=>{Zl(n.activeBranch,t)})}for(;e.component;)e=e.component.subTree;if(e.shapeFlag&1&&e.el)Na(e.el,t);else if(e.type===ht)e.children.forEach(n=>Zl(n,t));else if(e.type===ur){let{el:n,anchor:o}=e;for(;n&&(Na(n,t),n!==o);)n=n.nextSibling}}function Na(e,t){if(e.nodeType===1){const n=e.style;let o="";for(const s in t){const i=U0(t[s]);n.setProperty(`--${s}`,i),o+=`--${s}: ${i};`}n[Bp]=o}}const Rb=/(?:^|;)\s*display\s*:/;function Ob(e,t,n){const o=e.style,s=At(n);let i=!1;if(n&&!s){if(t)if(At(t))for(const r of t.split(";")){const a=r.slice(0,r.indexOf(":")).trim();n[a]==null&&fa(o,a,"")}else for(const r in t)n[r]==null&&fa(o,r,"");for(const r in n)r==="display"&&(i=!0),fa(o,r,n[r])}else if(s){if(t!==n){const r=o[Bp];r&&(n+=";"+r),o.cssText=n,i=Rb.test(n)}}else t&&e.removeAttribute("style");Da in e&&(e[Da]=i?o.display:"",e[Fp]&&(o.display="none"))}const n$=/\s*!important$/;function fa(e,t,n){if(De(n))n.forEach(o=>fa(e,t,o));else if(n==null&&(n=""),t.startsWith("--"))e.setProperty(t,n);else{const o=Db(e,t);n$.test(n)?e.setProperty(Qo(o),n.replace(n$,""),"important"):e[o]=n}}const s$=["Webkit","Moz","ms"],pl={};function Db(e,t){const n=pl[t];if(n)return n;let o=fo(t);if(o!=="filter"&&o in e)return pl[t]=o;o=Ed(o);for(let s=0;s<s$.length;s++){const i=s$[s]+o;if(i in e)return pl[t]=i}return t}const o$="http://www.w3.org/1999/xlink";function i$(e,t,n,o,s,i=F0(t)){o&&t.startsWith("xlink:")?n==null?e.removeAttributeNS(o$,t.slice(6,t.length)):e.setAttributeNS(o$,t,n):n==null||i&&!Gd(n)?e.removeAttribute(t):e.setAttribute(t,i?"":ko(n)?String(n):n)}function r$(e,t,n,o,s){if(t==="innerHTML"||t==="textContent"){n!=null&&(e[t]=t==="innerHTML"?jp(n):n);return}const i=e.tagName;if(t==="value"&&i!=="PROGRESS"&&!i.includes("-")){const a=i==="OPTION"?e.getAttribute("value")||"":e.value,c=n==null?e.type==="checkbox"?"on":"":String(n);(a!==c||!("_value"in e))&&(e.value=c),n==null&&e.removeAttribute(t),e._value=n;return}let r=!1;if(n===""||n==null){const a=typeof e[t];a==="boolean"?n=Gd(n):n==null&&a==="string"?(n="",r=!0):a==="number"&&(n=0,r=!0)}try{e[t]=n}catch{}r&&e.removeAttribute(s||t)}function Nb(e,t,n,o){e.addEventListener(t,n,o)}function jb(e,t,n,o){e.removeEventListener(t,n,o)}const a$=Symbol("_vei");function Hb(e,t,n,o,s=null){const i=e[a$]||(e[a$]={}),r=i[t];if(o&&r)r.value=o;else{const[a,c]=Fb(t);if(o){const l=i[t]=zb(o,s);Nb(e,a,l,c)}else r&&(jb(e,a,r,c),i[t]=void 0)}}const c$=/(?:Once|Passive|Capture)$/;function Fb(e){let t;if(c$.test(e)){t={};let o;for(;o=e.match(c$);)e=e.slice(0,e.length-o[0].length),t[o[0].toLowerCase()]=!0}return[e[2]===":"?e.slice(3):Qo(e.slice(2)),t]}let ml=0;const Ub=Promise.resolve(),Bb=()=>ml||(Ub.then(()=>ml=0),ml=Date.now());function zb(e,t){const n=o=>{if(!o._vts)o._vts=Date.now();else if(o._vts<=n.attached)return;us(Vb(o,n.value),t,5,[o])};return n.value=e,n.attached=Bb(),n}function Vb(e,t){if(De(t)){const n=e.stopImmediatePropagation;return e.stopImmediatePropagation=()=>{n.call(e),e._stopped=!0},t.map(o=>s=>!s._stopped&&o&&o(s))}else return t}const l$=e=>e.charCodeAt(0)===111&&e.charCodeAt(1)===110&&e.charCodeAt(2)>96&&e.charCodeAt(2)<123,qb=(e,t,n,o,s,i)=>{const r=s==="svg";t==="class"?Gb(e,o,r):t==="style"?Ob(e,n,o):sc(t)?vu(t)||Hb(e,t,n,o,i):(t[0]==="."?(t=t.slice(1),!0):t[0]==="^"?(t=t.slice(1),!1):Wb(e,t,o,r))?(r$(e,t,o),!e.tagName.includes("-")&&(t==="value"||t==="checked"||t==="selected")&&i$(e,t,o,r,i,t!=="value")):e._isVueCE&&(/[A-Z]/.test(t)||!At(o))?r$(e,fo(t),o,i,t):(t==="true-value"?e._trueValue=o:t==="false-value"&&(e._falseValue=o),i$(e,t,o,r))};function Wb(e,t,n,o){if(o)return!!(t==="innerHTML"||t==="textContent"||t in e&&l$(t)&&ze(n));if(t==="spellcheck"||t==="draggable"||t==="translate"||t==="autocorrect"||t==="form"||t==="list"&&e.tagName==="INPUT"||t==="type"&&e.tagName==="TEXTAREA")return!1;if(t==="width"||t==="height"){const s=e.tagName;if(s==="IMG"||s==="VIDEO"||s==="CANVAS"||s==="SOURCE")return!1}return l$(t)&&At(n)?!1:t in e}const Kb=["ctrl","shift","alt","meta"],Jb={stop:e=>e.stopPropagation(),prevent:e=>e.preventDefault(),self:e=>e.target!==e.currentTarget,ctrl:e=>!e.ctrlKey,shift:e=>!e.shiftKey,alt:e=>!e.altKey,meta:e=>!e.metaKey,left:e=>"button"in e&&e.button!==0,middle:e=>"button"in e&&e.button!==1,right:e=>"button"in e&&e.button!==2,exact:(e,t)=>Kb.some(n=>e[`${n}Key`]&&!t.includes(n))},Bs=(e,t)=>{const n=e._withMods||(e._withMods={}),o=t.join(".");return n[o]||(n[o]=(s,...i)=>{for(let r=0;r<t.length;r++){const a=Jb[t[r]];if(a&&a(s,t))return}return e(s,...i)})},Xb=Xt({patchProp:qb},Cb);let u$;function Yb(){return u$||(u$=Jg(Xb))}const _$=(...e)=>{const t=Yb().createApp(...e),{mount:n}=t;return t.mount=o=>{const s=Qb(o);if(!s)return;const i=t._component;!ze(i)&&!i.render&&!i.template&&(i.template=s.innerHTML),s.nodeType===1&&(s.textContent="");const r=n(s,!1,Zb(s));return s instanceof Element&&(s.removeAttribute("v-cloak"),s.setAttribute("data-v-app","")),r},t};function Zb(e){if(e instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&e instanceof MathMLElement)return"mathml"}function Qb(e){return At(e)?document.querySelector(e):e}const ha={maxRetries:3,retryDelay:1e3,timeout:1e4};let fl=null;const Mi={enabled:!0,maxCacheSize:50*1024*1024,cachePrefix:"mgpic_",version:"1.0.0",loadInterval:50,batchSize:3};class e1{constructor(){this.cache=new Map,this.totalSize=0}isSupported(){return"caches"in window}getCacheName(){return`${Mi.cachePrefix}${Mi.version}`}async isCached(t){if(!this.isSupported())return!1;try{return await(await caches.open(this.getCacheName())).match(t)!==void 0}catch(n){return f(":",n.message),!1}}async cacheResource(t,n){if(!this.isSupported())return!1;try{const o=await caches.open(this.getCacheName());if(await o.match(t))return f(`: ${t}`),!0;await o.put(t,n.clone());const i=n.headers.get("content-length");return i&&(this.totalSize+=parseInt(i)),f(`: ${t}`),!0}catch(o){return f(":",o.message),!1}}async getCachedResource(t){if(!this.isSupported())return null;try{return await(await caches.open(this.getCacheName())).match(t)}catch(n){return f(":",n.message),null}}async cleanupCache(){if(this.isSupported())try{const t=await caches.keys(),n=this.getCacheName();for(const o of t)o.startsWith(Mi.cachePrefix)&&o!==n&&(await caches.delete(o),f(`: ${o}`))}catch(t){f(":",t.message)}}}const Kn=new e1;let na=null;function t1(){return na||(f("R2 URL"),na="https://pub-6f9181bda40946ea92b5e87fe84e27d4.r2.dev",na)}function ee(e){let t=e;e.startsWith("/assets/")?t=e.slice(7):e.startsWith("@assets/")&&(t=e.slice(8));const n=t1(),o=t.startsWith("/")?t.slice(1):t;return`${n}/${o}`}async function zp(e,t={}){if(Kn.isSupported()){const s=await Kn.getCachedResource(e);if(s)return f(` Cache Storage : ${e}`),s}const{maxRetries:n=ha.maxRetries,retryDelay:o=ha.retryDelay}=t;for(let s=1;s<=n;s++)try{f(` (${s}/${n}): ${e}`);const i=new AbortController,r=setTimeout(()=>i.abort(),ha.timeout),a=await fetch(e,{method:"GET",mode:"cors",credentials:"omit",cache:"no-cache",signal:i.signal,...t});if(clearTimeout(r),a.ok)return Kn.isSupported()&&await Kn.cacheResource(e,a),f(`: ${e}`),a;throw new Error(`HTTP ${a.status}: ${a.statusText}`)}catch(i){if(f(` (${s}/${n}): ${e}`,i.message),s===n)throw f(`: ${e}`,i.message),i;const r=o*s;f(` ${r}ms ...`),await new Promise(a=>setTimeout(a,r))}}async function n1(e=["high","medium"]){try{if(fl){f("");const i=$$(fl,e);return f(` ${i.length}  (: ${e.join(", ")})`),i}const t=ee("asset-list.json");f(` R2 CDN : ${t}`);const n=await zp(t);if(!n.ok)throw new Error(`: HTTP ${n.status}`);const o=await n.json();fl=o,f("");const s=$$(o,e);return f(` ${s.length}  (: ${e.join(", ")})`),s}catch(t){return f(":",t.message),["logo.glb","frontend_resource/start_game.webp","frontend_resource/copper_warehouse.webp","frontend_resource/game_wiki.webp","frontend_resource/Tutorial.webp","frontend_resource/gacha.webp"]}}function $$(e,t){const n=[];for(const o of t)if(e.categories&&e.categories[o]){const s=e.categories[o].resources||[];n.push(...s.map(i=>i.path))}return n}async function Ql(e=null,t=["high","medium"]){f("..."),await Kn.cleanupCache();const n=await n1(t),o=Mi.batchSize,s=Mi.loadInterval,i=n.length;let r=0;e&&e(0,i,0);for(let a=0;a<n.length;a+=o){const c=n.slice(a,a+o);f(` ${Math.floor(a/o)+1}/${Math.ceil(n.length/o)}: ${c.length} `);const l=c.map(async(g,m)=>{const v=ee(g);try{if(await Kn.isCached(v))return f(`Cache Storage: ${g}`),{success:!0,path:g,cached:!0,source:"cache"};const w=new AbortController,k=setTimeout(()=>w.abort(),ha.timeout),L=await fetch(v,{method:"GET",mode:"cors",credentials:"omit",cache:"no-cache",signal:w.signal});if(clearTimeout(k),L.ok){const P=L.headers.get("x-cache")||L.headers.get("cf-cache-status")||L.type==="basic"&&!L.redirected;return Kn.isSupported()&&await Kn.cacheResource(v,L),f(`: ${g}${P?" ()":""}`),{success:!0,path:g,cached:!1,fromBrowserCache:!!P}}else throw new Error(`HTTP ${L.status}: ${L.statusText}`)}catch(y){return f(`: ${g}`,y.message),{success:!1,path:g,error:y.message}}}),u=await Promise.all(l);r+=c.length;const _=Math.round(r/i*100);e&&e(r,i,_);const $=u.filter(g=>g.success).length,d=u.filter(g=>g.cached).length,p=u.filter(g=>g.fromBrowserCache).length,b=u.filter(g=>!g.success).length;f(`:  ${$}, Cache Storage ${d},  ${p},  ${b}`),a+o<n.length&&(f(` ${s}ms ...`),await new Promise(g=>setTimeout(g,s)))}f(""),e&&e(i,i,100)}async function s1(){if(!Kn.isSupported())return{supported:!1,message:"API"};try{const t=await(await caches.open(Kn.getCacheName())).keys();return{supported:!0,cacheName:Kn.getCacheName(),resourceCount:t.length,totalSize:Kn.totalSize,maxSize:Mi.maxCacheSize}}catch(e){return{supported:!0,error:e.message}}}function pc(e,t){return ee(`copper/${e.toLowerCase()}/${t}/${t}.glb`)}function mc(e){return ee(`enemy/${e}/${e}.glb`)}function Vp(e){return ee(`structure/${e}/${e}.glb`)}function o1(e){return ee(e)}const Vt=(e,t)=>{const n=e.__vccOpts||e;for(const[o,s]of t)n[o]=s;return n},i1={class:"hall-container"},r1=["src"],a1={__name:"Hall",props:{musicOn:{type:Boolean,default:!0},paused:{type:Boolean,default:!1}},emits:["startGame","openWarehouse","openTutorial","openEncyclopedia","toggle-music"],setup(e,{emit:t}){const n=t,o=e;function s(){n("startGame")}function i(){n("openWarehouse")}function r(){n("openTutorial")}function a(){const g="https://mgpic-2025.github.io/CopperPuppetry-Wiki/";f(`[Hall] : ${g}`),window!=null&&window.open?window.open(g,"_blank","noopener"):window.location.href=g}const c=se(ee("@assets/frontend_resource/start_game.webp")),l=se(ee("@assets/frontend_resource/copper_warehouse.webp")),u=se(ee("@assets/frontend_resource/game_wiki.webp")),_=se(ee("@assets/frontend_resource/Tutorial.webp")),$=se(ee("ui/Gemini_Generated_Image_gtrehogtrehogtre (1).png")),d=se(!1),p=se(null),b=ee("@assets/frontend_resource/hall.mp3");return gn(()=>{setTimeout(()=>{d.value=!0,f("HallUI")},100),o.musicOn&&!o.paused&&p.value&&setTimeout(()=>{if(p.value.readyState>=2)p.value.play().then(()=>{f("[Hall] ")}).catch(m=>{f("[Hall] :",m)});else{const m=()=>{p.value.play().then(()=>{f("[Hall] ")}).catch(v=>{f("[Hall] :",v)}),p.value.removeEventListener("canplay",m)};p.value.addEventListener("canplay",m,{once:!0})}},200)}),Ln(()=>o.musicOn,g=>{if(p.value)if(g&&!o.paused)if(p.value.readyState>=2)p.value.play().catch(m=>{f("[Hall] :",m)});else{const m=()=>{p.value.play().catch(v=>{f("[Hall] :",v)}),p.value.removeEventListener("canplay",m)};p.value.addEventListener("canplay",m)}else p.value.pause()}),Ln(()=>o.paused,g=>{if(p.value){if(g)p.value.pause(),f("[Hall] ");else if(o.musicOn){if(p.value.readyState>=2)p.value.play().catch(m=>{f("[Hall] :",m)});else{const m=()=>{p.value.play().catch(v=>{f("[Hall] :",v)}),p.value.removeEventListener("canplay",m)};p.value.addEventListener("canplay",m)}f("[Hall] ")}}}),Is(()=>{p.value&&p.value.pause()}),(g,m)=>(W(),te("div",i1,[h("div",{class:"hall-bg",style:zn({backgroundImage:`url('${$.value}')`})},null,4),h("div",{class:St(["menu",{"menu--loaded":d.value}])},[h("button",{class:"tile tile--start",style:zn({backgroundImage:`url('${c.value}')`}),onClick:s},[...m[0]||(m[0]=[h("div",{class:"tile__mask"},null,-1),h("div",{class:"tile__caption tile__caption--bottom"},[h("div",{class:"tile__title"},""),h("div",{class:"tile__subtitle"},"Begin Adventure")],-1)])],4),h("button",{class:"tile tile--warehouse",style:zn({backgroundImage:`url('${l.value}')`}),onClick:i},[...m[1]||(m[1]=[h("div",{class:"tile__mask"},null,-1),h("div",{class:"tile__caption tile__caption--top"},[h("div",{class:"tile__title"},""),h("div",{class:"tile__subtitle"},"Character Collection")],-1)])],4),h("button",{class:"tile tile--wiki",style:zn({backgroundImage:`url('${u.value}')`}),onClick:a},[...m[2]||(m[2]=[h("div",{class:"tile__mask"},null,-1),h("div",{class:"tile__caption tile__caption--bottom"},[h("div",{class:"tile__title"},""),h("div",{class:"tile__subtitle"},"Encyclopedia")],-1)])],4),h("button",{class:"tile tile--tutorial",style:zn({backgroundImage:`url('${_.value}')`}),onClick:r},[...m[3]||(m[3]=[h("div",{class:"tile__mask"},null,-1),h("div",{class:"tile__caption tile__caption--top"},[h("div",{class:"tile__title"},""),h("div",{class:"tile__subtitle"},"Tutorial")],-1)])],4)],2),h("audio",{ref_key:"audioRef",ref:p,src:we(b),loop:"",preload:"auto"},null,8,r1)]))}},c1=Vt(a1,[["__scopeId","data-v-f6623161"]]),Jn={HeartCrystalDust:{name:"",icon:ee("resource/heart_crystal_dust.webp")},RecallGear:{name:"",icon:ee("resource/recall_gear.webp")},ResonantCrystal:{name:"",icon:ee("resource/resonant_star_crystal/resonant_star_crystal.webp")},RefinedCopper:{name:"",icon:ee("resource/refined_copper_ingot/refined_copper_ingot.webp")},SpiritalSpark:{name:"",icon:ee("resource/spiritual_spark.webp")}};function fc(e){var t;if(Array.isArray(e==null?void 0:e.item_type)&&e.item_type[0]==="Resource"){const n=e.item_type[1];return((t=Jn[n])==null?void 0:t.name)||n}else if(Array.isArray(e==null?void 0:e.item_type)&&e.item_type[0]==="Equipment")return"";return""}function en(e){var t;return((t=Jn[e])==null?void 0:t.name)||e}function ds(e){var t;return((t=Jn[e])==null?void 0:t.icon)||""}function l1(e){return{all:e=e||new Map,on:function(t,n){var o=e.get(t);o?o.push(n):e.set(t,[n])},off:function(t,n){var o=e.get(t);o&&(n?o.splice(o.indexOf(n)>>>0,1):e.set(t,[]))},emit:function(t,n){var o=e.get(t);o&&o.slice().map(function(s){s(n)}),(o=e.get("*"))&&o.slice().map(function(s){s(t,n)})}}}const Hu=l1(),Sn={UPDATE_RESOURCES:"update:resources",RESOURCES_UPDATED:"resources:updated",COPPER_ID_ADDED:"copper:id:added",START_MENU_PAUSE:"menu:pause",START_MENU_RESUME:"menu:resume",START_MENU_STARTED:"menu:started",CONTROL_MODE_CHANGED:"control:mode:changed",GAME_STARTED:"game:started",GAME_ENDED:"game:ended"},jo=(e,t)=>{Hu.emit(e,t)},hc=(e,t)=>{Hu.on(e,t)},Fu=(e,t)=>{Hu.off(e,t)};class u1{constructor(){this.queue=[],this.isProcessing=!1,this.handlers=new Map,this.sceneContext=null}setSceneContext(t){this.sceneContext=t}registerHandler(t,n){this.handlers.set(t,n)}enqueue(t){["handle_on_click_copper","on_game_start"].includes(t.type_msg)&&f("[MessageQueue] :",t.type_msg),this.queue.push(t),this.isProcessing||this.processNext()}async processNext(){if(this.queue.length===0){this.isProcessing=!1;return}this.isProcessing=!0;const t=50;let n=0;for(;this.queue.length>0&&n<t;){const o=this.queue.shift();n++;try{const{type_msg:s,content:i}=o,r=this.handlers.get(s);if(r){const a=JSON.parse(i),c=r(a,this.sceneContext||{});c&&typeof c.then=="function"&&await c}else f("[MessageQueue] :",s),f("[MessageQueue] :",Array.from(this.handlers.keys()))}catch(s){f("[MessageQueue] :",s),f("[MessageQueue] :",s.message),f("[MessageQueue] :",s.stack)}}this.queue.length>0?requestAnimationFrame(()=>this.processNext()):this.isProcessing=!1}}const Fe=new u1;function sa(e,t){return e.find(n=>n.id===t)}function d$(e){return new Promise(t=>setTimeout(t,e))}function _1(){f("[MessageQueue] ..."),Fe.registerHandler("handle_on_click_copper",async(i,r)=>{var u,_;const{copper:a,resources:c,has_attack_targets:l}=i;f(`[Handler] : ${((u=a.copper.copper_info)==null?void 0:u.name)||"Unknown"} (ID=${a.id})`),f(`[Handler] : HP=${a.now_health}/${a.copper.attribute.health}, =${a.can_move}, =${a.can_attack}, =${a.can_summon}, =${a.can_build}, =${l}`),f(`[Handler] : ${(_=a.copper)==null?void 0:_.copper_type}`),r.highlightSelectedCopper&&r.highlightSelectedCopper(a.id),r.onShowCopperInfo&&r.onShowCopperInfo(a,c,l)}),Fe.registerHandler("handle_on_click_enemy",async(i,r)=>{var d,p;const{enemy:a,resources:c,has_attack_targets:l}=i,u=a.owned||!1;f(`[Handler] ${u?"":""}: ${((d=a.enemy_base)==null?void 0:d.name)||"Unknown"} (ID=${a.id})`),f(`[Handler] : HP=${a.now_health}/${a.enemy_base.health}, =${a.can_move}, =${a.can_attack}, owned=${a.owned}, =${l}`);const $={id:a.id,now_health:a.now_health,can_move:u?a.can_move:!1,can_attack:u?a.can_attack:!1,can_summon:!1,position:a.position,isEnemy:!u,isOwnedEnemy:u,copper:{copper_info:{name:((p=a.enemy_base)==null?void 0:p.name)||(u?"":"")},attribute:{health:a.enemy_base.health,attack:a.enemy_base.attack,defense:a.enemy_base.defense,speed:a.enemy_base.speed}}};r.highlightSelectedCopper&&r.highlightSelectedCopper(a.id),r.onShowCopperInfo&&r.onShowCopperInfo($,c,l)}),Fe.registerHandler("handle_on_click_structure",async(i,r)=>{var _;const{structure:a,resources:c}=i,u=a.owned||!1?"":"";f(`[Handler] ${u}: ${((_=a.structure_base)==null?void 0:_.name)||"Unknown"} (ID=${a.id})`),f(`[Handler] : HP=${a.now_health}/${a.structure_base.health}, =${a.can_move}, =${a.can_attack}, owned=${a.owned}, =${a.structure_base.has_storage}`),r.highlightSelectedCopper&&r.highlightSelectedCopper(a.id),r.onShowStructureInfo&&r.onShowStructureInfo(a,c)}),Fe.registerHandler("set_copper",async(i,r)=>{const{id:a,position:c,copper:l}=i;window.__ACTUAL_COPPER_IDS__||(window.__ACTUAL_COPPER_IDS__=[]),window.__ACTUAL_COPPER_IDS__.push(l.id),jo(Sn.COPPER_ID_ADDED,l.id),r.onSetCopper&&await r.onSetCopper(a,c,l)}),Fe.registerHandler("set_enemy",async(i,r)=>{const{id:a,position:c,enemy:l}=i;r.onSetEnemy&&r.onSetEnemy(a,c,l),l.owned&&jo(Sn.UPDATE_RESOURCES)}),Fe.registerHandler("set_material",async(i,r)=>{const{id:a,position:c,material:l}=i;r.onSetMaterial&&await r.onSetMaterial(a,c,l)}),Fe.registerHandler("set_structure",async(i,r)=>{const{id:a,position:c,structure:l}=i;r.onSetStructure&&await r.onSetStructure(a,c,l),l.owned&&jo(Sn.UPDATE_RESOURCES)}),Fe.registerHandler("remove_unit",async(i,r)=>{const{id:a}=i,c=sa(r.models||[],a),l=c&&c.type==="enemy"&&!c.isOwned,u=l?c.position:null;if(f(`[Handler] remove_unit: ID=${a}, type=${c==null?void 0:c.type}, isOwned=${c==null?void 0:c.isOwned}, isEnemyDeath=${l}, position=${JSON.stringify(u)}`),c&&c.object){c.object.traverse(d=>{d.material&&(Array.isArray(d.material)?d.material=d.material.map(p=>p.clone()):d.material=d.material.clone())});const _=500,$=performance.now();if(await new Promise(d=>{function p(){const b=performance.now()-$,g=Math.min(b/_,1);c.object&&c.object.traverse(m=>{m.material&&(Array.isArray(m.material)?m.material.forEach(v=>{v.transparent=!0,v.opacity=1-g}):(m.material.transparent=!0,m.material.opacity=1-g))}),g<1?requestAnimationFrame(p):d()}p()}),r.scene&&r.scene.remove(c.object),c.object.traverse(d=>{d.geometry&&d.geometry.dispose(),d.material&&(Array.isArray(d.material)?d.material.forEach(p=>{p.map&&p.map.dispose(),p.lightMap&&p.lightMap.dispose(),p.bumpMap&&p.bumpMap.dispose(),p.normalMap&&p.normalMap.dispose(),p.specularMap&&p.specularMap.dispose(),p.envMap&&p.envMap.dispose(),p.alphaMap&&p.alphaMap.dispose(),p.aoMap&&p.aoMap.dispose(),p.displacementMap&&p.displacementMap.dispose(),p.emissiveMap&&p.emissiveMap.dispose(),p.metalnessMap&&p.metalnessMap.dispose(),p.roughnessMap&&p.roughnessMap.dispose(),p.dispose()}):(d.material.map&&d.material.map.dispose(),d.material.lightMap&&d.material.lightMap.dispose(),d.material.bumpMap&&d.material.bumpMap.dispose(),d.material.normalMap&&d.material.normalMap.dispose(),d.material.specularMap&&d.material.specularMap.dispose(),d.material.envMap&&d.material.envMap.dispose(),d.material.alphaMap&&d.material.alphaMap.dispose(),d.material.aoMap&&d.material.aoMap.dispose(),d.material.displacementMap&&d.material.displacementMap.dispose(),d.material.emissiveMap&&d.material.emissiveMap.dispose(),d.material.metalnessMap&&d.material.metalnessMap.dispose(),d.material.roughnessMap&&d.material.roughnessMap.dispose(),d.material.dispose()))}),r.models){const d=r.models.indexOf(c);d>-1&&r.models.splice(d,1)}r.onClearState&&r.onClearState(a),r.onRemoveHealthBar&&r.onRemoveHealthBar(a),c.type==="copper"&&r.onRemoveCopper&&r.onRemoveCopper(a)}if(l&&u){f("[Handler] ...");const _=$=>{f("[Handler] :",$),r.onShowResourceGain&&Object.keys($).length>0&&(f("[Handler] :",u,$),r.onShowResourceGain(u,$))};hc(Sn.RESOURCES_UPDATED,_),jo(Sn.UPDATE_RESOURCES),setTimeout(()=>{Fu(Sn.RESOURCES_UPDATED,_)},1e3)}}),Fe.registerHandler("change_direction",async(i,r)=>{const{id:a,direction:c}=i,l=sa(r.models||[],a);if(l&&l.object){let u=0;switch(c){case"PositiveY":u=0;break;case"PositiveX":u=Math.PI/2;break;case"NegativeY":u=Math.PI;break;case"NegativeX":u=-Math.PI/2;break}let _=l.object.rotation.y;_=Math.atan2(Math.sin(_),Math.cos(_));let $=u-_;$>Math.PI?$-=2*Math.PI:$<-Math.PI&&($+=2*Math.PI);const d=300,p=performance.now();await new Promise(b=>{function g(){const m=performance.now()-p,v=Math.min(m/d,1),y=1-Math.pow(1-v,2);l.object&&(l.object.rotation.y=_+$*y),v<1?requestAnimationFrame(g):(l.object&&(l.object.rotation.y=u),b())}g()})}}),Fe.registerHandler("move_to",async(i,r)=>{const{id:a,to:c}=i,l=sa(r.models||[],a);if(l&&l.object&&r.gridCellSize){const[u,_]=c,$=u,d=_,p=l.object.position.y;l.position=[u,_],r.onMoveStart&&r.onMoveStart(a,l),r.animateModelMove&&await new Promise(b=>{r.animateModelMove(l,{x:$,y:p,z:d},b)}),r.onMoveComplete&&r.onMoveComplete(a)}}),Fe.registerHandler("display_can_move",(i,r)=>{const{id:a,can_move:c}=i,l=c==="true"||c===!0;r.onDisplayCanMove&&r.onDisplayCanMove(a,l)}),Fe.registerHandler("display_can_attack",(i,r)=>{const{id:a,can_attack:c}=i,l=c==="true"||c===!0;r.onDisplayCanAttack&&r.onDisplayCanAttack(a,l)}),Fe.registerHandler("display_can_summon",(i,r)=>{const{id:a,can_summon:c}=i,l=c==="true"||c===!0;f(`[Handler] display_can_summon id=${a}, can_summon=${l}`),r.onDisplayCanSummon&&r.onDisplayCanSummon(a,l)}),Fe.registerHandler("update_health",(i,r)=>{const{id:a,now_health:c,max_health:l}=i;r.onUpdateHealth&&r.onUpdateHealth(a,c,l)}),Fe.registerHandler("clear_state",(i,r)=>{const{id:a}=i;r.onClearState&&r.onClearState(a)}),Fe.registerHandler("animate_move",async(i,r)=>{const{id:a}=i,c=sa(r.models||[],a);if(!c){f(`[Handler] animate_move:  ID=${a}`);return}if(window.disableAutoFocus){f(`[Handler] animate_move:  ID=${a}`);return}const l=r.followEnemies!==void 0?r.followEnemies:!1;if(c.type==="enemy"&&!l){f(`[Handler] animate_move:  ID=${a}  context.followEnemies = true `);return}if(r.camera&&r.focusOnModel){const u=r.focusOnModel(c.object,r.camera,r.controls);r.focusState&&(r.focusState.focusPosition=u.focusPosition,r.focusState.focusTarget=u.focusTarget,r.focusState.lerpFactor=u.lerpFactor,f(`[Handler] animate_move:  ID=${a} (${c.name})`)),await d$(1e3)}}),Fe.registerHandler("animate_reset",async(i,r)=>{if(f("[Handler] animate_reset"),r.camera&&r.controls){const a={x:0,y:2,z:5},c={x:0,y:0,z:0};r.focusState&&(r.focusState.focusPosition=a,r.focusState.focusTarget=c,r.focusState.lerpFactor=.08),await d$(1e3)}}),Fe.registerHandler("put_map_block",(i,r)=>{const{position:a}=i;r.onPutMapBlock&&r.onPutMapBlock(a)}),Fe.registerHandler("put_room_blocks",async(i,r)=>{const{room_position:a,size:c}=i,[l,u]=a;if(f(`[Handler]  : [${l}, ${u}], ${c}x${c}`),!r.onPutMapBlock){f("[Handler]  context.onPutMapBlock ");return}f("[Handler]  context.onPutMapBlock ...");const _=32,$=c*c;let d=0;for(let p=0;p<c;p++)for(let b=0;b<c;b++){const g=[l+p,u+b];r.onPutMapBlock(g),d++,d%_===0&&await new Promise(m=>requestAnimationFrame(m))}f(`[Handler]  : ${$}`)}),Fe.registerHandler("put_resource_marker",(i,r)=>{const{position:a}=i;r.onPutResourceMarker&&r.onPutResourceMarker(a)}),Fe.registerHandler("clear_resource_marker",(i,r)=>{const{position:a}=i;r.onClearResourceMarker&&r.onClearResourceMarker(a)});let e=0,t=0,n=0;Fe.registerHandler("set_move_block",(i,r)=>{const{position:a}=i;e++,r.onSetMoveBlock&&r.onSetMoveBlock(a)}),Fe.registerHandler("set_attack_block",(i,r)=>{const{position:a}=i;t++,r.onSetAttackBlock&&r.onSetAttackBlock(a),(t===1||t%10===0)&&f(`[Handler]  ${t} `)}),Fe.registerHandler("set_can_summon_blocks",(i,r)=>{const{position:a}=i;n++,r.onSetCanSummonBlock&&r.onSetCanSummonBlock(a),(n===1||n%10===0)&&f(`[Handler]  ${n} `)});let o=0,s=Date.now();Fe.registerHandler("clear_block",(i,r)=>{const{position:a}=i;r.onClearBlock&&r.onClearBlock(a),o++;const c=Date.now();c-s>500&&(o>1&&f(`[Handler]   ${o} `),o=0,e>0&&(f(`[Handler]  ${e} `),e=0),t>0&&(f(`[Handler]  ${t} `),t=0),n>0&&(f(`[Handler]  ${n} `),n=0)),s=c}),Fe.registerHandler("attack_complete",(i,r)=>{const{id:a}=i;r.onAttackComplete&&r.onAttackComplete(a)}),Fe.registerHandler("on_game_round_pass",(i,r)=>{}),Fe.registerHandler("craft_success",(i,r)=>{r.onCraftResult&&r.onCraftResult(!0,i.message||"")}),Fe.registerHandler("craft_failed",(i,r)=>{r.onCraftResult&&r.onCraftResult(!1,i.message||"")}),Fe.registerHandler("cannot_pick_up_item",(i,r)=>{f("[Handler] :",i.message||i)}),Fe.registerHandler("equipment_slot_full",(i,r)=>{f("[Handler] :",i.message||i)}),Fe.registerHandler("inventory_full",(i,r)=>{f("[Handler] :",i.message||i)}),Fe.registerHandler("resource_not_enough",(i,r)=>{let a="";if(i.missing&&Array.isArray(i.missing)&&i.missing.length>0){const c={HeartCrystalDust:"",RecallGear:"",SpiritalSpark:"",RefinedCopper:"",ResonantCrystal:""};a=`: ${i.missing.map(u=>{const _=c[u.type]||u.type,$=u.needed-u.current;return`${_} ( ${$})`}).join("")}`}f("[Handler] :",a),r.onResourceNotEnough&&r.onResourceNotEnough(a)}),Fe.registerHandler("summon_failed",(i,r)=>{f("[Handler] :",i.message||i),r.onSummonFailed&&r.onSummonFailed(i.message||"")}),Fe.registerHandler("summon_expired",(i,r)=>{const{id:a,message:c}=i;f(`[Handler] : ID=${a}, ${c}`)}),Fe.registerHandler("get_summon_menu",(i,r)=>{const{contents:a}=i;f("[Handler] :",a),r.onShowSummonMenu&&r.onShowSummonMenu(a)}),Fe.registerHandler("get_structure_menu",(i,r)=>{const{contents:a}=i;if(!a||a.length===0){f("[Handler]  ");return}const c=a.filter(l=>l.name!=="");f("[Handler] ",c.length,""),r.onShowStructureMenu&&r.onShowStructureMenu(c)}),Fe.registerHandler("drill_resource_generate",(i,r)=>{const{position:a,resource_type:c,amount:l}=i;f(`[Handler] : =${JSON.stringify(a)}, =${c}, =${l}`);const u={[c]:parseInt(l)};r.onShowResourceGain&&r.onShowResourceGain(a,u),jo(Sn.UPDATE_RESOURCES)}),Fe.registerHandler("game_over",(i,r)=>{f("[Handler] "),r.onGameOver&&r.onGameOver()}),Fe.registerHandler("success",(i,r)=>{f("[Handler] "),r.onGameSuccess&&r.onGameSuccess()})}const qp={hi:-1,lo:-1},$1={hi:232830643,lo:-1486618624},xt={hi:0,lo:0},un={hi:0,lo:1},sn={hi:0,lo:10},d1={hi:0,lo:100},p1={hi:0,lo:1e3},m1={hi:0,lo:1e4},f1={hi:0,lo:1e5},h1={hi:0,lo:1e6},g1={hi:0,lo:1e7},b1={hi:0,lo:1e8},y1={hi:0,lo:1e9},w1={hi:2,lo:1410065408},v1={hi:23,lo:1215752192},S1={hi:232,lo:-727379968},k1={hi:2328,lo:1316134912},M1={hi:23283,lo:276447232},C1={hi:232830,lo:-1530494976},x1={hi:0,lo:22},P1={hi:0,lo:37},L1={hi:-1,lo:-22},p$=new DataView(new ArrayBuffer(8));function Uu(e){return p$.setInt32(0,e,!0),p$.getFloat32(0,!0)}const I1={$tag:0},Wp={$tag:1},Kp={$tag:2};function Fr(e,t){this._0=e,this._1=t}Fr.prototype.$tag=3;function Ae(e){this._0=e}Ae.prototype.$tag=4;function In(e){this._0=e}In.prototype.$tag=5;function ke(e){this._0=e}ke.prototype.$tag=6;const T1={hi:-1048576,lo:0},E1={hi:2146435072,lo:0},A1={hi:2146959360,lo:1},Jp={hi:0,lo:2};class G1 extends Error{}function ne(){throw new G1}function S(e,t){if(t<0||t>=e.length)throw new Error("Index out of bounds")}function lt(e,t){const n=new Array(e);return n.fill(t),n}const R1=e=>e.slice(0);function Ji(e){this._0=e}Ji.prototype.$tag=1;function je(e){this._0=e}je.prototype.$tag=6;function Ur(e,t){this._0=e,this._1=t}Ur.prototype.$tag=5;const Tn={$tag:4},Xp={$tag:1};function Js(e){this._0=e}Js.prototype.$tag=0;function Yp(e){this._0=e}Yp.prototype.$tag=0;function gc(e){this._0=e}gc.prototype.$tag=0;function Bu(e){this._0=e}Bu.prototype.$tag=1;function Zp(e){this._0=e}Zp.prototype.$tag=0;function Qp(e){this._0=e}Qp.prototype.$tag=1;function zu(e){this._0=e}zu.prototype.$tag=0;function _o(e){this._0=e}_o.prototype.$tag=1;function em(e){this._0=e}em.prototype.$tag=0;function Go(e){this._0=e}Go.prototype.$tag=1;function tm(e){this._0=e}tm.prototype.$tag=0;function nm(e){this._0=e}nm.prototype.$tag=0;function sm(e){this._0=e}sm.prototype.$tag=1;const hl={hi:2147483647,lo:-1},m$={hi:0,lo:16},gl={hi:-2147483648,lo:0};function O1(e,t){return new Uint8Array(e)}const D1={hi:0,lo:65536},ga={$tag:0};function Vu(e){this._0=e}Vu.prototype.$tag=1;function bc(e){return e=e-(e>>>1&1431655765),e=(e&858993459)+(e>>>2&858993459),e=e+(e>>>4)&252645135,e=e+(e>>>8),e=e+(e>>>16),e&63}function N1(e){return e>>>=0,e===0?32:(e&=-e,31-Math.clz32(e))}function Ko(e,t,n){this._0=e,this._1=t,this._2=n}Ko.prototype.$tag=0;function $o(e,t,n){this._0=e,this._1=t,this._2=n}$o.prototype.$tag=1;function Ti(e){this._0=e}Ti.prototype.$tag=2;const Ci={$tag:0};function Mr(e,t){this._0=e,this._1=t}Mr.prototype.$tag=1;function yc(e){this._0=e}yc.prototype.$tag=0;function ws(e){this._0=e}ws.prototype.$tag=1;function wc(e){this._0=e}wc.prototype.$tag=0;function qu(e){this._0=e}qu.prototype.$tag=1;function Br(e){this._0=e}Br.prototype.$tag=0;function On(e){this._0=e}On.prototype.$tag=1;function bo(e){this._0=e}bo.prototype.$tag=0;function Ft(e){this._0=e}Ft.prototype.$tag=1;function om(e){this._0=e}om.prototype.$tag=0;function im(e){this._0=e}im.prototype.$tag=1;function rm(e){this._0=e}rm.prototype.$tag=0;function am(e){this._0=e}am.prototype.$tag=0;function Xi(e){this._0=e}Xi.prototype.$tag=1;function cm(e){this._0=e}cm.prototype.$tag=0;function eu(e){this._0=e}eu.prototype.$tag=1;function lm(e){this._0=e}lm.prototype.$tag=0;function um(e){this._0=e}um.prototype.$tag=1;const j1={hi:2097151,lo:-1},H1={hi:-2097152,lo:1};function _m(e){this._0=e}_m.prototype.$tag=0;function $m(e){this._0=e}$m.prototype.$tag=1;function tu(e){this._0=e}tu.prototype.$tag=0;function dm(e){this._0=e}dm.prototype.$tag=1;const F1={$tag:0},U1={$tag:1},B1={$tag:2};function Yi(e,t){this._0=e,this._1=t}Yi.prototype.$tag=3;function vc(e){this._0=e}vc.prototype.$tag=4;const z1={$tag:5},pm={$tag:6},V1={$tag:7},mm={$tag:8},fm={$tag:9};function hm(e,t){this._0=e,this._1=t}hm.prototype.$tag=0;function gm(e,t){this._0=e,this._1=t}gm.prototype.$tag=1;const bm={$tag:0};function tt(e,t){this._0=e,this._1=t}tt.prototype.$tag=1;const q1={$tag:0};function ym(e){this._0=e}ym.prototype.$tag=1;const bl={hi:0,lo:-1},W1=new Uint8Array([65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,49,50,51,52,53,54]),K1=()=>{var e;if((e=globalThis.crypto)!=null&&e.getRandomValues){const t=new Uint32Array(1);return globalThis.crypto.getRandomValues(t),t[0]|0}else return Math.floor(Math.random()*4294967296)|0},J1=(e,t)=>e.toString(t),X1=e=>(e.hi>>>0)*4294967296+(e.lo>>>0),Y1=function e(t){let n=e._view;return n===void 0&&(n=e._view=new DataView(new ArrayBuffer(8))),n.setUint32(0,t.hi),n.setUint32(4,t.lo),n.getFloat64(0)},bn=(e,t)=>{e.push(t)},Wu=function e(){return e._exports?e._exports:e._exports=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports},Z1=(e,t)=>{const n=e.hi,o=t.hi;if(n<o)return-1;if(n>o)return 1;const s=e.lo>>>0,i=t.lo>>>0;return s<i?-1:s>i?1:0},Q1=(e,t)=>{const n=e.hi>>>0,o=t.hi>>>0;if(n<o)return-1;if(n>o)return 1;const s=e.lo>>>0,i=t.lo>>>0;return s<i?-1:s>i?1:0},e2=e=>e.hi*4294967296+(e.lo>>>0),t2=e=>e.pop(),n2=(e,t,n)=>e.splice(t,n),oa={$tag:0};function Zi(e){this._0=e}Zi.prototype.$tag=1;function Ro(e){this._0=e}Ro.prototype.$tag=0;function wm(e){this._0=e}wm.prototype.$tag=1;function ba(e){this._0=e}ba.prototype.$tag=0;function vm(e){this._0=e}vm.prototype.$tag=1;function di(e){this._0=e}di.prototype.$tag=0;function Sm(e){this._0=e}Sm.prototype.$tag=1;function ms(e){this._0=e}ms.prototype.$tag=0;function km(e){this._0=e}km.prototype.$tag=1;function Qi(e){this._0=e}Qi.prototype.$tag=0;function pi(e){this._0=e}pi.prototype.$tag=1;const f$={$tag:0};function nu(e){this._0=e}nu.prototype.$tag=1;function su(e){this._0=e}su.prototype.$tag=0;function Mm(e){this._0=e}Mm.prototype.$tag=1;const s2={$tag:0};function Cm(e){this._0=e}Cm.prototype.$tag=1;const xm={$tag:0};function Ku(e){this._0=e}Ku.prototype.$tag=1;function Oo(e){this._0=e}Oo.prototype.$tag=0;function Pm(e){this._0=e}Pm.prototype.$tag=1;function er(e){this._0=e}er.prototype.$tag=0;function Lm(e){this._0=e}Lm.prototype.$tag=1;function Jo(e){this._0=e}Jo.prototype.$tag=0;function Ei(e){this._0=e}Ei.prototype.$tag=1;function Xo(e){this._0=e}Xo.prototype.$tag=2;function po(e){this._0=e}po.prototype.$tag=0;function xi(e){this._0=e}xi.prototype.$tag=1;function ou(e){this._0=e}ou.prototype.$tag=2;function Ju(e){this._0=e}Ju.prototype.$tag=3;const Cr={$tag:4};function Im(e){this._0=e}Im.prototype.$tag=0;const o2=qp,Tm="value out of range",Ai="invalid syntax",h$="",Em=$1,i2=xt,r2=xt,Kt={mantissa_bits:52,exponent_bits:11,bias:-1023},li=[1,3,6,9,13,16,19,23,26,29,33,36,39,43,46,49,53,56,59],a2={_0:0,_1:""},c2={_0:1,_1:"5"},l2={_0:1,_1:"25"},u2={_0:1,_1:"125"},_2={_0:2,_1:"625"},$2={_0:2,_1:"3125"},d2={_0:2,_1:"15625"},p2={_0:3,_1:"78125"},m2={_0:3,_1:"390625"},f2={_0:3,_1:"1953125"},h2={_0:4,_1:"9765625"},g2={_0:4,_1:"48828125"},b2={_0:4,_1:"244140625"},y2={_0:4,_1:"1220703125"},w2={_0:5,_1:"6103515625"},v2={_0:5,_1:"30517578125"},S2={_0:5,_1:"152587890625"},k2={_0:6,_1:"762939453125"},M2={_0:6,_1:"3814697265625"},C2={_0:6,_1:"19073486328125"},x2={_0:7,_1:"95367431640625"},P2={_0:7,_1:"476837158203125"},L2={_0:7,_1:"2384185791015625"},I2={_0:7,_1:"11920928955078125"},T2={_0:8,_1:"59604644775390625"},E2={_0:8,_1:"298023223876953125"},A2={_0:8,_1:"1490116119384765625"},G2={_0:9,_1:"7450580596923828125"},R2={_0:9,_1:"37252902984619140625"},O2={_0:9,_1:"186264514923095703125"},D2={_0:10,_1:"931322574615478515625"},N2={_0:10,_1:"4656612873077392578125"},j2={_0:10,_1:"23283064365386962890625"},H2={_0:10,_1:"116415321826934814453125"},F2={_0:11,_1:"582076609134674072265625"},U2={_0:11,_1:"2910383045673370361328125"},B2={_0:11,_1:"14551915228366851806640625"},z2={_0:12,_1:"72759576141834259033203125"},V2={_0:12,_1:"363797880709171295166015625"},q2={_0:12,_1:"1818989403545856475830078125"},W2={_0:13,_1:"9094947017729282379150390625"},K2={_0:13,_1:"45474735088646411895751953125"},J2={_0:13,_1:"227373675443232059478759765625"},X2={_0:13,_1:"1136868377216160297393798828125"},Y2={_0:14,_1:"5684341886080801486968994140625"},Z2={_0:14,_1:"28421709430404007434844970703125"},Q2={_0:14,_1:"142108547152020037174224853515625"},ey={_0:15,_1:"710542735760100185871124267578125"},ty={_0:15,_1:"3552713678800500929355621337890625"},ny={_0:15,_1:"17763568394002504646778106689453125"},sy={_0:16,_1:"88817841970012523233890533447265625"},oy={_0:16,_1:"444089209850062616169452667236328125"},iy={_0:16,_1:"2220446049250313080847263336181640625"},ry={_0:16,_1:"11102230246251565404236316680908203125"},ay={_0:17,_1:"55511151231257827021181583404541015625"},cy={_0:17,_1:"277555756156289135105907917022705078125"},ly={_0:17,_1:"1387778780781445675529539585113525390625"},uy={_0:18,_1:"6938893903907228377647697925567626953125"},_y={_0:18,_1:"34694469519536141888238489627838134765625"},$y={_0:18,_1:"173472347597680709441192448139190673828125"},dy={_0:19,_1:"867361737988403547205962240695953369140625"},ia=[a2,c2,l2,u2,_2,$2,d2,p2,m2,f2,h2,g2,b2,y2,w2,v2,S2,k2,M2,C2,x2,P2,L2,I2,T2,E2,A2,G2,R2,O2,D2,N2,j2,H2,F2,U2,B2,z2,V2,q2,W2,K2,J2,X2,Y2,Z2,Q2,ey,ty,ny,sy,oy,iy,ry,ay,cy,ly,uy,_y,$y,dy],g$=[un,sn,d1,p1,m1,f1,h1,g1,b1,y1,w1,v1,S1,k1,M1,C1],yl=x1,b$=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13,1e14,1e15,1e16,1e17,1e18,1e19,1e20,1e21,1e22,0,0,0,0,0,0,0,0,0],py=P1,my=L1,fy=xt,hy={_0:160,_1:160},gy={_0:5760,_1:5760},by={_0:8192,_1:8202},yy={_0:8232,_1:8233},wy={_0:8239,_1:8239},vy={_0:8287,_1:8287},Sy={_0:12288,_1:12288},ky={_0:65279,_1:65279},y$=".",w$="e",v$="E",My=Uu(2143289344),Cy=Uu(2139095040),xy=Uu(-8388608),Py=0,Ly=0,Iy=I1,Ty="",Ey="",Ay="/assets/copper/iron_wall/rocky/rocky.webp",Gy="/assets/copper/iron_wall/rocky/rocky.glb",Ry="",Oy="",Dy="/assets/copper/iron_wall/wesley/wesley.webp",Ny="/assets/copper/iron_wall/wesley/wesley.glb",jy="",Hy="",Fy="/assets/copper/iron_wall/bell/bell.webp",Uy="/assets/copper/iron_wall/bell/bell.glb",By="",zy="",Vy="/assets/copper/iron_wall/tumble/tumble.webp",qy="/assets/copper/iron_wall/tumble/tumble.glb",Wy="",Ky="",Jy="/assets/copper/iron_wall/chief/chief.webp",Xy="/assets/copper/iron_wall/chief/chief.glb",Yy="",Zy="1001",Qy="/assets/copper/arcanist/spark/spark.webp",e4="/assets/copper/arcanist/spark/spark.glb",t4="",n4="",s4="/assets/copper/arcanist/syrup/syrup.webp",o4="/assets/copper/arcanist/syrup/syrup.glb",i4="",r4="",a4="/assets/copper/arcanist/bubble/bubble.webp",c4="/assets/copper/arcanist/bubble/bubble.glb",l4="",u4="",_4="/assets/copper/arcanist/glimmer/glimmer.webp",$4="/assets/copper/arcanist/glimmer/glimmer.glb",d4="",p4="",m4="/assets/copper/arcanist/turner/turner.webp",f4="/assets/copper/arcanist/turner/turner.glb",h4="",g4="",b4="/assets/copper/resonator/murmur/murmur.webp",y4="/assets/copper/resonator/murmur/murmur.glb",w4="",v4="",S4="/assets/copper/resonator/melody/melody.webp",k4="/assets/copper/resonator/melody/melody.glb",M4="",C4="",x4="/assets/copper/resonator/clawster/clawster.webp",P4="/assets/copper/resonator/clawster/clawster.glb",L4="",I4=" 3*3 ",T4="/assets/copper/resonator/diggs/diggs.webp",E4="/assets/copper/resonator/diggs/diggs.glb",A4="",G4="",R4="/assets/copper/resonator/hive/hive.webp",O4="/assets/copper/resonator/hive/hive.glb",D4="",N4="",j4="/assets/copper/mechanic/gyro/gyro.webp",H4="/assets/copper/mechanic/gyro/gyro.glb",F4="",U4="",B4="/assets/copper/mechanic/tricky/tricky.webp",z4="/assets/copper/mechanic/tricky/tricky.glb",V4="",q4="",W4="/assets/copper/mechanic/pendulum/pendulum.webp",K4="/assets/copper/mechanic/pendulum/pendulum.glb",J4="",X4="",Y4="/assets/copper/mechanic/yoyo/yoyo.webp",Z4="/assets/copper/mechanic/yoyo/yoyo.glb",Q4="",ew="",tw="/assets/copper/mechanic/karin/karin.webp",nw="/assets/copper/mechanic/karin/karin.glb",sw="",ow="",iw="/assets/copper/craftsman/wrench/wrench.webp",rw="/assets/copper/craftsman/wrench/wrench.glb",aw="",cw="",lw="/assets/copper/craftsman/coil/coil.webp",uw="/assets/copper/craftsman/coil/coil.glb",_w="",$w="",dw="/assets/copper/craftsman/artifex/artifex.webp",pw="/assets/copper/craftsman/artifex/artifex.glb",mw="",fw="",hw="/assets/copper/craftsman/drillbit/drillbit.webp",gw="/assets/copper/craftsman/drillbit/drillbit.glb",bw="",yw="",ww="/assets/copper/craftsman/quickhand/quickhand.webp",vw="/assets/copper/craftsman/quickhand/quickhand.glb",Sw=10,kw={name:"",description:"1082",resource_url:"/assets/copper/iron_wall/rocky/rocky_skill.webp",cool_down:Sw},Mw=kw,Cw=10,xw={name:"",description:" 20%  15% ",resource_url:"/assets/copper/iron_wall/wesley/wesley_skill.webp",cool_down:Cw},Pw=xw,Lw=20,Iw={name:"",description:" 100 ",resource_url:"/assets/copper/arcanist/spark/spark_skill.webp",cool_down:Lw},Tw=Iw,Ew=10,Aw={name:"",description:"",resource_url:"/assets/copper/arcanist/bubble/bubble_skill.webp",cool_down:Ew},Gw=Aw,Rw=5,Ow={name:"",description:" 200% ",resource_url:"/assets/copper/arcanist/turner/turner_skill.webp",cool_down:Rw},Dw=Ow,Nw=10,jw={name:"",description:"",resource_url:"/assets/copper/mechanic/gyro/gyro_skill.webp",cool_down:Nw},Hw=jw,Fw=10,Uw={name:"",description:"",resource_url:"/assets/copper/mechanic/tricky/tricky_skill.webp",cool_down:Fw},Bw=Uw,zw=5,Vw={name:"",description:"",resource_url:"/assets/copper/mechanic/pendulum/pendulum_skill.webp",cool_down:zw},qw=Vw,Ww=3,Kw={name:"",description:" 200%",resource_url:"/assets/copper/mechanic/yoyo/yoyo_skill.webp",cool_down:Ww},Jw=Kw,Xw={type_msg:"upgrade_cost_error",content:""},Yw={_0:2,_1:100},Zw={_0:1,_1:0},Qw={_0:4,_1:0},ev={_0:3,_1:0},tv={_0:0,_1:0},nv=[Yw,Zw,Qw,ev,tv],sv={_0:2,_1:0},ov={_0:1,_1:0},iv={_0:4,_1:0},rv={_0:3,_1:0},av={_0:0,_1:0},cv=[sv,ov,iv,rv,av],lv={type_msg:"resource_not_enough",content:""},uv={type_msg:"resource_not_enough",content:""},_v={_0:3,_1:1},$v={_0:4,_1:1},dv={_0:0,_1:1},pv={_0:1,_1:1},mv={_0:3,_1:8},fv={_0:1,_1:2},hv={_0:3,_1:6},gv={_0:1,_1:3},bv={_0:3,_1:10},yv={_0:1,_1:4},wv={_0:0,_1:5},vv={_0:3,_1:20},Sv={_0:1,_1:6},kv={_0:4,_1:10},Mv={_0:3,_1:8},Cv={_0:1,_1:3},xv={_0:0,_1:3},Pv={_0:3,_1:30},Lv={_0:4,_1:20},Iv={_0:0,_1:10},Tv={_0:2,_1:8},Ev={_0:3,_1:15},Av={_0:1,_1:5},Gv={_0:4,_1:8},Rv={_0:3,_1:25},Ov={_0:4,_1:15},Dv={_0:2,_1:5},Nv=[0,2,3,4,6,6,8],jv={_0:0,_1:1},Hv={_0:1,_1:jv},Fv={_0:1,_1:1},Uv={_0:3,_1:Fv},Bv={_0:3,_1:2},zv={_0:1,_1:1},Vv={_0:0,_1:1},qv={_0:4,_1:Vv},Wv={_0:1,_1:1},Kv={_0:0,_1:Wv},Jv={_0:3,_1:1},Xv={_0:0,_1:2},Yv={_0:1,_1:2},Zv={_0:1,_1:Yv},Qv={_0:0,_1:1},e5={_0:3,_1:Qv},t5={_0:3,_1:3},n5={_0:1,_1:2},s5={_0:0,_1:1},o5={_0:1,_1:2},i5={_0:4,_1:o5},r5={_0:0,_1:1},a5={_0:0,_1:r5},c5={_0:1,_1:2},l5={_0:4,_1:3},u5={_0:2,_1:1},_5={_0:1,_1:3},$5={_0:1,_1:_5},d5={_0:1,_1:2},p5={_0:4,_1:d5},m5={_0:0,_1:1},f5={_0:3,_1:m5},h5={_0:1,_1:4},g5={_0:4,_1:2},b5={_0:3,_1:8},y5={_0:2,_1:3},w5={_0:1,_1:2},v5={_0:1,_1:w5},S5={_0:0,_1:1},k5={_0:4,_1:S5},M5={_0:1,_1:2},C5={_0:0,_1:6},x5={_0:3,_1:6},P5={_0:2,_1:1},L5={_0:2,_1:4},I5={_0:1,_1:L5},T5={_0:1,_1:3},E5={_0:4,_1:T5},A5={_0:1,_1:2},G5={_0:3,_1:A5},R5={_0:1,_1:6},O5={_0:4,_1:4},D5={_0:3,_1:12},N5={_0:2,_1:3},j5={_0:1,_1:2},H5={_0:1,_1:j5},F5={_0:2,_1:3},U5={_0:4,_1:F5},B5={_0:1,_1:2},z5={_0:0,_1:B5},V5={_0:1,_1:10},q5={_0:4,_1:10},W5={_0:0,_1:10},K5={_0:2,_1:3},J5={_0:2,_1:4},X5={_0:1,_1:J5},Y5={_0:2,_1:4},Z5={_0:4,_1:Y5},Q5={_0:1,_1:2},eS={_0:3,_1:Q5},tS={_0:1,_1:10},nS={_0:4,_1:10},sS={_0:3,_1:15},oS={_0:2,_1:5},iS={_0:3,_1:5},rS={_0:1,_1:iS},aS={_0:2,_1:3},cS={_0:4,_1:aS},lS={_0:1,_1:2},uS={_0:0,_1:lS},_S={_0:1,_1:10},$S={_0:4,_1:15},dS={_0:3,_1:10},pS={_0:2,_1:5},mS={_0:2,_1:3},fS={_0:1,_1:mS},hS={_0:3,_1:5},gS={_0:4,_1:hS},bS={_0:1,_1:2},yS={_0:3,_1:bS},wS={_0:1,_1:15},vS={_0:4,_1:15},SS={_0:0,_1:20},kS={_0:3,_1:20},MS={_0:2,_1:8},CS={_0:4,_1:6},xS={_0:1,_1:CS},PS={_0:4,_1:6},LS={_0:4,_1:PS},IS={_0:2,_1:3},TS={_0:3,_1:IS},ES={_0:2,_1:3},AS={_0:0,_1:ES},GS={_0:1,_1:30},RS={_0:4,_1:30},OS={_0:0,_1:30},DS={_0:3,_1:30},NS={_0:2,_1:10},jS={_0:5,_1:7},HS={_0:1,_1:jS},FS={_0:5,_1:7},US={_0:4,_1:FS},BS={_0:3,_1:4},zS={_0:3,_1:BS},VS={_0:3,_1:4},qS={_0:0,_1:VS},WS={_0:1,_1:40},KS={_0:4,_1:40},JS={_0:0,_1:40},XS={_0:3,_1:40},YS={_0:2,_1:15},ZS={name:"",resource_type:3,model_url:"/assets/resource/refined_copper_ingot/refined_copper_ingot.glb"},QS={name:"",resource_type:4,model_url:"/assets/resource/resonant_star_crystal/resonant_star_crystal.glb"},ek={_0:0,_1:0},tk={_0:0,_1:3},nk={_0:0,_1:4},sk={_0:0,_1:5},ok=[tk,nk,sk],ik={_0:0,_1:3},rk={_0:0,_1:4},ak={_0:0,_1:5},ck={_0:-1,_1:0},lk={_0:1,_1:0},uk={_0:0,_1:-1},_k={_0:0,_1:1},$k={_0:-1,_1:0},dk={_0:1,_1:0},pk={_0:0,_1:-1},mk={_0:0,_1:1},fk=void 0,hk={name:Ty,copper_type:0,description:Ey,icon_url:Ay,model_url:Gy,skill:Mw,attack_range:fk},gk=void 0,bk={name:Ry,copper_type:0,description:Oy,icon_url:Dy,model_url:Ny,skill:Pw,attack_range:gk},yk={name:"",description:"",resource_url:"/assets/copper/iron_wall/bell/bell_skill.webp",cool_down:void 0},wk=void 0,vk={name:jy,copper_type:0,description:Hy,icon_url:Fy,model_url:Uy,skill:yk,attack_range:wk},Sk={name:"",description:" 1:1 ",resource_url:"/assets/copper/iron_wall/tumble/tumble_skill.webp",cool_down:void 0},kk=void 0,Mk={name:By,copper_type:0,description:zy,icon_url:Vy,model_url:qy,skill:Sk,attack_range:kk},Ck={name:"",description:" 3x3  20%  10% ",resource_url:"/assets/copper/iron_wall/chief/chief_skill.webp",cool_down:void 0},xk=void 0,Pk={name:Wy,copper_type:0,description:Ky,icon_url:Jy,model_url:Xy,skill:Ck,attack_range:xk},Lk=void 0,Ik={name:Yy,copper_type:1,description:Zy,icon_url:Qy,model_url:e4,skill:Tw,attack_range:Lk},Tk={name:"",description:" 20% ",resource_url:"/assets/copper/arcanist/syrup/syrup_skill.webp",cool_down:void 0},Ek=void 0,Ak={name:t4,copper_type:1,description:n4,icon_url:s4,model_url:o4,skill:Tk,attack_range:Ek},Gk=void 0,Rk={name:i4,copper_type:1,description:r4,icon_url:a4,model_url:c4,skill:Gw,attack_range:Gk},Ok={name:"",description:" 20% ",resource_url:"/assets/copper/arcanist/glimmer/glimmer_skill.webp",cool_down:void 0},Dk=void 0,Nk={name:l4,copper_type:1,description:u4,icon_url:_4,model_url:$4,skill:Ok,attack_range:Dk},jk=void 0,Hk={name:d4,copper_type:1,description:p4,icon_url:m4,model_url:f4,skill:Dw,attack_range:jk},Fk={name:"",description:" 20 ",resource_url:"/assets/copper/resonator/murmur/murmur_skill.webp",cool_down:void 0},Uk=void 0,Bk={name:h4,copper_type:4,description:g4,icon_url:b4,model_url:y4,skill:Fk,attack_range:Uk},zk={name:"",description:" 5 ",resource_url:"/assets/copper/resonator/melody/melody_skill.webp",cool_down:void 0},Vk=void 0,qk={name:w4,copper_type:4,description:v4,icon_url:S4,model_url:k4,skill:zk,attack_range:Vk},Wk={name:"",description:" 0 ",resource_url:"/assets/copper/resonator/clawsteak/clawster_skill.webp",cool_down:void 0},Kk=void 0,Jk={name:M4,copper_type:4,description:C4,icon_url:x4,model_url:P4,skill:Wk,attack_range:Kk},Xk={name:"",description:" 3*3 ",resource_url:"/assets/copper/resonator/diggs/diggs_skill.webp",cool_down:void 0},Yk=void 0,Zk={name:L4,copper_type:4,description:I4,icon_url:T4,model_url:E4,skill:Xk,attack_range:Yk},Qk={name:"",description:" 10 ",resource_url:"/assets/copper/resonator/hive/hive_skill.webp",cool_down:void 0},eM=void 0,tM={name:A4,copper_type:4,description:G4,icon_url:R4,model_url:O4,skill:Qk,attack_range:eM},nM=void 0,sM={name:D4,copper_type:3,description:N4,icon_url:j4,model_url:H4,skill:Hw,attack_range:nM},oM=void 0,iM={name:F4,copper_type:3,description:U4,icon_url:B4,model_url:z4,skill:Bw,attack_range:oM},rM=void 0,aM={name:V4,copper_type:3,description:q4,icon_url:W4,model_url:K4,skill:qw,attack_range:rM},cM=void 0,lM={name:J4,copper_type:3,description:X4,icon_url:Y4,model_url:Z4,skill:Jw,attack_range:cM},uM={name:"",description:"",resource_url:"/assets/copper/mechanic/karin/karin_skill.webp",cool_down:void 0},_M=void 0,$M={name:Q4,copper_type:3,description:ew,icon_url:tw,model_url:nw,skill:uM,attack_range:_M},dM=void 0,pM=void 0,mM={name:sw,copper_type:2,description:ow,icon_url:iw,model_url:rw,skill:dM,attack_range:pM},fM=void 0,hM=void 0,gM={name:aw,copper_type:2,description:cw,icon_url:lw,model_url:uw,skill:fM,attack_range:hM},bM=void 0,yM=void 0,wM={name:_w,copper_type:2,description:$w,icon_url:dw,model_url:pw,skill:bM,attack_range:yM},vM=void 0,SM=void 0,kM={name:mw,copper_type:2,description:fw,icon_url:hw,model_url:gw,skill:vM,attack_range:SM},MM=void 0,CM=void 0,$r=[hk,bk,vk,Mk,Pk,Ik,Ak,Rk,Nk,Hk,Bk,qk,Jk,Zk,tM,sM,iM,aM,lM,$M,mM,gM,wM,kM,{name:bw,copper_type:2,description:yw,icon_url:ww,model_url:vw,skill:MM,attack_range:CM}],xM=K1(),PM=$x(e=>{const t=$r.length;let n=0;for(;;){const o=n;if(o<t){const s=$r[o];if(e({_0:s.name,_1:s})===1){n=o+1|0;continue}else return 0}else return 1}}),Gi=Ff(),Et=DM(GP()),LM=Ff(),et=$P(),Am=r3(),xr=Ar(T1),Pr=Ar(E1),Gm=[hy,gy,by,yy,wy,vy,Sy,ky],IM=Ar(A1),Rm=Rr(Jp,52),xs=zr(8),dr=zr(8),zt=zr(8),En=zr(8),yo=B3(8),Tt=NM(void 0),jn=jC({start:0,end:0}),iu=[{name:"",health:Math.fround(400),can_move:!1,can_attack:!1,attack_range:0,description:" ",asset_url:"assets/structure/riveted_barrier/riveted_barrier.webp",model_url:"assets/structure/riveted_barrier/riveted_barrier.glb",attribute:qt(Math.fround(0),0,Math.fround(0),Math.fround(0),Math.fround(0)),cost:Ct([mv,fv])},{name:"",health:Math.fround(180),can_move:!1,can_attack:!0,attack_range:3,description:"",asset_url:"assets/structure/gear_arrow_tower/gear_arrow_tower.webp",model_url:"assets/structure/gear_arrow_tower/gear_arrow_tower.glb",attribute:qt(Math.fround(0),0,Math.fround(30),Math.fround(0),Math.fround(0)),cost:Ct([hv,gv])},{name:"",health:Math.fround(300),can_move:!1,can_attack:!1,attack_range:0,description:"",asset_url:"assets/structure/heart_source_drill/heart_source_mineral_drill.webp",model_url:"assets/structure/heart_source_drill/heart_source_mineral_drill.glb",attribute:qt(Math.fround(0),0,Math.fround(0),Math.fround(0),Math.fround(0)),cost:Ct([bv,yv,wv])},{name:"",health:Math.fround(200),can_move:!1,can_attack:!1,attack_range:0,description:"",asset_url:"assets/structure/charging_coil/charging_coil.webp",model_url:"assets/structure/charging_coil/charging_coil.glb",attribute:qt(Math.fround(0),0,Math.fround(0),Math.fround(0),Math.fround(0)),cost:Ct([vv,Sv,kv])},{name:"",health:Math.fround(200),can_move:!1,can_attack:!0,attack_range:3,description:"",asset_url:"assets/structure/repair_workshop/repair_workshop.webp",model_url:"assets/structure/repair_workshop/repair_workshop.glb",attribute:qt(Math.fround(0),0,Math.fround(25),Math.fround(0),Math.fround(0)),cost:Ct([Mv,Cv,xv])},{name:"",health:Math.fround(1200),can_move:!1,can_attack:!0,attack_range:5,description:"",asset_url:"assets/structure/mirror_refractory_tower/mirror_light_refraction_tower.webp",model_url:"assets/structure/mirror_refractory_tower/mirror_light_refraction_tower.glb",attribute:qt(Math.fround(0),0,Math.fround(120),Math.fround(0),Math.fround(0)),cost:Ct([Pv,Lv,Iv,Tv])},{name:"",health:Math.fround(500),can_move:!1,can_attack:!0,attack_range:4,description:"",asset_url:"assets/structure/resonance_alarm_bell/resonance_alarm_bell.webp",model_url:"assets/structure/resonance_alarm_bell/resonance_alarm_bell.glb",attribute:qt(Math.fround(0),0,Math.fround(60),Math.fround(0),Math.fround(0)),cost:Ct([Ev,Av,Gv])},{name:"",health:Math.fround(800),can_move:!1,can_attack:!0,attack_range:4,description:"",asset_url:"assets/structure/storm_iron_anvil/storm_anvil.webp",model_url:"assets/structure/storm_iron_anvil/storm_anvil.glb",attribute:qt(Math.fround(0),0,Math.fround(100),Math.fround(0),Math.fround(0)),cost:Ct([Rv,Ov,Dv])}],Om=_x(e=>{const t=iu.length;let n=0;for(;;){const o=n;if(o<t){const s=iu[o];if(e({_0:s.name,_1:s})===1){n=o+1|0;continue}else return 0}else return 1}}),Xs=HC({start:0,end:0}),ja=[{level:1,health:Math.fround(25),attack:Math.fround(8),defense:Math.fround(3),dodge:Math.fround(0),attack_range:1,speed:2,name:"",enemy_type:"goblin",description:"''",asset_url:"/assets/enemy/goblin/goblin.webp",model_url:"/assets/enemy/goblin/goblin.glb",drop_items:[Hv,Uv],summon_cost:Ct([Bv,zv])},{level:1,health:Math.fround(30),attack:Math.fround(7),defense:Math.fround(5),dodge:Math.fround(0),attack_range:1,speed:1,name:"",enemy_type:"cruiser",description:"",asset_url:"/assets/enemy/cruiser/cruiser.webp",model_url:"/assets/enemy/cruiser/cruiser.glb",drop_items:[qv,Kv],summon_cost:Ct([Jv,Xv])},{level:2,health:Math.fround(35),attack:Math.fround(12),defense:Math.fround(5),dodge:Math.fround(10),attack_range:1,speed:4,name:"",enemy_type:"scout",description:"''",asset_url:"/assets/enemy/scout/scout.webp",model_url:"/assets/enemy/scout/scout.glb",drop_items:[Zv,e5],summon_cost:Ct([t5,n5,s5])},{level:2,health:Math.fround(40),attack:Math.fround(16),defense:Math.fround(8),dodge:Math.fround(5),attack_range:3,speed:2,name:"",enemy_type:"horn",description:"",asset_url:"/assets/enemy/horn/horn.webp",model_url:"/assets/enemy/horn/horn.glb",drop_items:[i5,a5],summon_cost:Ct([c5,l5,u5])},{level:3,health:Math.fround(70),attack:Math.fround(22),defense:Math.fround(15),dodge:Math.fround(0),attack_range:1,speed:1,name:"",enemy_type:"boxer",description:" ",asset_url:"/assets/enemy/boxer/boxer.webp",model_url:"/assets/enemy/boxer/boxer.glb",drop_items:[$5,p5,f5],summon_cost:Ct([h5,g5,b5,y5])},{level:3,health:Math.fround(55),attack:Math.fround(30),defense:Math.fround(4),dodge:Math.fround(20),attack_range:1,speed:3,name:"",enemy_type:"assassin",description:"",asset_url:"/assets/enemy/assassin/assassin.webp",model_url:"/assets/enemy/assassin/assassin.glb",drop_items:[v5,k5],summon_cost:Ct([M5,C5,x5,P5])},{level:4,health:Math.fround(110),attack:Math.fround(30),defense:Math.fround(20),dodge:Math.fround(0),attack_range:1,speed:2,name:"",enemy_type:"devourer",description:"",asset_url:"/assets/enemy/devourer/devourer.glb",model_url:"/assets/enemy/devourer/devourer.glb",drop_items:[I5,E5,G5],summon_cost:Ct([R5,O5,D5,N5])},{level:4,health:Math.fround(50),attack:Math.fround(32),defense:Math.fround(10),dodge:Math.fround(70),attack_range:2,speed:3,name:"",enemy_type:"mirror",description:"",asset_url:"/assets/enemy/mirror/mirror.webp",model_url:"/assets/enemy/mirror/mirror.glb",drop_items:[H5,U5,z5],summon_cost:Ct([V5,q5,W5,K5])},{level:5,health:Math.fround(250),attack:Math.fround(45),defense:Math.fround(35),dodge:Math.fround(5),attack_range:2,speed:1,name:"",enemy_type:"guard",description:"",asset_url:"/assets/enemy/guard/guard.webp",model_url:"/assets/enemy/guard/guard.glb",drop_items:[X5,Z5,eS],summon_cost:Ct([tS,nS,sS,oS])},{level:5,health:Math.fround(100),attack:Math.fround(50),defense:Math.fround(10),dodge:Math.fround(25),attack_range:2,speed:5,name:"",enemy_type:"demon",description:"''''",asset_url:"/assets/enemy/demon/demon.webp",model_url:"/assets/enemy/demon/demon.glb",drop_items:[rS,cS,uS],summon_cost:Ct([_S,$S,dS,pS])},{level:5,health:Math.fround(160),attack:Math.fround(55),defense:Math.fround(15),dodge:Math.fround(0),attack_range:2,speed:2,name:"",enemy_type:"variant",description:"''''",asset_url:"/assets/enemy/variant/variant.webp",model_url:"/assets/enemy/variant/variant.glb",drop_items:[fS,gS,yS],summon_cost:Ct([wS,vS,SS,kS,MS])},{level:6,health:Math.fround(300),attack:Math.fround(60),defense:Math.fround(20),dodge:Math.fround(30),attack_range:3,speed:3,name:"BOSS",enemy_type:"shatra",description:"''''''",asset_url:"/assets/enemy/shatra/shatra.webp",model_url:"/assets/enemy/shatra/shatra.glb",drop_items:[xS,LS,TS,AS],summon_cost:Ct([GS,RS,OS,DS,NS])},{level:6,health:Math.fround(500),attack:Math.fround(40),defense:Math.fround(40),dodge:Math.fround(0),attack_range:1,speed:2,name:"BOSS",enemy_type:"glutton",description:"''''",asset_url:"/assets/enemy/glutton/glutton.webp",model_url:"/assets/enemy/glutton/glutton.glb",drop_items:[HS,US,zS,qS],summon_cost:Ct([WS,KS,JS,XS,YS])}],TM=U3(ja),ru=ux(e=>TM(t=>e({_0:t.name,_1:t}))),Lr=Xu(!1),Ir=Xu(!1),Tr=Xu(!1);function Ts(e){ne()}function EM(e){return ne()}function Ha(e){return ne()}function AM(e){return ne()}function GM(e){return ne()}function RM(e){return ne()}function Dm(e){return ne()}function OM(e){return ne()}function DM(e){return{val:e}}function NM(e){return{val:e}}function Xu(e){return{val:e}}function Fa(e){return Es(e)|-1073741824}function jM(e,t){{const n=lt(e,t(0));let o=1;for(;;){const s=o;if(s<e){S(n,s),n[s]=t(s),o=s+1|0;continue}else break}return n}}function HM(e){return R1(e)}function FM(e,t){{e:{let n;t:{let o;n:{let s;s:if(gt(e.str,2,e.start,e.end))if(ge(e.str,H(e.str,0,e.start,e.end))===48)switch(ge(e.str,H(e.str,1,e.start,e.end))){case 120:{const a=e.str,c=H(e.str,2,e.start,e.end);let l;c===void 0?l=e.end:l=c,s={str:a,start:l,end:e.end};break s}case 88:{const a=e.str,c=H(e.str,2,e.start,e.end);let l;c===void 0?l=e.end:l=c,s={str:a,start:l,end:e.end};break s}case 111:{const a=e.str,c=H(e.str,2,e.start,e.end);let l;c===void 0?l=e.end:l=c,o={str:a,start:l,end:e.end};break n}case 79:{const a=e.str,c=H(e.str,2,e.start,e.end);let l;c===void 0?l=e.end:l=c,o={str:a,start:l,end:e.end};break n}case 98:{const a=e.str,c=H(e.str,2,e.start,e.end);let l;c===void 0?l=e.end:l=c,n={str:a,start:l,end:e.end};break t}case 66:{const a=e.str,c=H(e.str,2,e.start,e.end);let l;c===void 0?l=e.end:l=c,n={str:a,start:l,end:e.end};break t}default:break e}else break e;else break e;return new Ji({_0:16,_1:s,_2:!0})}return new Ji({_0:8,_1:o,_2:!0})}return new Ji({_0:2,_1:n,_2:!0})}return new Ji({_0:10,_1:e,_2:!1})}}function ya(){return new Yp(new Js(Tm))}function ra(){return new gc(new Js(Tm))}function UM(){return new Zp(new Js(Ai))}function zi(){return new gc(new Js(Ai))}function Ua(){return new zu(new Js(Ai))}function BM(){return new em(new Js(Ai))}function S$(){return new tm(new Js(Ai))}function k$(){return new nm(new Js(Ai))}function zM(e,t){return t?e===10?so(gl,sn):e===16?so(gl,m$):so(gl,Dn(e)):ks(e===10?so(hl,sn):e===16?so(hl,m$):so(hl,Dn(e)),un)}function Nm(e,t){if(h3(e,{str:h$,start:0,end:h$.length})){let n,o;e:{t:{const d=cf(e,0,void 0);if(gt(d.str,1,d.start,d.end))switch(ge(d.str,H(d.str,0,d.start,d.end))){case 43:{const b=d.str,g=H(d.str,1,d.start,d.end);let m;g===void 0?m=d.end:m=g,n={_0:!1,_1:{str:b,start:m,end:d.end}};break}case 45:{const b=d.str,g=H(d.str,1,d.start,d.end);let m;g===void 0?m=d.end:m=g,n={_0:!0,_1:{str:b,start:m,end:d.end}};break}default:{o=d;break t}}else{o=d;break t}break e}n={_0:!1,_1:o}}const s=n._0,i=n._1,r=FM(i);let a;if(r.$tag===1)a=r._0;else return r;const c=a._0,l=a._1,u=a._2,_=zM(c,s);let $;if(gt(l.str,1,l.start,l.end)){const d=ge(l.str,H(l.str,0,l.start,l.end));if(d>=48&&d<=57)$=!0;else if(d>=97&&d<=122)$=!0;else if(d>=65&&d<=90)$=!0;else if(gt(l.str,2,l.start,l.end))if(d===95){const p=ge(l.str,H(l.str,1,l.start,l.end));$=p>=48&&p<=57||p>=97&&p<=122?!0:p>=65&&p<=90}else $=!1;else $=!1}else $=!1;if($){let d,p=l,b=xt,g=u;for(;;){const m=p,v=b,y=g;let w,k,L;e:if(mo(m.str,1,m.start,m.end)){const I=ge(m.str,H(m.str,0,m.start,m.end));if(I===95){const U=zi();if(U.$tag===1){d=U._0;break}else return U}else{const U=m.str,R=H(m.str,1,m.start,m.end);let M;R===void 0?M=m.end:M=R;const de={str:U,start:M,end:m.end};w=v,k=de,L=I;break e}}else if(gt(m.str,1,m.start,m.end)){const I=ge(m.str,H(m.str,0,m.start,m.end));if(I===95)if(y===!1){const U=zi();if(U.$tag===1){d=U._0;break}else return U}else{const U=m.str,R=H(m.str,1,m.start,m.end);let M;R===void 0?M=m.end:M=R,p={str:U,start:M,end:m.end},g=!1;continue}else{const U=m.str,R=H(m.str,1,m.start,m.end);let M;R===void 0?M=m.end:M=R;const de={str:U,start:M,end:m.end};w=v,k=de,L=I;break e}}else{d=v;break}const P=L;let G;if(P>=48&&P<=57)G=P-48|0;else if(P>=97&&P<=122)G=P+-87|0;else if(P>=65&&P<=90)G=P+-55|0;else{const I=UM();if(I.$tag===1)G=I._0;else return I}if(G<c)if(s)if(uu(w,_)){const I=Gr(Yo(w,Dn(c)),Dn(G));if(Er(I,w)){p=k,b=I,g=!0;continue}else{const U=ra();if(U.$tag===1){d=U._0;break}else return U}}else{const I=ra();if(I.$tag===1){d=I._0;break}else return I}else if(Cc(w,_)){const I=ks(Yo(w,Dn(c)),Dn(G));if(uu(I,w)){p=k,b=I,g=!0;continue}else{const U=ra();if(U.$tag===1){d=U._0;break}else return U}}else{const I=ra();if(I.$tag===1){d=I._0;break}else return I}else{const I=zi();if(I.$tag===1){d=I._0;break}else return I}}return new Bu(d)}else return zi()}else return zi()}function VM(e,t){const n=Nm(e);let o;if(n.$tag===1)o=n._0;else return n;if(Cc(o,Dn(-2147483648))||of(o,Dn(2147483647))){const s=ya();if(s.$tag===1)s._0;else return s}return new Qp(Ho(o))}function qM(e){let t;if(gt(e.str,1,e.start,e.end))switch(ge(e.str,H(e.str,0,e.start,e.end))){case 43:{const _=e.str,$=H(e.str,1,e.start,e.end);let d;$===void 0?d=e.end:d=$,t={str:_,start:d,end:e.end};break}case 45:{const _=e.str,$=H(e.str,1,e.start,e.end);let d;$===void 0?d=e.end:d=$,t={str:_,start:d,end:e.end};break}default:t=e}else t=e;let n,o;e:{t:{let u;n:{s:{let _;r:{o:{let $;i:if(gt(t.str,2,t.start,t.end))if(ge(t.str,H(t.str,0,t.start,t.end))===48)switch(ge(t.str,H(t.str,1,t.start,t.end))){case 120:{const b=t.str,g=H(t.str,2,t.start,t.end);let m;g===void 0?m=t.end:m=g,$={str:b,start:m,end:t.end};break i}case 88:{const b=t.str,g=H(t.str,2,t.start,t.end);let m;g===void 0?m=t.end:m=g,$={str:b,start:m,end:t.end};break i}case 111:{const b=t.str,g=H(t.str,2,t.start,t.end);let m;g===void 0?m=t.end:m=g,_={str:b,start:m,end:t.end};break o}case 79:{const b=t.str,g=H(t.str,2,t.start,t.end);let m;g===void 0?m=t.end:m=g,_={str:b,start:m,end:t.end};break o}case 98:{const b=t.str,g=H(t.str,2,t.start,t.end);let m;g===void 0?m=t.end:m=g,u={str:b,start:m,end:t.end};break s}case 66:{const b=t.str,g=H(t.str,2,t.start,t.end);let m;g===void 0?m=t.end:m=g,u={str:b,start:m,end:t.end};break s}default:{o=t;break t}}else{o=t;break t}else{o=t;break t}n={_0:$,_1:!0,_2:!0};break r}n={_0:_,_1:!0,_2:!1}}break n}n={_0:u,_1:!0,_2:!1}}break e}n={_0:o,_1:!1,_2:!1}}const s=n._0,i=n._1,r=n._2;let a=s,c=i,l=!1;for(;;){const u=a,_=c,$=l;let d,p,b;e:{if(mo(u.str,0,u.start,u.end))return!0;if(mo(u.str,1,u.start,u.end)){const g=ge(u.str,H(u.str,0,u.start,u.end));if(g===95)return!1;{const m=u.str,v=H(u.str,1,u.start,u.end);let y;v===void 0?y=u.end:y=v,d={str:m,start:y,end:u.end},p=g,b=$;break e}}else{const g=ge(u.str,H(u.str,0,u.start,u.end));if(g===95){if(_===!1)return!1;{const m=u.str,v=H(u.str,1,u.start,u.end);let y;v===void 0?y=u.end:y=v,a={str:m,start:y,end:u.end},c=!1,l=!0;continue}}else{const m=u.str,v=H(u.str,1,u.start,u.end);let y;v===void 0?y=u.end:y=v,d={str:m,start:y,end:u.end},p=g,b=$;break e}}}if(p>=48&&p<=57||r&&(p>=97&&p<=102||p>=65&&p<=70)){a=d,c=!0,l=!1;continue}else{if(b)return!1;a=d,c=!1,l=!1;continue}}}function WM(){return{digits:O1(800),digits_num:0,decimal_point:0,negative:!1,truncated:!1}}function Yu(e){for(;;){let t;if(e.digits_num>0){const n=e.digits,o=e.digits_num-1|0;S(n,o),t=n[o]===0}else t=!1;if(t){e.digits_num=e.digits_num-1|0;continue}else break}if(e.digits_num===0){e.decimal_point=0;return}else return}function KM(e){const t=WM();let n=!1,o=!1,s;e:{t:{if(gt(e.str,1,e.start,e.end))switch(ge(e.str,H(e.str,0,e.start,e.end))){case 45:{const c=e.str,l=H(e.str,1,e.start,e.end);let u;l===void 0?u=e.end:u=l;const $={str:c,start:u,end:e.end};t.negative=!0,s=$;break}case 43:{const c=e.str,l=H(e.str,1,e.start,e.end);let u;l===void 0?u=e.end:u=l,s={str:c,start:u,end:e.end};break}default:break t}else break t;break e}s=e}let i,r=s;for(;;){const a=r;if(gt(a.str,1,a.start,a.end)){const c=ge(a.str,H(a.str,0,a.start,a.end));if(c===95){const l=a.str,u=H(a.str,1,a.start,a.end);let _;u===void 0?_=a.end:_=u,r={str:l,start:_,end:a.end};continue}else if(c===46){const l=a.str,u=H(a.str,1,a.start,a.end);let _;u===void 0?_=a.end:_=u;const d={str:l,start:_,end:a.end};if(n){const p=S$();if(p.$tag===1){i=p._0;break}else return p}else{n=!0,t.decimal_point=t.digits_num,r=d;continue}}else if(c>=48&&c<=57){const l=a.str,u=H(a.str,1,a.start,a.end);let _;u===void 0?_=a.end:_=u;const d={str:l,start:_,end:a.end};if(o=!0,c===48&&t.digits_num===0){t.decimal_point=t.decimal_point-1|0,r=d;continue}if(t.digits_num<t.digits.length){const p=t.digits,b=t.digits_num;S(p,b),p[b]=(c-48|0)&255,t.digits_num=t.digits_num+1|0}else c!==48&&(t.truncated=!0);r=d;continue}else{i=a;break}}else{i=a;break}}if(o){n||(t.decimal_point=t.digits_num);let a,c;e:{t:{if(gt(i.str,1,i.start,i.end))switch(ge(i.str,H(i.str,0,i.start,i.end))){case 101:{const $=i.str,d=H(i.str,1,i.start,i.end);let p;d===void 0?p=i.end:p=d,c={str:$,start:p,end:i.end};break t}case 69:{const $=i.str,d=H(i.str,1,i.start,i.end);let p;d===void 0?p=i.end:p=d,c={str:$,start:p,end:i.end};break t}default:a=i}else a=i;break e}let l=1,u;if(gt(c.str,1,c.start,c.end))switch(ge(c.str,H(c.str,0,c.start,c.end))){case 43:{const $=c.str,d=H(c.str,1,c.start,c.end);let p;d===void 0?p=c.end:p=d,u={str:$,start:p,end:c.end};break}case 45:{const $=c.str,d=H(c.str,1,c.start,c.end);let p;d===void 0?p=c.end:p=d;const g={str:$,start:p,end:c.end};l=-1,u=g;break}default:u=c}else u=c;t:{n:{if(gt(u.str,1,u.start,u.end)){const $=ge(u.str,H(u.str,0,u.start,u.end));if($>=48&&$<=57){let d=0,p,b=u;for(;;){const g=b;if(gt(g.str,1,g.start,g.end)){const m=ge(g.str,H(g.str,0,g.start,g.end));if(m===95){const v=g.str,y=H(g.str,1,g.start,g.end);let w;y===void 0?w=g.end:w=y,b={str:v,start:w,end:g.end};continue}else if(m>=48&&m<=57){const v=g.str,y=H(g.str,1,g.start,g.end);let w;y===void 0?w=g.end:w=y;const L={str:v,start:w,end:g.end};d=(Math.imul(d,10)|0)+(m-48|0)|0,b=L;continue}else{p=g;break}}else{p=g;break}}t.decimal_point=t.decimal_point+(Math.imul(l,d)|0)|0,a=p}else break n}else break n;break t}const _=S$();if(_.$tag===1)a=_._0;else return _}}return mo(a.str,0,a.start,a.end)?(Yu(t),new sm(t)):k$()}else return k$()}function JM(e){return KM(e)}function XM(e){let t,n;e:{t:{if(gt(e.str,1,e.start,e.end))switch(ge(e.str,H(e.str,0,e.start,e.end))){case 45:{const r=e.str,a=H(e.str,1,e.start,e.end);let c;a===void 0?c=e.end:c=a,t={_0:!1,_1:{str:r,start:c,end:e.end}};break}case 43:{const r=e.str,a=H(e.str,1,e.start,e.end);let c;a===void 0?c=e.end:c=a,n={str:r,start:c,end:e.end};break t}default:{n=e;break t}}else{n=e;break t}break e}t={_0:!0,_1:n}}const o=t._0,s=t._1;e:{let i;t:{n:if(mo(s.str,3,s.start,s.end))switch(ge(s.str,H(s.str,0,s.start,s.end))){case 110:switch(ge(s.str,H(s.str,1,s.start,s.end))){case 97:switch(ge(s.str,H(s.str,2,s.start,s.end))){case 110:break n;case 78:break n;default:break e}case 65:switch(ge(s.str,H(s.str,2,s.start,s.end))){case 110:break n;case 78:break n;default:break e}default:break e}case 78:switch(ge(s.str,H(s.str,1,s.start,s.end))){case 97:switch(ge(s.str,H(s.str,2,s.start,s.end))){case 110:break n;case 78:break n;default:break e}case 65:switch(ge(s.str,H(s.str,2,s.start,s.end))){case 110:break n;case 78:break n;default:break e}default:break e}case 105:switch(ge(s.str,H(s.str,1,s.start,s.end))){case 110:switch(ge(s.str,H(s.str,2,s.start,s.end))){case 102:{const l=s.str,u=H(s.str,3,s.start,s.end);let _;u===void 0?_=s.end:_=u,i={str:l,start:_,end:s.end};break t}case 70:{const l=s.str,u=H(s.str,3,s.start,s.end);let _;u===void 0?_=s.end:_=u,i={str:l,start:_,end:s.end};break t}default:break e}case 78:switch(ge(s.str,H(s.str,2,s.start,s.end))){case 102:{const l=s.str,u=H(s.str,3,s.start,s.end);let _;u===void 0?_=s.end:_=u,i={str:l,start:_,end:s.end};break t}case 70:{const l=s.str,u=H(s.str,3,s.start,s.end);let _;u===void 0?_=s.end:_=u,i={str:l,start:_,end:s.end};break t}default:break e}default:break e}case 73:switch(ge(s.str,H(s.str,1,s.start,s.end))){case 110:switch(ge(s.str,H(s.str,2,s.start,s.end))){case 102:{const l=s.str,u=H(s.str,3,s.start,s.end);let _;u===void 0?_=s.end:_=u,i={str:l,start:_,end:s.end};break t}case 70:{const l=s.str,u=H(s.str,3,s.start,s.end);let _;u===void 0?_=s.end:_=u,i={str:l,start:_,end:s.end};break t}default:break e}case 78:switch(ge(s.str,H(s.str,2,s.start,s.end))){case 102:{const l=s.str,u=H(s.str,3,s.start,s.end);let _;u===void 0?_=s.end:_=u,i={str:l,start:_,end:s.end};break t}case 70:{const l=s.str,u=H(s.str,3,s.start,s.end);let _;u===void 0?_=s.end:_=u,i={str:l,start:_,end:s.end};break t}default:break e}default:break e}default:break e}else if(gt(s.str,3,s.start,s.end))switch(ge(s.str,H(s.str,0,s.start,s.end))){case 105:switch(ge(s.str,H(s.str,1,s.start,s.end))){case 110:switch(ge(s.str,H(s.str,2,s.start,s.end))){case 102:{const l=s.str,u=H(s.str,3,s.start,s.end);let _;u===void 0?_=s.end:_=u,i={str:l,start:_,end:s.end};break t}case 70:{const l=s.str,u=H(s.str,3,s.start,s.end);let _;u===void 0?_=s.end:_=u,i={str:l,start:_,end:s.end};break t}default:break e}case 78:switch(ge(s.str,H(s.str,2,s.start,s.end))){case 102:{const l=s.str,u=H(s.str,3,s.start,s.end);let _;u===void 0?_=s.end:_=u,i={str:l,start:_,end:s.end};break t}case 70:{const l=s.str,u=H(s.str,3,s.start,s.end);let _;u===void 0?_=s.end:_=u,i={str:l,start:_,end:s.end};break t}default:break e}default:break e}case 73:switch(ge(s.str,H(s.str,1,s.start,s.end))){case 110:switch(ge(s.str,H(s.str,2,s.start,s.end))){case 102:{const l=s.str,u=H(s.str,3,s.start,s.end);let _;u===void 0?_=s.end:_=u,i={str:l,start:_,end:s.end};break t}case 70:{const l=s.str,u=H(s.str,3,s.start,s.end);let _;u===void 0?_=s.end:_=u,i={str:l,start:_,end:s.end};break t}default:break e}case 78:switch(ge(s.str,H(s.str,2,s.start,s.end))){case 102:{const l=s.str,u=H(s.str,3,s.start,s.end);let _;u===void 0?_=s.end:_=u,i={str:l,start:_,end:s.end};break t}case 70:{const l=s.str,u=H(s.str,3,s.start,s.end);let _;u===void 0?_=s.end:_=u,i={str:l,start:_,end:s.end};break t}default:break e}default:break e}default:break e}else break e;return new _o(IM)}t:{n:{if(mo(i.str,0,i.start,i.end))break n;if(mo(i.str,5,i.start,i.end))switch(ge(i.str,H(i.str,0,i.start,i.end))){case 105:switch(ge(i.str,H(i.str,1,i.start,i.end))){case 110:switch(ge(i.str,H(i.str,2,i.start,i.end))){case 105:switch(ge(i.str,H(i.str,3,i.start,i.end))){case 116:switch(ge(i.str,H(i.str,4,i.start,i.end))){case 121:break n;case 89:break n;default:break t}case 84:switch(ge(i.str,H(i.str,4,i.start,i.end))){case 121:break n;case 89:break n;default:break t}default:break t}case 73:switch(ge(i.str,H(i.str,3,i.start,i.end))){case 116:switch(ge(i.str,H(i.str,4,i.start,i.end))){case 121:break n;case 89:break n;default:break t}case 84:switch(ge(i.str,H(i.str,4,i.start,i.end))){case 121:break n;case 89:break n;default:break t}default:break t}default:break t}case 78:switch(ge(i.str,H(i.str,2,i.start,i.end))){case 105:switch(ge(i.str,H(i.str,3,i.start,i.end))){case 116:switch(ge(i.str,H(i.str,4,i.start,i.end))){case 121:break n;case 89:break n;default:break t}case 84:switch(ge(i.str,H(i.str,4,i.start,i.end))){case 121:break n;case 89:break n;default:break t}default:break t}case 73:switch(ge(i.str,H(i.str,3,i.start,i.end))){case 116:switch(ge(i.str,H(i.str,4,i.start,i.end))){case 121:break n;case 89:break n;default:break t}case 84:switch(ge(i.str,H(i.str,4,i.start,i.end))){case 121:break n;case 89:break n;default:break t}default:break t}default:break t}default:break t}case 73:switch(ge(i.str,H(i.str,1,i.start,i.end))){case 110:switch(ge(i.str,H(i.str,2,i.start,i.end))){case 105:switch(ge(i.str,H(i.str,3,i.start,i.end))){case 116:switch(ge(i.str,H(i.str,4,i.start,i.end))){case 121:break n;case 89:break n;default:break t}case 84:switch(ge(i.str,H(i.str,4,i.start,i.end))){case 121:break n;case 89:break n;default:break t}default:break t}case 73:switch(ge(i.str,H(i.str,3,i.start,i.end))){case 116:switch(ge(i.str,H(i.str,4,i.start,i.end))){case 121:break n;case 89:break n;default:break t}case 84:switch(ge(i.str,H(i.str,4,i.start,i.end))){case 121:break n;case 89:break n;default:break t}default:break t}default:break t}case 78:switch(ge(i.str,H(i.str,2,i.start,i.end))){case 105:switch(ge(i.str,H(i.str,3,i.start,i.end))){case 116:switch(ge(i.str,H(i.str,4,i.start,i.end))){case 121:break n;case 89:break n;default:break t}case 84:switch(ge(i.str,H(i.str,4,i.start,i.end))){case 121:break n;case 89:break n;default:break t}default:break t}case 73:switch(ge(i.str,H(i.str,3,i.start,i.end))){case 116:switch(ge(i.str,H(i.str,4,i.start,i.end))){case 121:break n;case 89:break n;default:break t}case 84:switch(ge(i.str,H(i.str,4,i.start,i.end))){case 121:break n;case 89:break n;default:break t}default:break t}default:break t}default:break t}default:break t}else break t}return o?new _o(Pr):new _o(xr)}return Ua()}return Ua()}function YM(e,t,n){let o=t,s=0,i=e;for(;;){const r=i;if(gt(r.str,1,r.start,r.end)){const a=ge(r.str,H(r.str,0,r.start,r.end)),c=r.str,l=H(r.str,1,r.start,r.end);let u;l===void 0?u=r.end:u=l;const $={str:c,start:u,end:r.end};if(a>=48&&a<=57)s=s+1|0,o=n(a-48|0,o);else if(a!==95)break;i=$;continue}else break}return{_0:i,_1:o,_2:s}}function ZM(e,t,n){let o=t,s=0,i=e;for(;;){const r=i;if(gt(r.str,1,r.start,r.end)){const a=ge(r.str,H(r.str,0,r.start,r.end)),c=r.str,l=H(r.str,1,r.start,r.end);let u;l===void 0?u=r.end:u=l;const $={str:c,start:u,end:r.end};if(a>=48&&a<=57)s=s+1|0,o=n(a-48|0,o);else if(a!==95)break;i=$;continue}else break}return{_0:i,_1:o,_2:s}}function M$(e,t){return YM(e,t,(n,o)=>ao(qn(o,sn),i_(n)))}function QM(e){let t=e,n=!1,o,s;e:{t:{const i=t;if(gt(i.str,1,i.start,i.end)){const r=ge(i.str,H(i.str,0,i.start,i.end));switch(r){case 43:{const a=i.str,c=H(i.str,1,i.start,i.end);let l;c===void 0?l=i.end:l=c,o={str:a,start:l,end:i.end},s=r;break t}case 45:{const a=i.str,c=H(i.str,1,i.start,i.end);let l;c===void 0?l=i.end:l=c,o={str:a,start:l,end:i.end},s=r;break t}}}break e}n=s===45,t=o}e:{const i=t;if(gt(i.str,1,i.start,i.end)){const r=ge(i.str,H(i.str,0,i.start,i.end));if(r>=48&&r<=57){const a=ZM(t,i2,(u,_)=>Cc(_,D1)?ks(Yo(sn,_),Dn(u)):_),c=a._0,l=a._1;return n?{_0:c,_1:Df(l)}:{_0:c,_1:l}}else break e}else break e}}function C$(e,t){let n=t,o=0,s=e;for(;;){const i=s;let r;e:if(gt(i.str,1,i.start,i.end)){const a=ge(i.str,H(i.str,0,i.start,i.end));if(a>=48&&a<=57){const c=i.str,l=H(i.str,1,i.start,i.end);let u;l===void 0?u=i.end:u=l;const $={str:c,start:u,end:i.end};if(lu(n,Em)){o=o+1|0,n=ao(qn(n,sn),i_(a-48|0)),s=$;continue}else{r=i;break e}}else if(a===95){const c=i.str,l=H(i.str,1,i.start,i.end);let u;l===void 0?u=i.end:u=l,s={str:c,start:u,end:i.end};continue}else{r=i;break e}}else{r=i;break e}return{_0:r,_1:n,_2:o}}}function e6(e){let t,n;e:{t:{if(gt(e.str,1,e.start,e.end))switch(ge(e.str,H(e.str,0,e.start,e.end))){case 45:{const v=e.str,y=H(e.str,1,e.start,e.end);let w;y===void 0?w=e.end:w=y,t={_0:{str:v,start:w,end:e.end},_1:!0};break}case 43:{const v=e.str,y=H(e.str,1,e.start,e.end);let w;y===void 0?w=e.end:w=y,n={str:v,start:w,end:e.end};break t}default:{n=e;break t}}else{n=e;break t}break e}t={_0:n,_1:!1}}const o=t._0,s=t._1;if(Q6(o))return new Go(void 0);const i=M$(o,xt),r=i._0,a=i._1,c=i._2;let l=a,u=r,_=c,$=0,d=xt;const p=u;if(gt(p.str,1,p.start,p.end)&&ge(p.str,H(p.str,0,p.start,p.end))===46){const v=p.str,y=H(p.str,1,p.start,p.end);let w;y===void 0?w=p.end:w=y,u={str:v,start:w,end:p.end};const P=M$(u,l),G=P._0,I=P._1,U=P._2;u=G,l=I,$=U,d=Df(Dn($))}if(_=_+$|0,_===0)return new Go(void 0);let b;e:{t:{const k=u;if(gt(k.str,1,k.start,k.end))switch(ge(k.str,H(k.str,0,k.start,k.end))){case 101:{const P=k.str,G=H(k.str,1,k.start,k.end);let I;G===void 0?I=k.end:I=G,b={str:P,start:I,end:k.end};break t}case 69:{const P=k.str,G=H(k.str,1,k.start,k.end);let I;G===void 0?I=k.end:I=G,b={str:P,start:I,end:k.end};break t}}break e}const m=QM(b);let v;if(m===void 0)return new Go(void 0);v=m;const y=v._0,w=v._1;u=y,d=ks(d,w)}const g=u;if(mo(g.str,0,g.start,g.end)){if(_<=19)return new Go({exponent:d,mantissa:l,negative:s,many_digits:!1});_=_-19|0;let m=!1,v=e.str,y=e.start,w=e.end;e:for(;;){const L=v,P=y,G=w;let I,U;t:if(gt(L,1,P,G)){const R=ge(L,H(L,0,P,G));switch(R){case 48:{const M=H(L,1,P,G);let B;M===void 0?B=G:B=M,I={str:L,start:B,end:G},U=R;break t}case 46:{const M=H(L,1,P,G);let B;M===void 0?B=G:B=M,I={str:L,start:B,end:G},U=R;break t}default:break e}}else break;_=_-((U-46|0)/2|0)|0,v=I.str,y=I.start,w=I.end}let k=l;if(_>0){m=!0,k=xt;const L=C$(e,k),P=L._0,G=L._1,I=L._2;k=G;let U;if(T3(k,Em))U=I;else if(gt(P.str,1,P.start,P.end)){const R=P.str,M=H(P.str,1,P.start,P.end);let B;M===void 0?B=P.end:B=M;const oe={str:R,start:B,end:P.end},be=C$(oe,k),K=be._1,A=be._2;k=K,U=A}else return new Go(void 0);d=Dn(U),d=ks(d,r2)}return new Go({exponent:d,mantissa:k,negative:s,many_digits:m})}else return BM()}function x$(e,t,n){const o=t-Kt.bias|0;let s=Nf(e,Gr(Fo(un,Kt.mantissa_bits),un));const i=Dn(o&((1<<Kt.exponent_bits)-1|0));return s=X$(s,Fo(i,Kt.mantissa_bits)),n&&(s=X$(s,Fo(Fo(un,Kt.mantissa_bits),Kt.exponent_bits))),s}function t6(e,t){if(t<0||t>=e.digits_num)return!1;let n;const o=e.digits;if(S(o,t),o[t]===5?n=(t+1|0)===e.digits_num:n=!1,n){if(e.truncated)return!0;let i;if(t>0){const r=e.digits,a=t-1|0;S(r,a),i=(r[a]%2|0)!==0}else i=!1;return i}const s=e.digits;return S(s,t),s[t]>=5}function n6(e){if(e.decimal_point>20)return qp;let t=xt,n=0;for(;n<e.decimal_point&&n<e.digits_num;){const o=Yo(t,sn),s=e.digits,i=n;S(s,i),t=ks(o,Wa(s[i])),n=n+1|0;continue}for(;n<e.decimal_point;){t=Yo(t,sn),n=n+1|0;continue}return t6(e,e.decimal_point)&&(t=ks(t,un)),t}function s6(e,t){S(ia,t);const n=ia[t]._0;S(ia,t);const o=ia[t]._1;let s=!1;const i=o.length;let r=0;for(;;){const a=r;if(a<i){if(a>=e.digits_num){s=!0;break}const c=o.charCodeAt(a)-48|0,l=e.digits;if(S(l,a),l[a]!==c){const u=e.digits;S(u,a),s=u[a]<c;break}r=a+1|0;continue}else break}return s?n-1|0:n}function P$(e,t){const n=s6(e,t);let o=e.digits_num,s=e.digits_num+n|0,i=xt;for(o=o-1|0;o>=0;){const r=e.digits,a=o;S(r,a);const c=Wa(r[a]);i=ks(i,Fo(c,t));const l=so(i,sn),u=Ho(Gr(i,Yo(l,sn)));if(s=s-1|0,s<e.digits.length){const _=e.digits,$=s;S(_,$),_[$]=u&255}else u!==0&&(e.truncated=!0);i=l,o=o-1|0;continue}for(;of(i,xt);){const r=so(i,sn),a=Ho(Gr(i,Yo(sn,r)));if(s=s-1|0,s<e.digits.length){const c=e.digits,l=s;S(c,l),c[l]=a&255}else a!==0&&(e.truncated=!0);i=r;continue}e.digits_num=e.digits_num+n|0,e.digits_num>e.digits.length&&(e.digits_num=e.digits.length),e.decimal_point=e.decimal_point+n|0,Yu(e)}function L$(e,t){let n=0,o=0,s=xt;for(;co(os(s,t),xt);){if(n>=e.digits_num){for(;co(os(s,t),xt);){s=qn(s,sn),n=n+1|0;continue}break}const r=e.digits,a=n;S(r,a);const c=r[a];s=ao(qn(s,sn),Wa(c)),n=n+1|0;continue}e.decimal_point=e.decimal_point-(n-1|0)|0;const i=mu(Rr(un,t),un);for(;n<e.digits_num;){const r=os(s,t),a=e.digits,c=o;S(a,c),a[c]=J$(r),o=o+1|0,s=zo(s,i);const l=e.digits,u=n;S(l,u);const _=l[u];s=ao(qn(s,sn),Wa(_)),n=n+1|0;continue}for(;Ba(s,xt);){const r=os(s,t);if(o<e.digits.length){const a=e.digits,c=o;S(a,c),a[c]=J$(r),o=o+1|0}else Ba(r,xt)&&(e.truncated=!0);s=zo(s,i),s=qn(s,sn);continue}e.digits_num=o,Yu(e)}function aa(e,t){if(e.digits_num===0)return;let n=t;if(n>0){for(;n>59;){P$(e,59),n=n-59|0;continue}P$(e,n)}if(n<0){for(;n<-59;){L$(e,59),n=n+59|0;continue}L$(e,-n|0);return}else return}function o6(e){let t=0,n=xt;if(e.digits_num===0||e.decimal_point<-330){n=xt,t=Kt.bias;const s=x$(n,t,e.negative);return new _o(Ar(s))}if(e.decimal_point>310){const s=ya();if(s.$tag===1)s._0;else return s}for(;e.decimal_point>0;){let s=0;if(e.decimal_point>=li.length)s=60;else{const i=e.decimal_point;S(li,i),s=li[i]}aa(e,-s|0),t=t+s|0;continue}for(;;){let s;if(e.decimal_point<0)s=!0;else{let i;if(e.decimal_point===0){const r=e.digits;S(r,0),i=r[0]<5}else i=!1;s=i}if(s){let i=0;if((-e.decimal_point|0)>=li.length)i=60;else{const r=-e.decimal_point|0;S(li,r),i=li[r]}aa(e,i),t=t-i|0;continue}else break}if(t=t-1|0,t<(Kt.bias+1|0)){const s=(Kt.bias+1|0)-t|0;aa(e,-s|0),t=t+s|0}if((t-Kt.bias|0)>=((1<<Kt.exponent_bits)-1|0)){const s=ya();if(s.$tag===1)s._0;else return s}if(aa(e,Kt.mantissa_bits+1|0),n=n6(e),Y$(n,Fo(Jp,Kt.mantissa_bits))&&(n=Vx(n,1),t=t+1|0,(t-Kt.bias|0)>=((1<<Kt.exponent_bits)-1|0))){const s=ya();if(s.$tag===1)s._0;else return s}Y$(Nf(n,Fo(un,Kt.mantissa_bits)),xt)&&(t=Kt.bias);const o=x$(n,t,e.negative);return new _o(Ar(o))}function i6(e,t){if(co(e,xt)||co(t,xt))return fy;if(co(e,un))return t;if(co(t,un))return e;if(Q$(t)===0||Q$(e)===0)return;const n=Kx(o2,t);if(!Ba(e,n))return qn(e,t)}function wl(e){const t=e&31;return S(b$,t),b$[t]}function r6(e){return Er(my,e.exponent)&&Er(e.exponent,py)&&I3(e.mantissa,Rm)&&!e.many_digits}function a6(e){if(r6(e)){let t;if(Er(e.exponent,yl)){const n=qa(e.mantissa);t=Cc(e.exponent,xt)?n/wl(-Ho(e.exponent)|0):n*wl(Ho(e.exponent))}else{const n=Gr(e.exponent,yl),o=e.mantissa,s=Ho(n);S(g$,s);const i=i6(o,g$[s]);let r;if(i===void 0||(r=i,Ba(r,Rm)))return ga;t=qa(r)*wl(Ho(yl))}return e.negative&&(t=-t),new Vu(t)}else return ga}function c6(e){if((e.end-e.start|0)>0)if(qM(e)){const t=e6(e);let n;if(t.$tag===1)n=t._0;else return t;if(n===void 0)return XM(e);{const i=a6(n);if(i.$tag===1){const a=i._0;return new _o(a)}else{const r=JM(e);let a;if(r.$tag===1)a=r._0;else return r;return o6(a)}}}else return Ua();else return Ua()}function l6(e,t,n){const o=e.length;let s;s=o;const i=t<0?o+t|0:t;return i>=0&&i<=s&&s<=o?{bytes:e,start:i,end:s}:OM()}function To(e,t,n){const o=t>>3;if(t&7)if(((t&7)+n|0)<=8){const s=e.bytes,i=e.start+o|0;S(s,i);const a=s[i],c=8-((t&7)+n|0)|0,l=(1<<n>>>0)-1|0;return a>>>c&l}else{const s=e.bytes,i=e.start+o|0;S(s,i);const a=s[i],c=o+1|0,l=e.bytes,u=e.start+c|0;S(l,u);const $=l[u],d=a<<8|$,p=(1<<(16-(t&7)|0)>>>0)-1|0,b=d&p,g=16-((t&7)+n|0)|0;return b>>>g|0}else{const s=e.bytes,i=e.start+o|0;S(s,i);const r=s[i];return sP(r,8-n|0)}}function u6(e,t,n){const o=(n+7|0)/8|0,s=To(e,t,8);switch(o){case 2:return To(e,t+8|0,n-8|0)<<8|s;case 3:{const i=To(e,t+8|0,8);return To(e,t+16|0,n-16|0)<<16|i<<8|s}case 4:{const i=To(e,t+8|0,8),r=To(e,t+16|0,8);return To(e,t+24|0,n-24|0)<<24|r<<16|i<<8|s}default:return Dm()}}function _6(e,t){return{elem_info:0|1<<e,data:[t]}}function Zu(e,t){if(e.elem_info&1<<t){const o=e.data,s=e.elem_info,i=bc(s&((1<<t>>>0)-1|0));return S(o,i),o[i]}else return}function $6(e,t,n,o){return{elem_info:0|1<<e|1<<n,data:e<n?[t,o]:[o,t]}}function d6(e,t,n){const o=e.data,s=o.length,i=s+1|0,r=e.elem_info,a=bc(r&((1<<t>>>0)-1|0)),c=lt(i,n);return Ka(o,c,a,0,0),Ka(o,c,s-a|0,a,a+1|0),{elem_info:e.elem_info|1<<t,data:c}}function p6(e,t){const n=e.data,o=n.length,s=e.elem_info,i=bc(s&((1<<t>>>0)-1|0)),r=lt(o-1|0,n[0]);return Ka(n,r,i,0,0),Ka(n,r,(o-i|0)-1|0,i+1|0,i),{elem_info:e.elem_info^1<<t,data:r}}function jm(e,t,n){const o=HM(e.data),s=e.elem_info,i=bc(s&((1<<t>>>0)-1|0));return S(o,i),o[i]=n,{elem_info:e.elem_info,data:o}}function m6(e,t,n){let o=e,s=n;e:for(;;){const i=o,r=s;switch(i.$tag){case 1:{const a=i,c=a._0,l=a._1,u=a._2;return t===c?l:V6(u,t)}case 0:{const a=i,c=a._0,l=a._1,u=a._2;return r===u&&t===c?l:void 0}default:{const c=i._0,u=r&31,_=Zu(c,u);if(_!==void 0){o=_,s=r>>>5|0;continue e}return}}}}function f6(e,t){const n=e;if(n!==void 0)return m6(n,t,Fa(t))}function Hm(e,t,n,o,s,i){const a=n&31,l=i&31;if(a===l){let u;if(n>>>0<=127){const $={_0:e,_1:t};u=new $o(o,s,new Mr($,Ci))}else{const d=n>>>5|0;u=Hm(e,t,d,o,s,i>>>5|0)}return new Ti(_6(a,u))}else{let u,_;e:if(n>>>0<=127){const d=new $o(e,t,Ci),p=new $o(o,s,Ci);u=d,_=p;break e}else{const d=n,p=new Ko(e,t,d>>>5|0),b=i,g=new Ko(o,s,b>>>5|0);u=p,_=g;break e}return new Ti($6(a,u,l,_))}}function Fm(e,t,n,o){switch(e.$tag){case 1:{const s=e,i=s._0,r=s._1,a=s._2;if(t===i)return new $o(t,n,a);{const c=Zm(a,_=>_._0===t);let l;c===void 0?l=a:l=Qm(a,c);const u={_0:i,_1:r};return new $o(t,n,new Mr(u,l))}}case 0:{const s=e,i=s._0,r=s._1,a=s._2;return o===a&&t===i?new Ko(i,n,a):Hm(i,r,a,t,n,o)}default:{const i=e._0,a=o&31,c=Zu(i,a);if(c===void 0){const l=o,u=new Ko(t,n,l>>>5|0);return new Ti(d6(i,a,u))}else{const $=Fm(c,t,n,o>>>5|0);return new Ti(jm(i,a,$))}}}}function wa(e,t,n){const o=e;return o===void 0?new Ko(t,n,Fa(t)):Fm(o,t,n,Fa(t))}function Um(e,t,n){switch(e.$tag){case 1:{const o=e,s=o._0,i=o._1,r=o._2;if(s===t){if(r.$tag===0)return;{const a=r,c=a._0,l=c._0,u=c._1,_=a._1;return new $o(l,u,_)}}else{const a=Zm(r,c=>c._0===t);if(a===void 0)return e;{const l=a;return new $o(s,i,Qm(r,l))}}}case 0:{const o=e,s=o._0,i=o._2;return n===i&&t===s?void 0:e}default:{const s=e._0,r=n&31,a=Zu(s,r);if(a===void 0)return e;{const _=Um(a,t,n>>>5|0);let $,d;e:{t:{if(s.data.length===1){if(_===void 0)return;d=_;break t}else if(_===void 0)$=p6(s,r);else{d=_;break t}break e}$=jm(s,r,d)}e:{const p=$.data;if(p.length===1){const b=p[0];if(b.$tag===0){const g=b,m=g._0,v=g._1,y=g._2,w=$.elem_info,k=N1(w),L=y;return new Ko(m,v,L<<5|k)}else break e}else break e}return new Ti($)}}}}function h6(e,t){const n=e;if(n!==void 0)return Um(n,t,Fa(t))}function Bm(e){switch(e.$tag){case 1:{const t=e,n=t._0,o=t._1,s=t._2;return Rx(K$({_0:n,_1:o}),z6(s))}case 0:{const t=e,n=t._0,o=t._1;return K$({_0:n,_1:o})}default:{const o=e._0.data;return s=>{const i=o.length;let r=0;for(;;){const a=r;if(a<i){const c=o[a];if(Bm(c)(s)===1){r=a+1|0;continue}else return 0}else return 1}}}}}function g6(e){const t=e;return t===void 0?Gx():Bm(t)}function b6(e){const t=g6(e);return n=>t(o=>n(o._1))}function ca(e,t){if(e!==void 0)return t(e)}function y6(e,t){return Math.pow(e,t)}function Sc(e,t){let n=1,o=0,s=0;for(;;){const i=s;if(i<t){const r=e.str,a=e.start+i|0;r.charCodeAt(a)===10?(n=n+1|0,o=0):o=o+1|0,s=i+1|0;continue}else break}return{line:n,column:o}}function w6(e,t){const n=e.offset+t|0,o=Mc(e.input,n),s=65533;return new yc(new Ur(Sc(e.input,n),o===-1?s:o))}function Qn(e,t){const n=e.offset+t|0,o=Mc(e.input,n),s=65533;return new wc(new Ur(Sc(e.input,n),o===-1?s:o))}function Qu(e,t){const n=e.offset+t|0,o=Mc(e.input,n),s=65533;return new Br(new Ur(Sc(e.input,n),o===-1?s:o))}function kc(e,t){const n=e.offset+t|0,o=Mc(e.input,n),s=65533;return new bo(new Ur(Sc(e.input,n),o===-1?s:o))}function v6(e,t){return new om(new je({_0:e,_1:t}))}function S6(e,t){return new rm(new je({_0:e,_1:t}))}function k6(e,t){return new am(new je({_0:e,_1:t}))}function M6(e,t){return new cm(new je({_0:e,_1:t}))}function C6(e,t){return new lm(new je({_0:e,_1:t}))}function zm(e,t){const n=e;let o=0,s=n.length;for(;;){const i=o,r=s;if(i<r){const a=(i+r|0)/2|0,c=w3(n,a),l=c._0,u=c._1;if(t<l){s=a;continue}else if(t>u){o=a+1|0;continue}else return!0}else return!1}}function Wt(e){if(e.offset<e.end_offset){const t=e.input,n=e.offset,o=t.str,s=t.start+n|0,i=o.charCodeAt(s);if(e.offset=e.offset+1|0,i>=55296&&i<=56319&&e.offset<e.end_offset){const r=e.input,a=e.offset,c=r.str,l=r.start+a|0,u=c.charCodeAt(l);if(u>=56320&&u<=57343)return e.offset=e.offset+1|0,((i<<10)+u|0)-56613888|0}return i}else return-1}function Ri(e){e:for(;;)t:{n:{const t=Wt(e);if(t===-1)break;{const o=t;switch(o){case 9:break n;case 32:break n;case 10:break n;case 13:break n;default:{if(o>127&&zm(Gm,o))break t;e.offset=e.offset-1|0;break e}}}}break t}}function x6(e,t){return{offset:0,input:e,end_offset:e.end-e.start|0,remaining_available_depth:t}}function ps(e,t){if(e.offset<e.end_offset){const n=e.input,o=e.offset,s=n.str,i=n.start+o|0,r=s.charCodeAt(i);return e.offset=e.offset+1|0,t!==r?Qn(e,-1):new qu(void 0)}else return new wc(Tn)}function wo(e,t,n){const o=cf(e.input,t,n);if(!vl(o,{str:y$,start:0,end:y$.length})&&!vl(o,{str:w$,start:0,end:w$.length})&&!vl(o,{str:v$,start:0,end:v$.length})){let s,i;e:{t:{const r=Nm(o);let a;if(r.$tag===1)a=r._0;else{i=r._0;break t}s=new Bu(a);break e}s=new gc(i)}e:if(s.$tag===1){const a=s._0;if(Er(a,j1)&&uu(a,H1))return{_0:Wx(a),_1:void 0};break e}else break e;e:if(gt(o.str,1,o.start,o.end)){if(ge(o.str,H(o.str,0,o.start,o.end))===45)return{_0:xr,_1:o};break e}else break e;return{_0:Pr,_1:o}}else{let s,i;e:{t:{const r=c6(o);let a;if(r.$tag===1)a=r._0;else{i=r._0;break t}s=new _o(a);break e}s=new zu(i)}if(s.$tag===1)return{_0:s._0,_1:void 0};e:if(gt(o.str,1,o.start,o.end)){if(ge(o.str,H(o.str,0,o.start,o.end))===45)return{_0:xr,_1:o};break e}else break e;return{_0:Pr,_1:o}}}function Vm(e,t){for(;;)e:{const n=Wt(e);if(n===-1)return wo(e,t,e.offset);{const s=n;if(s>=48&&s<=57)break e;return e.offset=e.offset-1|0,wo(e,t,e.offset)}}}function P6(e,t){const n=Wt(e);if(n===-1)return new Br(Tn);{const s=n;return s>=48&&s<=57?new On(Vm(e,t)):(e.offset=e.offset-1|0,Qu(e,0))}}function e_(e,t){e:{const s=Wt(e);if(s===-1)return new Br(Tn);{const r=s;switch(r){case 43:break e;case 45:break e;default:return r>=48&&r<=57?new On(Vm(e,t)):(e.offset=e.offset-1|0,Qu(e,0))}}}const n=P6(e,t);let o;if(n.$tag===1)o=n._0;else return n;return new On(o)}function L6(e,t){for(;;)e:{t:{const s=Wt(e);if(s===-1)return new On(wo(e,t,e.offset));{const r=s;switch(r){case 101:break t;case 69:break t;default:{if(r>=48&&r<=57)break e;return e.offset=e.offset-1|0,new On(wo(e,t,e.offset))}}}}const n=e_(e,t);let o;if(n.$tag===1)o=n._0;else return n;return new On(o)}}function qm(e,t){const n=Wt(e);if(n===-1)return new Br(Tn);{const s=n;return s>=48&&s<=57?L6(e,t):Qu(e,-1)}}function I$(e,t){for(;;)e:{t:{const s=Wt(e);if(s===-1)return new On(wo(e,t,e.offset));{const r=s;switch(r){case 46:{const a=qm(e,t);let c;if(a.$tag===1)c=a._0;else return a;return new On(c)}case 101:break t;case 69:break t;default:{if(r>=48&&r<=57)break e;return e.offset=e.offset-1|0,new On(wo(e,t,e.offset))}}}}const n=e_(e,t);let o;if(n.$tag===1)o=n._0;else return n;return new On(o)}}function I6(e,t){let n=0,o=0;for(;;){const s=o;if(s<t){const i=Wt(e);if(i===-1)return new _m(Tn);{const a=i;if(a>=65){const c=((a&-33)-65|0)+10|0;if(c>15){const l=Qn(e,-1);if(l.$tag===1)l._0;else return l}n=n<<4|c}else if(a>=48){const c=a-48|0;if(c>9){const l=Qn(e,-1);if(l.$tag===1)l._0;else return l}n=n<<4|c}else{const c=Qn(e,-1);if(c.$tag===1)c._0;else return c}}o=s+1|0;continue}else break}return new $m(n)}function T$(e,t){const n=e._2,o=e._1,s=e._0;if(s.val>0&&t>s.val){const r=o.input.str,c=o.input.start;Vr(n,r,c+s.val|0,t-s.val|0);return}else return}function t_(e){const t=ei(),n={val:e.offset},o={_0:n,_1:e,_2:t};e:for(;;)t:{n:{s:{const i=Wt(e);if(i===-1)return new tu(Tn);{const a=i;switch(a){case 34:{T$(o,e.offset-1|0);break e}case 10:break s;case 13:break s;case 92:{T$(o,e.offset-1|0);const c=Wt(e);if(c===-1)return new tu(Tn);switch(c){case 98:{ut(t,8);break}case 102:{ut(t,12);break}case 110:{ut(t,10);break}case 114:{ut(t,13);break}case 116:{ut(t,9);break}case 34:{ut(t,34);break}case 92:{ut(t,92);break}case 47:{ut(t,47);break}case 117:{const _=I6(e,4);let $;if(_.$tag===1)$=_._0;else return _;ut(t,$);break}default:{const _=Qn(e,-1);if(_.$tag===1)_._0;else return _}}n.val=e.offset;break}default:if(a<32){const c=Qn(e,-1);if(c.$tag===1)c._0;else return c}else break t}}break n}const s=Qn(e,-1);if(s.$tag===1)s._0;else return s}break t}return new dm(t.val)}function E$(e,t){e:{const n=Wt(e);if(n===-1)return new On(wo(e,t,e.offset));{const s=n;switch(s){case 46:return qm(e,t);case 101:break e;case 69:break e;default:{if(s>=48&&s<=57){e.offset=e.offset-1|0;const i=Qn(e,0);if(i.$tag===1)i._0;else return i}return e.offset=e.offset-1|0,new On(wo(e,t,e.offset))}}}}return e_(e,t)}function au(e,t){for(;;)e:{t:{n:{const n=Wt(e);if(n===-1)return new bo(Tn);{const s=n;if(s===9)break n;if(s===32)break n;if(s===10)break n;if(s===13)break n;if(s===123)return new Ft(z1);if(s===91)return new Ft(V1);if(s===93){if(t)return new Ft(mm);{const i=Qn(e,-1);if(i.$tag===1)i._0;else return i}}else if(s===110){const i=ps(e,117);if(i.$tag===1)i._0;else return i;const r=ps(e,108);if(r.$tag===1)r._0;else return r;const a=ps(e,108);if(a.$tag===1)a._0;else return a;return new Ft(F1)}else if(s===116){const i=ps(e,114);if(i.$tag===1)i._0;else return i;const r=ps(e,117);if(r.$tag===1)r._0;else return r;const a=ps(e,101);if(a.$tag===1)a._0;else return a;return new Ft(U1)}else if(s===102){const i=ps(e,97);if(i.$tag===1)i._0;else return i;const r=ps(e,108);if(r.$tag===1)r._0;else return r;const a=ps(e,115);if(a.$tag===1)a._0;else return a;const c=ps(e,101);if(c.$tag===1)c._0;else return c;return new Ft(B1)}else if(s===45){const i=Wt(e);if(i===-1)return new bo(Tn);{const a=i;if(a===48){const c=E$(e,e.offset-2|0);let l;if(c.$tag===1)l=c._0;else return c;const u=l._0,_=l._1;return new Ft(new Yi(u,ca(_,$=>ua($))))}else{if(a>=49&&a<=57){const l=I$(e,e.offset-2|0);let u;if(l.$tag===1)u=l._0;else return l;const _=u._0,$=u._1;return new Ft(new Yi(_,ca($,d=>ua(d))))}const c=Qn(e,-1);if(c.$tag===1)c._0;else return c}}}else if(s===48){const i=E$(e,e.offset-1|0);let r;if(i.$tag===1)r=i._0;else return i;const a=r._0,c=r._1;return new Ft(new Yi(a,ca(c,l=>ua(l))))}else if(s>=49&&s<=57){const i=I$(e,e.offset-1|0);let r;if(i.$tag===1)r=i._0;else return i;const a=r._0,c=r._1;return new Ft(new Yi(a,ca(c,l=>ua(l))))}else if(s===34){const i=t_(e);let r;if(i.$tag===1)r=i._0;else return i;return new Ft(new vc(r))}else{if(s>127&&zm(Gm,s))break e;const r=-(s<=65535?1:2)|0,a=Qn(e,r);if(a.$tag===1)a._0;else return a}}break t}break e}break e}}function T6(e){Ri(e);const t=Wt(e);if(t===-1)return new bo(Tn);switch(t){case 93:return new Ft(mm);case 44:return new Ft(fm);default:return kc(e,-1)}}function E6(e){Ri(e);const t=Wt(e);if(t===-1)return new bo(Tn);switch(t){case 125:return new Ft(pm);case 44:return new Ft(fm);default:return kc(e,-1)}}function A6(e){Ri(e);const t=Wt(e);return t===-1?new wc(Tn):t===58?new qu(void 0):Qn(e,-1)}function G6(e){Ri(e);const t=Wt(e);if(t===-1)return new bo(Tn);switch(t){case 125:return new Ft(pm);case 34:{const s=t_(e);let i;if(s.$tag===1)i=s._0;else return s;return new Ft(new vc(i))}default:return kc(e,-1)}}function R6(e){Ri(e);const t=Wt(e);if(t===-1)return new bo(Tn);if(t===34){const s=t_(e);let i;if(s.$tag===1)i=s._0;else return s;return new Ft(new vc(i))}else return kc(e,-1)}function Wm(e){const t=au(e,!1);let n;if(t.$tag===1)n=t._0;else return t;return Km(e,n)}function Km(e,t){e:switch(t.$tag){case 0:return new ws(Iy);case 1:return new ws(Wp);case 2:return new ws(Kp);case 3:{const n=t,o=n._0,s=n._1;return new ws(new Fr(o,s))}case 4:{const o=t._0;return new ws(new Ae(o))}case 5:return D6(e);case 7:return O6(e);case 8:break e;case 6:break e;default:break e}return new ws(Ha())}function O6(e){if(e.remaining_available_depth<=0)return new yc(Xp);e.remaining_available_depth=e.remaining_available_depth-1|0;const t=[];let n;const o=au(e,!0);let s;if(o.$tag===1)s=o._0;else return o;let i=s;e:for(;;){const r=i;if(r.$tag===8){e.remaining_available_depth=e.remaining_available_depth+1|0,n=new In(t);break}else{const a=Km(e,r);let c;if(a.$tag===1)c=a._0;else return a;Ix(t,c);const l=T6(e);let u;if(l.$tag===1)u=l._0;else return l;switch(u.$tag){case 9:{const _=au(e,!1);if(_.$tag===1)i=_._0;else return _;continue e}case 8:{e.remaining_available_depth=e.remaining_available_depth+1|0,n=new In(t);break e}default:{n=Ha();break e}}}}return new ws(n)}function D6(e){if(e.remaining_available_depth<=0)return new yc(Xp);e.remaining_available_depth=e.remaining_available_depth-1|0;const t=uf(8);let n;const o=G6(e);let s;if(o.$tag===1)s=o._0;else return o;let i=s;e:for(;;){const r=i;switch(r.$tag){case 6:{e.remaining_available_depth=e.remaining_available_depth+1|0,n=new ke(t);break e}case 4:{const c=r._0,l=A6(e);if(l.$tag===1)l._0;else return l;const u=Wm(e);let _;if(u.$tag===1)_=u._0;else return u;ce(t,c,_);const $=E6(e);let d;if($.$tag===1)d=$._0;else return $;switch(d.$tag){case 9:{const p=R6(e);if(p.$tag===1)i=p._0;else return p;continue e}case 6:{e.remaining_available_depth=e.remaining_available_depth+1|0,n=new ke(t);break e}default:{n=Ha();break e}}}default:{n=Ha();break e}}}return new ws(n)}function Jm(e,t){const n=x6(e,t),o=Wm(n);let s;if(o.$tag===1)s=o._0;else return o;return Ri(n),n.offset>=n.end_offset?new ws(s):w6(n,0)}function A$(e,t){const n=ei(e.length),o=J6(e);for(;;){const s=dx(o);if(s===-1)break;{const r=s;switch(r){case 34:{mt(n,'\\"');break}case 92:{mt(n,"\\\\");break}case 47:{ut(n,r);break}case 10:{mt(n,"\\n");break}case 13:{mt(n,"\\r");break}case 8:{mt(n,"\\b");break}case 9:{mt(n,"\\t");break}default:{const a=r;a===12?mt(n,"\\f"):a<32?(mt(n,"\\u00"),mt(n,N3(a&255))):ut(n,r)}}continue}}return n.val}function ui(e,t){return""}function Ze(e,t,n,o){const s=ei(),i=[];let r=e;for(;;){const a=r;if(a===void 0){if(i.length===0)break;{const c=i[i.length-1|0];if(c.$tag===0){const l=c,u=l._0,_=l._1;if(_<u.length){const $=g3(u,_);l._1=_+1|0,_>0&&(ut(s,44),mt(s,ui())),r=$;continue}else{ed(i),mt(s,ui()),ut(s,93),r=void 0;continue}}else{const l=c,u=l._0,_=l._1,$=Lf(u);if($===void 0){ed(i),mt(s,ui()),ut(s,125),r=void 0;continue}else{const p=$,b=p._0;let m=p._1;_||(ut(s,44),mt(s,ui())),ut(s,34),mt(s,A$(b)),ut(s,34),ut(s,58),l._1=!1,r=m;continue}}}}else{const l=a;switch(l.$tag){case 6:{const _=l._0;_.size===0?mt(s,"{}"):(ut(s,123),mt(s,ui()),W$(i,new gm(xf(_),!0)));break}case 5:{const _=l._0;_.length===0?mt(s,"[]"):(ut(s,91),mt(s,ui()),W$(i,new hm(_,0)));break}case 4:{const _=l._0;ut(s,34),mt(s,A$(_)),ut(s,34);break}case 3:{const u=l,_=u._0,$=u._1;$===void 0?F3(s,_):mt(s,$);break}case 1:{mt(s,"true");break}case 2:{mt(s,"false");break}default:mt(s,"null")}r=void 0;continue}}return s.val}function Vi(e){if(e.$tag===3){const n=e._0;return new Vu(n)}else return ga}function va(e){if(e.$tag===4)return e._0}function Xm(e){if(e.$tag===5){const n=e._0;return new ym(n)}else return q1}function Ym(e){if(e.$tag===6)return e._0}function N6(e,t){return pP(e,t)}function j6(e,t){return hu(e,t)}function H6(e,t){let n;return n=bm,N6(e,n)}function F6(e,t){let n;return n=bm,j6(e,n)}function U6(e,t){switch(e.$tag){case 1:return new eu(!0);case 2:return new eu(!1);default:return M6(t,"Bool::from_json: expected boolean")}}function ro(e,t){e:if(e.$tag===3){const o=e._0;if(o!==Pr)if(o!==xr){if(o>2147483647||o<-2147483648){const s=S6(t,"Int::from_json: overflow");if(s.$tag===1)s._0;else return s}return new im(fi(o))}else break e;else break e}else break e;return v6(t,"Int::from_json: expected number")}function la(e,t){e:switch(e.$tag){case 4:switch(e._0){case"NaN":return new Xi(My);case"Infinity":return new Xi(Cy);case"-Infinity":return new Xi(xy);default:break e}case 3:{const o=e._0;if(o!==Pr&&o!==xr)return new Xi(Math.fround(o));break e}default:break e}return k6(t,"Float::from_json: expected number")}function Ss(e,t){if(e.$tag===4){const o=e._0;return new um(o)}else return C6(t,"String::from_json: expected string")}function B6(e){return Math.round(e)}function z6(e){return n=>{let o=e;for(;;){const s=o;if(s.$tag===0)return 1;{const i=s,r=i._0,a=i._1;if(n(r)===0)return 0;o=a;continue}}}}function V6(e,t){let n=e;for(;;){const o=n;if(o.$tag===0)return;{const s=o,i=s._0,r=i._0,a=i._1,c=s._1;if(r===t)return a;n=c;continue}}}function Zm(e,t){let n=e,o=0;for(;;){const s=n,i=o;if(s.$tag===0)return;{const r=s,a=r._0,c=r._1;if(t(a))return i;n=c,o=i+1|0;continue}}}function Qm(e,t){if(e.$tag===0)return Ci;if(t<0)return e;if(t===0)return e._1;{const n=e,o=n._0,s=n._1,i=new Mr(o,Ci);let r=i,a=s,c=t-1|0;for(;;){const l=r,u=a,_=c;if(u.$tag===0)break;if(l.$tag===1){const $=l,d=u,p=d._0,b=d._1;if(_===0){$._1=b;break}else{$._1=new Mr(p,Ci),r=$._1,a=b,c=_-1|0;continue}}else{ne();break}}return i}}function q6(e,t){t.method_0(t.self,String(e))}function mo(e,t,n,o){let s;o===void 0?s=e.length:s=o;let i=n,r=0;for(;;){const a=i,c=r;if(a<s&&c<t){const l=e.charCodeAt(a);if(55296<=l&&l<=56319&&(a+1|0)<s){const u=a+1|0,_=e.charCodeAt(u);if(56320<=_&&_<=57343){i=a+2|0,r=c+1|0;continue}else Ts()}i=a+1|0,r=c+1|0;continue}else return c===t&&a===s}}function gt(e,t,n,o){let s;o===void 0?s=e.length:s=o;let i=n,r=0;for(;;){const a=i,c=r;if(a<s&&c<t){const l=e.charCodeAt(a);if(55296<=l&&l<=56319&&(a+1|0)<s){const u=a+1|0,_=e.charCodeAt(u);if(56320<=_&&_<=57343){i=a+2|0,r=c+1|0;continue}else Ts()}i=a+1|0,r=c+1|0;continue}else return c>=t}}function W6(e,t,n,o){let s=0,i=o;for(;(i-1|0)>=n&&s<t;){const r=i-1|0,a=e.charCodeAt(r);56320<=a&&a<=57343?i=i-2|0:i=i-1|0,s=s+1|0;continue}return s<t||i<n?void 0:i}function K6(e,t,n,o){if(n>=0&&n<=o){let s=n,i=0;for(;s<o&&i<t;){const r=s,a=e.charCodeAt(r);55296<=a&&a<=56319?s=s+2|0:s=s+1|0,i=i+1|0;continue}return i<t||s>=o?void 0:s}else return GM()}function H(e,t,n,o){let s;return o===void 0?s=e.length:s=o,t>=0?K6(e,t,n,s):W6(e,-t|0,n,s)}function ef(e,t){return(((Math.imul(e-55296|0,1024)|0)+t|0)-56320|0)+65536|0}function J6(e){const t=e.length,n={val:0};return()=>{if(n.val<t){const s=n.val,i=e.charCodeAt(s);if(55296<=i&&i<=56319&&(n.val+1|0)<t){const r=n.val+1|0,a=e.charCodeAt(r);if(56320<=a&&a<=57343){const c=ef(i,a);return n.val=n.val+2|0,c}}return n.val=n.val+1|0,i}else return-1}}function X6(e,t){const n=e.end-e.start|0,o=t.end-t.start|0;if(o>0)if(n>=o){const s=lt(256,o),i=o-1|0;let r=0;for(;;){const c=r;if(c<i){const l=t.str,u=t.start+c|0,_=l.charCodeAt(u)&255;S(s,_),s[_]=(o-1|0)-c|0,r=c+1|0;continue}else break}let a=0;for(;;){const c=a;if(c<=(n-o|0)){const l=o-1|0;let u=0;for(;;){const b=u;if(b<=l){const g=c+b|0,m=e.str,v=e.start+g|0,y=m.charCodeAt(v),w=t.str,k=t.start+b|0;if(y!==w.charCodeAt(k))break;u=b+1|0;continue}else return c}const _=(c+o|0)-1|0,$=e.str,d=e.start+_|0,p=$.charCodeAt(d)&255;S(s,p),a=c+s[p]|0;continue}else break}return}else return;else return Py}function Y6(e,t){const n=e.end-e.start|0,o=t.end-t.start|0;if(o>0)if(n>=o){const i=t.str,r=t.start+0|0,a=i.charCodeAt(r),c=n-o|0;let l=0;for(;l<=c;){for(;;){let u;if(l<=c){const _=l,$=e.str,d=e.start+_|0;u=$.charCodeAt(d)!==a}else u=!1;if(u){l=l+1|0;continue}else break}if(l<=c){let u=1;for(;;){const _=u;if(_<o){const $=l+_|0,d=e.str,p=e.start+$|0,b=d.charCodeAt(p),g=t.str,m=t.start+_|0;if(b!==g.charCodeAt(m))break;u=_+1|0;continue}else return l}l=l+1|0}continue}return}else return;else return Ly}function Z6(e,t){return(t.end-t.start|0)<=4?Y6(e,t):X6(e,t)}function vl(e,t){return Z6(e,t)!==void 0}function Q6(e){return(e.end-e.start|0)===0}function Mc(e,t){if(t>=0&&t<(e.end-e.start|0)){const n=e.str,o=e.start+t|0,s=n.charCodeAt(o);if(55296<=s&&s<=56319)if((t+1|0)<(e.end-e.start|0)){const i=t+1|0,r=e.str,a=e.start+i|0,c=r.charCodeAt(a);return 56320<=c&&c<=57343?ef(s,c):-1}else return-1;else return 56320<=s&&s<=57343?-1:s}else return-1}function e3(e,t,n){S(t,0),t[0]=1634760805,S(t,1),t[1]=1634760805,S(t,2),t[2]=1634760805,S(t,3),t[3]=1634760805,S(t,4),t[4]=857760878,S(t,5),t[5]=857760878,S(t,6),t[6]=857760878,S(t,7),t[7]=857760878,S(t,8),t[8]=2036477234,S(t,9),t[9]=2036477234,S(t,10),t[10]=2036477234,S(t,11),t[11]=2036477234,S(t,12),t[12]=1797285236,S(t,13),t[13]=1797285236,S(t,14),t[14]=1797285236,S(t,15),t[15]=1797285236,S(e,0),S(t,16),t[16]=e[0],S(e,0),S(t,17),t[17]=e[0],S(e,0),S(t,18),t[18]=e[0],S(e,0),S(t,19),t[19]=e[0],S(e,1),S(t,20),t[20]=e[1],S(e,1),S(t,21),t[21]=e[1],S(e,1),S(t,22),t[22]=e[1],S(e,1),S(t,23),t[23]=e[1],S(e,2),S(t,24),t[24]=e[2],S(e,2),S(t,25),t[25]=e[2],S(e,2),S(t,26),t[26]=e[2],S(e,2),S(t,27),t[27]=e[2],S(e,3),S(t,28),t[28]=e[3],S(e,3),S(t,29),t[29]=e[3],S(e,3),S(t,30),t[30]=e[3],S(e,3),S(t,31),t[31]=e[3],S(e,4),S(t,32),t[32]=e[4],S(e,4),S(t,33),t[33]=e[4],S(e,4),S(t,34),t[34]=e[4],S(e,4),S(t,35),t[35]=e[4],S(e,5),S(t,36),t[36]=e[5],S(e,5),S(t,37),t[37]=e[5],S(e,5),S(t,38),t[38]=e[5],S(e,5),S(t,39),t[39]=e[5],S(e,6),S(t,40),t[40]=e[6],S(e,6),S(t,41),t[41]=e[6],S(e,6),S(t,42),t[42]=e[6],S(e,6),S(t,43),t[43]=e[6],S(e,7),S(t,44),t[44]=e[7],S(e,7),S(t,45),t[45]=e[7],S(e,7),S(t,46),t[46]=e[7],S(e,7),S(t,47),t[47]=e[7],S(t,48),t[48]=n,S(t,49),t[49]=(n>>>0)+1|0,S(t,50),t[50]=(n>>>0)+2|0,S(t,51),t[51]=(n>>>0)+3|0,S(t,52),t[52]=0,S(t,53),t[53]=0,S(t,54),t[54]=0,S(t,55),t[55]=0,S(t,56),t[56]=0,S(t,57),t[57]=0,S(t,58),t[58]=0,S(t,59),t[59]=0,S(t,60),t[60]=0,S(t,61),t[61]=0,S(t,62),t[62]=0,S(t,63),t[63]=0}function Zs(e){const t=e._0,n=e._1,o=e._2,s=e._3,i=(t>>>0)+(n>>>0)|0,r=s^i,a=r<<16|(r>>>16|0),c=(o>>>0)+(a>>>0)|0,l=n^c,u=l<<12|(l>>>20|0),_=(i>>>0)+(u>>>0)|0,$=a^_,d=$<<8|($>>>24|0),p=(c>>>0)+(d>>>0)|0,b=u^p,g=b<<7|(b>>>25|0);return{_0:_,_1:g,_2:p,_3:d}}function tf(e,t,n){e3(e,t,n);let o=0;for(;;){const s=o;if(s<4){S(t,s);let i=t[s];const r=4+s|0;S(t,r);let a=t[r];const c=8+s|0;S(t,c);let l=t[c];const u=12+s|0;S(t,u);let _=t[u];const $=16+s|0;S(t,$);let d=t[$];const p=20+s|0;S(t,p);let b=t[p];const g=24+s|0;S(t,g);let m=t[g];const v=28+s|0;S(t,v);let y=t[v];const w=32+s|0;S(t,w);let k=t[w];const L=36+s|0;S(t,L);let P=t[L];const G=40+s|0;S(t,G);let I=t[G];const U=44+s|0;S(t,U);let R=t[U];const M=48+s|0;S(t,M);let B=t[M];const de=52+s|0;S(t,de);let oe=t[de];const be=56+s|0;S(t,be);let K=t[be];const A=60+s|0;S(t,A);let Q=t[A],F=0;for(;;){const Z=F;if(Z<4){const J=Zs({_0:i,_1:d,_2:k,_3:B}),ue=J._0,le=J._1,ie=J._2,Y=J._3;i=ue,d=le,k=ie,B=Y;const Se=Zs({_0:a,_1:b,_2:P,_3:oe}),fe=Se._0,ve=Se._1,Te=Se._2,Re=Se._3;a=fe,b=ve,P=Te,oe=Re;const Xe=Zs({_0:l,_1:m,_2:I,_3:K}),Me=Xe._0,Ye=Xe._1,ye=Xe._2,dt=Xe._3;l=Me,m=Ye,I=ye,K=dt;const pt=Zs({_0:_,_1:y,_2:R,_3:Q}),Yt=pt._0,Hn=pt._1,It=pt._2,Zt=pt._3;_=Yt,y=Hn,R=It,Q=Zt;const Fn=Zs({_0:i,_1:b,_2:I,_3:Q}),Os=Fn._0,Di=Fn._1,Ni=Fn._2,qc=Fn._3;i=Os,b=Di,I=Ni,Q=qc;const oi=Zs({_0:a,_1:m,_2:R,_3:B}),Wc=oi._0,Kc=oi._1,Jc=oi._2,ii=oi._3;a=Wc,m=Kc,R=Jc,B=ii;const ri=Zs({_0:l,_1:y,_2:k,_3:oe}),Xc=ri._0,Wr=ri._1,Kr=ri._2,Jr=ri._3;l=Xc,y=Wr,k=Kr,oe=Jr;const ai=Zs({_0:_,_1:d,_2:P,_3:K}),Yc=ai._0,Zc=ai._1,Qc=ai._2,el=ai._3;_=Yc,d=Zc,P=Qc,K=el,F=Z+1|0;continue}else break}S(t,s),t[s]=i;const D=4+s|0;S(t,D),t[D]=a;const X=8+s|0;S(t,X),t[X]=l;const q=12+s|0;S(t,q),t[q]=_;const he=16+s|0;S(t,he),S(t,he),t[he]=(t[he]>>>0)+(d>>>0)|0;const Ge=20+s|0;S(t,Ge),S(t,Ge),t[Ge]=(t[Ge]>>>0)+(b>>>0)|0;const qe=24+s|0;S(t,qe),S(t,qe),t[qe]=(t[qe]>>>0)+(m>>>0)|0;const He=28+s|0;S(t,He),S(t,He),t[He]=(t[He]>>>0)+(y>>>0)|0;const rt=32+s|0;S(t,rt),S(t,rt),t[rt]=(t[rt]>>>0)+(k>>>0)|0;const bt=36+s|0;S(t,bt),S(t,bt),t[bt]=(t[bt]>>>0)+(P>>>0)|0;const $t=40+s|0;S(t,$t),S(t,$t),t[$t]=(t[$t]>>>0)+(I>>>0)|0;const Dt=44+s|0;S(t,Dt),S(t,Dt),t[Dt]=(t[Dt]>>>0)+(R>>>0)|0;const x=48+s|0;S(t,x),t[x]=B;const T=52+s|0;S(t,T),t[T]=oe;const z=56+s|0;S(t,z),t[z]=K;const N=60+s|0;S(t,N),t[N]=Q,o=s+1|0;continue}else return}}function t3(e){const t=jM(8,s=>{const i=l6(e,Math.imul(s,4)|0);return(i.end-i.start|0)>=4?u6(i,0,32):Dm()}),n=lt(64,0);return tf(t,n,0),{buffer:n,seed:t,i:0,n:32,counter:0}}function n3(e){const t=e.i;if(t>>>0>=e.n>>>0)return;e.i=(t>>>0)+1|0;const n=t&31,o=e.buffer,s=Math.imul(n,2)|0;S(o,s);const i=pu(o[s]),r=e.buffer,a=(Math.imul(n,2)|0)+1|0;S(r,a);const c=pu(r[a]);return Xx(Rr(c,32),i)}function s3(e){e.counter=(e.counter>>>0)+4|0,e.counter===16&&(nP(e.buffer,e.seed,8,56,0),e.counter=0),tf(e.seed,e.buffer,e.counter),e.i=0,e.n=e.counter===12?28:32}function o3(e){for(;;){const t=n3(e);if(t!==void 0)return t;s3(e)}}function i3(e){return e.length!==32&&Ts(),{self:t3(e),method_0:o3}}function r3(e){return i3(W1)}function G$(e,t){const n=zo(e,bl),o=os(e,32),s=zo(t,bl),i=os(t,32),r=qn(n,s),a=ao(qn(o,s),os(r,32)),c=ao(qn(n,i),zo(a,bl));return{hi:ao(ao(qn(o,i),os(a,32)),os(c,32)),lo:qn(e,t)}}function a3(e,t){if(co(t,xt)){const s=e;return s.method_0(s.self)}else if(co(zo(t,mu(t,un)),xt)){const s=e;return zo(s.method_0(s.self),mu(t,un))}const n=e;let o=G$(n.method_0(n.self),t);if(lu(o.lo,t)){const s=Jx(Yx(t),t);for(;lu(o.lo,s);){const i=e;o=G$(i.method_0(i.self),t);continue}}return o.hi}function c3(e,t){if(t===0){const n=e;return Z$(n.method_0(n.self))}return Z$(a3(e,pu(t)))}function l3(e,t){if(t===0){const n=e;return af(os(n.method_0(n.self),33))}else return c3(e,t)}function u3(e){const t=e;return qa(os(Rr(t.method_0(t.self),11),11))/qa(Rr(un,53))}function zr(e){const t=Lt(e),n=t-1|0,o=(Math.imul(t,13)|0)/16|0;return{entries:lt(t,void 0),size:0,capacity:t,capacity_mask:n,grow_at:o,head:void 0,tail:-1}}function _3(e,t,n){const o=e.tail;if(o===-1)e.head=n;else{const i=e.entries;S(i,o);const r=i[o];let a;r===void 0?a=ne():a=r,a.next=n}e.tail=t;const s=e.entries;S(s,t),s[t]=n,e.size=e.size+1|0}function R$(e,t,n){const o=e.entries;S(o,n),o[n]=t;const s=t.next;if(s===void 0){e.tail=n;return}else{const r=s;r.prev=n;return}}function $3(e,t,n){let o=n.psl+1|0,s=t+1&e.capacity_mask,i=n;for(;;){const r=o,a=s,c=i,l=e.entries;S(l,a);const u=l[a];if(u===void 0){c.psl=r,R$(e,c,a);break}else{const $=u;if(r>$.psl){c.psl=r,R$(e,c,a),o=$.psl+1|0,s=a+1&e.capacity_mask,i=$;continue}else{o=r+1|0,s=a+1&e.capacity_mask;continue}}}}function nf(e,t,n){e.size>=e.grow_at&&d3(e);let o,s=0,i=n&e.capacity_mask;for(;;){const _=s,$=i,d=e.entries;S(d,$);const p=d[$];if(p===void 0){o={_0:$,_1:_};break}else{const g=p;let m;if(g.hash===n){const v=g.key;m=v._0===t._0&&v._1===t._1}else m=!1;if(m)return;if(_>g.psl){$3(e,$,g),o={_0:$,_1:_};break}s=_+1|0,i=$+1&e.capacity_mask;continue}}const r=o._0,a=o._1,u={prev:e.tail,next:void 0,psl:a,hash:n,key:t};_3(e,r,u)}function d3(e){const t=e.head,n=e.capacity<<1;e.entries=lt(n,void 0),e.capacity=n,e.capacity_mask=n-1|0;const o=e.capacity;e.grow_at=(Math.imul(o,13)|0)/16|0,e.size=0,e.head=void 0,e.tail=-1;let s=t;for(;;){const i=s;if(i===void 0)return;{const a=i,c=a.next,l=a.key,u=a.hash;nf(e,l,u),s=c;continue}}}function as(e,t){nf(e,t,ti(t))}function sf(e){const t=e.end-e.start|0;let n=Lt(t);t>((Math.imul(n,13)|0)/16|0)&&(n=Math.imul(n,2)|0);const s=zr(n),i=e.end-e.start|0;let r=0;for(;;){const a=r;if(a<i){const c=e.buf[e.start+a|0];as(s,c),r=a+1|0;continue}else break}return s}function fs(e,t){const n=ti(t);let o=0,s=n&e.capacity_mask;for(;;){const i=o,r=s,a=e.entries;S(a,r);const c=a[r];if(c===void 0)return!1;{const u=c;let _;if(u.hash===n){const $=u.key;_=$._0===t._0&&$._1===t._1}else _=!1;if(_)return!0;if(i>u.psl)return!1;o=i+1|0,s=r+1&e.capacity_mask;continue}}}function on(e){cx(e.entries,void 0,0),e.size=0,e.head=void 0,e.tail=-1}function rn(e){const t={val:e.head};return()=>{const o=t.val;if(o!==void 0){const i=o,r=i.key,a=i.next;return t.val=a,r}}}function p3(e,t,n,o,s){if(e===n&&t<o){let i=0;for(;;){const r=i;if(r<s){const a=t+r|0,c=o+r|0;S(n,c),S(e,a),e[a]=n[c],i=r+1|0;continue}else return}}else{let i=s-1|0;for(;;){const r=i;if(r>=0){const a=t+r|0,c=o+r|0;S(n,c),S(e,a),e[a]=n[c],i=r-1|0;continue}else return}}}function m3(e,t,n,o,s){if(e===n&&t<o){let i=0;for(;;){const r=i;if(r<s){const a=t+r|0,c=o+r|0;S(n,c),S(e,a),e[a]=n[c],i=r+1|0;continue}else return}}else{let i=s-1|0;for(;;){const r=i;if(r>=0){const a=t+r|0,c=o+r|0;S(n,c),S(e,a),e[a]=n[c],i=r-1|0;continue}else return}}}function ei(e){return{val:""}}function ut(e,t){const n=e;n.val=`${n.val}${String.fromCodePoint(t)}`}function f3(e,t){return(((Math.imul(e-55296|0,1024)|0)+t|0)-56320|0)+65536|0}function ge(e,t){const n=e.charCodeAt(t);if(55296<=n&&n<=56319){const o=t+1|0,s=e.charCodeAt(o);return f3(n,s)}else return n}function h3(e,t){return!j3(e,t)}function g3(e,t){const n=e.length;return t>=0&&t<n?(S(e,t),e[t]):ne()}function wt(e,t){const n=e.length;return t>=0&&t<n?(S(e,t),e[t]):ne()}function vt(e,t){const n=e.length;return t>=0&&t<n?(S(e,t),e[t]):ne()}function Do(e,t){const n=e.length;return t>=0&&t<n?(S(e,t),e[t]):ne()}function b3(e,t){const n=e.length;return t<n?(S(e,t),e[t]):ne()}function y3(e,t){const n=e.length;return t>=0&&t<n?(S(e,t),e[t]):ne()}function w3(e,t){const n=e.length;return t>=0&&t<n?(S(e,t),e[t]):ne()}function v3(e,t){const n=e.length;return t>=0&&t<n?(S(e,t),e[t]):ne()}function S3(e,t){const n=e.length;return t<n?(S(e,t),e[t]):ne()}function Qs(e,t){const n=e.length;return t>=0&&t<n?(S(e,t),e[t]):ne()}function mt(e,t){const n=e;n.val=`${n.val}${t}`}function yn(e){const t=e._0,n=e._1,o=[Oe(t),Oe(n)];return new In(o)}function k3(e){const t=e._0,n=e._1,o=[Gc(t),yn(n)];return new In(o)}function M3(e){const t=e._0,n=e._1,o=[Gc(t),Oe(n)];return new In(o)}function C3(e,t){eP(t,e)}function x3(e,t){cP(t,e)}function P3(e,t){L3(t,e)}function cu(e,t){tP(t,e)}function L3(e,t){const n=e._0,o=e._1;cu(t,n),cu(t,o)}function Cc(e,t){return Ec(e,t)<0}function lu(e,t){return Ac(e,t)<0}function of(e,t){return Ec(e,t)>0}function Ba(e,t){return Ac(e,t)>0}function Er(e,t){return Ec(e,t)<=0}function I3(e,t){return Ac(e,t)<=0}function uu(e,t){return Ec(e,t)>=0}function T3(e,t){return Ac(e,t)>=0}function E3(e){let t=e.acc;return t=t^(t>>>15|0),t=Math.imul(t,-2048144777)|0,t=t^(t>>>13|0),t=Math.imul(t,-1028477379)|0,t=t^(t>>>16|0),t}function xc(e){return E3(e)}function A3(e){return{acc:(e>>>0)+374761393|0}}function Pc(e){let t;return t=xM,A3(t)}function _s(e){const t=Pc();return C3(t,e),xc(t)}function rf(e){const t=Pc();return x3(t,e),xc(t)}function ti(e){const t=Pc();return P3(t,e),xc(t)}function Es(e){const t=Pc();return cu(t,e),xc(t)}function G3(e){const t=ei();return BP(e,{self:t,method_0:mt,method_1:Vr,method_2:ut}),t.val}function R3(e){const t=ei();return aP(e,{self:t,method_0:mt,method_1:Vr,method_2:ut}),t.val}function Lc(e){const t=ei(),n={self:t,method_0:mt,method_1:Vr,method_2:ut};return e?n.method_0(n.self,"true"):n.method_0(n.self,"false"),t.val}function O3(e){return{hi:e>>31&-1,lo:e|0}}function Dn(e){return O3(e)}function Ho(e){return e.lo}function D3(e,t){return J1(e,t)}function Vn(e){return D3(e,10)}function af(e){return e.lo}function cf(e,t,n){let o;return n===void 0?o=e.end-e.start|0:o=n,t>=0&&t<=o&&o<=(e.end-e.start|0)?{str:e.str,start:e.start+t|0,end:e.start+o|0}:AM()}function O$(e){return e<10?(e+48|0)&255:(((e+97|0)&255)-10|0)&255}function N3(e){const t=ei();return ut(t,O$((e/16|0)&255)),ut(t,O$((e%16|0)&255)),t.val}function ua(e){return e.str.substring(e.start,e.end)}function j3(e,t){const n=e.end-e.start|0;if(n===(t.end-t.start|0)){if(e.str===t.str&&e.start===t.start)return!0;let o=0;for(;;){const s=o;if(s<n){const i=e.str,r=e.start+s|0,a=i.charCodeAt(r),c=t.str,l=t.start+s|0;if(a!==c.charCodeAt(l))return!1;o=s+1|0;continue}else break}return!0}else return!1}function H3(e,t,n){const o=e.length;let s;return n===void 0?s=o:s=n,t>=0&&t<=s&&s<=o?e.substring(t,s):ne()}function Vr(e,t,n,o){const s=e;s.val=`${s.val}${H3(t,n,n+o|0)}`}function F3(e,t){q6(t,{self:e,method_0:mt,method_1:Vr,method_2:ut})}function U3(e){return n=>{const o=e.length;let s=0;for(;;){const i=s;if(i<o){const r=e[i];if(n(r)!==1)return 0;s=i+1|0;continue}else return 1}}}function lf(e){return e.$tag===0?ne():e._0}function qi(e){return e.$tag===0?ne():e._0}function Lt(e){return e>=0?e<=1?1:e>1073741824?1073741824:(2147483647>>(Math.clz32(e-1|0)-1|0))+1|0:ne()}function uf(e){const t=Lt(e),n=t-1|0,o=(Math.imul(t,13)|0)/16|0;return{entries:lt(t,void 0),size:0,capacity:t,capacity_mask:n,grow_at:o,head:void 0,tail:-1}}function B3(e){const t=Lt(e),n=t-1|0,o=(Math.imul(t,13)|0)/16|0;return{entries:lt(t,void 0),size:0,capacity:t,capacity_mask:n,grow_at:o,head:void 0,tail:-1}}function z3(e){const t=Lt(e),n=t-1|0,o=(Math.imul(t,13)|0)/16|0;return{entries:lt(t,void 0),size:0,capacity:t,capacity_mask:n,grow_at:o,head:void 0,tail:-1}}function V3(e){const t=Lt(e),n=t-1|0,o=(Math.imul(t,13)|0)/16|0;return{entries:lt(t,void 0),size:0,capacity:t,capacity_mask:n,grow_at:o,head:void 0,tail:-1}}function q3(e){const t=Lt(e),n=t-1|0,o=(Math.imul(t,13)|0)/16|0;return{entries:lt(t,void 0),size:0,capacity:t,capacity_mask:n,grow_at:o,head:void 0,tail:-1}}function W3(e){const t=Lt(e),n=t-1|0,o=(Math.imul(t,13)|0)/16|0;return{entries:lt(t,void 0),size:0,capacity:t,capacity_mask:n,grow_at:o,head:void 0,tail:-1}}function K3(e){const t=Lt(e),n=t-1|0,o=(Math.imul(t,13)|0)/16|0;return{entries:lt(t,void 0),size:0,capacity:t,capacity_mask:n,grow_at:o,head:void 0,tail:-1}}function J3(e){const t=Lt(e),n=t-1|0,o=(Math.imul(t,13)|0)/16|0;return{entries:lt(t,void 0),size:0,capacity:t,capacity_mask:n,grow_at:o,head:void 0,tail:-1}}function X3(e){const t=Lt(e),n=t-1|0,o=(Math.imul(t,13)|0)/16|0;return{entries:lt(t,void 0),size:0,capacity:t,capacity_mask:n,grow_at:o,head:void 0,tail:-1}}function Y3(e){const t=Lt(e),n=t-1|0,o=(Math.imul(t,13)|0)/16|0;return{entries:lt(t,void 0),size:0,capacity:t,capacity_mask:n,grow_at:o,head:void 0,tail:-1}}function Z3(e){const t=Lt(e),n=t-1|0,o=(Math.imul(t,13)|0)/16|0;return{entries:lt(t,void 0),size:0,capacity:t,capacity_mask:n,grow_at:o,head:void 0,tail:-1}}function Q3(e,t,n){const o=e.tail;if(o===-1)e.head=n;else{const i=e.entries;S(i,o);const r=i[o];let a;r===void 0?a=ne():a=r,a.next=n}e.tail=t;const s=e.entries;S(s,t),s[t]=n,e.size=e.size+1|0}function eC(e,t,n){const o=e.tail;if(o===-1)e.head=n;else{const i=e.entries;S(i,o);const r=i[o];let a;r===void 0?a=ne():a=r,a.next=n}e.tail=t;const s=e.entries;S(s,t),s[t]=n,e.size=e.size+1|0}function tC(e,t,n){const o=e.tail;if(o===-1)e.head=n;else{const i=e.entries;S(i,o);const r=i[o];let a;r===void 0?a=ne():a=r,a.next=n}e.tail=t;const s=e.entries;S(s,t),s[t]=n,e.size=e.size+1|0}function nC(e,t,n){const o=e.tail;if(o===-1)e.head=n;else{const i=e.entries;S(i,o);const r=i[o];let a;r===void 0?a=ne():a=r,a.next=n}e.tail=t;const s=e.entries;S(s,t),s[t]=n,e.size=e.size+1|0}function sC(e,t,n){const o=e.tail;if(o===-1)e.head=n;else{const i=e.entries;S(i,o);const r=i[o];let a;r===void 0?a=ne():a=r,a.next=n}e.tail=t;const s=e.entries;S(s,t),s[t]=n,e.size=e.size+1|0}function oC(e,t,n){const o=e.tail;if(o===-1)e.head=n;else{const i=e.entries;S(i,o);const r=i[o];let a;r===void 0?a=ne():a=r,a.next=n}e.tail=t;const s=e.entries;S(s,t),s[t]=n,e.size=e.size+1|0}function iC(e,t,n){const o=e.tail;if(o===-1)e.head=n;else{const i=e.entries;S(i,o);const r=i[o];let a;r===void 0?a=ne():a=r,a.next=n}e.tail=t;const s=e.entries;S(s,t),s[t]=n,e.size=e.size+1|0}function rC(e,t,n){const o=e.tail;if(o===-1)e.head=n;else{const i=e.entries;S(i,o);const r=i[o];let a;r===void 0?a=ne():a=r,a.next=n}e.tail=t;const s=e.entries;S(s,t),s[t]=n,e.size=e.size+1|0}function aC(e,t,n){const o=e.tail;if(o===-1)e.head=n;else{const i=e.entries;S(i,o);const r=i[o];let a;r===void 0?a=ne():a=r,a.next=n}e.tail=t;const s=e.entries;S(s,t),s[t]=n,e.size=e.size+1|0}function cC(e,t,n){const o=e.tail;if(o===-1)e.head=n;else{const i=e.entries;S(i,o);const r=i[o];let a;r===void 0?a=ne():a=r,a.next=n}e.tail=t;const s=e.entries;S(s,t),s[t]=n,e.size=e.size+1|0}function lC(e,t,n){const o=e.tail;if(o===-1)e.head=n;else{const i=e.entries;S(i,o);const r=i[o];let a;r===void 0?a=ne():a=r,a.next=n}e.tail=t;const s=e.entries;S(s,t),s[t]=n,e.size=e.size+1|0}function D$(e,t,n){const o=e.entries;S(o,n),o[n]=t;const s=t.next;if(s===void 0){e.tail=n;return}else{const r=s;r.prev=n;return}}function N$(e,t,n){const o=e.entries;S(o,n),o[n]=t;const s=t.next;if(s===void 0){e.tail=n;return}else{const r=s;r.prev=n;return}}function _u(e,t,n){const o=e.entries;S(o,n),o[n]=t;const s=t.next;if(s===void 0){e.tail=n;return}else{const r=s;r.prev=n;return}}function $u(e,t,n){const o=e.entries;S(o,n),o[n]=t;const s=t.next;if(s===void 0){e.tail=n;return}else{const r=s;r.prev=n;return}}function du(e,t,n){const o=e.entries;S(o,n),o[n]=t;const s=t.next;if(s===void 0){e.tail=n;return}else{const r=s;r.prev=n;return}}function j$(e,t,n){const o=e.entries;S(o,n),o[n]=t;const s=t.next;if(s===void 0){e.tail=n;return}else{const r=s;r.prev=n;return}}function H$(e,t,n){const o=e.entries;S(o,n),o[n]=t;const s=t.next;if(s===void 0){e.tail=n;return}else{const r=s;r.prev=n;return}}function F$(e,t,n){const o=e.entries;S(o,n),o[n]=t;const s=t.next;if(s===void 0){e.tail=n;return}else{const r=s;r.prev=n;return}}function U$(e,t,n){const o=e.entries;S(o,n),o[n]=t;const s=t.next;if(s===void 0){e.tail=n;return}else{const r=s;r.prev=n;return}}function B$(e,t,n){const o=e.entries;S(o,n),o[n]=t;const s=t.next;if(s===void 0){e.tail=n;return}else{const r=s;r.prev=n;return}}function z$(e,t,n){const o=e.entries;S(o,n),o[n]=t;const s=t.next;if(s===void 0){e.tail=n;return}else{const r=s;r.prev=n;return}}function uC(e,t,n){let o=n.psl+1|0,s=t+1&e.capacity_mask,i=n;for(;;){const r=o,a=s,c=i,l=e.entries;S(l,a);const u=l[a];if(u===void 0){c.psl=r,D$(e,c,a);break}else{const $=u;if(r>$.psl){c.psl=r,D$(e,c,a),o=$.psl+1|0,s=a+1&e.capacity_mask,i=$;continue}else{o=r+1|0,s=a+1&e.capacity_mask;continue}}}}function _C(e,t,n){let o=n.psl+1|0,s=t+1&e.capacity_mask,i=n;for(;;){const r=o,a=s,c=i,l=e.entries;S(l,a);const u=l[a];if(u===void 0){c.psl=r,N$(e,c,a);break}else{const $=u;if(r>$.psl){c.psl=r,N$(e,c,a),o=$.psl+1|0,s=a+1&e.capacity_mask,i=$;continue}else{o=r+1|0,s=a+1&e.capacity_mask;continue}}}}function $C(e,t,n){let o=n.psl+1|0,s=t+1&e.capacity_mask,i=n;for(;;){const r=o,a=s,c=i,l=e.entries;S(l,a);const u=l[a];if(u===void 0){c.psl=r,du(e,c,a);break}else{const $=u;if(r>$.psl){c.psl=r,du(e,c,a),o=$.psl+1|0,s=a+1&e.capacity_mask,i=$;continue}else{o=r+1|0,s=a+1&e.capacity_mask;continue}}}}function dC(e,t,n){let o=n.psl+1|0,s=t+1&e.capacity_mask,i=n;for(;;){const r=o,a=s,c=i,l=e.entries;S(l,a);const u=l[a];if(u===void 0){c.psl=r,_u(e,c,a);break}else{const $=u;if(r>$.psl){c.psl=r,_u(e,c,a),o=$.psl+1|0,s=a+1&e.capacity_mask,i=$;continue}else{o=r+1|0,s=a+1&e.capacity_mask;continue}}}}function pC(e,t,n){let o=n.psl+1|0,s=t+1&e.capacity_mask,i=n;for(;;){const r=o,a=s,c=i,l=e.entries;S(l,a);const u=l[a];if(u===void 0){c.psl=r,$u(e,c,a);break}else{const $=u;if(r>$.psl){c.psl=r,$u(e,c,a),o=$.psl+1|0,s=a+1&e.capacity_mask,i=$;continue}else{o=r+1|0,s=a+1&e.capacity_mask;continue}}}}function mC(e,t,n){let o=n.psl+1|0,s=t+1&e.capacity_mask,i=n;for(;;){const r=o,a=s,c=i,l=e.entries;S(l,a);const u=l[a];if(u===void 0){c.psl=r,j$(e,c,a);break}else{const $=u;if(r>$.psl){c.psl=r,j$(e,c,a),o=$.psl+1|0,s=a+1&e.capacity_mask,i=$;continue}else{o=r+1|0,s=a+1&e.capacity_mask;continue}}}}function fC(e,t,n){let o=n.psl+1|0,s=t+1&e.capacity_mask,i=n;for(;;){const r=o,a=s,c=i,l=e.entries;S(l,a);const u=l[a];if(u===void 0){c.psl=r,H$(e,c,a);break}else{const $=u;if(r>$.psl){c.psl=r,H$(e,c,a),o=$.psl+1|0,s=a+1&e.capacity_mask,i=$;continue}else{o=r+1|0,s=a+1&e.capacity_mask;continue}}}}function hC(e,t,n){let o=n.psl+1|0,s=t+1&e.capacity_mask,i=n;for(;;){const r=o,a=s,c=i,l=e.entries;S(l,a);const u=l[a];if(u===void 0){c.psl=r,F$(e,c,a);break}else{const $=u;if(r>$.psl){c.psl=r,F$(e,c,a),o=$.psl+1|0,s=a+1&e.capacity_mask,i=$;continue}else{o=r+1|0,s=a+1&e.capacity_mask;continue}}}}function gC(e,t,n){let o=n.psl+1|0,s=t+1&e.capacity_mask,i=n;for(;;){const r=o,a=s,c=i,l=e.entries;S(l,a);const u=l[a];if(u===void 0){c.psl=r,U$(e,c,a);break}else{const $=u;if(r>$.psl){c.psl=r,U$(e,c,a),o=$.psl+1|0,s=a+1&e.capacity_mask,i=$;continue}else{o=r+1|0,s=a+1&e.capacity_mask;continue}}}}function bC(e,t,n){let o=n.psl+1|0,s=t+1&e.capacity_mask,i=n;for(;;){const r=o,a=s,c=i,l=e.entries;S(l,a);const u=l[a];if(u===void 0){c.psl=r,B$(e,c,a);break}else{const $=u;if(r>$.psl){c.psl=r,B$(e,c,a),o=$.psl+1|0,s=a+1&e.capacity_mask,i=$;continue}else{o=r+1|0,s=a+1&e.capacity_mask;continue}}}}function yC(e,t,n){let o=n.psl+1|0,s=t+1&e.capacity_mask,i=n;for(;;){const r=o,a=s,c=i,l=e.entries;S(l,a);const u=l[a];if(u===void 0){c.psl=r,z$(e,c,a);break}else{const $=u;if(r>$.psl){c.psl=r,z$(e,c,a),o=$.psl+1|0,s=a+1&e.capacity_mask,i=$;continue}else{o=r+1|0,s=a+1&e.capacity_mask;continue}}}}function _f(e,t,n,o){e.size>=e.grow_at&&wC(e);let s,i=0,r=o&e.capacity_mask;for(;;){const $=i,d=r,p=e.entries;S(p,d);const b=p[d];if(b===void 0){s={_0:d,_1:$};break}else{const m=b;if(m.hash===o&&m.key===t){m.value=n;return}if($>m.psl){uC(e,d,m),s={_0:d,_1:$};break}i=$+1|0,r=d+1&e.capacity_mask;continue}}const a=s._0,c=s._1,_={prev:e.tail,next:void 0,psl:c,hash:o,key:t,value:n};Q3(e,a,_)}function $f(e,t,n,o){e.size>=e.grow_at&&vC(e);let s,i=0,r=o&e.capacity_mask;for(;;){const $=i,d=r,p=e.entries;S(p,d);const b=p[d];if(b===void 0){s={_0:d,_1:$};break}else{const m=b;if(m.hash===o&&Bf(m.key,t)){m.value=n;return}if($>m.psl){_C(e,d,m),s={_0:d,_1:$};break}i=$+1|0,r=d+1&e.capacity_mask;continue}}const a=s._0,c=s._1,_={prev:e.tail,next:void 0,psl:c,hash:o,key:t,value:n};eC(e,a,_)}function df(e,t,n,o){e.size>=e.grow_at&&SC(e);let s,i=0,r=o&e.capacity_mask;for(;;){const $=i,d=r,p=e.entries;S(p,d);const b=p[d];if(b===void 0){s={_0:d,_1:$};break}else{const m=b;if(m.hash===o&&m.key===t){m.value=n;return}if($>m.psl){$C(e,d,m),s={_0:d,_1:$};break}i=$+1|0,r=d+1&e.capacity_mask;continue}}const a=s._0,c=s._1,_={prev:e.tail,next:void 0,psl:c,hash:o,key:t,value:n};tC(e,a,_)}function pf(e,t,n,o){e.size>=e.grow_at&&kC(e);let s,i=0,r=o&e.capacity_mask;for(;;){const $=i,d=r,p=e.entries;S(p,d);const b=p[d];if(b===void 0){s={_0:d,_1:$};break}else{const m=b;if(m.hash===o&&m.key===t){m.value=n;return}if($>m.psl){dC(e,d,m),s={_0:d,_1:$};break}i=$+1|0,r=d+1&e.capacity_mask;continue}}const a=s._0,c=s._1,_={prev:e.tail,next:void 0,psl:c,hash:o,key:t,value:n};nC(e,a,_)}function mf(e,t,n,o){e.size>=e.grow_at&&MC(e);let s,i=0,r=o&e.capacity_mask;for(;;){const $=i,d=r,p=e.entries;S(p,d);const b=p[d];if(b===void 0){s={_0:d,_1:$};break}else{const m=b;if(m.hash===o&&m.key===t){m.value=n;return}if($>m.psl){pC(e,d,m),s={_0:d,_1:$};break}i=$+1|0,r=d+1&e.capacity_mask;continue}}const a=s._0,c=s._1,_={prev:e.tail,next:void 0,psl:c,hash:o,key:t,value:n};sC(e,a,_)}function ff(e,t,n,o){e.size>=e.grow_at&&CC(e);let s,i=0,r=o&e.capacity_mask;for(;;){const $=i,d=r,p=e.entries;S(p,d);const b=p[d];if(b===void 0){s={_0:d,_1:$};break}else{const m=b;if(m.hash===o&&m.key===t){m.value=n;return}if($>m.psl){mC(e,d,m),s={_0:d,_1:$};break}i=$+1|0,r=d+1&e.capacity_mask;continue}}const a=s._0,c=s._1,_={prev:e.tail,next:void 0,psl:c,hash:o,key:t,value:n};oC(e,a,_)}function hf(e,t,n,o){e.size>=e.grow_at&&xC(e);let s,i=0,r=o&e.capacity_mask;for(;;){const $=i,d=r,p=e.entries;S(p,d);const b=p[d];if(b===void 0){s={_0:d,_1:$};break}else{const m=b;if(m.hash===o&&m.key===t){m.value=n;return}if($>m.psl){fC(e,d,m),s={_0:d,_1:$};break}i=$+1|0,r=d+1&e.capacity_mask;continue}}const a=s._0,c=s._1,_={prev:e.tail,next:void 0,psl:c,hash:o,key:t,value:n};iC(e,a,_)}function gf(e,t,n,o){e.size>=e.grow_at&&PC(e);let s,i=0,r=o&e.capacity_mask;for(;;){const $=i,d=r,p=e.entries;S(p,d);const b=p[d];if(b===void 0){s={_0:d,_1:$};break}else{const m=b;let v;if(m.hash===o){const y=m.key;v=y._0===t._0&&y._1===t._1}else v=!1;if(v){m.value=n;return}if($>m.psl){hC(e,d,m),s={_0:d,_1:$};break}i=$+1|0,r=d+1&e.capacity_mask;continue}}const a=s._0,c=s._1,_={prev:e.tail,next:void 0,psl:c,hash:o,key:t,value:n};rC(e,a,_)}function bf(e,t,n,o){e.size>=e.grow_at&&LC(e);let s,i=0,r=o&e.capacity_mask;for(;;){const $=i,d=r,p=e.entries;S(p,d);const b=p[d];if(b===void 0){s={_0:d,_1:$};break}else{const m=b;let v;if(m.hash===o){const y=m.key;v=y._0===t._0&&y._1===t._1}else v=!1;if(v){m.value=n;return}if($>m.psl){gC(e,d,m),s={_0:d,_1:$};break}i=$+1|0,r=d+1&e.capacity_mask;continue}}const a=s._0,c=s._1,_={prev:e.tail,next:void 0,psl:c,hash:o,key:t,value:n};aC(e,a,_)}function yf(e,t,n,o){e.size>=e.grow_at&&IC(e);let s,i=0,r=o&e.capacity_mask;for(;;){const $=i,d=r,p=e.entries;S(p,d);const b=p[d];if(b===void 0){s={_0:d,_1:$};break}else{const m=b;if(m.hash===o&&m.key===t){m.value=n;return}if($>m.psl){bC(e,d,m),s={_0:d,_1:$};break}i=$+1|0,r=d+1&e.capacity_mask;continue}}const a=s._0,c=s._1,_={prev:e.tail,next:void 0,psl:c,hash:o,key:t,value:n};cC(e,a,_)}function wf(e,t,n,o){e.size>=e.grow_at&&TC(e);let s,i=0,r=o&e.capacity_mask;for(;;){const $=i,d=r,p=e.entries;S(p,d);const b=p[d];if(b===void 0){s={_0:d,_1:$};break}else{const m=b;let v;if(m.hash===o){const y=m.key;v=y._0===t._0&&y._1===t._1}else v=!1;if(v){m.value=n;return}if($>m.psl){yC(e,d,m),s={_0:d,_1:$};break}i=$+1|0,r=d+1&e.capacity_mask;continue}}const a=s._0,c=s._1,_={prev:e.tail,next:void 0,psl:c,hash:o,key:t,value:n};lC(e,a,_)}function wC(e){const t=e.head,n=e.capacity<<1;e.entries=lt(n,void 0),e.capacity=n,e.capacity_mask=n-1|0;const o=e.capacity;e.grow_at=(Math.imul(o,13)|0)/16|0,e.size=0,e.head=void 0,e.tail=-1;let s=t;for(;;){const i=s;if(i===void 0)return;{const a=i,c=a.next,l=a.key,u=a.value,_=a.hash;_f(e,l,u,_),s=c;continue}}}function vC(e){const t=e.head,n=e.capacity<<1;e.entries=lt(n,void 0),e.capacity=n,e.capacity_mask=n-1|0;const o=e.capacity;e.grow_at=(Math.imul(o,13)|0)/16|0,e.size=0,e.head=void 0,e.tail=-1;let s=t;for(;;){const i=s;if(i===void 0)return;{const a=i,c=a.next,l=a.key,u=a.value,_=a.hash;$f(e,l,u,_),s=c;continue}}}function SC(e){const t=e.head,n=e.capacity<<1;e.entries=lt(n,void 0),e.capacity=n,e.capacity_mask=n-1|0;const o=e.capacity;e.grow_at=(Math.imul(o,13)|0)/16|0,e.size=0,e.head=void 0,e.tail=-1;let s=t;for(;;){const i=s;if(i===void 0)return;{const a=i,c=a.next,l=a.key,u=a.value,_=a.hash;df(e,l,u,_),s=c;continue}}}function kC(e){const t=e.head,n=e.capacity<<1;e.entries=lt(n,void 0),e.capacity=n,e.capacity_mask=n-1|0;const o=e.capacity;e.grow_at=(Math.imul(o,13)|0)/16|0,e.size=0,e.head=void 0,e.tail=-1;let s=t;for(;;){const i=s;if(i===void 0)return;{const a=i,c=a.next,l=a.key,u=a.value,_=a.hash;pf(e,l,u,_),s=c;continue}}}function MC(e){const t=e.head,n=e.capacity<<1;e.entries=lt(n,void 0),e.capacity=n,e.capacity_mask=n-1|0;const o=e.capacity;e.grow_at=(Math.imul(o,13)|0)/16|0,e.size=0,e.head=void 0,e.tail=-1;let s=t;for(;;){const i=s;if(i===void 0)return;{const a=i,c=a.next,l=a.key,u=a.value,_=a.hash;mf(e,l,u,_),s=c;continue}}}function CC(e){const t=e.head,n=e.capacity<<1;e.entries=lt(n,void 0),e.capacity=n,e.capacity_mask=n-1|0;const o=e.capacity;e.grow_at=(Math.imul(o,13)|0)/16|0,e.size=0,e.head=void 0,e.tail=-1;let s=t;for(;;){const i=s;if(i===void 0)return;{const a=i,c=a.next,l=a.key,u=a.value,_=a.hash;ff(e,l,u,_),s=c;continue}}}function xC(e){const t=e.head,n=e.capacity<<1;e.entries=lt(n,void 0),e.capacity=n,e.capacity_mask=n-1|0;const o=e.capacity;e.grow_at=(Math.imul(o,13)|0)/16|0,e.size=0,e.head=void 0,e.tail=-1;let s=t;for(;;){const i=s;if(i===void 0)return;{const a=i,c=a.next,l=a.key,u=a.value,_=a.hash;hf(e,l,u,_),s=c;continue}}}function PC(e){const t=e.head,n=e.capacity<<1;e.entries=lt(n,void 0),e.capacity=n,e.capacity_mask=n-1|0;const o=e.capacity;e.grow_at=(Math.imul(o,13)|0)/16|0,e.size=0,e.head=void 0,e.tail=-1;let s=t;for(;;){const i=s;if(i===void 0)return;{const a=i,c=a.next,l=a.key,u=a.value,_=a.hash;gf(e,l,u,_),s=c;continue}}}function LC(e){const t=e.head,n=e.capacity<<1;e.entries=lt(n,void 0),e.capacity=n,e.capacity_mask=n-1|0;const o=e.capacity;e.grow_at=(Math.imul(o,13)|0)/16|0,e.size=0,e.head=void 0,e.tail=-1;let s=t;for(;;){const i=s;if(i===void 0)return;{const a=i,c=a.next,l=a.key,u=a.value,_=a.hash;bf(e,l,u,_),s=c;continue}}}function IC(e){const t=e.head,n=e.capacity<<1;e.entries=lt(n,void 0),e.capacity=n,e.capacity_mask=n-1|0;const o=e.capacity;e.grow_at=(Math.imul(o,13)|0)/16|0,e.size=0,e.head=void 0,e.tail=-1;let s=t;for(;;){const i=s;if(i===void 0)return;{const a=i,c=a.next,l=a.key,u=a.value,_=a.hash;yf(e,l,u,_),s=c;continue}}}function TC(e){const t=e.head,n=e.capacity<<1;e.entries=lt(n,void 0),e.capacity=n,e.capacity_mask=n-1|0;const o=e.capacity;e.grow_at=(Math.imul(o,13)|0)/16|0,e.size=0,e.head=void 0,e.tail=-1;let s=t;for(;;){const i=s;if(i===void 0)return;{const a=i,c=a.next,l=a.key,u=a.value,_=a.hash;wf(e,l,u,_),s=c;continue}}}function ce(e,t,n){_f(e,t,n,_s(t))}function n_(e,t,n){$f(e,t,n,rf(t))}function EC(e,t,n){df(e,t,n,Es(t))}function AC(e,t,n){pf(e,t,n,Es(t))}function GC(e,t,n){mf(e,t,n,Es(t))}function RC(e,t,n){ff(e,t,n,_s(t))}function OC(e,t,n){hf(e,t,n,_s(t))}function za(e,t,n){gf(e,t,n,ti(t))}function V$(e,t,n){bf(e,t,n,ti(t))}function DC(e,t,n){yf(e,t,n,_s(t))}function NC(e,t,n){wf(e,t,n,ti(t))}function Ce(e){const t=e.end-e.start|0;let n=Lt(t);t>((Math.imul(n,13)|0)/16|0)&&(n=Math.imul(n,2)|0);const s=uf(n),i=e.end-e.start|0;let r=0;for(;;){const a=r;if(a<i){const c=e.buf[e.start+a|0];ce(s,c._0,c._1),r=a+1|0;continue}else break}return s}function jC(e){const t=e.end-e.start|0;let n=Lt(t);return t>((Math.imul(n,13)|0)/16|0)&&(n=Math.imul(n,2)|0),z3(n)}function HC(e){const t=e.end-e.start|0;let n=Lt(t);return t>((Math.imul(n,13)|0)/16|0)&&(n=Math.imul(n,2)|0),V3(n)}function vf(e){const t=e.end-e.start|0;let n=Lt(t);t>((Math.imul(n,13)|0)/16|0)&&(n=Math.imul(n,2)|0);const s=q3(n),i=e.end-e.start|0;let r=0;for(;;){const a=r;if(a<i){const c=e.buf[e.start+a|0];n_(s,c._0,c._1),r=a+1|0;continue}else break}return s}function FC(e){const t=e.end-e.start|0;let n=Lt(t);return t>((Math.imul(n,13)|0)/16|0)&&(n=Math.imul(n,2)|0),W3(n)}function UC(e){const t=e.end-e.start|0;let n=Lt(t);return t>((Math.imul(n,13)|0)/16|0)&&(n=Math.imul(n,2)|0),K3(n)}function Sf(e){const t=e.end-e.start|0;let n=Lt(t);t>((Math.imul(n,13)|0)/16|0)&&(n=Math.imul(n,2)|0);const s=J3(n),i=e.end-e.start|0;let r=0;for(;;){const a=r;if(a<i){const c=e.buf[e.start+a|0];za(s,c._0,c._1),r=a+1|0;continue}else break}return s}function BC(e){const t=e.end-e.start|0;let n=Lt(t);return t>((Math.imul(n,13)|0)/16|0)&&(n=Math.imul(n,2)|0),X3(n)}function zC(e){const t=e.end-e.start|0;let n=Lt(t);return t>((Math.imul(n,13)|0)/16|0)&&(n=Math.imul(n,2)|0),Y3(n)}function VC(e){const t=e.end-e.start|0;let n=Lt(t);return t>((Math.imul(n,13)|0)/16|0)&&(n=Math.imul(n,2)|0),Z3(n)}function re(e,t){const n=_s(t);let o=0,s=n&e.capacity_mask;for(;;){const i=o,r=s,a=e.entries;S(a,r);const c=a[r];if(c===void 0)return;{const u=c;if(u.hash===n&&u.key===t)return u.value;if(i>u.psl)return;o=i+1|0,s=r+1&e.capacity_mask;continue}}}function kf(e,t){const n=rf(t);let o=0,s=n&e.capacity_mask;for(;;){const i=o,r=s,a=e.entries;S(a,r);const c=a[r];if(c===void 0)return;{const u=c;if(u.hash===n&&Bf(u.key,t))return u.value;if(i>u.psl)return;o=i+1|0,s=r+1&e.capacity_mask;continue}}}function qr(e,t){const n=Es(t);let o=0,s=n&e.capacity_mask;for(;;){const i=o,r=s,a=e.entries;S(a,r);const c=a[r];if(c===void 0)return;{const u=c;if(u.hash===n&&u.key===t)return u.value;if(i>u.psl)return;o=i+1|0,s=r+1&e.capacity_mask;continue}}}function qC(e,t){const n=_s(t);let o=0,s=n&e.capacity_mask;for(;;){const i=o,r=s,a=e.entries;S(a,r);const c=a[r];if(c===void 0)return;{const u=c;if(u.hash===n&&u.key===t)return u.value;if(i>u.psl)return;o=i+1|0,s=r+1&e.capacity_mask;continue}}}function WC(e,t){const n=_s(t);let o=0,s=n&e.capacity_mask;for(;;){const i=o,r=s,a=e.entries;S(a,r);const c=a[r];if(c===void 0)return;{const u=c;if(u.hash===n&&u.key===t)return u.value;if(i>u.psl)return;o=i+1|0,s=r+1&e.capacity_mask;continue}}}function KC(e,t){const n=Es(t);let o=0,s=n&e.capacity_mask;for(;;){const i=o,r=s,a=e.entries;S(a,r);const c=a[r];if(c===void 0)return;{const u=c;if(u.hash===n&&u.key===t)return u.value;if(i>u.psl)return;o=i+1|0,s=r+1&e.capacity_mask;continue}}}function JC(e,t){const n=Es(t);let o=0,s=n&e.capacity_mask;for(;;){const i=o,r=s,a=e.entries;S(a,r);const c=a[r];if(c===void 0)return;{const u=c;if(u.hash===n&&u.key===t)return u.value;if(i>u.psl)return;o=i+1|0,s=r+1&e.capacity_mask;continue}}}function XC(e,t){const n=ti(t);let o=0,s=n&e.capacity_mask;for(;;){const i=o,r=s,a=e.entries;S(a,r);const c=a[r];if(c===void 0)return;{const u=c;let _;if(u.hash===n){const $=u.key;_=$._0===t._0&&$._1===t._1}else _=!1;if(_)return u.value;if(i>u.psl)return;o=i+1|0,s=r+1&e.capacity_mask;continue}}}function Mf(e,t){const n=ti(t);let o=0,s=n&e.capacity_mask;for(;;){const i=o,r=s,a=e.entries;S(a,r);const c=a[r];if(c===void 0)return-1;{const u=c;let _;if(u.hash===n){const $=u.key;_=$._0===t._0&&$._1===t._1}else _=!1;if(_)return u.value;if(i>u.psl)return-1;o=i+1|0,s=r+1&e.capacity_mask;continue}}}function Va(e,t){const n=_s(t);let o=0,s=n&e.capacity_mask;for(;;){const i=o,r=s,a=e.entries;S(a,r);const c=a[r];if(c===void 0)ne();else{const u=c;if(u.hash===n&&u.key===t)return u.value;if(i<=u.psl){o=i+1|0,s=r+1&e.capacity_mask;continue}else ne()}}}function q$(e,t){const n=_s(t);let o=0,s=n&e.capacity_mask;for(;;){const i=o,r=s,a=e.entries;S(a,r);const c=a[r];if(c===void 0)ne();else{const u=c;if(u.hash===n&&u.key===t)return u.value;if(i<=u.psl){o=i+1|0,s=r+1&e.capacity_mask;continue}else ne()}}}function YC(e,t){const n=_s(t);let o=0,s=n&e.capacity_mask;for(;;){const i=o,r=s,a=e.entries;S(a,r);const c=a[r];if(c===void 0)ne();else{const u=c;if(u.hash===n&&u.key===t)return u.value;if(i<=u.psl){o=i+1|0,s=r+1&e.capacity_mask;continue}else ne()}}}function ZC(e,t){const n=_s(t);let o=0,s=n&e.capacity_mask;for(;;){const i=o,r=s,a=e.entries;S(a,r);const c=a[r];if(c===void 0)ne();else{const u=c;if(u.hash===n&&u.key===t)return u.value;if(i<=u.psl){o=i+1|0,s=r+1&e.capacity_mask;continue}else ne()}}}function QC(e,t){const n=t.prev;if(n===-1)e.head=t.next;else{const s=e.entries;S(s,n);const i=s[n];let r;i===void 0?r=ne():r=i;const a=r;a.next=t.next}const o=t.next;if(o===void 0){e.tail=t.prev;return}else{const i=o;i.prev=t.prev;return}}function ex(e,t){const n=t.prev;if(n===-1)e.head=t.next;else{const s=e.entries;S(s,n);const i=s[n];let r;i===void 0?r=ne():r=i;const a=r;a.next=t.next}const o=t.next;if(o===void 0){e.tail=t.prev;return}else{const i=o;i.prev=t.prev;return}}function tx(e,t){const n=t.prev;if(n===-1)e.head=t.next;else{const s=e.entries;S(s,n);const i=s[n];let r;i===void 0?r=ne():r=i;const a=r;a.next=t.next}const o=t.next;if(o===void 0){e.tail=t.prev;return}else{const i=o;i.prev=t.prev;return}}function nx(e,t){let n=t;for(;;){const o=n,s=o+1&e.capacity_mask;e:{const r=e.entries;S(r,s);const a=r[s];if(a===void 0)break e;{const l=a;if(l.psl===0)break e;l.psl=l.psl-1|0,_u(e,l,o),n=s;continue}}const i=e.entries;S(i,o),i[o]=void 0;return}}function sx(e,t){let n=t;for(;;){const o=n,s=o+1&e.capacity_mask;e:{const r=e.entries;S(r,s);const a=r[s];if(a===void 0)break e;{const l=a;if(l.psl===0)break e;l.psl=l.psl-1|0,$u(e,l,o),n=s;continue}}const i=e.entries;S(i,o),i[o]=void 0;return}}function ox(e,t){let n=t;for(;;){const o=n,s=o+1&e.capacity_mask;e:{const r=e.entries;S(r,s);const a=r[s];if(a===void 0)break e;{const l=a;if(l.psl===0)break e;l.psl=l.psl-1|0,du(e,l,o),n=s;continue}}const i=e.entries;S(i,o),i[o]=void 0;return}}function ix(e,t,n){let o=0,s=n&e.capacity_mask;for(;;){const i=o,r=s,a=e.entries;S(a,r);const c=a[r];if(c===void 0)break;{const u=c;if(u.hash===n&&u.key===t){QC(e,u),nx(e,r),e.size=e.size-1|0;break}if(i>u.psl)break;o=i+1|0,s=r+1&e.capacity_mask;continue}}}function rx(e,t,n){let o=0,s=n&e.capacity_mask;for(;;){const i=o,r=s,a=e.entries;S(a,r);const c=a[r];if(c===void 0)break;{const u=c;if(u.hash===n&&u.key===t){ex(e,u),sx(e,r),e.size=e.size-1|0;break}if(i>u.psl)break;o=i+1|0,s=r+1&e.capacity_mask;continue}}}function ax(e,t,n){let o=0,s=n&e.capacity_mask;for(;;){const i=o,r=s,a=e.entries;S(a,r);const c=a[r];if(c===void 0)break;{const u=c;if(u.hash===n&&u.key===t){tx(e,u),ox(e,r),e.size=e.size-1|0;break}if(i>u.psl)break;o=i+1|0,s=r+1&e.capacity_mask;continue}}}function Ic(e,t){ix(e,t,Es(t))}function Tc(e,t){rx(e,t,Es(t))}function Cf(e,t){ax(e,t,Es(t))}function cx(e,t,n,o){const s=e.length;if(s>0)if(n<s){let i;i=s-n|0,e.fill(t,n,n+i);return}else{ne();return}else return}function xf(e){const t={val:e.head};return()=>{const o=t.val;if(o!==void 0){const i=o,r=i.key,a=i.value,c=i.next;return t.val=c,{_0:r,_1:a}}}}function lx(e){const t={val:e.head};return()=>{const o=t.val;if(o!==void 0){const i=o,r=i.key,a=i.value,c=i.next;return t.val=c,{_0:r,_1:a}}}}function Pf(e){return n=>{let o=e.head;for(;;){const s=o;if(s===void 0)return 1;{const r=s,a=r.value,c=r.next;if(n(a)===1){o=c;continue}else return 0}}}}function s_(e){return n=>{let o=e.head;for(;;){const s=o;if(s===void 0)return 1;{const r=s,a=r.value,c=r.next;if(n(a)===1){o=c;continue}else return 0}}}}function o_(e){return n=>{let o=e.head;for(;;){const s=o;if(s===void 0)return 1;{const r=s,a=r.value,c=r.next;if(n(a)===1){o=c;continue}else return 0}}}}function ux(e){const t=FC({start:0,end:0});return e(n=>(RC(t,n._0,n._1),1)),t}function _x(e){const t=UC({start:0,end:0});return e(n=>(OC(t,n._0,n._1),1)),t}function $x(e){const t=zC({start:0,end:0});return e(n=>(DC(t,n._0,n._1),1)),t}function Lf(e){return e()}function an(e){return e()}function dx(e){return e()}function px(e){return e()}function xn(e){return e?Wp:Kp}function Oe(e){const t=e+0,n=void 0;return new Fr(t,n)}function mx(e){return{hi:0,lo:e}}function i_(e){return mx(e)}function pu(e){return i_(e)}function qa(e){return X1(e)}function Ar(e){return Y1(e)}function Pn(e){const t=e,n=void 0;return new Fr(t,n)}function fx(e){const t=new Array(e.length),n=e.length;let o=0;for(;;){const s=o;if(s<n){const i=e[s];t[s]=Oc(i),o=s+1|0;continue}else break}return new In(t)}function hx(e){const t=new Array(e.length),n=e.length;let o=0;for(;;){const s=o;if(s<n){const i=e[s];t[s]=fu(i),o=s+1|0;continue}else break}return new In(t)}function gx(e){const t=new Array(e.length),n=e.length;let o=0;for(;;){const s=o;if(s<n){const i=e[s];t[s]=i,o=s+1|0;continue}else break}return new In(t)}function bx(e){const t=new Array(e.length),n=e.length;let o=0;for(;;){const s=o;if(s<n){const i=e[s];t[s]=Qf(i),o=s+1|0;continue}else break}return new In(t)}function yx(e){const t=new Array(e.length),n=e.length;let o=0;for(;;){const s=o;if(s<n){const i=e[s];t[s]=k3(i),o=s+1|0;continue}else break}return new In(t)}function wx(e){const t=new Array(e.length),n=e.length;let o=0;for(;;){const s=o;if(s<n){const i=e[s];t[s]=M3(i),o=s+1|0;continue}else break}return new In(t)}function vx(e){if(e.length===0){const i=[];return new In(i)}const n=new Array(e.length),o=e.length;let s=0;for(;;){const i=s;if(i<o){const r=e[i];n[i]=eh(r),s=i+1|0;continue}else break}return new In(n)}function W$(e,t){bn(e,t)}function Sx(e,t){bn(e,t)}function kx(e,t){bn(e,t)}function kn(e,t){bn(e,t)}function Mx(e,t){bn(e,t)}function Cx(e,t){bn(e,t)}function vo(e,t){bn(e,t)}function xx(e,t){bn(e,t)}function Px(e,t){bn(e,t)}function Lx(e,t){bn(e,t)}function Ix(e,t){bn(e,t)}function Tx(e,t){bn(e,t)}function Sl(e,t){bn(e,t)}function Ex(e,t){bn(e,t)}function Ax(e,t){bn(e,t)}function Gx(){return e=>1}function K$(e){return t=>t(e)}function Rx(e,t){return n=>e(n)===1&&t(n)===1?1:0}function Ox(e){const t=[];return e(n=>(Sx(t,n),1)),t}function Dx(e){const t=[];return e(n=>(Ax(t,n),1)),t}function J$(e){return af(e)&255}function Wa(e){return Dn(e)}function Nx(e){return e.lo===0?{hi:~e.hi+1|0,lo:0}:{hi:~e.hi,lo:~e.lo+1|0}}function If(e,t,n){const o=e.hi,s=e.lo,i=s+n|0,r=i>>31,a=s>>31,c=n>>31,l=(a&c|~r&(a^c))&1;return{hi:(o+t|0)+l|0,lo:i}}function Tf(e,t){return If(e,t.hi,t.lo)}function Ef(e,t){return t.lo===0?{hi:e.hi-t.hi|0,lo:e.lo}:If(e,~t.hi,~t.lo+1|0)}function Af(e,t){const n=e.hi,o=e.lo,s=t.hi,i=t.lo,r=n,a=o,c=s,l=i,u=r>>>16|0,_=r&65535,$=a>>>16|0,d=a&65535,p=c>>>16|0,b=c&65535,g=l>>>16|0,m=l&65535,v=Math.imul(d,m)|0,y=v>>>16|0,w=v&65535,k=(y>>>0)+((Math.imul($,m)|0)>>>0)|0,L=k>>>16|0,G=((k&65535)>>>0)+((Math.imul(d,g)|0)>>>0)|0,I=(L>>>0)+((G>>>16|0)>>>0)|0,U=G&65535,R=(I>>>0)+((Math.imul(_,m)|0)>>>0)|0,M=R>>>16|0,de=((R&65535)>>>0)+((Math.imul($,g)|0)>>>0)|0,oe=(M>>>0)+((de>>>16|0)>>>0)|0,K=((de&65535)>>>0)+((Math.imul(d,b)|0)>>>0)|0,A=(oe>>>0)+((K>>>16|0)>>>0)|0,Q=K&65535;return{hi:(((((((((A>>>0)+((Math.imul(u,m)|0)>>>0)|0)>>>0)+((Math.imul(_,g)|0)>>>0)|0)>>>0)+((Math.imul($,b)|0)>>>0)|0)>>>0)+((Math.imul(d,p)|0)>>>0)|0)&65535)<<16|Q,lo:U<<16|w}}function jx(e,t){if(t.hi===0&&t.lo===0)return ne();{const n=Wu(),o=e.hi,s=e.lo,i=t.hi,r=t.lo,a=n.div_s,c=a(s,o,r,i),l=n.get_high;return{hi:l(),lo:c}}}function Hx(e,t){if(t.hi===0&&t.lo===0)return ne();{const n=Wu(),o=e.hi,s=e.lo,i=t.hi,r=t.lo,a=n.div_u,c=a(s,o,r,i),l=n.get_high;return{hi:l(),lo:c}}}function Fx(e,t){if(t.hi===0&&t.lo===0)return ne();{const n=Wu(),o=e.hi,s=e.lo,i=t.hi,r=t.lo,a=n.rem_u,c=a(s,o,r,i),l=n.get_high;return{hi:l(),lo:c}}}function Ux(e){return{hi:~e.hi,lo:~e.lo}}function Gf(e,t){return{hi:e.hi&t.hi,lo:e.lo&t.lo}}function Rf(e,t){return{hi:e.hi|t.hi,lo:e.lo|t.lo}}function Of(e,t){const n=t&63;if(n===0)return e;if(n<32){const o=e.hi,s=e.lo,i=o,r=s,a=i<<n|(r>>>(32-n|0)|0),c=r<<n;return{hi:a,lo:c}}else return{hi:e.lo<<(n-32|0),lo:0}}function Bx(e,t){const n=t&63;return n===0?e:n<32?{hi:e.hi>>>n|0,lo:e.lo>>>n|e.hi<<(32-n|0)}:{hi:0,lo:e.hi>>>(n-32|0)|0}}function zx(e,t){const n=t&63;return n===0?e:n<32?{hi:e.hi>>n,lo:e.lo>>>n|e.hi<<(32-n|0)}:{hi:e.hi>>31,lo:e.hi>>(n-32|0)}}function Df(e){return Nx(e)}function ks(e,t){return Tf(e,t)}function Gr(e,t){return Ef(e,t)}function Yo(e,t){return Af(e,t)}function so(e,t){return jx(e,t)}function Nf(e,t){return Gf(e,t)}function X$(e,t){return Rf(e,t)}function Vx(e,t){return zx(e,t)}function Fo(e,t){return Of(e,t)}function Y$(e,t){const n=e,o=t;return n.hi===o.hi&&n.lo===o.lo}function Ec(e,t){return Z1(e,t)}function qx(e){return e2(e)}function Wx(e){return qx(e)}function ao(e,t){return Tf(e,t)}function mu(e,t){return Ef(e,t)}function qn(e,t){return Af(e,t)}function Kx(e,t){return Hx(e,t)}function Jx(e,t){return Fx(e,t)}function Z$(e){return e.lo}function Ac(e,t){return Q1(e,t)}function co(e,t){const n=e,o=t;return n.hi===o.hi&&n.lo===o.lo}function zo(e,t){return Gf(e,t)}function Xx(e,t){return Rf(e,t)}function Yx(e){return Ux(e)}function Rr(e,t){return Of(e,t)}function os(e,t){return Bx(e,t)}function Q$(e){const t=e;return t.hi!==0?Math.clz32(t.hi):32+Math.clz32(t.lo)|0}function Zx(e,t){const n=(e.acc>>>0)+((Math.imul(t,-1028477379)|0)>>>0)|0,o=17;e.acc=Math.imul(n<<o|(n>>>(32-o|0)|0),668265263)|0}function jf(e,t){e.acc=(e.acc>>>0)+4|0,Zx(e,t)}function mi(e,t){jf(e,t)}function Qx(e,t){const n=t.length;let o=0;for(;;){const s=o;if(s<n){jf(e,t.charCodeAt(s)),o=s+1|0;continue}else return}}function eP(e,t){Qx(t,e)}function tP(e,t){mi(t,e)}function Ka(e,t,n,o,s){if(s>=0&&o>=0&&(s+n|0)<=t.length&&(o+n|0)<=e.length){p3(t,s,e,o,n);return}else{Ts(`bounds check failed: dst_offset = ${Vn(s)}, src_offset = ${Vn(o)}, len = ${Vn(n)}, dst.length = ${Vn(t.length)}, self.length = ${Vn(e.length)}`);return}}function nP(e,t,n,o,s){if((s+n|0)<=t.length&&(o+n|0)<=e.length){m3(t,s,e,o,n);return}else{Ts(`bounds check failed: dst_offset = ${Vn(s)}, src_offset = ${Vn(o)}, len = ${Vn(n)}, dst.length = ${Vn(t.length)}, self.length = ${Vn(e.length)}`);return}}function fi(e){return e!==e?0:e>=2147483647?2147483647:e<=-2147483648?-2147483648:e|0}function Hf(e){console.log(e)}function sP(e,t){return(e>>>t|0)&255}function oP(e){return t2(e)}function ed(e){if(e.length!==0)return oP(e)}function iP(e,t){if(t>=0&&t<e.length){S(e,t);const n=e[t];return n2(e,t,1),n}else return RM(`index out of bounds: the len is from 0 to ${Vn(e.length)} but the index is ${Vn(t)}`)}function rP(e,t){const n=e.length;return t<n?e[t]:void 0}function Ff(){return{now:0}}function ni(e){return e.now=e.now+1|0,e.now}function Uf(e){const n=Ce({buf:[],start:0,end:0});return ce(n,"cost",wx(e.cost)),new ke(n)}function aP(e,t){switch(e){case 0:{t.method_0(t.self,"HeartCrystalDust");return}case 1:{t.method_0(t.self,"RecallGear");return}case 2:{t.method_0(t.self,"SpiritalSpark");return}case 3:{t.method_0(t.self,"RefinedCopper");return}default:{t.method_0(t.self,"ResonantCrystal");return}}}function Bf(e,t){switch(e){case 0:return t===0;case 1:return t===1;case 2:return t===2;case 3:return t===3;default:return t===4}}function cP(e,t){switch(e){case 0:{mi(t,0);return}case 1:{mi(t,1);return}case 2:{mi(t,2);return}case 3:{mi(t,3);return}default:{mi(t,4);return}}}function Gc(e){switch(e){case 0:{const t="HeartCrystalDust";return new Ae(t)}case 1:{const t="RecallGear";return new Ae(t)}case 2:{const t="SpiritalSpark";return new Ae(t)}case 3:{const t="RefinedCopper";return new Ae(t)}default:{const t="ResonantCrystal";return new Ae(t)}}}function Ct(e){return{cost:e}}function Rc(e){const n=Ce({buf:[],start:0,end:0});return ce(n,"health",Pn(e.health)),ce(n,"speed",Oe(e.speed)),ce(n,"attack",Pn(e.attack)),ce(n,"defense",Pn(e.defense)),ce(n,"dodge",Pn(e.dodge)),new ke(n)}function zf(e,t){let n,o=oa,s=oa,i=oa,r=oa;if(e.$tag===6){const v=e._0,y=re(v,"health");if(y!==void 0){const I=y,U="health",R=la(I,new tt(t,U));let M;if(R.$tag===1)M=R._0;else return R;o=new Zi(M)}const w=re(v,"speed");if(w!==void 0){const I=w,U="speed",R=ro(I,new tt(t,U));let M;if(R.$tag===1)M=R._0;else return R;n=M}const k=re(v,"attack");if(k!==void 0){const I=k,U="attack",R=la(I,new tt(t,U));let M;if(R.$tag===1)M=R._0;else return R;r=new Zi(M)}const L=re(v,"defense");if(L!==void 0){const I=L,U="defense",R=la(I,new tt(t,U));let M;if(R.$tag===1)M=R._0;else return R;i=new Zi(M)}const P=re(v,"dodge");if(P!==void 0){const I=P,U="dodge",R=la(I,new tt(t,U));let M;if(R.$tag===1)M=R._0;else return R;s=new Zi(M)}}else return new Ro(new je({_0:t,_1:"Expected object to deserialize Attribute"}));const a=n;let c;if(a===void 0)return new Ro(new je({_0:t,_1:"Missing field speed"}));c=a;const l=o;let u;if(l.$tag===1)u=l._0;else return new Ro(new je({_0:t,_1:"Missing field health"}));const _=s;let $;if(_.$tag===1)$=_._0;else return new Ro(new je({_0:t,_1:"Missing field dodge"}));const d=i;let p;if(d.$tag===1)p=d._0;else return new Ro(new je({_0:t,_1:"Missing field defense"}));const b=r;let g;if(b.$tag===1)g=b._0;else return new Ro(new je({_0:t,_1:"Missing field attack"}));return new wm({health:u,speed:c,attack:g,defense:p,dodge:$})}function qt(e,t,n,o,s){return{health:e,speed:t,attack:n,defense:o,dodge:s}}function fu(e){const n=Ce({buf:[],start:0,end:0});return ce(n,"equipment_base",lP(e.equipment_base)),ce(n,"id",Oe(e.id)),new ke(n)}function hu(e,t){let n,o;if(e.$tag===6){const l=e._0,u=re(l,"equipment_base");if(u!==void 0){const d=u,p="equipment_base",b=uP(d,new tt(t,p));let g;if(b.$tag===1)g=b._0;else return b;o=g}const _=re(l,"id");if(_!==void 0){const d=_,p="id",b=ro(d,new tt(t,p));let g;if(b.$tag===1)g=b._0;else return b;n=g}}else return new ba(new je({_0:t,_1:"Expected object to deserialize Equipment"}));const s=n;let i;if(s===void 0)return new ba(new je({_0:t,_1:"Missing field id"}));i=s;const r=o;let a;return r===void 0?new ba(new je({_0:t,_1:"Missing field equipment_base"})):(a=r,new vm({equipment_base:a,id:i}))}function lP(e){const n=Ce({buf:[],start:0,end:0}),o=e.name;ce(n,"name",new Ae(o));const s=e.description;ce(n,"description",new Ae(s));const i=e.resource_url;return ce(n,"resource_url",new Ae(i)),ce(n,"attribute",Rc(e.attribute)),new ke(n)}function uP(e,t){let n,o,s,i;if(e.$tag===6){const b=e._0,g=re(b,"name");if(g!==void 0){const k=g,L="name",P=Ss(k,new tt(t,L));let G;if(P.$tag===1)G=P._0;else return P;o=G}const m=re(b,"description");if(m!==void 0){const k=m,L="description",P=Ss(k,new tt(t,L));let G;if(P.$tag===1)G=P._0;else return P;s=G}const v=re(b,"resource_url");if(v!==void 0){const k=v,L="resource_url",P=Ss(k,new tt(t,L));let G;if(P.$tag===1)G=P._0;else return P;n=G}const y=re(b,"attribute");if(y!==void 0){const k=y,L="attribute",P=zf(k,new tt(t,L));let G;if(P.$tag===1)G=P._0;else return P;i=G}}else return new di(new je({_0:t,_1:"Expected object to deserialize EquipmentBase"}));const r=n;let a;if(r===void 0)return new di(new je({_0:t,_1:"Missing field resource_url"}));a=r;const c=o;let l;if(c===void 0)return new di(new je({_0:t,_1:"Missing field name"}));l=c;const u=s;let _;if(u===void 0)return new di(new je({_0:t,_1:"Missing field description"}));_=u;const $=i;let d;return $===void 0?new di(new je({_0:t,_1:"Missing field attribute"})):(d=$,new Sm({name:l,description:_,resource_url:a,attribute:d}))}function _P(e){const n=Ce({buf:[],start:0,end:0});ce(n,"id",Oe(e.id));const o=e.type_msg;ce(n,"type_msg",new Ae(o));const s=e.content;return ce(n,"content",new Ae(s)),new ke(n)}function $P(){return{history:[],callback:e=>{}}}function dP(e,t){e.callback=t}function nt(e,t){const n={id:ni(LM),type_msg:t.type_msg,content:t.content};kx(e.history,n);const o=e.callback;o(Ze(_P(n)))}function Oc(e){const n=Ce({buf:[],start:0,end:0});return ce(n,"id",Oe(e.id)),ce(n,"level",Oe(e.level)),ce(n,"suffix",Oe(e.suffix)),ce(n,"live_left",Oe(e.live_left)),ce(n,"attribute",Rc(e.attribute)),ce(n,"copper_type",Vf(e.copper_type)),ce(n,"equipment_slot",mP(e.equipment_slot)),ce(n,"copper_info",hP(e.copper_info)),new ke(n)}function pP(e,t){let n,o,s,i,r,a,c,l;if(e.$tag===6){const R=e._0,M=re(R,"id");if(M!==void 0){const D=M,X="id",q=ro(D,new tt(t,X));let he;if(q.$tag===1)he=q._0;else return q;i=he}const B=re(R,"level");if(B!==void 0){const D=B,X="level",q=ro(D,new tt(t,X));let he;if(q.$tag===1)he=q._0;else return q;s=he}const de=re(R,"suffix");if(de!==void 0){const D=de,X="suffix",q=ro(D,new tt(t,X));let he;if(q.$tag===1)he=q._0;else return q;n=he}const oe=re(R,"live_left");if(oe!==void 0){const D=oe,X="live_left",q=ro(D,new tt(t,X));let he;if(q.$tag===1)he=q._0;else return q;o=he}const be=re(R,"attribute");if(be!==void 0){const D=be,X="attribute",q=zf(D,new tt(t,X));let he;if(q.$tag===1)he=q._0;else return q;l=he}const K=re(R,"copper_type");if(K!==void 0){const D=K,X="copper_type",q=qf(D,new tt(t,X));let he;if(q.$tag===1)he=q._0;else return q;a=he}const A=re(R,"equipment_slot");if(A!==void 0){const D=A,X="equipment_slot",q=fP(D,new tt(t,X));let he;if(q.$tag===1)he=q._0;else return q;r=he}const Q=re(R,"copper_info");if(Q!==void 0){const D=Q,X="copper_info",q=gP(D,new tt(t,X));let he;if(q.$tag===1)he=q._0;else return q;c=he}}else return new ms(new je({_0:t,_1:"Expected object to deserialize Copper"}));const u=n;let _;if(u===void 0)return new ms(new je({_0:t,_1:"Missing field suffix"}));_=u;const $=o;let d;if($===void 0)return new ms(new je({_0:t,_1:"Missing field live_left"}));d=$;const p=s;let b;if(p===void 0)return new ms(new je({_0:t,_1:"Missing field level"}));b=p;const g=i;let m;if(g===void 0)return new ms(new je({_0:t,_1:"Missing field id"}));m=g;const v=r;let y;if(v===void 0)return new ms(new je({_0:t,_1:"Missing field equipment_slot"}));y=v;const w=a;let k;if(w===void 0)return new ms(new je({_0:t,_1:"Missing field copper_type"}));k=w;const L=c;let P;if(L===void 0)return new ms(new je({_0:t,_1:"Missing field copper_info"}));P=L;const G=l;let I;return G===void 0?new ms(new je({_0:t,_1:"Missing field attribute"})):(I=G,new km({id:m,level:b,suffix:_,live_left:d,attribute:I,copper_type:k,equipment_slot:y,copper_info:P}))}function Vf(e){switch(e){case 0:{const t="IronWall";return new Ae(t)}case 1:{const t="Arcanist";return new Ae(t)}case 2:{const t="CraftsMan";return new Ae(t)}case 3:{const t="Mechanic";return new Ae(t)}default:{const t="Resonator";return new Ae(t)}}}function qf(e,t){let n;switch(e.$tag){case 4:{n=e._0;break}case 5:{const s=e._0,i=rP(s,0);if(i===void 0)return new Qi(new je({_0:t,_1:"Missing tag in array[0] when derserializing CopperType"}));{const a=i;if(a.$tag===4)n=a._0;else return new Qi(new je({_0:t,_1:"Expected string tag at array[0] when derserializing CopperType"}))}break}default:return new Qi(new je({_0:t,_1:"Expected string or array for tag in enum when derserializing CopperType"}))}switch(n){case"IronWall":return new pi(0);case"Arcanist":return new pi(1);case"CraftsMan":return new pi(2);case"Mechanic":return new pi(3);case"Resonator":return new pi(4);default:return new Qi(new je({_0:t,_1:`Unknown enum constructor ${n} when deserializing CopperType`}))}}function mP(e){const n=Ce({buf:[],start:0,end:0}),o=e.slot1;o===void 0||ce(n,"slot1",fu(o));const s=e.slot2;return s===void 0||ce(n,"slot2",fu(s)),ce(n,"is_slot2_locked",xn(e.is_slot2_locked)),new ke(n)}function fP(e,t){let n=f$,o=f$,s=-1;if(e.$tag===6){const $=e._0,d=re($,"slot1");if(d!==void 0){const m=d,v="slot1",y=hu(m,new tt(t,v));let w;if(y.$tag===1)w=y._0;else return y;o=new nu(w)}const p=re($,"slot2");if(p!==void 0){const m=p,v="slot2",y=hu(m,new tt(t,v));let w;if(y.$tag===1)w=y._0;else return y;n=new nu(w)}const b=re($,"is_slot2_locked");if(b!==void 0){const m=b,v="is_slot2_locked",y=U6(m,new tt(t,v));let w;if(y.$tag===1)w=y._0;else return y;s=w}}else return new su(new je({_0:t,_1:"Expected object to deserialize EquipmentSlot"}));const i=n;let r;i.$tag===1?r=i._0:r=void 0;const a=o;let c;a.$tag===1?c=a._0:c=void 0;const l=s;let u;return l===-1?new su(new je({_0:t,_1:"Missing field is_slot2_locked"})):(u=l,new Mm({slot1:c,slot2:r,is_slot2_locked:u}))}function hP(e){const n=Ce({buf:[],start:0,end:0}),o=e.name;ce(n,"name",new Ae(o)),ce(n,"copper_type",Vf(e.copper_type));const s=e.description;ce(n,"description",new Ae(s));const i=e.icon_url;ce(n,"icon_url",new Ae(i));const r=e.model_url;ce(n,"model_url",new Ae(r));const a=e.skill;a===void 0||ce(n,"skill",bP(a));const c=e.attack_range;return c===void 0||ce(n,"attack_range",Oe(c)),new ke(n)}function gP(e,t){let n=s2,o,s,i,r,a,c=xm;if(e.$tag===6){const G=e._0,I=re(G,"name");if(I!==void 0){const K=I,A="name",Q=Ss(K,new tt(t,A));let F;if(Q.$tag===1)F=Q._0;else return Q;o=F}const U=re(G,"copper_type");if(U!==void 0){const K=U,A="copper_type",Q=qf(K,new tt(t,A));let F;if(Q.$tag===1)F=Q._0;else return Q;a=F}const R=re(G,"description");if(R!==void 0){const K=R,A="description",Q=Ss(K,new tt(t,A));let F;if(Q.$tag===1)F=Q._0;else return Q;r=F}const M=re(G,"icon_url");if(M!==void 0){const K=M,A="icon_url",Q=Ss(K,new tt(t,A));let F;if(Q.$tag===1)F=Q._0;else return Q;i=F}const B=re(G,"model_url");if(B!==void 0){const K=B,A="model_url",Q=Ss(K,new tt(t,A));let F;if(Q.$tag===1)F=Q._0;else return Q;s=F}const de=re(G,"skill");if(de!==void 0){const K=de,A="skill",Q=yP(K,new tt(t,A));let F;if(Q.$tag===1)F=Q._0;else return Q;n=new Cm(F)}const oe=re(G,"attack_range");if(oe!==void 0){const K=oe,A="attack_range",Q=ro(K,new tt(t,A));let F;if(Q.$tag===1)F=Q._0;else return Q;c=new Ku(F)}}else return new Oo(new je({_0:t,_1:"Expected object to deserialize CopperInfo"}));const l=n;let u;l.$tag===1?u=l._0:u=void 0;const _=o;let $;if(_===void 0)return new Oo(new je({_0:t,_1:"Missing field name"}));$=_;const d=s;let p;if(d===void 0)return new Oo(new je({_0:t,_1:"Missing field model_url"}));p=d;const b=i;let g;if(b===void 0)return new Oo(new je({_0:t,_1:"Missing field icon_url"}));g=b;const m=r;let v;if(m===void 0)return new Oo(new je({_0:t,_1:"Missing field description"}));v=m;const y=a;let w;if(y===void 0)return new Oo(new je({_0:t,_1:"Missing field copper_type"}));w=y;const k=c;let L;return k.$tag===1?L=k._0:L=void 0,new Pm({name:$,copper_type:w,description:v,icon_url:g,model_url:p,skill:u,attack_range:L})}function bP(e){const n=Ce({buf:[],start:0,end:0}),o=e.name;ce(n,"name",new Ae(o));const s=e.description;ce(n,"description",new Ae(s));const i=e.resource_url;ce(n,"resource_url",new Ae(i));const r=e.cool_down;return r===void 0||ce(n,"cool_down",Oe(r)),new ke(n)}function yP(e,t){let n,o,s,i=xm;if(e.$tag===6){const b=e._0,g=re(b,"name");if(g!==void 0){const k=g,L="name",P=Ss(k,new tt(t,L));let G;if(P.$tag===1)G=P._0;else return P;o=G}const m=re(b,"description");if(m!==void 0){const k=m,L="description",P=Ss(k,new tt(t,L));let G;if(P.$tag===1)G=P._0;else return P;s=G}const v=re(b,"resource_url");if(v!==void 0){const k=v,L="resource_url",P=Ss(k,new tt(t,L));let G;if(P.$tag===1)G=P._0;else return P;n=G}const y=re(b,"cool_down");if(y!==void 0){const k=y,L="cool_down",P=ro(k,new tt(t,L));let G;if(P.$tag===1)G=P._0;else return P;i=new Ku(G)}}else return new er(new je({_0:t,_1:"Expected object to deserialize Skill"}));const r=n;let a;if(r===void 0)return new er(new je({_0:t,_1:"Missing field resource_url"}));a=r;const c=o;let l;if(c===void 0)return new er(new je({_0:t,_1:"Missing field name"}));l=c;const u=s;let _;if(u===void 0)return new er(new je({_0:t,_1:"Missing field description"}));_=u;const $=i;let d;return $.$tag===1?d=$._0:d=void 0,new Lm({name:l,description:_,resource_url:a,cool_down:d})}function Ot(e,t,n){return B6(Math.fround(e*Math.fround(y6(n,(t-1|0)+0))))}function r_(e){switch(e){case 0:return qt(Math.fround(150),2,Math.fround(15),Math.fround(20),Math.fround(10));case 1:return qt(Math.fround(50),3,Math.fround(20),Math.fround(5),Math.fround(10));case 4:return qt(Math.fround(100),3,Math.fround(10),Math.fround(10),Math.fround(10));case 3:return qt(Math.fround(80),3,Math.fround(5),Math.fround(8),Math.fround(10));default:return qt(Math.fround(80),4,Math.fround(0),Math.fround(8),Math.fround(10))}}function td(e){const t=e.level+1|0,n=r_(e.copper_type),o=e.attribute.speed;switch(e.copper_type){case 0:return qt(Ot(n.health,t,Math.fround(1.35)),o,Ot(n.attack,t,Math.fround(1.28)),Ot(n.defense,t,Math.fround(1.37)),Ot(n.dodge,t,Math.fround(1.19)));case 1:return qt(Ot(n.health,t,Math.fround(1.22)),o,Ot(n.attack,t,Math.fround(1.4)),Ot(n.defense,t,Math.fround(1.27)),Ot(n.dodge,t,Math.fround(1.19)));case 4:return qt(Ot(n.health,t,Math.fround(1.38)),o,Ot(n.attack,t,Math.fround(1.16)),Ot(n.defense,t,Math.fround(1.27)),Ot(n.dodge,t,Math.fround(1.19)));case 3:return qt(Ot(n.health,t,Math.fround(1.3)),o,Ot(n.attack,t,Math.fround(1.2)),Ot(n.defense,t,Math.fround(1.27)),Ot(n.dodge,t,Math.fround(1.19)));default:return qt(Ot(n.health,t,Math.fround(1.3)),o,Ot(n.attack,t,Math.fround(1.27)),Ot(n.defense,t,Math.fround(1.16)),Ot(n.dodge,t,Math.fround(1.19)))}}function wP(e){return{slot1:e.slot1,slot2:e.slot2,is_slot2_locked:!1}}function vP(e){return e.level===4?{...e,attribute:td(e),level:e.level+1|0,equipment_slot:wP(e.equipment_slot)}:{...e,attribute:td(e),level:e.level+1|0}}function SP(e){let t;switch(e){case 1:{t=5;break}case 2:{t=10;break}case 3:{t=20;break}case 4:{t=30;break}default:nt(et,Xw),t=0}return Ct([{_0:2,_1:t}])}function Wf(){return{slot1:void 0,slot2:void 0,is_slot2_locked:!0}}function kl(e){const t=ZC(PM,e),n=ni(Gi);return{id:n,level:1,suffix:n,live_left:5,attribute:r_(t.copper_type),copper_type:t.copper_type,equipment_slot:Wf(),copper_info:t}}function lo(e,t){return e+l3(Am,(t-e|0)+1|0)|0}function Or(e){const t=u3(Am);return Hf(`12121:${String(t)}`),t<=e}function kP(){return vf({buf:nv,start:0,end:5})}function MP(){return vf({buf:cv,start:0,end:5})}function An(e,t){const n=kf(e,t);return n===void 0?ne():n}function Kf(e,t,n){const o=kf(e,t);let s;if(o===void 0?s=ne():s=o,s<n){nt(et,lv);return}else{n_(e,t,s-n|0);return}}function Dc(e,t){const n=t.cost,o=n.length;let s=0;for(;;){const i=s;if(i<o){const r=n[i],a=r._0,c=r._1;if(An(e,a)<c)return!1;s=i+1|0;continue}else break}return!0}function Nc(e,t){const n=t.cost,o=n.length;let s=0;for(;;){const i=s;if(i<o){const r=n[i],a=r._0,c=r._1;Kf(e,a,c),s=i+1|0;continue}else return}}function oo(e,t,n){n_(e,t,An(e,t)+n|0)}function CP(){return{resources:kP(),equipments:[]}}function xP(e,t){return{resources:e,equipments:t}}function a_(e,t){const n=t.length;let o=0;for(;;){const s=o;if(s<n){const i=t[s],r=i.item_type;if(r.$tag===0){const c=r._0;oo(e.resources,c,i.count)}else{const c=r._0;Mx(e.equipments,c)}o=s+1|0;continue}else return}}function PP(e,t){return{item_type:e,count:t}}function LP(){const e=kl(""),t=kl(""),n=kl("");return{coppers:wa(wa(wa(void 0,e.id,e),t.id,t),n.id,n)}}function IP(){return{coppers:void 0}}function c_(e,t){return{coppers:wa(e.coppers,t.id,t)}}function Sa(e,t){const n=f6(e.coppers,t);return n===void 0?ne():n}function Jf(e){return Ox(b6(e.coppers))}function TP(e,t){return{coppers:h6(e.coppers,t)}}function EP(){const e=ni(Gi),t=lo(0,$r.length-1|0);S($r,t);const n=$r[t],o=r_(n.copper_type);return{id:e,level:1,suffix:e,live_left:5,attribute:o,copper_type:n.copper_type,equipment_slot:Wf(),copper_info:n}}function AP(e){if(An(e,2)>=10)return Kf(e,2,10),EP();nt(et,uv)}function GP(){const e=CP();return{warehouse:LP(),bag:e}}function RP(e,t){return{warehouse:e,bag:t}}function OP(e){const t=e.bag.resources,n=[{_0:"SpiritalSpark",_1:Oe(An(t,2))},{_0:"RecallGear",_1:Oe(An(t,1))},{_0:"ResonantCrystal",_1:Oe(An(t,4))},{_0:"RefinedCopper",_1:Oe(An(t,3))},{_0:"HeartCrystalDust",_1:Oe(An(t,0))}],o=Ce({buf:n,start:0,end:5});return Ze(new ke(o))}function DP(e){const t=e.warehouse,n=[{_0:"coppers",_1:fx(Jf(t))}],o=Ce({buf:n,start:0,end:1});return Ze(new ke(o))}function NP(e){const t=AP(e.bag.resources);let n;if(t===void 0){const o="error",s={_0:"type",_1:new Ae(o)},i="",r=[s,{_0:"content",_1:new Ae(i)}],a=Ce({buf:r,start:0,end:2});n=new ke(a)}else{const s=t;e.warehouse=c_(e.warehouse,s);const i="success",r=[{_0:"type",_1:new Ae(i)},{_0:"copper",_1:Oc(s)}],a=Ce({buf:r,start:0,end:2});n=new ke(a)}return Ze(n)}function jP(e,t){const n=e.warehouse,o=Sa(n,t),s=SP(o.level);let i;if(Dc(e.bag.resources,s)){const r=vP(o);Nc(e.bag.resources,s),e.warehouse=TP(e.warehouse,t),e.warehouse=c_(e.warehouse,r);const a="success",c=[{_0:"type",_1:new Ae(a)}],l=Ce({buf:c,start:0,end:1});i=new ke(l)}else{const r="error",a={_0:"type",_1:new Ae(r)},c="",l=[a,{_0:"content",_1:new Ae(c)}],u=Ce({buf:l,start:0,end:2});i=new ke(u)}return Ze(i)}function HP(e){const t=Ct([_v,$v,dv,pv]);let n;if(Dc(e.bag.resources,t)){Nc(e.bag.resources,t),oo(e.bag.resources,2,1);const o="success",s=[{_0:"type",_1:new Ae(o)}],i=Ce({buf:s,start:0,end:1});n=new ke(i)}else{const o="error",s={_0:"type",_1:new Ae(o)},i="",r=[s,{_0:"content",_1:new Ae(i)}],a=Ce({buf:r,start:0,end:2});n=new ke(a)}return Ze(n)}function Xf(e){const n=Ce({buf:[],start:0,end:0});return ce(n,"id",Oe(e.id)),ce(n,"original_id",Oe(e.original_id)),ce(n,"copper",Oc(e.copper)),ce(n,"can_move",xn(e.can_move)),ce(n,"can_attack",xn(e.can_attack)),ce(n,"can_summon",xn(e.can_summon)),ce(n,"can_build",xn(e.can_build)),ce(n,"position",yn(e.position)),ce(n,"now_health",Pn(e.now_health)),ce(n,"attribute",Rc(e.attribute)),new ke(n)}function Yf(e){const n=Ce({buf:[],start:0,end:0});return ce(n,"id",Oe(e.id)),ce(n,"owned",xn(e.owned)),ce(n,"can_move",xn(e.can_move)),ce(n,"can_attack",xn(e.can_attack)),ce(n,"position",yn(e.position)),ce(n,"now_health",Pn(e.now_health)),ce(n,"enemy_base",Qf(e.enemy_base)),new ke(n)}function FP(e){const n=Ce({buf:[],start:0,end:0}),o=e.name;ce(n,"name",new Ae(o)),ce(n,"resource_type",Gc(e.resource_type));const s=e.model_url;return ce(n,"model_url",new Ae(s)),new ke(n)}function Zf(e){const n=Ce({buf:[],start:0,end:0});ce(n,"id",Oe(e.id)),ce(n,"owned",xn(e.owned)),ce(n,"position",yn(e.position)),ce(n,"can_attack",xn(e.can_attack));const o=e.resource_type;return o===void 0||ce(n,"resource_type",Gc(o)),ce(n,"now_health",Pn(e.now_health)),ce(n,"structure_base",eh(e.structure_base)),new ke(n)}function Qf(e){const n=Ce({buf:[],start:0,end:0});ce(n,"level",Oe(e.level)),ce(n,"health",Pn(e.health)),ce(n,"attack",Pn(e.attack)),ce(n,"defense",Pn(e.defense)),ce(n,"dodge",Pn(e.dodge)),ce(n,"attack_range",Oe(e.attack_range)),ce(n,"speed",Oe(e.speed));const o=e.name;ce(n,"name",new Ae(o));const s=e.enemy_type;ce(n,"enemy_type",new Ae(s));const i=e.description;ce(n,"description",new Ae(i));const r=e.asset_url;ce(n,"asset_url",new Ae(r));const a=e.model_url;return ce(n,"model_url",new Ae(a)),ce(n,"drop_items",yx(e.drop_items)),ce(n,"summon_cost",Uf(e.summon_cost)),new ke(n)}function UP(e){const n=Ce({buf:[],start:0,end:0});return ce(n,"id",Oe(e.id)),ce(n,"material_base",FP(e.material_base)),new ke(n)}function eh(e){const n=Ce({buf:[],start:0,end:0}),o=e.name;ce(n,"name",new Ae(o)),ce(n,"health",Pn(e.health)),ce(n,"can_move",xn(e.can_move)),ce(n,"can_attack",xn(e.can_attack)),ce(n,"attack_range",Oe(e.attack_range));const s=e.description;ce(n,"description",new Ae(s));const i=e.asset_url;ce(n,"asset_url",new Ae(i));const r=e.model_url;return ce(n,"model_url",new Ae(r)),ce(n,"attribute",Rc(e.attribute)),ce(n,"cost",Uf(e.cost)),new ke(n)}function BP(e,t){switch(e){case 0:{t.method_0(t.self,"PositiveX");return}case 1:{t.method_0(t.self,"NegativeX");return}case 2:{t.method_0(t.self,"PositiveY");return}default:{t.method_0(t.self,"NegativeY");return}}}function th(e,t,n,o){const s=ni(Gi),i=e.can_attack,r=e.health,a={id:s,owned:t,position:o,can_attack:i,resource_type:n,now_health:r,structure_base:e};return GC(Xs,a.id,a),a}function l_(e){const t=JC(Xs,e);return t===void 0?ne():t}function u_(e){const t=[{_0:"id",_1:Oe(e)}],n=Ce({buf:t,start:0,end:1});nt(et,{type_msg:"clear_state",content:Ze(new ke(n))})}function __(e,t){const n={_0:"id",_1:Oe(e)},o=Lc(t),s=[n,{_0:"can_attack",_1:new Ae(o)}],i=Ce({buf:s,start:0,end:2});nt(et,{type_msg:"display_can_attack",content:Ze(new ke(i))})}function pr(e){if(u_(e.id),e.structure_base.can_attack){__(e.id,!0);return}else return}function Oi(e){const t=[];let o=-e|0;for(;;){const s=o;if(s<=e){let r=-e|0;for(;;){const a=r;if(a<=e){const c=(s<0?-s|0:s)+(a<0?-a|0:a)|0;c<=e&&c!==0&&vo(t,{_0:s,_1:a}),r=a+1|0;continue}else break}o=s+1|0;continue}else break}return t}function nh(e,t){const n=t._0,o=t._1,s=e.index_position,i=s._0,r=s._1;return n>=i&&n<(i+9|0)&&o>=r&&o<(r+9|0)}function si(e,t){const n=e.rooms,o=n.length;let s=0;for(;;){const i=s;if(i<o){const r=n[i];if(nh(r,t))return r;s=i+1|0;continue}else break}}function zs(e,t){const n=e.rooms,o=n.length;let s=0;for(;;){const i=s;if(i<o){const r=n[i];if(nh(r,t)){const a=t._0-r.index_position._0|0,c=t._1-r.index_position._1|0;return{_0:r,_1:{_0:a,_1:c}}}s=i+1|0;continue}else break}}function $_(e,t){const n=si(e,t);if(n===void 0)return ne();{const s=n,i=zs(e,t);if(i===void 0)return ne();{const c=i._1;return{_0:s,_1:c}}}}function So(e,t){const n=$_(e,t),o=n._0,s=n._1;return wt(vt(o.blocks,s._0),s._1).occupant}function Vo(e,t){const n=si(e,t);if(n!==void 0){const s=n,i=zs(e,t);if(i===void 0)ne();else{const c=i._1,l=wt(vt(s.blocks,c._0),c._1).occupant;let u;return l.$tag===4?u=!0:u=!1,!u}}return!1}function zP(e,t){const n=e.structure_base.attack_range,o=Oi(n),s=[],i=o.length;let r=0;for(;;){const a=r;if(a<i){const c=o[a],l={_0:e.position._0+c._0|0,_1:e.position._1+c._1|0};if(Vo(t,l)){const u=So(t,l);if(e.owned)switch(u.$tag){case 1:{const $=u._0;e.structure_base.name===""&&kn(s,new Ei($));break}case 0:{const $=u._0;$.owned===!1&&kn(s,new Jo($));break}case 3:{const $=u._0;$.owned===!1&&kn(s,new Xo($));break}}else switch(u.$tag){case 1:{const $=u._0;kn(s,new Ei($));break}case 0:{const $=u._0;$.owned===!0&&kn(s,new Jo($));break}case 3:{const $=u._0;$.owned===!0&&kn(s,new Xo($));break}}}r=a+1|0;continue}else break}return s}function jc(e,t){return e.now_health=Math.fround(e.now_health-t),Math.fround(e.now_health<=Math.fround(0))}function VP(e,t,n){const o=[{_0:"id",_1:Oe(t)},{_0:"position",_1:yn(n)},{_0:"copper",_1:Xf(e)}],s=Ce({buf:o,start:0,end:3});nt(et,{type_msg:"set_copper",content:Ze(new ke(s))})}function d_(e,t,n){const o=[{_0:"id",_1:Oe(t)},{_0:"position",_1:yn(n)},{_0:"enemy",_1:Yf(e)}],s=Ce({buf:o,start:0,end:3});nt(et,{type_msg:"set_enemy",content:Ze(new ke(s))})}function sh(e,t,n){const o=[{_0:"id",_1:Oe(t)},{_0:"position",_1:yn(n)},{_0:"structure",_1:Zf(e)}],s=Ce({buf:o,start:0,end:3});nt(et,{type_msg:"set_structure",content:Ze(new ke(s))})}function qP(e,t,n){const o=[{_0:"id",_1:Oe(t)},{_0:"position",_1:yn(n)},{_0:"material",_1:UP(e)}],s=Ce({buf:o,start:0,end:3});nt(et,{type_msg:"set_material",content:Ze(new ke(s))})}function cs(e){const t=[{_0:"id",_1:Oe(e)}],n=Ce({buf:t,start:0,end:1});nt(et,{type_msg:"remove_unit",content:Ze(new ke(n))})}function qo(e,t){const n={_0:"id",_1:Oe(e)},o=G3(t),s=[n,{_0:"direction",_1:new Ae(o)}],i=Ce({buf:s,start:0,end:2});nt(et,{type_msg:"change_direction",content:Ze(new ke(i))})}function Ja(e,t){const n=[{_0:"id",_1:Oe(e)},{_0:"to",_1:yn(t)}],o=Ce({buf:n,start:0,end:2});nt(et,{type_msg:"move_to",content:Ze(new ke(o))})}function oh(e,t){const n={_0:"id",_1:Oe(e)},o=Lc(t),s=[n,{_0:"can_move",_1:new Ae(o)}],i=Ce({buf:s,start:0,end:2});nt(et,{type_msg:"display_can_move",content:Ze(new ke(i))})}function WP(e,t){const n={_0:"id",_1:Oe(e)},o=Lc(t),s=[n,{_0:"can_summon",_1:new Ae(o)}],i=Ce({buf:s,start:0,end:2});nt(et,{type_msg:"display_can_summon",content:Ze(new ke(i))})}function KP(e,t){const n={_0:"id",_1:Oe(e)},o=Lc(t),s=[n,{_0:"can_build",_1:new Ae(o)}],i=Ce({buf:s,start:0,end:2});nt(et,{type_msg:"display_can_build",content:Ze(new ke(i))})}function Zo(e){const t=[{_0:"id",_1:Oe(e)}],n=Ce({buf:t,start:0,end:1});nt(et,{type_msg:"animate_move",content:Ze(new ke(n))})}function JP(){const t=Ce({buf:[],start:0,end:0});nt(et,{type_msg:"animate_reset",content:Ze(new ke(t))})}function XP(e,t){const n=[{_0:"room_position",_1:yn(e)},{_0:"size",_1:Oe(t)}],o=Ce({buf:n,start:0,end:2});nt(et,{type_msg:"put_room_blocks",content:Ze(new ke(o))})}function Xa(e){const t=[{_0:"position",_1:yn(e)}],n=Ce({buf:t,start:0,end:1});nt(et,{type_msg:"set_move_block",content:Ze(new ke(n))})}function io(e){const t=[{_0:"position",_1:yn(e)}],n=Ce({buf:t,start:0,end:1});nt(et,{type_msg:"set_attack_block",content:Ze(new ke(n))})}function Ya(e){const t=[{_0:"position",_1:yn(e)}],n=Ce({buf:t,start:0,end:1});nt(et,{type_msg:"set_can_summon_blocks",content:Ze(new ke(n))})}function cn(e){const t=[{_0:"position",_1:yn(e)}],n=Ce({buf:t,start:0,end:1});nt(et,{type_msg:"clear_block",content:Ze(new ke(n))})}function p_(e){const t=[{_0:"id",_1:Oe(e)}],n=Ce({buf:t,start:0,end:1});nt(et,{type_msg:"attack_complete",content:Ze(new ke(n))})}function Nn(e,t,n){const o=[{_0:"id",_1:Oe(e)},{_0:"now_health",_1:Pn(t)},{_0:"max_health",_1:Pn(n)}],s=Ce({buf:o,start:0,end:3});nt(et,{type_msg:"update_health",content:Ze(new ke(s))})}function ih(){const t=Ce({buf:[],start:0,end:0});nt(et,{type_msg:"game_over",content:Ze(new ke(t))})}function rh(){const t=Ce({buf:[],start:0,end:0});nt(et,{type_msg:"success",content:Ze(new ke(t))})}function ah(e){const t=[],n=ja.length;let o=0;for(;;){const i=o;if(i<n){const r=ja[i];r.level<=e&&Tx(t,r),o=i+1|0;continue}else break}const s=t;return v3(s,lo(0,s.length-1|0))}function Ml(e){let t=lo(0,8),n=lo(0,8);for(;fs(e,{_0:t,_1:n});){t=lo(0,8),n=lo(0,8);continue}return{_0:t,_1:n}}function mr(e,t,n){const o=!n,s=!n,i=ni(Gi),r=e.health,a={id:i,owned:n,can_move:o,can_attack:s,position:t,now_health:r,enemy_base:e};return AC(jn,a.id,a),a}function YP(){return{occupant:Cr}}function nd(e){return{id:ni(Gi),material_base:e}}function ch(e,t,n){let o=e;const s=[];let i=0;for(;;){const r=i;if(r<9){const a=[];let c=0;for(;;){const l=c;if(l<9){xx(a,YP()),c=l+1|0;continue}else break}Px(s,a),i=r+1|0;continue}else break}if(o===6&&Lr.val===!1)wt(vt(s,3),4).occupant=new po(mr(q$(ru,"BOSS"),{_0:t._0+3|0,_1:t._1+4|0},!1)),wt(vt(s,5),4).occupant=new po(mr(q$(ru,"BOSS"),{_0:t._0+5|0,_1:t._1+4|0},!1)),Lr.val=!0;else{o===6&&(o=5),wt(vt(s,4),4).occupant=new Ju(th(YC(Om,""),!1,void 0,{_0:t._0+4|0,_1:t._1+4|0}));const r=Do(Nv,o);let a=0;for(;;){const c=a;if(c<r){const l=ah(o),u=Ml(n);as(n,u);const _={_0:t._0+u._0|0,_1:t._1+u._1|0};wt(vt(s,u._0),u._1).occupant=new po(mr(l,_,!1)),a=c+1|0;continue}else break}if(Or(.4)){const c=Ml(n);as(n,c),wt(vt(s,c._0),c._1).occupant=new ou(nd(ZS))}if(Or(.4)){const c=Ml(n);as(n,c),wt(vt(s,c._0),c._1).occupant=new ou(nd(QS))}}return{level:o,index_position:t,blocks:s}}function ZP(e){const t=e.blocks,n=t.length;let o=0;for(;;){const s=o;if(s<n){const i=t[s],r=i.length;let a=0;for(;;){const c=a;if(c<r){if(i[c].occupant.$tag===4)return!1;a=c+1|0;continue}else break}o=s+1|0;continue}else break}return!0}function QP(e){const t=[];let n=0;for(;;){const o=n;if(o<9){let s=0;for(;;){const i=s;if(i<9){wt(vt(e.blocks,o),i).occupant.$tag===4&&vo(t,{_0:o,_1:i}),s=i+1|0;continue}else break}n=o+1|0;continue}else break}return t}function e7(e,t){const n=t._0,o=t._1,s=e.index_position,i=s._0,r=s._1,a=n-i|0,c=o-r|0;return a<0?c<0?{_0:5,_1:{_0:i-9|0,_1:r}}:c>=9?{_0:4,_1:{_0:i-9|0,_1:r+9|0}}:{_0:0,_1:{_0:i-9|0,_1:r}}:a>=9?c<0?{_0:7,_1:{_0:i+9|0,_1:r}}:c>=9?{_0:6,_1:{_0:i+9|0,_1:r+9|0}}:{_0:1,_1:{_0:i+9|0,_1:r}}:c<0?{_0:3,_1:{_0:i,_1:r-9|0}}:{_0:2,_1:{_0:i,_1:r+9|0}}}function t7(e){const t=VC({start:0,end:0}),n=e.rooms,o=n.length;let s=0;for(;;){const i=s;if(i<o){const r=n[i],a=r.index_position,c=a._0,l=a._1;let u=0;for(;;){const _=u;if(_<9){let $=0;for(;;){const d=$;if(d<9){const p={_0:c+_|0,_1:l+d|0};NC(t,p,wt(vt(r.blocks,_),d)),$=d+1|0;continue}else break}u=_+1|0;continue}else break}s=i+1|0;continue}else break}return t}function n7(e){const t=t7(e),o=Sf({buf:[],start:0,end:0}),s={map:o},i=lx(t);for(;;){const r=px(i);if(r===void 0)break;{const c=r,l=c._0;c._1.occupant.$tag===4?za(o,l,!0):za(o,l,!1);continue}}return s}function s7(e,t){const n=Mf(e.map,t);return n===-1?!1:n}function o7(e,t,n){const o=Oi(t),s=[],i=o.length;let r=0;for(;;){const a=r;if(a<i){const c=o[a],l={_0:n._0+c._0|0,_1:n._1+c._1|0};s7(e,l)&&vo(s,l),r=a+1|0;continue}else break}return s}function _a(e,t){const n=e._0>t._0?e._0-t._0|0:t._0-e._0|0,o=e._1>t._1?e._1-t._1|0:t._1-e._1|0;return n+o|0}function i7(e,t,n,o,s){if(t._0===n._0&&t._1===n._1)return t;const i=[{position:t,g_cost:0,h_cost:_a(t,n),f_cost:_a(t,n)}],a=Sf({buf:[],start:0,end:0}),c=BC({start:0,end:0});for(;i.length>0;){let l=0,u=Qs(i,0);const _=i.length;let $=1;for(;;){const y=$;if(y<_){Qs(i,y).f_cost<u.f_cost&&(u=Qs(i,y),l=y),$=y+1|0;continue}else break}iP(i,l),za(a,u.position,!0);const d=_a(u.position,n);let p;const b=u.position;if(b._0===n._0&&b._1===n._1?p=!0:p=d<=s,p){let y=u.position,w=u.position;for(;;){const k=XC(c,y);if(k===void 0)break;{const P=k;w=y,y=P;const G=y;if(G._0===t._0&&G._1===t._1)break;continue}}return w}const g=o7(e,o,u.position),m=g.length;let v=0;for(;;){const y=v;if(y<m){e:{const w=g[y];if(Mf(a,w)!==-1)break e;const L=u.g_cost+1|0;let P=!1,G=0;const I=i.length;let U=0;for(;;){const R=U;if(R<I){const M=Qs(i,R).position;if(M._0===w._0&&M._1===w._1){P=!0,G=R;break}U=R+1|0;continue}else break}if(P)L<Qs(i,G).g_cost&&(Qs(i,G).g_cost=L,Qs(i,G).f_cost=L+Qs(i,G).h_cost|0,V$(c,w,u.position));else{const R=_a(w,n),M=L+R|0;Ex(i,{position:w,g_cost:L,h_cost:R,f_cost:M}),V$(c,w,u.position)}break e}v=y+1|0;continue}else break}continue}}function lh(e,t){Lx(e.rooms,t)}function r7(e){const t=ch(1,ek,e),n={rooms:[]};return lh(n,t),n}function a7(e,t){const n=si(e,t);if(n===void 0)return ne();{const s=n,i=zs(e,t);if(i===void 0)return ne();{const c=i._1;return wt(vt(s.blocks,c._0),c._1)}}}function m_(e,t){const n=si(e,t);if(n!==void 0){const s=n,i=zs(e,t);if(i===void 0)ne();else{const c=i._1,l=wt(vt(s.blocks,c._0),c._1).occupant;let u;return l.$tag===4?u=!0:u=!1,!u}}return!0}function Cl(e,t){if(si(e,t)!==void 0)return 0;let o=999999;const s=e.rooms,i=s.length;let r=0;for(;;){const a=r;if(a<i){const l=s[a].index_position,u=l._0,_=l._1,$=t._0,d=t._1,p=$<u?u-$|0:$>=(u+9|0)?($-(u+9|0)|0)+1|0:0,b=d<_?_-d|0:d>=(_+9|0)?(d-(_+9|0)|0)+1|0:0,g=p>b?p:b;g<o&&(o=g),r=a+1|0;continue}else break}return o}function Xn(e,t){const n=$_(e,t),o=n._0,s=n._1;wt(vt(o.blocks,s._0),s._1).occupant=Cr}function f_(e,t,n){const o=$_(e,t),s=o._0,i=o._1;wt(vt(s.blocks,i._0),i._1).occupant=n}function uh(e){const t=e.index_position,n=t._0,o=t._1;XP(e.index_position,9);let s=0;for(;;){const i=s;if(i<9){let r=0;for(;;){const a=r;if(a<9){const c={_0:n+i|0,_1:o+a|0},l=wt(vt(e.blocks,i),a).occupant;switch(l.$tag){case 4:break;case 0:{const _=l._0;d_(_,_.id,c),Nn(_.id,_.now_health,_.enemy_base.health);break}case 1:{const _=l._0;VP(_,_.id,c),Nn(_.id,_.now_health,_.copper.attribute.health);break}case 3:{const _=l._0;sh(_,_.id,c);break}default:{const _=l._0;qP(_,_.id,c)}}r=a+1|0;continue}else break}s=i+1|0;continue}else return}}function c7(e){return((e/4|0)+1|0)>=6?6:(e/4|0)+1|0}function l7(){return{map:r7(sf({buf:ok,start:0,end:3}))}}function ts(e,t){if(t===0&&(fs(En,e)?Xa(e):fs(dr,e)?io(e):fs(xs,e)&&Ya(e)),t===1&&(fs(zt,e)||fs(dr,e)?io(e):fs(xs,e)&&Ya(e)),t===2)if(fs(zt,e)){io(e);return}else if(fs(dr,e)){io(e);return}else if(fs(En,e)){Xa(e);return}else return;else return}function u7(e){const t=l_(e),n=[{_0:"structure",_1:Zf(t)}],o=Ce({buf:n,start:0,end:1});nt(et,{type_msg:"handle_on_click_structure",content:Ze(new ke(o))})}function As(){const e=rn(zt);for(;;){const t=an(e);if(t===void 0)break;{const o=t;cn(o),ts(o,0);continue}}on(zt)}function Gs(){const e=rn(En);for(;;){const t=an(e);if(t===void 0)break;{const o=t;cn(o),ts(o,1);continue}}on(En)}function Rs(){const e=rn(xs);for(;;){const t=an(e);if(t===void 0)break;{const o=t;cn(o),ts(o,2);continue}}on(xs)}function Hc(e){switch(e.$tag){case 0:return e._0.position;case 1:return e._0.position;default:return e._0.position}}function _7(e,t){Gs(),As(),Rs();const n=l_(t),o=zP(n,e),s=o.length;let i=0;for(;;){const r=i;if(r<s){const a=o[r],c=Hc(a);io(c),as(zt,c),i=r+1|0;continue}else return}}function $7(){const e=rn(zt);for(;;){const t=an(e);if(t===void 0)break;{const o=t;cn(o),ts(o,0);continue}}on(zt)}function _h(e,t){if(Or(e.attribute.dodge/100))return!1;const n=e.attribute.defense,o=Math.fround(t/Math.fround(t+Math.fround(Math.fround(1)*n))),s=Math.fround(t*o);return e.now_health=Math.fround(e.now_health-s),Math.fround(e.now_health<=Math.fround(0))}function $h(e,t){if(e.now_health=Math.fround(e.now_health+t),Math.fround(e.now_health>e.attribute.health)){e.now_health=e.attribute.health;return}else return}function Fc(e,t){if(Or(e.enemy_base.dodge/100))return!1;const n=e.enemy_base.defense,o=Math.fround(t/Math.fround(t+Math.fround(Math.fround(1)*n))),s=Math.fround(t*o);return e.now_health=Math.fround(e.now_health-s),Math.fround(e.now_health<=Math.fround(0))}function h_(e){const t=[],n=e.enemy_base.drop_items,o=n.length;let s=0;for(;;){const i=s;if(i<o){const r=n[i],a=lo(r._1._0,r._1._1);Cx(t,PP(new Im(r._0),a)),s=i+1|0;continue}else break}return t}function d7(e,t,n){Zo(e);const o=l_(e),s=So(n,t);switch(s.$tag){case 0:{const c=s._0;Fc(c,o.structure_base.attribute.attack)?(a_(Et.val.bag,h_(c)),Ic(jn,c.id),cs(c.id),Xn(n,c.position)):Nn(c.id,c.now_health,c.enemy_base.health),o.can_attack=!1,pr(o);break}case 1:{const c=s._0;o.owned?$h(c,o.structure_base.attribute.attack):(_h(c,o.structure_base.attribute.attack)&&(Cf(yo,c.id),cs(c.id),Xn(n,c.position)),yo.size===0&&ih()),Nn(c.id,c.now_health,c.copper.attribute.health),o.can_attack=!1,pr(o);break}case 3:{const c=s._0;jc(c,o.structure_base.attribute.attack)?(Tc(Xs,c.id),cs(c.id),Xn(n,c.position)):Nn(c.id,c.now_health,c.structure_base.health),o.can_attack=!1,pr(o);break}case 4:break;default:Ts()}const i=rn(zt);for(;;){const a=an(i);if(a===void 0)break;{const l=a;cn(l),ts(l,0);continue}}on(zt);let r;if(s.$tag===4?r=!0:r=!1,!r){p_(e);return}}function xl(e,t,n){const o=e.copper_type;let s;switch(o){case 2:{s=!1;break}case 4:{s=!1;break}default:s=!0}const i=ni(Gi),r=e.copper_type;let a;r===4?a=!0:a=!1;const c=e.copper_type;let l;c===2?l=!0:l=!1;const u=e.attribute.health,_=e.attribute,$={id:i,original_id:t,copper:e,can_move:!0,can_attack:s,can_summon:a,can_build:l,position:n,now_health:u,attribute:_};return EC(yo,$.id,$),$}function Ms(e){u_(e.id),oh(e.id,e.can_move),__(e.id,e.can_attack),WP(e.id,e.can_summon),KP(e.id,e.can_build)}function p7(e){const t=Et.val.warehouse,n=xl(Sa(t,Do(e,0)),Do(e,0),ik),o=xl(Sa(t,Do(e,1)),Do(e,1),rk),s=xl(Sa(t,Do(e,2)),Do(e,2),ak);Tt.val=l7();const i=Tt.val;let r;i===void 0?r=ne():r=i;const a=r.map,c=b3(a.rooms,0);wt(vt(c.blocks,0),3).occupant=new xi(n),wt(vt(c.blocks,0),4).occupant=new xi(o),wt(vt(c.blocks,0),5).occupant=new xi(s),uh(c),qo(n.id,2),qo(o.id,2),qo(s.id,2),Ms(n),Ms(o),Ms(s)}function Za(e){e:switch(e){case 0:return 1;case 1:return 0;case 2:return 2;case 3:return 3;case 4:break e;case 5:break e;case 6:break e;default:break e}return EM()}function Qa(e,t){const n=t._0-e._0|0,o=t._1-e._1|0;return n!==0?n>0?2:3:o>0?0:1}function m7(){return Dx(Pf(yo))}function f7(e){const t=[],n=e.position,o=n._0,s=n._1,i=m7(),r=i.length;let a=0;for(;;){const p=a;if(p<r){const b=i[p];Sl(t,{_0:b.position,_1:new Ei(b)}),a=p+1|0;continue}else break}s_(jn)(p=>(p.id!==e.id&&p.owned&&Sl(t,{_0:p.position,_1:new Jo(p)}),1)),o_(Xs)(p=>(p.owned===!0&&Sl(t,{_0:p.position,_1:new Xo(p)}),1));let u=1e9,_;const $=t.length;let d=0;for(;;){const p=d;if(p<$){const b=t[p],g=b._0,m=g._0,v=g._1,y=b._1,w=m-o|0,k=w<0?-w|0:w,L=v-s|0,P=k+(L<0?-L|0:L)|0;P<u&&(u=P,_=y),d=p+1|0;continue}else break}return _}function g_(e,t){const n=e.enemy_base.attack_range,o=Oi(n),s=[],i=o.length;let r=0;for(;;){const a=r;if(a<i){const c=o[a],l={_0:e.position._0+c._0|0,_1:e.position._1+c._1|0};if(Vo(t,l)){const u=So(t,l);if(e.owned)switch(u.$tag){case 0:{const $=u._0;$.owned===!1&&kn(s,new Jo($));break}case 3:{const $=u._0;$.owned===!1&&kn(s,new Xo($));break}}else switch(u.$tag){case 1:{const $=u._0;kn(s,new Ei($));break}case 0:{const $=u._0;$.owned===!0&&kn(s,new Jo($));break}case 3:{const $=u._0;$.owned===!0&&kn(s,new Xo($));break}}}r=a+1|0;continue}else break}return s}function h7(e,t){const n=g_(t,e);if(n.length>0){const o=S3(n,0);switch(Zo(t.id),o.$tag){case 0:{const i=o._0;Fc(i,t.enemy_base.attack)?(Ic(jn,i.id),cs(i.id),Xn(e,i.position)):Nn(i.id,i.now_health,i.enemy_base.health);break}case 1:{const i=o._0;if(_h(i,t.enemy_base.attack)){const a=i.copper;a.live_left=a.live_left-1|0,Cf(yo,i.id),cs(i.id),Xn(e,i.position),yo.size===0&&ih()}else Nn(i.id,i.now_health,i.copper.attribute.health);break}default:{const i=o._0;jc(i,t.enemy_base.attack)?(Tc(Xs,i.id),cs(i.id),Xn(e,i.position)):Nn(i.id,i.now_health,i.structure_base.health)}}}else{const o=f7(t);if(o!==void 0){const r=Hc(o),a=n7(e),c=i7(a,t.position,r,t.enemy_base.speed,t.enemy_base.attack_range);if(c!==void 0){const u=c;Zo(t.id);const _=t.position;Xn(e,t.position),t.position=u,f_(e,t.position,new po(t)),qo(t.id,Za(Qa(_,u))),Ja(t.id,u)}}}return 1}function g7(){const e=Tt.val;let t;e===void 0?t=ne():t=e;const n=t.map;s_(jn)(s=>s.owned===!1?h7(n,s):1)}function b7(){const e=rn(zt);for(;;){const s=an(e);if(s===void 0)break;cn(s)}on(zt);const t=rn(En);for(;;){const s=an(t);if(s===void 0)break;cn(s)}on(En);const n=rn(dr);for(;;){const s=an(n);if(s===void 0)break;cn(s)}on(dr);const o=rn(xs);for(;;){const s=an(o);if(s===void 0)break;cn(s)}on(xs)}function Dr(e){if(u_(e.id),e.can_move&&oh(e.id,!0),e.can_attack){__(e.id,!0);return}else return}function y7(){Pf(yo)(o=>{o.can_move=!0;const s=o.copper.copper_type;let i;switch(s){case 2:{i=!1;break}case 4:{i=!1;break}default:i=!0}o.can_attack=i;const r=o.copper.copper_type;let a;r===4?a=!0:a=!1,o.can_summon=a;const c=o.copper.copper_type;let l;return c===2?l=!0:l=!1,o.can_build=l,Ms(o),1}),s_(jn)(o=>(o.owned&&(o.can_move=!0,o.can_attack=!0,Dr(o)),1)),o_(Xs)(o=>(o.owned&&(o.structure_base.can_attack&&(o.can_attack=!0),pr(o)),1))}function w7(){o_(Xs)(t=>{if(t.structure_base.name===""){const n=t.resource_type;if(n!==void 0){const s=n;oo(Et.val.bag.resources,s,2);const i={_0:"position",_1:yn(t.position)},r=R3(s),a={_0:"resource_type",_1:new Ae(r)},c=2,l=void 0,u=[i,a,{_0:"amount",_1:new Fr(c,l)}],_=Ce({buf:u,start:0,end:3});nt(et,{type_msg:"drill_resource_generate",content:Ze(new ke(_))})}}return 1})}function v7(){if(Or(.2)){const e=Tt.val;let t;e===void 0?t=ne():t=e;const o=t.map.rooms,s=o.length;let i=0;for(;;){const r=i;if(r<s){e:{const a=o[r];if(ZP(a))break e;const c=wt(vt(a.blocks,4),4).occupant;if(c.$tag===3&&c._0.structure_base.name===""){const _=a.level,$=ah(_),d=QP(a),p=y3(d,lo(0,d.length-1|0)),b={_0:a.index_position._0+p._0|0,_1:a.index_position._1+p._1|0},g=mr($,b,!1);wt(vt(a.blocks,p._0),p._1).occupant=new po(g),d_(g,g.id,b)}break e}i=r+1|0;continue}else return}}else return}function S7(){b7(),y7(),g7(),JP(),v7(),w7()}function k7(){Tt.val=void 0,Lr.val=!1,Ir.val=!1,Tr.val=!1}function M7(e){Gs(),As(),Rs();const t=qr(jn,e);let n;t===void 0?n=ne():n=t;const o=Tt.val;let s;o===void 0?s=ne():s=o;const i=s.map,a=g_(n,i).length!==0,c=[{_0:"enemy",_1:Yf(n)},{_0:"has_attack_targets",_1:xn(a)}],l=Ce({buf:c,start:0,end:2});nt(et,{type_msg:"handle_on_click_enemy",content:Ze(new ke(l))})}function C7(e,t){Gs(),As(),Rs();const n=qr(jn,t);let o;n===void 0?o=ne():o=n;const s=g_(o,e),i=s.length;let r=0;for(;;){const a=r;if(a<i){const c=s[a],l=Hc(c);io(l),as(zt,l),r=a+1|0;continue}else return}}function x7(){const e=rn(zt);for(;;){const t=an(e);if(t===void 0)break;{const o=t;cn(o),ts(o,0);continue}}on(zt)}function P7(e,t,n){Zo(e);const o=qr(jn,e);let s;o===void 0?s=ne():s=o;const i=So(n,t);switch(i.$tag){case 0:{const l=i._0;Fc(l,s.enemy_base.attack)?(a_(Et.val.bag,h_(l)),Ic(jn,l.id),cs(l.id),Xn(n,l.position),Lr.val===!0&&(l.enemy_base.name==="BOSS"?Ir.val=!0:l.enemy_base.name==="BOSS"&&(Tr.val=!0),Ir.val===!0&&Tr.val===!0&&rh())):Nn(l.id,l.now_health,l.enemy_base.health),s.can_attack=!1,Dr(s);break}case 3:{const l=i._0;jc(l,s.enemy_base.attack)?(Tc(Xs,l.id),cs(l.id),Xn(n,l.position)):Nn(l.id,l.now_health,l.structure_base.health),s.can_attack=!1,Dr(s);break}case 4:break;default:Ts()}const r=rn(zt);for(;;){const c=an(r);if(c===void 0)break;{const u=c;cn(u),ts(u,0);continue}}on(zt);let a;if(i.$tag===4?a=!0:a=!1,!a){p_(e);return}}function L7(e,t){const n=Oi(e.enemy_base.speed),o=[],s=n.length;let i=0;for(;;){const r=i;if(r<s){const a=n[r],c={_0:e.position._0+a._0|0,_1:e.position._1+a._1|0};m_(t,c)||vo(o,c),i=r+1|0;continue}else break}return o}function I7(e,t){Gs(),As(),Rs();const n=qr(jn,t);let o;n===void 0?o=ne():o=n;const s=L7(o,e),i=s.length;let r=0;for(;;){const a=r;if(a<i){const c=s[a];Xa(c),as(En,c),r=a+1|0;continue}else return}}function T7(){const e=rn(En);for(;;){const t=an(e);if(t===void 0)break;{const o=t;cn(o),ts(o,1);continue}}on(En)}function E7(e,t,n){Zo(e);const o=qr(jn,e);let s;if(o===void 0?s=ne():s=o,si(n,t)===void 0)Ts();else{const a=s.position,c=zs(n,a);let l;c===void 0?l=ne():l=c;const u=l._0,_=l._1,$=zs(n,t);let d;$===void 0?d=ne():d=$;const p=d._0,b=d._1;wt(vt(u.blocks,_._0),_._1).occupant=Cr,wt(vt(p.blocks,b._0),b._1).occupant=new po(s),s.position=t,qo(e,Za(Qa(a,t))),Ja(e,t)}s.can_move=!1,Dr(s);const r=rn(En);for(;;){const a=an(r);if(a===void 0)break;{const l=a;cn(l),ts(l,1);continue}}on(En)}function Ps(e){const t=KC(yo,e);return t===void 0?ne():t}function A7(e){const t=e.copper.copper_info.attack_range;if(t===void 0)switch(e.copper.copper_type){case 0:return 1;case 1:return 3;case 3:return 1;case 4:return 0;default:return 0}else return t}function dh(e,t){const n=A7(e),o=Oi(n),s=[],i=o.length;let r=0;for(;;){const a=r;if(a<i){const c=o[a],l={_0:e.position._0+c._0|0,_1:e.position._1+c._1|0};if(Vo(t,l)){const u=So(t,l);switch(u.$tag){case 1:{const $=u._0;$.copper.copper_type===3&&kn(s,new Ei($));break}case 3:{const $=u._0;$.owned===!1&&kn(s,new Xo($));break}case 0:{const $=u._0;$.owned===!1&&kn(s,new Jo($));break}}}r=a+1|0;continue}else break}return s}function G7(e){Gs(),As(),Rs();const t=Ps(e),n=Tt.val;let o;n===void 0?o=ne():o=n;const s=o.map,r=dh(t,s).length!==0,a=[{_0:"copper",_1:Xf(Ps(e))},{_0:"has_attack_targets",_1:xn(r)}],c=Ce({buf:a,start:0,end:2});nt(et,{type_msg:"handle_on_click_copper",content:Ze(new ke(c))}),Ms(t)}function R7(e,t){Gs(),As(),Rs();const n=Ps(t),o=dh(n,e),s=o.length;let i=0;for(;;){const r=i;if(r<s){const a=o[r],c=Hc(a);io(c),as(zt,c),i=r+1|0;continue}else return}}function O7(e,t,n){Zo(e);const o=Ps(e),s=So(n,t);switch(s.$tag){case 0:{const c=s._0;if(Fc(c,o.attribute.attack)){a_(Et.val.bag,h_(c)),Ic(jn,c.id),cs(c.id),Xn(n,c.position);const u=Tt.val;let _;u===void 0?_=ne():_=u;const $=_.map,d=So($,c.position);let p;switch(d.$tag){case 4:{p="Empty";break}case 0:{p="Enemy";break}default:p="Other"}Hf(`deeeebug${p}`),Lr.val===!0&&(c.enemy_base.name==="BOSS"?Ir.val=!0:c.enemy_base.name==="BOSS"&&(Tr.val=!0),Ir.val===!0&&Tr.val===!0&&rh())}else Nn(c.id,c.now_health,c.enemy_base.health);o.can_attack=!1,Ms(o);break}case 1:{const c=s._0;$h(c,o.attribute.attack),Nn(c.id,c.now_health,c.copper.attribute.health),o.can_attack=!1,Ms(o);break}case 3:{const c=s._0;jc(c,o.attribute.attack)?(Tc(Xs,c.id),cs(c.id),Xn(n,c.position)):Nn(c.id,c.now_health,c.structure_base.health),o.can_attack=!1,Ms(o);break}case 4:break;default:Ts()}const i=rn(zt);for(;;){const a=an(i);if(a===void 0)break;{const l=a;cn(l),ts(l,0);continue}}on(zt);let r;if(s.$tag===4?r=!0:r=!1,!r){p_(e);return}}function D7(e,t){const n=Oi(e.attribute.speed),o=[],s=n.length;let i=0;for(;;){const r=i;if(r<s){e:{const a=n[r],c={_0:e.position._0+a._0|0,_1:e.position._1+a._1|0};if(Cl(t,c)>1||Vo(t,c))break e;const u=a._0,_=a._1;if(u!==0&&_!==0){const $={_0:e.position._0+u|0,_1:e.position._1},d={_0:e.position._0,_1:e.position._1+_|0},p=Cl(t,$),b=Cl(t,d),g=p<=1&&!Vo(t,$),m=b<=1&&!Vo(t,d);if(!g&&!m)break e}vo(o,c);break e}i=r+1|0;continue}else break}return o}function N7(e,t){Gs(),As(),Rs();const n=Ps(t),o=D7(n,e),s=o.length;let i=0;for(;;){const r=i;if(r<s){const a=o[r];Xa(a),as(En,a),i=r+1|0;continue}else return}}function j7(e,t,n){Zo(e);const o=Ps(e);if(si(n,t)===void 0){const r=o.position,a=zs(n,r);let c;a===void 0?c=ne():c=a;const l=c._0,u=c._1,$=e7(l,t)._1,d=t._0-$._0|0,p=t._1-$._1|0,b=c7(n.rooms.length+1|0),m=ch(b,$,sf({buf:[{_0:d,_1:p}],start:0,end:1}));lh(n,m),wt(vt(l.blocks,u._0),u._1).occupant=Cr,wt(vt(m.blocks,d),p).occupant=new xi(o),uh(m),qo(e,Za(Qa(r,t))),o.position=t,Ja(e,t)}else{const r=o.position,a=zs(n,r);let c;a===void 0?c=ne():c=a;const l=c._0,u=c._1,_=zs(n,t);let $;_===void 0?$=ne():$=_;const d=$._0,p=$._1;wt(vt(l.blocks,u._0),u._1).occupant=Cr,wt(vt(d.blocks,p._0),p._1).occupant=new xi(o),o.position=t,qo(e,Za(Qa(r,t))),Ja(e,t)}o.can_move=!1,Ms(o);const i=rn(En);for(;;){const r=an(i);if(r===void 0)break;{const c=r;cn(c),ts(c,1);continue}}on(En)}function H7(e,t){const n=[],o=[ck,lk,uk,_k],s=o.length;let i=0;for(;;){const r=i;if(r<s){const a=o[r],c={_0:e.position._0+a._0|0,_1:e.position._1+a._1|0};m_(t,c)||vo(n,c),i=r+1|0;continue}else break}return n}function F7(e){Gs(),As(),Rs();const t=Ps(e),n=Tt.val;let o;n===void 0?o=ne():o=n;const s=o.map,i=H7(t,s),r=i.length;let a=0;for(;;){const c=a;if(c<r){const l=i[c];Ya(l),as(xs,l),a=c+1|0;continue}else return}}function U7(e,t,n,o){const s=qC(ru,o);let i;s===void 0?i=ne():i=s;const r=i.summon_cost,a=Ps(e);if(Dc(Et.val.bag.resources,r)){Nc(Et.val.bag.resources,r);const c=mr(i,t,!0);f_(n,t,new po(c)),d_(c,c.id,t),Dr(c),a.can_summon=!1,Ms(a);return}else{const c="",l=[{_0:"message",_1:new Ae(c)}],u=Ce({buf:l,start:0,end:1});nt(et,{type_msg:"resource_not_enough",content:Ze(new ke(u))});return}}function B7(){const e=[{_0:"contents",_1:bx(ja)}],t=Ce({buf:e,start:0,end:1});nt(et,{type_msg:"get_summon_menu",content:Ze(new ke(t))})}function z7(){const e=[{_0:"contents",_1:vx(iu)}],t=Ce({buf:e,start:0,end:1});nt(et,{type_msg:"get_structure_menu",content:Ze(new ke(t))})}function V7(e,t,n){const o=[],s=[$k,dk,pk,mk],i=s.length;let r=0;for(;;){const a=r;if(a<i){const c=s[a],l={_0:e.position._0+c._0|0,_1:e.position._1+c._1|0};n?Vo(t,l)&&a7(t,l).occupant.$tag===2&&vo(o,l):m_(t,l)||vo(o,l),r=a+1|0;continue}else break}return o}function q7(e,t){Gs(),As(),Rs();const n=Ps(e),o=Tt.val;let s;o===void 0?s=ne():s=o;const i=s.map,r=V7(n,i,t===""),a=r.length;let c=0;for(;;){const l=c;if(l<a){const u=r[l];Ya(u),as(xs,u),c=l+1|0;continue}else return}}function gu(){const e=rn(xs);for(;;){const t=an(e);if(t===void 0)break;{const o=t;cn(o),ts(o,2);continue}}on(xs)}function W7(e,t,n,o){const s=WC(Om,o);let i;s===void 0?i=ne():i=s;const r=i.cost,a=Ps(e);if(Dc(Et.val.bag.resources,r)){Nc(Et.val.bag.resources,r);let c;if(o===""){const u=So(n,t);if(u.$tag===2){const $=u._0;Xn(n,t),cs($.id),c=$.material_base.resource_type}else c=ne()}else c=void 0;const l=th(i,!0,c,t);f_(n,t,new Ju(l)),sh(l,l.id,t),a.can_build=!1,pr(l),gu();return}else{const c="",l=[{_0:"message",_1:new Ae(c)}],u=Ce({buf:l,start:0,end:1});nt(et,{type_msg:"resource_not_enough",content:Ze(new ke(u))}),gu();return}}function ot(e){e:{const t=va(e);let n;t===void 0?n=ne():n=t;const o=VM({str:n,start:0,end:n.length});if(o.$tag===1)return o._0;o._0;break e}return ne()}function K7(e){let t;e:{t:{const n=Jm({str:e,start:0,end:e.length},1024);if(n.$tag===1)t=n._0;else{n._0;break t}break e}t=ne()}e:if(t.$tag===6){const o=t._0,s=re(o,"type");if(s===void 0)break e;{const r=s;if(r.$tag===4)switch(r._0){case"on_click_copper":{const l=re(o,"content");if(l===void 0)break e;{const _=l;if(_.$tag===6){const d=_._0,p=re(d,"id");if(p===void 0)break e;G7(ot(p));return}else break e}}case"on_attack_start":{const l=re(o,"content");if(l===void 0)break e;{const _=l;if(_.$tag===6){const d=_._0,p=re(d,"id");if(p===void 0)break e;{const g=p,m=Tt.val;let v;m===void 0?v=ne():v=m,R7(v.map,ot(g));return}}else break e}}case"on_attack_end":{As();return}case"on_attack_apply":{const l=re(o,"content");if(l===void 0)break e;{const _=l;if(_.$tag===6){const d=_._0,p=re(d,"id");if(p===void 0)break e;{const g=p,m=re(d,"position");if(m===void 0)break e;{const y=m;if(y.$tag===6){const k=y._0,L=re(k,"x");if(L===void 0)break e;{const G=L,I=re(k,"y");if(I===void 0)break e;{const R=I,M=ot(g),B={_0:ot(G),_1:ot(R)},de=Tt.val;let oe;de===void 0?oe=ne():oe=de,O7(M,B,oe.map);return}}}else break e}}}else break e}}case"on_move_start":{const l=re(o,"content");if(l===void 0)break e;{const _=l;if(_.$tag===6){const d=_._0,p=re(d,"id");if(p===void 0)break e;{const g=p,m=Tt.val;let v;m===void 0?v=ne():v=m,N7(v.map,ot(g));return}}else break e}}case"on_move_end":{Gs();return}case"on_move_apply":{const l=re(o,"content");if(l===void 0)break e;{const _=l;if(_.$tag===6){const d=_._0,p=re(d,"id");if(p===void 0)break e;{const g=p,m=re(d,"position");if(m===void 0)break e;{const y=m;if(y.$tag===6){const k=y._0,L=re(k,"x");if(L===void 0)break e;{const G=L,I=re(k,"y");if(I===void 0)break e;{const R=I,M=ot(g),B={_0:ot(G),_1:ot(R)},de=Tt.val;let oe;de===void 0?oe=ne():oe=de,j7(M,B,oe.map);return}}}else break e}}}else break e}}case"on_game_start":{const l=re(o,"content");if(l===void 0)break e;{const _=l;if(_.$tag===6){const d=_._0,p=re(d,"ids");if(p===void 0)break e;{const m=lf(Xm(p)),v=new Array(m.length),y=m.length;let w=0;for(;;){const k=w;if(k<y){const L=m[k];v[k]=ot(L),w=k+1|0;continue}else break}p7(v);return}}else break e}}case"on_game_round_pass":{S7();return}case"on_click_enemy":{const l=re(o,"content");if(l===void 0)break e;{const _=l;if(_.$tag===6){const d=_._0,p=re(d,"id");if(p===void 0)break e;M7(ot(p));return}else break e}}case"on_enemy_attack_start":{const l=re(o,"content");if(l===void 0)break e;{const _=l;if(_.$tag===6){const d=_._0,p=re(d,"id");if(p===void 0)break e;{const g=p,m=Tt.val;let v;m===void 0?v=ne():v=m,C7(v.map,ot(g));return}}else break e}}case"on_enemy_attack_end":{x7();return}case"on_enemy_attack_apply":{const l=re(o,"content");if(l===void 0)break e;{const _=l;if(_.$tag===6){const d=_._0,p=re(d,"id");if(p===void 0)break e;{const g=p,m=re(d,"position");if(m===void 0)break e;{const y=m;if(y.$tag===6){const k=y._0,L=re(k,"x");if(L===void 0)break e;{const G=L,I=re(k,"y");if(I===void 0)break e;{const R=I,M=ot(g),B={_0:ot(G),_1:ot(R)},de=Tt.val;let oe;de===void 0?oe=ne():oe=de,P7(M,B,oe.map);return}}}else break e}}}else break e}}case"on_enemy_move_start":{const l=re(o,"content");if(l===void 0)break e;{const _=l;if(_.$tag===6){const d=_._0,p=re(d,"id");if(p===void 0)break e;{const g=p,m=Tt.val;let v;m===void 0?v=ne():v=m,I7(v.map,ot(g));return}}else break e}}case"on_enemy_move_end":{T7();return}case"on_enemy_move_apply":{const l=re(o,"content");if(l===void 0)break e;{const _=l;if(_.$tag===6){const d=_._0,p=re(d,"id");if(p===void 0)break e;{const g=p,m=re(d,"position");if(m===void 0)break e;{const y=m;if(y.$tag===6){const k=y._0,L=re(k,"x");if(L===void 0)break e;{const G=L,I=re(k,"y");if(I===void 0)break e;{const R=I,M=ot(g),B={_0:ot(G),_1:ot(R)},de=Tt.val;let oe;de===void 0?oe=ne():oe=de,E7(M,B,oe.map);return}}}else break e}}}else break e}}case"on_get_summon_menu":{B7();return}case"on_summon_start":{const l=re(o,"content");if(l===void 0)break e;{const _=l;if(_.$tag===6){const d=_._0,p=re(d,"id");if(p===void 0)break e;F7(ot(p));return}else break e}}case"on_summon_apply":{const l=re(o,"content");if(l===void 0)break e;{const _=l;if(_.$tag===6){const d=_._0,p=re(d,"id");if(p===void 0)break e;{const g=p,m=re(d,"position");if(m===void 0)break e;{const y=m;if(y.$tag===6){const k=y._0,L=re(k,"x");if(L===void 0)break e;{const G=L,I=re(k,"y");if(I===void 0)break e;{const R=I,M=re(d,"name");if(M===void 0)break e;{const de=M,oe=ot(g),be={_0:ot(G),_1:ot(R)},K=Tt.val;let A;K===void 0?A=ne():A=K;const Q=A.map,F=va(de);let D;F===void 0?D=ne():D=F,U7(oe,be,Q,D);return}}}}else break e}}}else break e}}case"on_summon_end":{Rs();return}case"on_click_structure":{const l=re(o,"content");if(l===void 0)break e;{const _=l;if(_.$tag===6){const d=_._0,p=re(d,"id");if(p===void 0)break e;u7(ot(p));return}else break e}}case"on_get_structure_menu":{z7();return}case"on_structure_build_start":{const l=re(o,"content");if(l===void 0)break e;{const _=l;if(_.$tag===6){const d=_._0,p=re(d,"id");if(p===void 0)break e;{const g=p,m=re(d,"name");if(m===void 0)break e;{const y=m,w=ot(g),k=va(y);let L;k===void 0?L=ne():L=k,q7(w,L);return}}}else break e}}case"on_structure_build_apply":{const l=re(o,"content");if(l===void 0)break e;{const _=l;if(_.$tag===6){const d=_._0,p=re(d,"id");if(p===void 0)break e;{const g=p,m=re(d,"position");if(m===void 0)break e;{const y=m;if(y.$tag===6){const k=y._0,L=re(k,"x");if(L===void 0)break e;{const G=L,I=re(k,"y");if(I===void 0)break e;{const R=I,M=re(d,"name");if(M===void 0)break e;{const de=M,oe=ot(g),be={_0:ot(G),_1:ot(R)},K=Tt.val;let A;K===void 0?A=ne():A=K;const Q=A.map,F=va(de);let D;F===void 0?D=ne():D=F,W7(oe,be,Q,D);return}}}}else break e}}}else break e}}case"on_structure_build_end":{gu();return}case"on_structure_attack_start":{const l=re(o,"content");if(l===void 0)break e;{const _=l;if(_.$tag===6){const d=_._0,p=re(d,"id");if(p===void 0)break e;{const g=p,m=Tt.val;let v;m===void 0?v=ne():v=m,_7(v.map,ot(g));return}}else break e}}case"on_structure_attack_end":{$7();return}case"on_structure_attack_apply":{const l=re(o,"content");if(l===void 0)break e;{const _=l;if(_.$tag===6){const d=_._0,p=re(d,"id");if(p===void 0)break e;{const g=p,m=re(d,"position");if(m===void 0)break e;{const y=m;if(y.$tag===6){const k=y._0,L=re(k,"x");if(L===void 0)break e;{const G=L,I=re(k,"y");if(I===void 0)break e;{const R=I,M=ot(g),B={_0:ot(G),_1:ot(R)},de=Tt.val;let oe;de===void 0?oe=ne():oe=de,d7(M,B,oe.map);return}}}else break e}}}else break e}}case"on_game_over":{k7();return}default:break e}else break e}}else break e;Ts()}function J7(e){const t=Jf(e),n=new Array(t.length),o=t.length;let s=0;for(;;){const i=s;if(i<o){const r=t[i];n[i]=Oc(r),s=i+1|0;continue}else break}return gx(n)}function X7(){const e={_0:"warehouse",_1:J7(Et.val.warehouse)},t=[{_0:"SpiritalSpark",_1:Oe(An(Et.val.bag.resources,2))},{_0:"RecallGear",_1:Oe(An(Et.val.bag.resources,1))},{_0:"ResonantCrystal",_1:Oe(An(Et.val.bag.resources,4))},{_0:"RefinedCopper",_1:Oe(An(Et.val.bag.resources,3))},{_0:"HeartCrystalDust",_1:Oe(An(Et.val.bag.resources,0))}],n=Ce({buf:t,start:0,end:5}),o=[{_0:"resources",_1:new ke(n)},{_0:"equipments",_1:hx(Et.val.bag.equipments)}],s=Ce({buf:o,start:0,end:2}),i=[e,{_0:"bag",_1:new ke(s)}],r=Ce({buf:i,start:0,end:2});return Ze(new ke(r))}function Y7(e){let t=IP();if(e.$tag===5){const o=e._0,s=o.length;let i=0;for(;;){const r=i;if(r<s){const a=o[r];let c;e:{t:{const l=H6(a);if(l.$tag===1)c=l._0;else{l._0;break t}break e}c=ne()}t=c_(t,c),i=r+1|0;continue}else break}return t}else return ne()}function Z7(e){const t=Ym(e);let n;t===void 0?n=ne():n=t;const o=MP(),s=xf(n);for(;;){const i=Lf(s);if(i===void 0)break;{const a=i,c=a._0,l=a._1;switch(c){case"SpiritalSpark":{oo(o,2,fi(qi(Vi(l))));break}case"RecallGear":{oo(o,1,fi(qi(Vi(l))));break}case"ResonantCrystal":{oo(o,4,fi(qi(Vi(l))));break}case"RefinedCopper":{oo(o,3,fi(qi(Vi(l))));break}case"HeartCrystalDust":{oo(o,0,fi(qi(Vi(l))));break}}continue}}return o}function Q7(e){if(e.$tag===6){const n=e._0,o=Z7(Va(n,"resources")),s=lf(Xm(Va(n,"equipments"))),i=new Array(s.length),r=s.length;let a=0;for(;;){const l=a;if(l<r){const u=s[l];let _;e:{t:{const $=F6(u);if($.$tag===1)_=$._0;else{$._0;break t}break e}_=ne()}i[l]=_,a=l+1|0;continue}else break}return xP(o,i)}else return ne()}function eL(e){let t;e:{t:{const i=Jm({str:e,start:0,end:e.length},1024);let r;if(i.$tag===1)r=i._0;else{i._0;break t}const a=Ym(r);a===void 0?t=ne():t=a;break e}t=ne()}const n=Y7(Va(t,"warehouse")),o=Q7(Va(t,"bag")),s=RP(n,o);Et.val=s}function tL(){return OP(Et.val)}function nL(){return HP(Et.val)}function sL(){return DP(Et.val)}function oL(){return NP(Et.val)}function iL(e){return jP(Et.val,e)}function rL(e){dP(et,e)}function aL(e){eL(e)}function cL(){return X7()}function lL(e){K7(e)}_1();function uL(){return JSON.parse(oL())}function Uc(){return JSON.parse(tL())}function _L(){return JSON.parse(nL())}function ka(){return JSON.parse(sL())}function $L(e){return JSON.parse(iL(e))}function ph(e){rL(t=>{const n=JSON.parse(t);e(n),Fe.enqueue(n)})}function dL(e){aL(e)}function pL(){return JSON.parse(cL())}function Ue(e){lL(e)}const mL={class:"draw-screen"},fL={class:"draw-screen__body"},hL={class:"draw-card"},gL={class:"card-face card-back"},bL=["src"],yL={class:"card-face card-front"},wL=["src"],vL={key:1,class:"card-icon"},SL=["src"],kL={class:"draw-cost"},ML=["src"],CL=["disabled","title"],xL={key:0,class:"toast"},PL={__name:"DrawScreen",emits:["draw"],setup(e,{emit:t}){const n=t,o=se(!1),s=se(!0),i=se(!1),r=se(""),a=se(""),c=se(""),l=se({left:0,top:0,width:0,height:0}),u=se(!1),_=se(!1),$=se(!1),d=se("");function p(v){d.value=v||"",$.value=!0,setTimeout(()=>{$.value=!1},1800)}async function b(){try{const y=Uc(),w=Number((y==null?void 0:y.SpiritalSpark)??0);s.value=w>=10}catch{s.value=!1}}function g(){i.value=!1,u.value=!1,_.value=!1}function m(){if(o.value)return;if(b(),!s.value){p("");return}o.value=!0,f("[DrawScreen] runDrawSequence start");const v=document.querySelector(".draw-card");if(v){v.classList.add("is-shaking"),setTimeout(()=>v.classList.remove("is-shaking"),500);const y=v.getBoundingClientRect();l.value={left:Math.round(y.left),top:Math.round(y.top),width:Math.round(y.width),height:Math.round(y.height)}}setTimeout(async()=>{i.value=!0,u.value=!1,_.value=!0;try{const y=uL();if(y&&y.type==="success"&&y.copper&&y.copper.copper_info){const w=y.copper.copper_info;r.value=w.name||"",a.value="",c.value=ee(w.icon_url||""),f("[DrawScreen] tempImage resolved:",c.value),await br(),setTimeout(()=>{_.value=!1,setTimeout(()=>{u.value=!0},350)},450),n("draw",{name:w.name,image:w.icon_url||""}),b()}else y&&y.type==="error"&&(i.value=!1,u.value=!1,_.value=!1,p(y.content||""),n("draw",{error:!0}),b())}catch{i.value=!1,u.value=!1,_.value=!1,p(""),n("draw",{error:!0}),b()}finally{setTimeout(()=>{o.value=!1},800)}},600)}return(v,y)=>(W(),te("div",mL,[h("div",fL,[h("div",hL,[i.value?(W(),te("div",{key:0,class:"draw-temp",onClick:g},[y[3]||(y[3]=h("div",{class:"dim-backdrop"},null,-1)),h("div",{class:"temp-stack",style:zn({left:l.value.left+"px",top:l.value.top+"px",width:l.value.width+"px",height:l.value.height+"px"}),onClick:y[2]||(y[2]=Bs(()=>{},["stop"]))},[h("div",{class:St(["card",{flipped:_.value}]),onClick:y[0]||(y[0]=Bs(w=>_.value=!_.value,["stop"]))},[h("div",gL,[h("img",{src:we(ee)("frontend_resource/gacha.webp"),alt:"back"},null,8,bL)]),h("div",yL,[c.value?(W(),te("img",{key:0,src:c.value,alt:"copper",class:"card-front-img"},null,8,wL)):(W(),te("div",vL,ae(a.value||""),1))])],2),h("div",{class:St(["card-name-below",{show:u.value}]),onClick:y[1]||(y[1]=Bs(()=>{},["stop"]))},ae(r.value),3)],4)])):Ie("",!0),h("img",{class:"draw-card__img",src:we(ee)("frontend_resource/gacha.webp"),alt:"card"},null,8,SL)]),h("div",kL,[h("img",{class:"draw-cost__icon",src:we(ee)("resource/spiritual_spark.webp"),alt:"cost"},null,8,ML),y[4]||(y[4]=h("span",{class:"draw-cost__times"},"X 10",-1))]),h("button",{class:"draw-action",disabled:o.value||!s.value,title:s.value?"":"",onClick:m},"  ",8,CL),$.value?(W(),te("div",xL,ae(d.value),1)):Ie("",!0)])]))}},LL=Vt(PL,[["__scopeId","data-v-b6bb0732"]]);function sd(e,t){if(t===Wh)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),e;if(t===Gl||t===hd){let n=e.getIndex();if(n===null){const r=[],a=e.getAttribute("position");if(a!==void 0){for(let c=0;c<a.count;c++)r.push(c);e.setIndex(r),n=e.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e}const o=n.count-2,s=[];if(t===Gl)for(let r=1;r<=o;r++)s.push(n.getX(0)),s.push(n.getX(r)),s.push(n.getX(r+1));else for(let r=0;r<o;r++)r%2===0?(s.push(n.getX(r)),s.push(n.getX(r+1)),s.push(n.getX(r+2))):(s.push(n.getX(r+2)),s.push(n.getX(r+1)),s.push(n.getX(r)));s.length/3!==o&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const i=e.clone();return i.setIndex(s),i.clearGroups(),i}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",t),e}class Bc extends gd{constructor(t){super(t),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(n){return new GL(n)}),this.register(function(n){return new RL(n)}),this.register(function(n){return new zL(n)}),this.register(function(n){return new VL(n)}),this.register(function(n){return new qL(n)}),this.register(function(n){return new DL(n)}),this.register(function(n){return new NL(n)}),this.register(function(n){return new jL(n)}),this.register(function(n){return new HL(n)}),this.register(function(n){return new AL(n)}),this.register(function(n){return new FL(n)}),this.register(function(n){return new OL(n)}),this.register(function(n){return new BL(n)}),this.register(function(n){return new UL(n)}),this.register(function(n){return new TL(n)}),this.register(function(n){return new WL(n)}),this.register(function(n){return new KL(n)})}load(t,n,o,s){const i=this;let r;if(this.resourcePath!=="")r=this.resourcePath;else if(this.path!==""){const l=tr.extractUrlBase(t);r=tr.resolveURL(l,this.path)}else r=tr.extractUrlBase(t);this.manager.itemStart(t);const a=function(l){s?s(l):console.error(l),i.manager.itemError(t),i.manager.itemEnd(t)},c=new Ma(this.manager);c.setPath(this.path),c.setResponseType("arraybuffer"),c.setRequestHeader(this.requestHeader),c.setWithCredentials(this.withCredentials),c.load(t,function(l){try{i.parse(l,r,function(u){n(u),i.manager.itemEnd(t)},a)}catch(u){a(u)}},o,a)}setDRACOLoader(t){return this.dracoLoader=t,this}setKTX2Loader(t){return this.ktx2Loader=t,this}setMeshoptDecoder(t){return this.meshoptDecoder=t,this}register(t){return this.pluginCallbacks.indexOf(t)===-1&&this.pluginCallbacks.push(t),this}unregister(t){return this.pluginCallbacks.indexOf(t)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(t),1),this}parse(t,n,o,s){let i;const r={},a={},c=new TextDecoder;if(typeof t=="string")i=JSON.parse(t);else if(t instanceof ArrayBuffer)if(c.decode(new Uint8Array(t,0,4))===mh){try{r[Qe.KHR_BINARY_GLTF]=new JL(t)}catch(_){s&&s(_);return}i=JSON.parse(r[Qe.KHR_BINARY_GLTF].content)}else i=JSON.parse(c.decode(t));else i=t;if(i.asset===void 0||i.asset.version[0]<2){s&&s(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const l=new cI(i,{path:n||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let u=0;u<this.pluginCallbacks.length;u++){const _=this.pluginCallbacks[u](l);_.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),a[_.name]=_,r[_.name]=!0}if(i.extensionsUsed)for(let u=0;u<i.extensionsUsed.length;++u){const _=i.extensionsUsed[u],$=i.extensionsRequired||[];switch(_){case Qe.KHR_MATERIALS_UNLIT:r[_]=new EL;break;case Qe.KHR_DRACO_MESH_COMPRESSION:r[_]=new XL(i,this.dracoLoader);break;case Qe.KHR_TEXTURE_TRANSFORM:r[_]=new YL;break;case Qe.KHR_MESH_QUANTIZATION:r[_]=new ZL;break;default:$.indexOf(_)>=0&&a[_]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+_+'".')}}l.setExtensions(r),l.setPlugins(a),l.parse(o,s)}parseAsync(t,n){const o=this;return new Promise(function(s,i){o.parse(t,n,s,i)})}}function IL(){let e={};return{get:function(t){return e[t]},add:function(t,n){e[t]=n},remove:function(t){delete e[t]},removeAll:function(){e={}}}}const Qe={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class TL{constructor(t){this.parser=t,this.name=Qe.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const t=this.parser,n=this.parser.json.nodes||[];for(let o=0,s=n.length;o<s;o++){const i=n[o];i.extensions&&i.extensions[this.name]&&i.extensions[this.name].light!==void 0&&t._addNodeRef(this.cache,i.extensions[this.name].light)}}_loadLight(t){const n=this.parser,o="light:"+t;let s=n.cache.get(o);if(s)return s;const i=n.json,c=((i.extensions&&i.extensions[this.name]||{}).lights||[])[t];let l;const u=new ls(16777215);c.color!==void 0&&u.setRGB(c.color[0],c.color[1],c.color[2],Cs);const _=c.range!==void 0?c.range:0;switch(c.type){case"directional":l=new vs(u),l.target.position.set(0,0,-1),l.add(l.target);break;case"point":l=new hi(u),l.distance=_;break;case"spot":l=new Kh(u),l.distance=_,c.spot=c.spot||{},c.spot.innerConeAngle=c.spot.innerConeAngle!==void 0?c.spot.innerConeAngle:0,c.spot.outerConeAngle=c.spot.outerConeAngle!==void 0?c.spot.outerConeAngle:Math.PI/4,l.angle=c.spot.outerConeAngle,l.penumbra=1-c.spot.innerConeAngle/c.spot.outerConeAngle,l.target.position.set(0,0,-1),l.add(l.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+c.type)}return l.position.set(0,0,0),gs(l,c),c.intensity!==void 0&&(l.intensity=c.intensity),l.name=n.createUniqueName(c.name||"light_"+t),s=Promise.resolve(l),n.cache.add(o,s),s}getDependency(t,n){if(t==="light")return this._loadLight(n)}createNodeAttachment(t){const n=this,o=this.parser,i=o.json.nodes[t],a=(i.extensions&&i.extensions[this.name]||{}).light;return a===void 0?null:this._loadLight(a).then(function(c){return o._getNodeRef(n.cache,a,c)})}}class EL{constructor(){this.name=Qe.KHR_MATERIALS_UNLIT}getMaterialType(){return Bt}extendParams(t,n,o){const s=[];t.color=new ls(1,1,1),t.opacity=1;const i=n.pbrMetallicRoughness;if(i){if(Array.isArray(i.baseColorFactor)){const r=i.baseColorFactor;t.color.setRGB(r[0],r[1],r[2],Cs),t.opacity=r[3]}i.baseColorTexture!==void 0&&s.push(o.assignTexture(t,"map",i.baseColorTexture,nn))}return Promise.all(s)}}class AL{constructor(t){this.parser=t,this.name=Qe.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(t,n){const s=this.parser.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=s.extensions[this.name].emissiveStrength;return i!==void 0&&(n.emissiveIntensity=i),Promise.resolve()}}class GL{constructor(t){this.parser=t,this.name=Qe.KHR_MATERIALS_CLEARCOAT}getMaterialType(t){const o=this.parser.json.materials[t];return!o.extensions||!o.extensions[this.name]?null:Ls}extendMaterialParams(t,n){const o=this.parser,s=o.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=[],r=s.extensions[this.name];if(r.clearcoatFactor!==void 0&&(n.clearcoat=r.clearcoatFactor),r.clearcoatTexture!==void 0&&i.push(o.assignTexture(n,"clearcoatMap",r.clearcoatTexture)),r.clearcoatRoughnessFactor!==void 0&&(n.clearcoatRoughness=r.clearcoatRoughnessFactor),r.clearcoatRoughnessTexture!==void 0&&i.push(o.assignTexture(n,"clearcoatRoughnessMap",r.clearcoatRoughnessTexture)),r.clearcoatNormalTexture!==void 0&&(i.push(o.assignTexture(n,"clearcoatNormalMap",r.clearcoatNormalTexture)),r.clearcoatNormalTexture.scale!==void 0)){const a=r.clearcoatNormalTexture.scale;n.clearcoatNormalScale=new $n(a,a)}return Promise.all(i)}}class RL{constructor(t){this.parser=t,this.name=Qe.KHR_MATERIALS_DISPERSION}getMaterialType(t){const o=this.parser.json.materials[t];return!o.extensions||!o.extensions[this.name]?null:Ls}extendMaterialParams(t,n){const s=this.parser.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=s.extensions[this.name];return n.dispersion=i.dispersion!==void 0?i.dispersion:0,Promise.resolve()}}class OL{constructor(t){this.parser=t,this.name=Qe.KHR_MATERIALS_IRIDESCENCE}getMaterialType(t){const o=this.parser.json.materials[t];return!o.extensions||!o.extensions[this.name]?null:Ls}extendMaterialParams(t,n){const o=this.parser,s=o.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=[],r=s.extensions[this.name];return r.iridescenceFactor!==void 0&&(n.iridescence=r.iridescenceFactor),r.iridescenceTexture!==void 0&&i.push(o.assignTexture(n,"iridescenceMap",r.iridescenceTexture)),r.iridescenceIor!==void 0&&(n.iridescenceIOR=r.iridescenceIor),n.iridescenceThicknessRange===void 0&&(n.iridescenceThicknessRange=[100,400]),r.iridescenceThicknessMinimum!==void 0&&(n.iridescenceThicknessRange[0]=r.iridescenceThicknessMinimum),r.iridescenceThicknessMaximum!==void 0&&(n.iridescenceThicknessRange[1]=r.iridescenceThicknessMaximum),r.iridescenceThicknessTexture!==void 0&&i.push(o.assignTexture(n,"iridescenceThicknessMap",r.iridescenceThicknessTexture)),Promise.all(i)}}class DL{constructor(t){this.parser=t,this.name=Qe.KHR_MATERIALS_SHEEN}getMaterialType(t){const o=this.parser.json.materials[t];return!o.extensions||!o.extensions[this.name]?null:Ls}extendMaterialParams(t,n){const o=this.parser,s=o.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=[];n.sheenColor=new ls(0,0,0),n.sheenRoughness=0,n.sheen=1;const r=s.extensions[this.name];if(r.sheenColorFactor!==void 0){const a=r.sheenColorFactor;n.sheenColor.setRGB(a[0],a[1],a[2],Cs)}return r.sheenRoughnessFactor!==void 0&&(n.sheenRoughness=r.sheenRoughnessFactor),r.sheenColorTexture!==void 0&&i.push(o.assignTexture(n,"sheenColorMap",r.sheenColorTexture,nn)),r.sheenRoughnessTexture!==void 0&&i.push(o.assignTexture(n,"sheenRoughnessMap",r.sheenRoughnessTexture)),Promise.all(i)}}class NL{constructor(t){this.parser=t,this.name=Qe.KHR_MATERIALS_TRANSMISSION}getMaterialType(t){const o=this.parser.json.materials[t];return!o.extensions||!o.extensions[this.name]?null:Ls}extendMaterialParams(t,n){const o=this.parser,s=o.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=[],r=s.extensions[this.name];return r.transmissionFactor!==void 0&&(n.transmission=r.transmissionFactor),r.transmissionTexture!==void 0&&i.push(o.assignTexture(n,"transmissionMap",r.transmissionTexture)),Promise.all(i)}}class jL{constructor(t){this.parser=t,this.name=Qe.KHR_MATERIALS_VOLUME}getMaterialType(t){const o=this.parser.json.materials[t];return!o.extensions||!o.extensions[this.name]?null:Ls}extendMaterialParams(t,n){const o=this.parser,s=o.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=[],r=s.extensions[this.name];n.thickness=r.thicknessFactor!==void 0?r.thicknessFactor:0,r.thicknessTexture!==void 0&&i.push(o.assignTexture(n,"thicknessMap",r.thicknessTexture)),n.attenuationDistance=r.attenuationDistance||1/0;const a=r.attenuationColor||[1,1,1];return n.attenuationColor=new ls().setRGB(a[0],a[1],a[2],Cs),Promise.all(i)}}class HL{constructor(t){this.parser=t,this.name=Qe.KHR_MATERIALS_IOR}getMaterialType(t){const o=this.parser.json.materials[t];return!o.extensions||!o.extensions[this.name]?null:Ls}extendMaterialParams(t,n){const s=this.parser.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=s.extensions[this.name];return n.ior=i.ior!==void 0?i.ior:1.5,Promise.resolve()}}class FL{constructor(t){this.parser=t,this.name=Qe.KHR_MATERIALS_SPECULAR}getMaterialType(t){const o=this.parser.json.materials[t];return!o.extensions||!o.extensions[this.name]?null:Ls}extendMaterialParams(t,n){const o=this.parser,s=o.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=[],r=s.extensions[this.name];n.specularIntensity=r.specularFactor!==void 0?r.specularFactor:1,r.specularTexture!==void 0&&i.push(o.assignTexture(n,"specularIntensityMap",r.specularTexture));const a=r.specularColorFactor||[1,1,1];return n.specularColor=new ls().setRGB(a[0],a[1],a[2],Cs),r.specularColorTexture!==void 0&&i.push(o.assignTexture(n,"specularColorMap",r.specularColorTexture,nn)),Promise.all(i)}}class UL{constructor(t){this.parser=t,this.name=Qe.EXT_MATERIALS_BUMP}getMaterialType(t){const o=this.parser.json.materials[t];return!o.extensions||!o.extensions[this.name]?null:Ls}extendMaterialParams(t,n){const o=this.parser,s=o.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=[],r=s.extensions[this.name];return n.bumpScale=r.bumpFactor!==void 0?r.bumpFactor:1,r.bumpTexture!==void 0&&i.push(o.assignTexture(n,"bumpMap",r.bumpTexture)),Promise.all(i)}}class BL{constructor(t){this.parser=t,this.name=Qe.KHR_MATERIALS_ANISOTROPY}getMaterialType(t){const o=this.parser.json.materials[t];return!o.extensions||!o.extensions[this.name]?null:Ls}extendMaterialParams(t,n){const o=this.parser,s=o.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=[],r=s.extensions[this.name];return r.anisotropyStrength!==void 0&&(n.anisotropy=r.anisotropyStrength),r.anisotropyRotation!==void 0&&(n.anisotropyRotation=r.anisotropyRotation),r.anisotropyTexture!==void 0&&i.push(o.assignTexture(n,"anisotropyMap",r.anisotropyTexture)),Promise.all(i)}}class zL{constructor(t){this.parser=t,this.name=Qe.KHR_TEXTURE_BASISU}loadTexture(t){const n=this.parser,o=n.json,s=o.textures[t];if(!s.extensions||!s.extensions[this.name])return null;const i=s.extensions[this.name],r=n.options.ktx2Loader;if(!r){if(o.extensionsRequired&&o.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return n.loadTextureImage(t,i.source,r)}}class VL{constructor(t){this.parser=t,this.name=Qe.EXT_TEXTURE_WEBP}loadTexture(t){const n=this.name,o=this.parser,s=o.json,i=s.textures[t];if(!i.extensions||!i.extensions[n])return null;const r=i.extensions[n],a=s.images[r.source];let c=o.textureLoader;if(a.uri){const l=o.options.manager.getHandler(a.uri);l!==null&&(c=l)}return o.loadTextureImage(t,r.source,c)}}class qL{constructor(t){this.parser=t,this.name=Qe.EXT_TEXTURE_AVIF}loadTexture(t){const n=this.name,o=this.parser,s=o.json,i=s.textures[t];if(!i.extensions||!i.extensions[n])return null;const r=i.extensions[n],a=s.images[r.source];let c=o.textureLoader;if(a.uri){const l=o.options.manager.getHandler(a.uri);l!==null&&(c=l)}return o.loadTextureImage(t,r.source,c)}}class WL{constructor(t){this.name=Qe.EXT_MESHOPT_COMPRESSION,this.parser=t}loadBufferView(t){const n=this.parser.json,o=n.bufferViews[t];if(o.extensions&&o.extensions[this.name]){const s=o.extensions[this.name],i=this.parser.getDependency("buffer",s.buffer),r=this.parser.options.meshoptDecoder;if(!r||!r.supported){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return i.then(function(a){const c=s.byteOffset||0,l=s.byteLength||0,u=s.count,_=s.byteStride,$=new Uint8Array(a,c,l);return r.decodeGltfBufferAsync?r.decodeGltfBufferAsync(u,_,$,s.mode,s.filter).then(function(d){return d.buffer}):r.ready.then(function(){const d=new ArrayBuffer(u*_);return r.decodeGltfBuffer(new Uint8Array(d),u,_,$,s.mode,s.filter),d})})}else return null}}class KL{constructor(t){this.name=Qe.EXT_MESH_GPU_INSTANCING,this.parser=t}createNodeMesh(t){const n=this.parser.json,o=n.nodes[t];if(!o.extensions||!o.extensions[this.name]||o.mesh===void 0)return null;const s=n.meshes[o.mesh];for(const l of s.primitives)if(l.mode!==Bn.TRIANGLES&&l.mode!==Bn.TRIANGLE_STRIP&&l.mode!==Bn.TRIANGLE_FAN&&l.mode!==void 0)return null;const r=o.extensions[this.name].attributes,a=[],c={};for(const l in r)a.push(this.parser.getDependency("accessor",r[l]).then(u=>(c[l]=u,c[l])));return a.length<1?null:(a.push(this.parser.createNodeMesh(t)),Promise.all(a).then(l=>{const u=l.pop(),_=u.isGroup?u.children:[u],$=l[0].count,d=[];for(const p of _){const b=new Uo,g=new Be,m=new Li,v=new Be(1,1,1),y=new bd(p.geometry,p.material,$);for(let w=0;w<$;w++)c.TRANSLATION&&g.fromBufferAttribute(c.TRANSLATION,w),c.ROTATION&&m.fromBufferAttribute(c.ROTATION,w),c.SCALE&&v.fromBufferAttribute(c.SCALE,w),y.setMatrixAt(w,b.compose(g,m,v));for(const w in c)if(w==="_COLOR_0"){const k=c[w];y.instanceColor=new Jh(k.array,k.itemSize,k.normalized)}else w!=="TRANSLATION"&&w!=="ROTATION"&&w!=="SCALE"&&p.geometry.setAttribute(w,c[w]);yd.prototype.copy.call(y,p),this.parser.assignFinalMaterial(y),d.push(y)}return u.isGroup?(u.clear(),u.add(...d),u):d[0]}))}}const mh="glTF",Wi=12,od={JSON:1313821514,BIN:5130562};class JL{constructor(t){this.name=Qe.KHR_BINARY_GLTF,this.content=null,this.body=null;const n=new DataView(t,0,Wi),o=new TextDecoder;if(this.header={magic:o.decode(new Uint8Array(t.slice(0,4))),version:n.getUint32(4,!0),length:n.getUint32(8,!0)},this.header.magic!==mh)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const s=this.header.length-Wi,i=new DataView(t,Wi);let r=0;for(;r<s;){const a=i.getUint32(r,!0);r+=4;const c=i.getUint32(r,!0);if(r+=4,c===od.JSON){const l=new Uint8Array(t,Wi+r,a);this.content=o.decode(l)}else if(c===od.BIN){const l=Wi+r;this.body=t.slice(l,l+a)}r+=a}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class XL{constructor(t,n){if(!n)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Qe.KHR_DRACO_MESH_COMPRESSION,this.json=t,this.dracoLoader=n,this.dracoLoader.preload()}decodePrimitive(t,n){const o=this.json,s=this.dracoLoader,i=t.extensions[this.name].bufferView,r=t.extensions[this.name].attributes,a={},c={},l={};for(const u in r){const _=bu[u]||u.toLowerCase();a[_]=r[u]}for(const u in t.attributes){const _=bu[u]||u.toLowerCase();if(r[u]!==void 0){const $=o.accessors[t.attributes[u]],d=Pi[$.componentType];l[_]=d.name,c[_]=$.normalized===!0}}return n.getDependency("bufferView",i).then(function(u){return new Promise(function(_,$){s.decodeDracoFile(u,function(d){for(const p in d.attributes){const b=d.attributes[p],g=c[p];g!==void 0&&(b.normalized=g)}_(d)},a,l,Cs,$)})})}}class YL{constructor(){this.name=Qe.KHR_TEXTURE_TRANSFORM}extendTexture(t,n){return(n.texCoord===void 0||n.texCoord===t.channel)&&n.offset===void 0&&n.rotation===void 0&&n.scale===void 0||(t=t.clone(),n.texCoord!==void 0&&(t.channel=n.texCoord),n.offset!==void 0&&t.offset.fromArray(n.offset),n.rotation!==void 0&&(t.rotation=n.rotation),n.scale!==void 0&&t.repeat.fromArray(n.scale),t.needsUpdate=!0),t}}class ZL{constructor(){this.name=Qe.KHR_MESH_QUANTIZATION}}class fh extends g0{constructor(t,n,o,s){super(t,n,o,s)}copySampleValue_(t){const n=this.resultBuffer,o=this.sampleValues,s=this.valueSize,i=t*s*3+s;for(let r=0;r!==s;r++)n[r]=o[i+r];return n}interpolate_(t,n,o,s){const i=this.resultBuffer,r=this.sampleValues,a=this.valueSize,c=a*2,l=a*3,u=s-n,_=(o-n)/u,$=_*_,d=$*_,p=t*l,b=p-l,g=-2*d+3*$,m=d-$,v=1-g,y=m-$+_;for(let w=0;w!==a;w++){const k=r[b+w+a],L=r[b+w+c]*u,P=r[p+w+a],G=r[p+w]*u;i[w]=v*k+y*L+g*P+m*G}return i}}const QL=new Li;class eI extends fh{interpolate_(t,n,o,s){const i=super.interpolate_(t,n,o,s);return QL.fromArray(i).normalize().toArray(i),i}}const Bn={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},Pi={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},id={9728:vd,9729:Rl,9984:e0,9985:Qh,9986:Zh,9987:wd},rd={33071:n0,33648:t0,10497:Vs},Pl={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},bu={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},eo={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},tI={CUBICSPLINE:void 0,LINEAR:Md,STEP:m0},Ll={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function nI(e){return e.DefaultMaterial===void 0&&(e.DefaultMaterial=new Ut({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:h0})),e.DefaultMaterial}function Eo(e,t,n){for(const o in n.extensions)e[o]===void 0&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[o]=n.extensions[o])}function gs(e,t){t.extras!==void 0&&(typeof t.extras=="object"?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function sI(e,t,n){let o=!1,s=!1,i=!1;for(let l=0,u=t.length;l<u;l++){const _=t[l];if(_.POSITION!==void 0&&(o=!0),_.NORMAL!==void 0&&(s=!0),_.COLOR_0!==void 0&&(i=!0),o&&s&&i)break}if(!o&&!s&&!i)return Promise.resolve(e);const r=[],a=[],c=[];for(let l=0,u=t.length;l<u;l++){const _=t[l];if(o){const $=_.POSITION!==void 0?n.getDependency("accessor",_.POSITION):e.attributes.position;r.push($)}if(s){const $=_.NORMAL!==void 0?n.getDependency("accessor",_.NORMAL):e.attributes.normal;a.push($)}if(i){const $=_.COLOR_0!==void 0?n.getDependency("accessor",_.COLOR_0):e.attributes.color;c.push($)}}return Promise.all([Promise.all(r),Promise.all(a),Promise.all(c)]).then(function(l){const u=l[0],_=l[1],$=l[2];return o&&(e.morphAttributes.position=u),s&&(e.morphAttributes.normal=_),i&&(e.morphAttributes.color=$),e.morphTargetsRelative=!0,e})}function oI(e,t){if(e.updateMorphTargets(),t.weights!==void 0)for(let n=0,o=t.weights.length;n<o;n++)e.morphTargetInfluences[n]=t.weights[n];if(t.extras&&Array.isArray(t.extras.targetNames)){const n=t.extras.targetNames;if(e.morphTargetInfluences.length===n.length){e.morphTargetDictionary={};for(let o=0,s=n.length;o<s;o++)e.morphTargetDictionary[n[o]]=o}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function iI(e){let t;const n=e.extensions&&e.extensions[Qe.KHR_DRACO_MESH_COMPRESSION];if(n?t="draco:"+n.bufferView+":"+n.indices+":"+Il(n.attributes):t=e.indices+":"+Il(e.attributes)+":"+e.mode,e.targets!==void 0)for(let o=0,s=e.targets.length;o<s;o++)t+=":"+Il(e.targets[o]);return t}function Il(e){let t="";const n=Object.keys(e).sort();for(let o=0,s=n.length;o<s;o++)t+=n[o]+":"+e[n[o]]+";";return t}function yu(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function rI(e){return e.search(/\.jpe?g($|\?)/i)>0||e.search(/^data\:image\/jpeg/)===0?"image/jpeg":e.search(/\.webp($|\?)/i)>0||e.search(/^data\:image\/webp/)===0?"image/webp":e.search(/\.ktx2($|\?)/i)>0||e.search(/^data\:image\/ktx2/)===0?"image/ktx2":"image/png"}const aI=new Uo;class cI{constructor(t={},n={}){this.json=t,this.extensions={},this.plugins={},this.options=n,this.cache=new IL,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let o=!1,s=-1,i=!1,r=-1;if(typeof navigator<"u"){const a=navigator.userAgent;o=/^((?!chrome|android).)*safari/i.test(a)===!0;const c=a.match(/Version\/(\d+)/);s=o&&c?parseInt(c[1],10):-1,i=a.indexOf("Firefox")>-1,r=i?a.match(/Firefox\/([0-9]+)\./)[1]:-1}typeof createImageBitmap>"u"||o&&s<17||i&&r<98?this.textureLoader=new Ii(this.options.manager):this.textureLoader=new Xh(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Ma(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(t){this.extensions=t}setPlugins(t){this.plugins=t}parse(t,n){const o=this,s=this.json,i=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(r){return r._markDefs&&r._markDefs()}),Promise.all(this._invokeAll(function(r){return r.beforeRoot&&r.beforeRoot()})).then(function(){return Promise.all([o.getDependencies("scene"),o.getDependencies("animation"),o.getDependencies("camera")])}).then(function(r){const a={scene:r[0][s.scene||0],scenes:r[0],animations:r[1],cameras:r[2],asset:s.asset,parser:o,userData:{}};return Eo(i,a,s),gs(a,s),Promise.all(o._invokeAll(function(c){return c.afterRoot&&c.afterRoot(a)})).then(function(){for(const c of a.scenes)c.updateMatrixWorld();t(a)})}).catch(n)}_markDefs(){const t=this.json.nodes||[],n=this.json.skins||[],o=this.json.meshes||[];for(let s=0,i=n.length;s<i;s++){const r=n[s].joints;for(let a=0,c=r.length;a<c;a++)t[r[a]].isBone=!0}for(let s=0,i=t.length;s<i;s++){const r=t[s];r.mesh!==void 0&&(this._addNodeRef(this.meshCache,r.mesh),r.skin!==void 0&&(o[r.mesh].isSkinnedMesh=!0)),r.camera!==void 0&&this._addNodeRef(this.cameraCache,r.camera)}}_addNodeRef(t,n){n!==void 0&&(t.refs[n]===void 0&&(t.refs[n]=t.uses[n]=0),t.refs[n]++)}_getNodeRef(t,n,o){if(t.refs[n]<=1)return o;const s=o.clone(),i=(r,a)=>{const c=this.associations.get(r);c!=null&&this.associations.set(a,c);for(const[l,u]of r.children.entries())i(u,a.children[l])};return i(o,s),s.name+="_instance_"+t.uses[n]++,s}_invokeOne(t){const n=Object.values(this.plugins);n.push(this);for(let o=0;o<n.length;o++){const s=t(n[o]);if(s)return s}return null}_invokeAll(t){const n=Object.values(this.plugins);n.unshift(this);const o=[];for(let s=0;s<n.length;s++){const i=t(n[s]);i&&o.push(i)}return o}getDependency(t,n){const o=t+":"+n;let s=this.cache.get(o);if(!s){switch(t){case"scene":s=this.loadScene(n);break;case"node":s=this._invokeOne(function(i){return i.loadNode&&i.loadNode(n)});break;case"mesh":s=this._invokeOne(function(i){return i.loadMesh&&i.loadMesh(n)});break;case"accessor":s=this.loadAccessor(n);break;case"bufferView":s=this._invokeOne(function(i){return i.loadBufferView&&i.loadBufferView(n)});break;case"buffer":s=this.loadBuffer(n);break;case"material":s=this._invokeOne(function(i){return i.loadMaterial&&i.loadMaterial(n)});break;case"texture":s=this._invokeOne(function(i){return i.loadTexture&&i.loadTexture(n)});break;case"skin":s=this.loadSkin(n);break;case"animation":s=this._invokeOne(function(i){return i.loadAnimation&&i.loadAnimation(n)});break;case"camera":s=this.loadCamera(n);break;default:if(s=this._invokeOne(function(i){return i!=this&&i.getDependency&&i.getDependency(t,n)}),!s)throw new Error("Unknown type: "+t);break}this.cache.add(o,s)}return s}getDependencies(t){let n=this.cache.get(t);if(!n){const o=this,s=this.json[t+(t==="mesh"?"es":"s")]||[];n=Promise.all(s.map(function(i,r){return o.getDependency(t,r)})),this.cache.add(t,n)}return n}loadBuffer(t){const n=this.json.buffers[t],o=this.fileLoader;if(n.type&&n.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+n.type+" buffer type is not supported.");if(n.uri===void 0&&t===0)return Promise.resolve(this.extensions[Qe.KHR_BINARY_GLTF].body);const s=this.options;return new Promise(function(i,r){o.load(tr.resolveURL(n.uri,s.path),i,void 0,function(){r(new Error('THREE.GLTFLoader: Failed to load buffer "'+n.uri+'".'))})})}loadBufferView(t){const n=this.json.bufferViews[t];return this.getDependency("buffer",n.buffer).then(function(o){const s=n.byteLength||0,i=n.byteOffset||0;return o.slice(i,i+s)})}loadAccessor(t){const n=this,o=this.json,s=this.json.accessors[t];if(s.bufferView===void 0&&s.sparse===void 0){const r=Pl[s.type],a=Pi[s.componentType],c=s.normalized===!0,l=new a(s.count*r);return Promise.resolve(new nr(l,r,c))}const i=[];return s.bufferView!==void 0?i.push(this.getDependency("bufferView",s.bufferView)):i.push(null),s.sparse!==void 0&&(i.push(this.getDependency("bufferView",s.sparse.indices.bufferView)),i.push(this.getDependency("bufferView",s.sparse.values.bufferView))),Promise.all(i).then(function(r){const a=r[0],c=Pl[s.type],l=Pi[s.componentType],u=l.BYTES_PER_ELEMENT,_=u*c,$=s.byteOffset||0,d=s.bufferView!==void 0?o.bufferViews[s.bufferView].byteStride:void 0,p=s.normalized===!0;let b,g;if(d&&d!==_){const m=Math.floor($/d),v="InterleavedBuffer:"+s.bufferView+":"+s.componentType+":"+m+":"+s.count;let y=n.cache.get(v);y||(b=new l(a,m*d,s.count*d/u),y=new Yh(b,d/u),n.cache.add(v,y)),g=new f0(y,c,$%d/u,p)}else a===null?b=new l(s.count*c):b=new l(a,$,s.count*c),g=new nr(b,c,p);if(s.sparse!==void 0){const m=Pl.SCALAR,v=Pi[s.sparse.indices.componentType],y=s.sparse.indices.byteOffset||0,w=s.sparse.values.byteOffset||0,k=new v(r[1],y,s.sparse.count*m),L=new l(r[2],w,s.sparse.count*c);a!==null&&(g=new nr(g.array.slice(),g.itemSize,g.normalized)),g.normalized=!1;for(let P=0,G=k.length;P<G;P++){const I=k[P];if(g.setX(I,L[P*c]),c>=2&&g.setY(I,L[P*c+1]),c>=3&&g.setZ(I,L[P*c+2]),c>=4&&g.setW(I,L[P*c+3]),c>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}g.normalized=p}return g})}loadTexture(t){const n=this.json,o=this.options,i=n.textures[t].source,r=n.images[i];let a=this.textureLoader;if(r.uri){const c=o.manager.getHandler(r.uri);c!==null&&(a=c)}return this.loadTextureImage(t,i,a)}loadTextureImage(t,n,o){const s=this,i=this.json,r=i.textures[t],a=i.images[n],c=(a.uri||a.bufferView)+":"+r.sampler;if(this.textureCache[c])return this.textureCache[c];const l=this.loadImageSource(n,o).then(function(u){u.flipY=!1,u.name=r.name||a.name||"",u.name===""&&typeof a.uri=="string"&&a.uri.startsWith("data:image/")===!1&&(u.name=a.uri);const $=(i.samplers||{})[r.sampler]||{};return u.magFilter=id[$.magFilter]||Rl,u.minFilter=id[$.minFilter]||wd,u.wrapS=rd[$.wrapS]||Vs,u.wrapT=rd[$.wrapT]||Vs,u.generateMipmaps=!u.isCompressedTexture&&u.minFilter!==vd&&u.minFilter!==Rl,s.associations.set(u,{textures:t}),u}).catch(function(){return null});return this.textureCache[c]=l,l}loadImageSource(t,n){const o=this,s=this.json,i=this.options;if(this.sourceCache[t]!==void 0)return this.sourceCache[t].then(_=>_.clone());const r=s.images[t],a=self.URL||self.webkitURL;let c=r.uri||"",l=!1;if(r.bufferView!==void 0)c=o.getDependency("bufferView",r.bufferView).then(function(_){l=!0;const $=new Blob([_],{type:r.mimeType});return c=a.createObjectURL($),c});else if(r.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+t+" is missing URI and bufferView");const u=Promise.resolve(c).then(function(_){return new Promise(function($,d){let p=$;n.isImageBitmapLoader===!0&&(p=function(b){const g=new v_(b);g.needsUpdate=!0,$(g)}),n.load(tr.resolveURL(_,i.path),p,void 0,d)})}).then(function(_){return l===!0&&a.revokeObjectURL(c),gs(_,r),_.userData.mimeType=r.mimeType||rI(r.uri),_}).catch(function(_){throw console.error("THREE.GLTFLoader: Couldn't load texture",c),_});return this.sourceCache[t]=u,u}assignTexture(t,n,o,s){const i=this;return this.getDependency("texture",o.index).then(function(r){if(!r)return null;if(o.texCoord!==void 0&&o.texCoord>0&&(r=r.clone(),r.channel=o.texCoord),i.extensions[Qe.KHR_TEXTURE_TRANSFORM]){const a=o.extensions!==void 0?o.extensions[Qe.KHR_TEXTURE_TRANSFORM]:void 0;if(a){const c=i.associations.get(r);r=i.extensions[Qe.KHR_TEXTURE_TRANSFORM].extendTexture(r,a),i.associations.set(r,c)}}return s!==void 0&&(r.colorSpace=s),t[n]=r,r})}assignFinalMaterial(t){const n=t.geometry;let o=t.material;const s=n.attributes.tangent===void 0,i=n.attributes.color!==void 0,r=n.attributes.normal===void 0;if(t.isPoints){const a="PointsMaterial:"+o.uuid;let c=this.cache.get(a);c||(c=new s0,sl.prototype.copy.call(c,o),c.color.copy(o.color),c.map=o.map,c.sizeAttenuation=!1,this.cache.add(a,c)),o=c}else if(t.isLine){const a="LineBasicMaterial:"+o.uuid;let c=this.cache.get(a);c||(c=new o0,sl.prototype.copy.call(c,o),c.color.copy(o.color),c.map=o.map,this.cache.add(a,c)),o=c}if(s||i||r){let a="ClonedMaterial:"+o.uuid+":";s&&(a+="derivative-tangents:"),i&&(a+="vertex-colors:"),r&&(a+="flat-shading:");let c=this.cache.get(a);c||(c=o.clone(),i&&(c.vertexColors=!0),r&&(c.flatShading=!0),s&&(c.normalScale&&(c.normalScale.y*=-1),c.clearcoatNormalScale&&(c.clearcoatNormalScale.y*=-1)),this.cache.add(a,c),this.associations.set(c,this.associations.get(o))),o=c}t.material=o}getMaterialType(){return Ut}loadMaterial(t){const n=this,o=this.json,s=this.extensions,i=o.materials[t];let r;const a={},c=i.extensions||{},l=[];if(c[Qe.KHR_MATERIALS_UNLIT]){const _=s[Qe.KHR_MATERIALS_UNLIT];r=_.getMaterialType(),l.push(_.extendParams(a,i,n))}else{const _=i.pbrMetallicRoughness||{};if(a.color=new ls(1,1,1),a.opacity=1,Array.isArray(_.baseColorFactor)){const $=_.baseColorFactor;a.color.setRGB($[0],$[1],$[2],Cs),a.opacity=$[3]}_.baseColorTexture!==void 0&&l.push(n.assignTexture(a,"map",_.baseColorTexture,nn)),a.metalness=_.metallicFactor!==void 0?_.metallicFactor:1,a.roughness=_.roughnessFactor!==void 0?_.roughnessFactor:1,_.metallicRoughnessTexture!==void 0&&(l.push(n.assignTexture(a,"metalnessMap",_.metallicRoughnessTexture)),l.push(n.assignTexture(a,"roughnessMap",_.metallicRoughnessTexture))),r=this._invokeOne(function($){return $.getMaterialType&&$.getMaterialType(t)}),l.push(Promise.all(this._invokeAll(function($){return $.extendMaterialParams&&$.extendMaterialParams(t,a)})))}i.doubleSided===!0&&(a.side=Cn);const u=i.alphaMode||Ll.OPAQUE;if(u===Ll.BLEND?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,u===Ll.MASK&&(a.alphaTest=i.alphaCutoff!==void 0?i.alphaCutoff:.5)),i.normalTexture!==void 0&&r!==Bt&&(l.push(n.assignTexture(a,"normalMap",i.normalTexture)),a.normalScale=new $n(1,1),i.normalTexture.scale!==void 0)){const _=i.normalTexture.scale;a.normalScale.set(_,_)}if(i.occlusionTexture!==void 0&&r!==Bt&&(l.push(n.assignTexture(a,"aoMap",i.occlusionTexture)),i.occlusionTexture.strength!==void 0&&(a.aoMapIntensity=i.occlusionTexture.strength)),i.emissiveFactor!==void 0&&r!==Bt){const _=i.emissiveFactor;a.emissive=new ls().setRGB(_[0],_[1],_[2],Cs)}return i.emissiveTexture!==void 0&&r!==Bt&&l.push(n.assignTexture(a,"emissiveMap",i.emissiveTexture,nn)),Promise.all(l).then(function(){const _=new r(a);return i.name&&(_.name=i.name),gs(_,i),n.associations.set(_,{materials:t}),i.extensions&&Eo(s,_,i),_})}createUniqueName(t){const n=i0.sanitizeNodeName(t||"");return n in this.nodeNamesUsed?n+"_"+ ++this.nodeNamesUsed[n]:(this.nodeNamesUsed[n]=0,n)}loadGeometries(t){const n=this,o=this.extensions,s=this.primitiveCache;function i(a){return o[Qe.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(a,n).then(function(c){return ad(c,a,n)})}const r=[];for(let a=0,c=t.length;a<c;a++){const l=t[a],u=iI(l),_=s[u];if(_)r.push(_.promise);else{let $;l.extensions&&l.extensions[Qe.KHR_DRACO_MESH_COMPRESSION]?$=i(l):$=ad(new Sd,l,n),s[u]={primitive:l,promise:$},r.push($)}}return Promise.all(r)}loadMesh(t){const n=this,o=this.json,s=this.extensions,i=o.meshes[t],r=i.primitives,a=[];for(let c=0,l=r.length;c<l;c++){const u=r[c].material===void 0?nI(this.cache):this.getDependency("material",r[c].material);a.push(u)}return a.push(n.loadGeometries(r)),Promise.all(a).then(function(c){const l=c.slice(0,c.length-1),u=c[c.length-1],_=[];for(let d=0,p=u.length;d<p;d++){const b=u[d],g=r[d];let m;const v=l[d];if(g.mode===Bn.TRIANGLES||g.mode===Bn.TRIANGLE_STRIP||g.mode===Bn.TRIANGLE_FAN||g.mode===void 0)m=i.isSkinnedMesh===!0?new r0(b,v):new Mt(b,v),m.isSkinnedMesh===!0&&m.normalizeSkinWeights(),g.mode===Bn.TRIANGLE_STRIP?m.geometry=sd(m.geometry,hd):g.mode===Bn.TRIANGLE_FAN&&(m.geometry=sd(m.geometry,Gl));else if(g.mode===Bn.LINES)m=new a0(b,v);else if(g.mode===Bn.LINE_STRIP)m=new c0(b,v);else if(g.mode===Bn.LINE_LOOP)m=new l0(b,v);else if(g.mode===Bn.POINTS)m=new u0(b,v);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+g.mode);Object.keys(m.geometry.morphAttributes).length>0&&oI(m,i),m.name=n.createUniqueName(i.name||"mesh_"+t),gs(m,i),g.extensions&&Eo(s,m,g),n.assignFinalMaterial(m),_.push(m)}for(let d=0,p=_.length;d<p;d++)n.associations.set(_[d],{meshes:t,primitives:d});if(_.length===1)return i.extensions&&Eo(s,_[0],i),_[0];const $=new ss;i.extensions&&Eo(s,$,i),n.associations.set($,{meshes:t});for(let d=0,p=_.length;d<p;d++)$.add(_[d]);return $})}loadCamera(t){let n;const o=this.json.cameras[t],s=o[o.type];if(!s){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return o.type==="perspective"?n=new Nr(kd.radToDeg(s.yfov),s.aspectRatio||1,s.znear||1,s.zfar||2e6):o.type==="orthographic"&&(n=new _0(-s.xmag,s.xmag,s.ymag,-s.ymag,s.znear,s.zfar)),o.name&&(n.name=this.createUniqueName(o.name)),gs(n,o),Promise.resolve(n)}loadSkin(t){const n=this.json.skins[t],o=[];for(let s=0,i=n.joints.length;s<i;s++)o.push(this._loadNodeShallow(n.joints[s]));return n.inverseBindMatrices!==void 0?o.push(this.getDependency("accessor",n.inverseBindMatrices)):o.push(null),Promise.all(o).then(function(s){const i=s.pop(),r=s,a=[],c=[];for(let l=0,u=r.length;l<u;l++){const _=r[l];if(_){a.push(_);const $=new Uo;i!==null&&$.fromArray(i.array,l*16),c.push($)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',n.joints[l])}return new $0(a,c)})}loadAnimation(t){const n=this.json,o=this,s=n.animations[t],i=s.name?s.name:"animation_"+t,r=[],a=[],c=[],l=[],u=[];for(let _=0,$=s.channels.length;_<$;_++){const d=s.channels[_],p=s.samplers[d.sampler],b=d.target,g=b.node,m=s.parameters!==void 0?s.parameters[p.input]:p.input,v=s.parameters!==void 0?s.parameters[p.output]:p.output;b.node!==void 0&&(r.push(this.getDependency("node",g)),a.push(this.getDependency("accessor",m)),c.push(this.getDependency("accessor",v)),l.push(p),u.push(b))}return Promise.all([Promise.all(r),Promise.all(a),Promise.all(c),Promise.all(l),Promise.all(u)]).then(function(_){const $=_[0],d=_[1],p=_[2],b=_[3],g=_[4],m=[];for(let y=0,w=$.length;y<w;y++){const k=$[y],L=d[y],P=p[y],G=b[y],I=g[y];if(k===void 0)continue;k.updateMatrix&&k.updateMatrix();const U=o._createAnimationTracks(k,L,P,G,I);if(U)for(let R=0;R<U.length;R++)m.push(U[R])}const v=new d0(i,void 0,m);return gs(v,s),v})}createNodeMesh(t){const n=this.json,o=this,s=n.nodes[t];return s.mesh===void 0?null:o.getDependency("mesh",s.mesh).then(function(i){const r=o._getNodeRef(o.meshCache,s.mesh,i);return s.weights!==void 0&&r.traverse(function(a){if(a.isMesh)for(let c=0,l=s.weights.length;c<l;c++)a.morphTargetInfluences[c]=s.weights[c]}),r})}loadNode(t){const n=this.json,o=this,s=n.nodes[t],i=o._loadNodeShallow(t),r=[],a=s.children||[];for(let l=0,u=a.length;l<u;l++)r.push(o.getDependency("node",a[l]));const c=s.skin===void 0?Promise.resolve(null):o.getDependency("skin",s.skin);return Promise.all([i,Promise.all(r),c]).then(function(l){const u=l[0],_=l[1],$=l[2];$!==null&&u.traverse(function(d){d.isSkinnedMesh&&d.bind($,aI)});for(let d=0,p=_.length;d<p;d++)u.add(_[d]);return u})}_loadNodeShallow(t){const n=this.json,o=this.extensions,s=this;if(this.nodeCache[t]!==void 0)return this.nodeCache[t];const i=n.nodes[t],r=i.name?s.createUniqueName(i.name):"",a=[],c=s._invokeOne(function(l){return l.createNodeMesh&&l.createNodeMesh(t)});return c&&a.push(c),i.camera!==void 0&&a.push(s.getDependency("camera",i.camera).then(function(l){return s._getNodeRef(s.cameraCache,i.camera,l)})),s._invokeAll(function(l){return l.createNodeAttachment&&l.createNodeAttachment(t)}).forEach(function(l){a.push(l)}),this.nodeCache[t]=Promise.all(a).then(function(l){let u;if(i.isBone===!0?u=new p0:l.length>1?u=new ss:l.length===1?u=l[0]:u=new yd,u!==l[0])for(let _=0,$=l.length;_<$;_++)u.add(l[_]);if(i.name&&(u.userData.name=i.name,u.name=r),gs(u,i),i.extensions&&Eo(o,u,i),i.matrix!==void 0){const _=new Uo;_.fromArray(i.matrix),u.applyMatrix4(_)}else i.translation!==void 0&&u.position.fromArray(i.translation),i.rotation!==void 0&&u.quaternion.fromArray(i.rotation),i.scale!==void 0&&u.scale.fromArray(i.scale);if(!s.associations.has(u))s.associations.set(u,{});else if(i.mesh!==void 0&&s.meshCache.refs[i.mesh]>1){const _=s.associations.get(u);s.associations.set(u,{..._})}return s.associations.get(u).nodes=t,u}),this.nodeCache[t]}loadScene(t){const n=this.extensions,o=this.json.scenes[t],s=this,i=new ss;o.name&&(i.name=s.createUniqueName(o.name)),gs(i,o),o.extensions&&Eo(n,i,o);const r=o.nodes||[],a=[];for(let c=0,l=r.length;c<l;c++)a.push(s.getDependency("node",r[c]));return Promise.all(a).then(function(c){for(let u=0,_=c.length;u<_;u++)i.add(c[u]);const l=u=>{const _=new Map;for(const[$,d]of s.associations)($ instanceof sl||$ instanceof v_)&&_.set($,d);return u.traverse($=>{const d=s.associations.get($);d!=null&&_.set($,d)}),_};return s.associations=l(i),i})}_createAnimationTracks(t,n,o,s,i){const r=[],a=t.name?t.name:t.uuid,c=[];eo[i.path]===eo.weights?t.traverse(function($){$.morphTargetInfluences&&c.push($.name?$.name:$.uuid)}):c.push(a);let l;switch(eo[i.path]){case eo.weights:l=k_;break;case eo.rotation:l=M_;break;case eo.translation:case eo.scale:l=S_;break;default:switch(o.itemSize){case 1:l=k_;break;case 2:case 3:default:l=S_;break}break}const u=s.interpolation!==void 0?tI[s.interpolation]:Md,_=this._getArrayFromAccessor(o);for(let $=0,d=c.length;$<d;$++){const p=new l(c[$]+"."+eo[i.path],n.array,_,u);s.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(p),r.push(p)}return r}_getArrayFromAccessor(t){let n=t.array;if(t.normalized){const o=yu(n.constructor),s=new Float32Array(n.length);for(let i=0,r=n.length;i<r;i++)s[i]=n[i]*o;n=s}return n}_createCubicSplineTrackInterpolant(t){t.createInterpolant=function(o){const s=this instanceof M_?eI:fh;return new s(this.times,this.values,this.getValueSize()/3,o)},t.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function lI(e,t,n){const o=t.attributes,s=new pn;if(o.POSITION!==void 0){const a=n.json.accessors[o.POSITION],c=a.min,l=a.max;if(c!==void 0&&l!==void 0){if(s.set(new Be(c[0],c[1],c[2]),new Be(l[0],l[1],l[2])),a.normalized){const u=yu(Pi[a.componentType]);s.min.multiplyScalar(u),s.max.multiplyScalar(u)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const i=t.targets;if(i!==void 0){const a=new Be,c=new Be;for(let l=0,u=i.length;l<u;l++){const _=i[l];if(_.POSITION!==void 0){const $=n.json.accessors[_.POSITION],d=$.min,p=$.max;if(d!==void 0&&p!==void 0){if(c.setX(Math.max(Math.abs(d[0]),Math.abs(p[0]))),c.setY(Math.max(Math.abs(d[1]),Math.abs(p[1]))),c.setZ(Math.max(Math.abs(d[2]),Math.abs(p[2]))),$.normalized){const b=yu(Pi[$.componentType]);c.multiplyScalar(b)}a.max(c)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}s.expandByVector(a)}e.boundingBox=s;const r=new b0;s.getCenter(r.center),r.radius=s.min.distanceTo(s.max)/2,e.boundingSphere=r}function ad(e,t,n){const o=t.attributes,s=[];function i(r,a){return n.getDependency("accessor",r).then(function(c){e.setAttribute(a,c)})}for(const r in o){const a=bu[r]||r.toLowerCase();a in e.attributes||s.push(i(o[r],a))}if(t.indices!==void 0&&!e.index){const r=n.getDependency("accessor",t.indices).then(function(a){e.setIndex(a)});s.push(r)}return Ol.workingColorSpace!==Cs&&"COLOR_0"in o&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${Ol.workingColorSpace}" not supported.`),gs(e,t),lI(e,t,n),Promise.all(s).then(function(){return t.targets!==void 0?sI(e,t.targets,n):e})}const Tl=new WeakMap;class zc extends gd{constructor(t){super(t),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(t){return this.decoderPath=t,this}setDecoderConfig(t){return this.decoderConfig=t,this}setWorkerLimit(t){return this.workerLimit=t,this}load(t,n,o,s){const i=new Ma(this.manager);i.setPath(this.path),i.setResponseType("arraybuffer"),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials),i.load(t,r=>{this.parse(r,n,s)},o,s)}parse(t,n,o=()=>{}){this.decodeDracoFile(t,n,null,null,nn,o).catch(o)}decodeDracoFile(t,n,o,s,i=Cs,r=()=>{}){const a={attributeIDs:o||this.defaultAttributeIDs,attributeTypes:s||this.defaultAttributeTypes,useUniqueIDs:!!o,vertexColorSpace:i};return this.decodeGeometry(t,a).then(n).catch(r)}decodeGeometry(t,n){const o=JSON.stringify(n);if(Tl.has(t)){const c=Tl.get(t);if(c.key===o)return c.promise;if(t.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let s;const i=this.workerNextTaskID++,r=t.byteLength,a=this._getWorker(i,r).then(c=>(s=c,new Promise((l,u)=>{s._callbacks[i]={resolve:l,reject:u},s.postMessage({type:"decode",id:i,taskConfig:n,buffer:t},[t])}))).then(c=>this._createGeometry(c.geometry));return a.catch(()=>!0).then(()=>{s&&i&&this._releaseTask(s,i)}),Tl.set(t,{key:o,promise:a}),a}_createGeometry(t){const n=new Sd;t.index&&n.setIndex(new nr(t.index.array,1));for(let o=0;o<t.attributes.length;o++){const s=t.attributes[o],i=s.name,r=s.array,a=s.itemSize,c=new nr(r,a);i==="color"&&(this._assignVertexColorSpace(c,s.vertexColorSpace),c.normalized=!(r instanceof Float32Array)),n.setAttribute(i,c)}return n}_assignVertexColorSpace(t,n){if(n!==nn)return;const o=new ls;for(let s=0,i=t.count;s<i;s++)o.fromBufferAttribute(t,s),Ol.colorSpaceToWorking(o,nn),t.setXYZ(s,o.r,o.g,o.b)}_loadLibrary(t,n){const o=new Ma(this.manager);return o.setPath(this.decoderPath),o.setResponseType(n),o.setWithCredentials(this.withCredentials),new Promise((s,i)=>{o.load(t,s,void 0,i)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const t=typeof WebAssembly!="object"||this.decoderConfig.type==="js",n=[];return t?n.push(this._loadLibrary("draco_decoder.js","text")):(n.push(this._loadLibrary("draco_wasm_wrapper.js","text")),n.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(n).then(o=>{const s=o[0];t||(this.decoderConfig.wasmBinary=o[1]);const i=uI.toString(),r=["/* draco decoder */",s,"","/* worker */",i.substring(i.indexOf("{")+1,i.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([r]))}),this.decoderPending}_getWorker(t,n){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const s=new Worker(this.workerSourceURL);s._callbacks={},s._taskCosts={},s._taskLoad=0,s.postMessage({type:"init",decoderConfig:this.decoderConfig}),s.onmessage=function(i){const r=i.data;switch(r.type){case"decode":s._callbacks[r.id].resolve(r);break;case"error":s._callbacks[r.id].reject(r);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+r.type+'"')}},this.workerPool.push(s)}else this.workerPool.sort(function(s,i){return s._taskLoad>i._taskLoad?-1:1});const o=this.workerPool[this.workerPool.length-1];return o._taskCosts[t]=n,o._taskLoad+=n,o})}_releaseTask(t,n){t._taskLoad-=t._taskCosts[n],delete t._callbacks[n],delete t._taskCosts[n]}debug(){console.log("Task load: ",this.workerPool.map(t=>t._taskLoad))}dispose(){for(let t=0;t<this.workerPool.length;++t)this.workerPool[t].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}}function uI(){let e,t;onmessage=function(r){const a=r.data;switch(a.type){case"init":e=a.decoderConfig,t=new Promise(function(u){e.onModuleLoaded=function(_){u({draco:_})},DracoDecoderModule(e)});break;case"decode":const c=a.buffer,l=a.taskConfig;t.then(u=>{const _=u.draco,$=new _.Decoder;try{const d=n(_,$,new Int8Array(c),l),p=d.attributes.map(b=>b.array.buffer);d.index&&p.push(d.index.array.buffer),self.postMessage({type:"decode",id:a.id,geometry:d},p)}catch(d){console.error(d),self.postMessage({type:"error",id:a.id,error:d.message})}finally{_.destroy($)}});break}};function n(r,a,c,l){const u=l.attributeIDs,_=l.attributeTypes;let $,d;const p=a.GetEncodedGeometryType(c);if(p===r.TRIANGULAR_MESH)$=new r.Mesh,d=a.DecodeArrayToMesh(c,c.byteLength,$);else if(p===r.POINT_CLOUD)$=new r.PointCloud,d=a.DecodeArrayToPointCloud(c,c.byteLength,$);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!d.ok()||$.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+d.error_msg());const b={index:null,attributes:[]};for(const g in u){const m=self[_[g]];let v,y;if(l.useUniqueIDs)y=u[g],v=a.GetAttributeByUniqueId($,y);else{if(y=a.GetAttributeId($,r[u[g]]),y===-1)continue;v=a.GetAttribute($,y)}const w=s(r,a,$,g,m,v);g==="color"&&(w.vertexColorSpace=l.vertexColorSpace),b.attributes.push(w)}return p===r.TRIANGULAR_MESH&&(b.index=o(r,a,$)),r.destroy($),b}function o(r,a,c){const u=c.num_faces()*3,_=u*4,$=r._malloc(_);a.GetTrianglesUInt32Array(c,_,$);const d=new Uint32Array(r.HEAPF32.buffer,$,u).slice();return r._free($),{array:d,itemSize:1}}function s(r,a,c,l,u,_){const $=_.num_components(),p=c.num_points()*$,b=p*u.BYTES_PER_ELEMENT,g=i(r,u),m=r._malloc(b);a.GetAttributeDataArrayForAllPoints(c,_,g,b,m);const v=new u(r.HEAPF32.buffer,m,p).slice();return r._free(m),{name:l,array:v,itemSize:$}}function i(r,a){switch(a){case Float32Array:return r.DT_FLOAT32;case Int8Array:return r.DT_INT8;case Int16Array:return r.DT_INT16;case Int32Array:return r.DT_INT32;case Uint8Array:return r.DT_UINT8;case Uint16Array:return r.DT_UINT16;case Uint32Array:return r.DT_UINT32}}}class _I{constructor(){this.gltfCache=new Map,this.modelPool=new Map,this.instancedMeshes=new Map,this.gltfLoader=null,this.dracoLoader=null,this.maxCacheSize=50,this.maxInstancesPerModel=1e3,this.preloadStatus=new Map,this.preloadQueue=[],this.initLoaders()}initLoaders(){this.gltfLoader||(this.gltfLoader=new Bc,this.gltfLoader.setCrossOrigin("anonymous"),this.dracoLoader=new zc,this.dracoLoader.setDecoderPath("https://www.gstatic.com/draco/versioned/decoders/1.5.6/"),this.dracoLoader.setCrossOrigin("anonymous"),this.gltfLoader.setDRACOLoader(this.dracoLoader),f("[ModelCache] GLTFDraco"))}async loadModel(t,n=!0){if(n&&this.modelPool.has(t)){const i=this.modelPool.get(t);return f(`[ModelCache] : ${t}`),i.clone(!0)}let o;if(this.gltfCache.has(t))f(`[ModelCache] GLTF: ${t}`),o=this.gltfCache.get(t);else try{const r=await(await zp(t)).arrayBuffer();f(`[ModelCache] GLTF: ${t}`),o=await new Promise((a,c)=>{this.gltfLoader.parse(r,"",l=>a(l),l=>c(l))}),this.cacheGLTF(t,o)}catch(i){throw f(`[ModelCache] : ${t}`,i),i}const s=o.scene.clone(!0);return n&&this.addToModelPool(t,s),s}async createInstancedMesh(t,n=100){if(this.instancedMeshes.has(t))return f(`[ModelCache] : ${t}`),this.instancedMeshes.get(t);const o=await this.loadModel(t,!0),s=[];if(o.traverse(c=>{c.isMesh&&s.push(c)}),s.length===0)throw new Error(`[ModelCache] : ${t}`);const i=s[0],r=new bd(i.geometry,i.material,n),a=new Uo;for(let c=0;c<n;c++)a.setPosition(0,-1e3,0),r.setMatrixAt(c,a);return r.instanceMatrix.needsUpdate=!0,this.instancedMeshes.set(t,r),f(`[ModelCache] : ${t}, : ${n}`),r}updateInstancedMeshInstance(t,n,o,s,i){const r=this.instancedMeshes.get(t);if(!r){f(`[ModelCache] : ${t}`);return}if(n>=r.count){f(`[ModelCache] : ${n}/${r.count}`);return}const a=new Uo;a.compose(o,new Li().setFromEuler(s),i),r.setMatrixAt(n,a),r.instanceMatrix.needsUpdate=!0}hideInstancedMeshInstance(t,n){const o=this.instancedMeshes.get(t);if(!o)return;const s=new Uo;s.setPosition(0,-1e3,0),o.setMatrixAt(n,s),o.instanceMatrix.needsUpdate=!0}cacheGLTF(t,n){if(this.gltfCache.size>=this.maxCacheSize){const o=this.gltfCache.keys().next().value;this.gltfCache.delete(o),f(`[ModelCache] GLTF: ${o}`)}this.gltfCache.set(t,n),f(`[ModelCache] GLTF: ${t}`)}addToModelPool(t,n){if(this.modelPool.size>=this.maxCacheSize){const o=this.modelPool.keys().next().value,s=this.modelPool.get(o);this.disposeModel(s),this.modelPool.delete(o),f(`[ModelCache] : ${o}`)}this.modelPool.set(t,n),f(`[ModelCache] : ${t}`)}async preloadModels(t,n=null){f(`[ModelCache]  ${t.length} `);const o=t.length;let s=0;const i=t.filter(a=>{const c=this.preloadStatus.get(a);return!c||c==="failed"});f(`[ModelCache]  ${i.length} `);const r=3;for(let a=0;a<i.length;a+=r){const l=i.slice(a,a+r).map(async u=>{try{this.preloadStatus.set(u,"loading"),await this.loadModel(u,!0),this.preloadStatus.set(u,"loaded"),s++,n&&n(s,o,Math.round(s/o*100)),f(`[ModelCache] : ${u} (${s}/${o})`)}catch(_){f(`[ModelCache] : ${u}`,_),this.preloadStatus.set(u,"failed"),s++,n&&n(s,o,Math.round(s/o*100))}});await Promise.all(l),a+r<i.length&&await new Promise(u=>setTimeout(u,100))}f(`[ModelCache] : ${s}/${o} `)}isPreloaded(t){return this.preloadStatus.get(t)==="loaded"}getPreloadStatus(){const t={total:this.preloadStatus.size,loaded:0,loading:0,failed:0};for(const n of this.preloadStatus.values())t[n]++;return t}disposeModel(t){t&&t.traverse(n=>{n.isMesh&&(n.geometry&&n.geometry.dispose(),n.material&&(Array.isArray(n.material)?n.material.forEach(o=>{o.map&&o.map.dispose(),o.dispose&&o.dispose()}):(n.material.map&&n.material.map.dispose(),n.material.dispose&&n.material.dispose())))})}clearCache(){f("[ModelCache] ..."),this.modelPool.forEach(t=>{this.disposeModel(t)}),this.modelPool.clear(),this.instancedMeshes.forEach(t=>{this.disposeModel(t)}),this.instancedMeshes.clear(),this.gltfCache.clear(),this.preloadStatus.clear(),f("[ModelCache] ")}getCacheStatus(){return{gltfCacheSize:this.gltfCache.size,modelPoolSize:this.modelPool.size,instancedMeshesSize:this.instancedMeshes.size,preloadStatus:this.getPreloadStatus(),maxCacheSize:this.maxCacheSize,maxInstancesPerModel:this.maxInstancesPerModel,gltfLoaderInitialized:!!this.gltfLoader,dracoLoaderInitialized:!!this.dracoLoader}}updateConfig(t){t.maxCacheSize!==void 0&&(this.maxCacheSize=Math.max(10,t.maxCacheSize)),t.maxInstancesPerModel!==void 0&&(this.maxInstancesPerModel=Math.max(10,t.maxInstancesPerModel)),f("[ModelCache] :",this.getCacheStatus())}}const Gn=new _I,$I={class:"model-wrapper"},dI={key:0,class:"model-loading"},pI={__name:"PuppetModelView",props:{puppet:{type:Object,default:null}},setup(e){const t=e,n=se(null),o=se(!1);let s=null,i=null,r=null,a=0,c=null,l=null,u=new w0,_=null,$=null,d=0,p=!1;window.__GLTF_MEMORY_CACHE__||(window.__GLTF_MEMORY_CACHE__=new Map,f("[PuppetModelView] Initialized global GLTF memory cache"));function b(){if(p)return;const y=n.value;if(!y){f("[PuppetModelView] Container not ready for Three.js initialization");return}f("[PuppetModelView] Initializing Three.js..."),i=new ec,r=new Nr(45,1,.1,1e3),r.position.set(0,1,3),s=new tc({antialias:!0,alpha:!0}),s.setPixelRatio(window.devicePixelRatio||1),s.outputColorSpace=nn,$=new zc,$.setDecoderPath("https://www.gstatic.com/draco/versioned/decoders/1.5.6/"),$.setCrossOrigin("anonymous"),f("[PuppetModelView] Draco loader initialized:",!!$),y.innerHTML="",y.appendChild(s.domElement);const w=new nc(16777215,1.2),k=new vs(16777215,1.5);k.position.set(3,5,2);const L=new vs(16777215,.8);L.position.set(-2,3,4);const P=new hi(16777215,1,10);P.position.set(0,2,3),i.add(w,k,L,P);const G=()=>{if(!y||!s)return;let U=y.clientWidth,R=y.clientHeight;if(!U||!R){const M=y.getBoundingClientRect();if(U=M.width||200,R=M.height||200,!M.width||!M.height){requestAnimationFrame(G);return}}s.setSize(U,R,!0),r.aspect=U/Math.max(1,R),r.updateProjectionMatrix()};G(),_=new ResizeObserver(G),_.observe(y),requestAnimationFrame(()=>{G(),requestAnimationFrame(()=>{G(),requestAnimationFrame(G)})});const I=()=>{if(!s||!i||!r)return;a=requestAnimationFrame(I);const U=u.getDelta();l&&l.update(U),c&&(c.rotation.y+=U*.6),s.render(i,r)};I(),p=!0,f("[PuppetModelView] Three.js initialized successfully, container size:",y.clientWidth,"x",y.clientHeight)}function g(){l&&(l.stopAllAction(),l=null),c&&(i.remove(c),c.traverse(y=>{y.isMesh&&(y.geometry&&y.geometry.dispose(),Array.isArray(y.material)?y.material.forEach(w=>{w.map&&w.map.dispose(),w&&w.dispose&&w.dispose()}):y.material&&(y.material.map&&y.material.map.dispose(),y.material.dispose&&y.material.dispose()))}),c=null)}function m(y){const w=new pn().setFromObject(y),k=new Be,L=new Be;w.getSize(k),w.getCenter(L),y.position.sub(L),y.position.add(new Be(0,0,0)),y.scale.multiplyScalar(.8);const G=s==null?void 0:s.domElement,I=G?G.clientWidth||G.width:200,U=G?G.clientHeight||G.height:200,R=Math.max(1e-6,I/Math.max(1,U)),M=r.fov*(Math.PI/180),B=2*Math.atan(Math.tan(M/2)*R),de=1.05,oe=k.y/2/Math.tan(M/2),be=k.x/2/Math.tan(B/2),K=de*Math.max(oe,be,.1);r.position.set(0,0,K),r.lookAt(0,0,0)}async function v(y){var L;if(!y)return;f("[PuppetModelView] Loading puppet:",y.name),o.value=!0,b(),g();const w=++d;f("[PuppetModelView] ");let k=y.modelUrl||"";if(f("[PuppetModelView] Original modelUrl:",k),f("[PuppetModelView] Puppet image:",y.image),f("[PuppetModelView] Puppet name:",y.name),f("[PuppetModelView] Puppet data:",y),!k||k.trim()===""){f("[PuppetModelView] No model URL found");return}f("[PuppetModelView] Final Model URL:",k);try{f("[PuppetModelView] Starting to load:",k),f("[PuppetModelView] Cache status:",Gn.getCacheStatus());const P=await Gn.loadModel(k);if(f("[PuppetModelView] Model loaded from cache manager:",P),w!==d){f("[PuppetModelView] Ignoring outdated load result for:",y.name),gltf&&gltf.scene&&gltf.scene.traverse(G=>{G.isMesh&&(G.geometry&&G.geometry.dispose(),Array.isArray(G.material)?G.material.forEach(I=>{I.map&&I.map.dispose(),I.dispose&&I.dispose()}):G.material&&(G.material.map&&G.material.map.dispose(),G.material.dispose&&G.material.dispose()))});return}if(f("[PuppetModelView] Applying model for:",y.name),!i){f("[PuppetModelView] Scene not ready, initializing..."),b();let G=0;for(;!i&&G<40;)await new Promise(I=>setTimeout(I,50)),G++;if(!i){f("[PuppetModelView] Scene initialization timeout");return}}if(c=P,!c){f("[PuppetModelView] No model instance received");return}i.add(c),m(c),f("[PuppetModelView] Model loaded successfully:",y.name,"Scene children:",i.children.length),o.value=!1}catch(P){if(f("[PuppetModelView] Load failed:",P),f("[PuppetModelView] Failed URL:",k),f("[PuppetModelView] Puppet data:",y),typeof(P==null?void 0:P.message)=="string"&&P.message.includes("DRACOLoader")){f("[PuppetModelView] Retrying without Draco decoder...");try{const G=new Bc;G.setCrossOrigin("anonymous");const I=await G.loadAsync(k);if(w===d&&(c=I.scene||((L=I.scenes)==null?void 0:L[0]),c)){i.add(c),I.animations&&I.animations.length&&(l=new y0(c),l.clipAction(I.animations[0]).play()),m(c),f("[PuppetModelView] Model loaded successfully without Draco:",y.name);return}}catch(G){f("[PuppetModelView] Fallback load also failed:",G)}}if(w===d){const G=new bs(1,1,1),I=new Ut({color:8947967});c=new Mt(G,I),i.add(c),m(c)}o.value=!1}}return Ln(()=>t.puppet,async y=>{await br(),v(y)},{immediate:!1}),gn(()=>{f("[PuppetModelView] Component mounted"),br(()=>{n.value&&(b(),t.puppet&&setTimeout(()=>{v(t.puppet)},0))})}),Is(()=>{if(f("[PuppetModelView] Cleaning up..."),cancelAnimationFrame(a),g(),_&&n.value)try{_.unobserve(n.value)}catch{}const y=i,w=s;s=null,i=null,r=null,p=!1,d=0;const k=()=>{if(f("[PuppetModelView] Starting deferred cleanup..."),y&&y.traverse(L=>{if(L.isMesh)try{if(L.geometry&&L.geometry.dispose(),Array.isArray(L.material))L.material.forEach(P=>{try{P.map&&P.map.dispose(),P.dispose&&P.dispose()}catch{}});else if(L.material)try{L.material.map&&L.material.map.dispose(),L.material.dispose&&L.material.dispose()}catch{}}catch{}}),w)try{w.dispose(),w.forceContextLoss&&w.forceContextLoss()}catch{}f("[PuppetModelView] Deferred cleanup completed")};typeof window<"u"&&window.requestIdleCallback?window.requestIdleCallback(k,{timeout:1e3}):setTimeout(k,100),f("[PuppetModelView] Quick cleanup completed, heavy cleanup deferred")}),(y,w)=>(W(),te("div",$I,[h("div",{ref_key:"mountEl",ref:n,class:"model-canvas"},null,512),o.value?(W(),te("div",dI,[...w[0]||(w[0]=[h("div",{class:"loading-spinner"},null,-1)])])):Ie("",!0)]))}},mI=Vt(pI,[["__scopeId","data-v-0e860b93"]]),fI={class:"warehouse"},hI={class:"warehouse__resources"},gI={class:"resource-icon"},bI=["src","alt"],yI={class:"resource-value"},wI={class:"resource-tooltip"},vI={key:0,class:"warehouse__main"},SI={class:"warehouse__sidebar"},kI={class:"puppet-list"},MI=["onClick","onMouseenter"],CI={class:"puppet-card__quantity"},xI={class:"puppet-card__image"},PI=["src","alt"],LI={class:"puppet-card__info"},II={class:"puppet-card__name"},TI={class:"puppet-card__level"},EI={class:"puppet-detail__header"},AI={class:"puppet-detail__name"},GI={class:"puppet-detail__content"},RI={class:"puppet-detail__row"},OI={class:"puppet-detail__model"},DI={class:"puppet-detail__description"},NI={class:"puppet-detail__row"},jI={class:"puppet-detail__stats"},HI={class:"stats-section"},FI={class:"stat-item"},UI={class:"stat-value"},BI={class:"stat-item"},zI={class:"stat-value"},VI={class:"stat-item"},qI={class:"stat-value"},WI={class:"stat-item"},KI={class:"stat-value"},JI={class:"stat-item"},XI={class:"stat-value"},YI={class:"stat-item"},ZI={class:"stat-value"},QI={class:"stat-item"},e8={class:"stat-value"},t8={class:"equipment-section"},n8={class:"equipment-slots"},s8=["src","alt"],o8=["src"],i8=["src"],r8={key:3,class:"equipment-icon"},a8={key:0,class:"skill-section"},c8={class:"skill-info"},l8={class:"skill-text"},u8={class:"skill-name"},_8={class:"skill-cooldown"},$8={class:"skill-effect"},d8={class:"skill-icon"},p8=["src","alt"],m8={key:1},f8={class:"puppet-detail__upgrade"},h8={class:"upgrade-cost"},g8=["src"],b8={class:"cost-amount"},y8=["disabled"],w8=["src"],v8={class:"warehouse__placeholder",key:"placeholder"},S8=["src"],k8={__name:"Warehouse",props:{musicOn:{type:Boolean,default:!0}},setup(e,{expose:t}){es(K=>({fdb82c0e:de,v4f1f7bb6:B,v4f1e1e99:U,v4f1e92f8:R,v4f1f0757:M}));const n=e,o=["SpiritalSpark","RecallGear","ResonantCrystal","RefinedCopper","HeartCrystalDust"];function s(K){return o.map(A=>({icon:Jn[A].icon,name:Jn[A].name,value:Number((K==null?void 0:K[A])??0)}))}const i={IronWall:"",Arcanist:"",CraftsMan:"",Mechanic:"",Resonator:""};function r(K){const A=Number(K??1);return A===1?5:A===2?10:A===3?20:A===4?30:0}function a(K){return(K||[]).map((A,Q)=>{var N,Z,J,ue,le,ie;const F=(A==null?void 0:A.copper_info)||{},D=(F==null?void 0:F.skill)||{},X=(A==null?void 0:A.equipment_slot)||{},q=(X==null?void 0:X.slot1)||null,he=(X==null?void 0:X.slot2)||null,Ge=(A==null?void 0:A.attribute)||{},qe=((N=q==null?void 0:q.equipment_base)==null?void 0:N.attribute)||{},He=((Z=he==null?void 0:he.equipment_base)==null?void 0:Z.attribute)||{},rt=Number(qe.attack||0)+Number(He.attack||0),bt=Number(qe.defense||0)+Number(He.defense||0),$t=Number(qe.dodge||0)+Number(He.dodge||0),Dt=A==null?void 0:A.copper_type,x=(A==null?void 0:A.level)??1,T=(F==null?void 0:F.model_url)||"",z=T?ee(T):"";return{id:Number((A==null?void 0:A.id)??Q+1),name:(F==null?void 0:F.name)??"",level:x,suffix:(A==null?void 0:A.suffix)??0,image:ee((F==null?void 0:F.icon_url)||""),modelUrl:z,quantity:1,description:(F==null?void 0:F.description)||"",stats:{level:`${x}/5`,health:Number(Ge.health||0),live_left:Number((A==null?void 0:A.live_left)??0),attack:{base:Number(Ge.attack||0),bonus:rt},defense:{base:Number(Ge.defense||0),bonus:bt},dodge:{base:Number(Ge.dodge||0),bonus:$t},class:i[Dt]||""},equipment:[q?{name:((J=q.equipment_base)==null?void 0:J.name)||"",icon:ee(((ue=q.equipment_base)==null?void 0:ue.resource_url)||""),equipped:!0,locked:!1}:{name:"",icon:"",equipped:!1,locked:!1},X!=null&&X.is_slot2_locked?{name:"",icon:"",equipped:!1,locked:!0}:he?{name:((le=he.equipment_base)==null?void 0:le.name)||"",icon:ee(((ie=he.equipment_base)==null?void 0:ie.resource_url)||""),equipped:!0,locked:!1}:{name:"",icon:"",equipped:!1,locked:!1}],skill:{name:(D==null?void 0:D.name)||"",cooldown:(D==null?void 0:D.cool_down)!=null?`${D.cool_down}`:"",effect:(D==null?void 0:D.description)||"",icon:ee((D==null?void 0:D.resource_url)||"")},upgradeCost:r(x)}})}function c(K,A,Q=[]){if(!K||typeof K!="object")return null;if(Object.prototype.hasOwnProperty.call(K,A))return[...Q,A];if(Array.isArray(K)){for(let F=0;F<K.length;F++){const D=c(K[F],A,[...Q,F]);if(D)return D}return null}for(const F of Object.keys(K)){const D=c(K[F],A,[...Q,F]);if(D)return D}return null}function l(K,A){return A.reduce((Q,F)=>Q!=null?Q[F]:void 0,K)}const u=se([]);async function _(){try{const K=Uc();K&&(u.value=s(K))}catch(K){console.error("[Warehouse] :",K),u.value=s({})}}gn(()=>{_(),hc(Sn.UPDATE_RESOURCES,_)});function $(K){let A=K;if(typeof K=="string")try{A=JSON.parse(K)}catch{}A&&A.type_msg&&(A.type_msg==="upgrade_cost_error"?alert(A.content||""):f("[GlobalInfo]",A))}gn(()=>{try{ph($)}catch{}n.musicOn&&oe.value&&setTimeout(()=>{if(oe.value.readyState>=2)oe.value.play().then(()=>{f("[Warehouse] ")}).catch(A=>{f("[Warehouse] :",A)});else{const A=()=>{oe.value.play().then(()=>{f("[Warehouse] ")}).catch(Q=>{f("[Warehouse] :",Q)}),oe.value.removeEventListener("canplay",A)};oe.value.addEventListener("canplay",A,{once:!0})}},200)}),Ln(()=>n.musicOn,K=>{if(oe.value)if(K)if(oe.value.readyState>=2)oe.value.play().catch(A=>{f("[Warehouse] :",A)});else{const A=()=>{oe.value.play().catch(Q=>{f("[Warehouse] :",Q)}),oe.value.removeEventListener("canplay",A)};oe.value.addEventListener("canplay",A)}else oe.value.pause()}),Is(()=>{oe.value&&oe.value.pause(),Fu(Sn.UPDATE_RESOURCES,_)});const d=se([]);gn(async()=>{try{const K=ka();let A=K&&Array.isArray(K.coppers)?K.coppers:[];if(!Array.isArray(A)){const Q=c(K,"coppers");if(f("[Warehouse] copper key path:",Q),Q){const F=l(K,Q);f("[Warehouse] copper found by path:",F),Array.isArray(F)&&(A=F)}!Array.isArray(A)&&K&&K.entries&&f("[Warehouse] copper entries sample:",K.entries)}Array.isArray(A)||f("[Warehouse] copper list not array"),d.value=a(A),Array.isArray(d.value)&&d.value.length>0&&(p.value=d.value[0]),!p.value&&Array.isArray(d.value)&&d.value.length>0&&(p.value=d.value[0])}catch{d.value=[]}});const p=se(null),b=se([]),g=se(null),m=se(null),v=se(null);function y(K,A){K&&(b.value[A]=K)}async function w(K,A){p.value=K,await br();const Q=b.value[A];if(Q&&typeof Q.scrollIntoView=="function"&&Q.scrollIntoView({block:"nearest",inline:"nearest",behavior:"smooth"}),g.value=A,m.value)try{m.value.scrollTo({top:0,behavior:"smooth"})}catch{m.value.scrollTop=0}setTimeout(()=>{g.value===A&&(g.value=null)},320)}const k=se(!1);function L(){k.value=!0}function P(){return k.value?(k.value=!1,!0):!1}t({handleBack:P});async function G(K){try{await _();const A=ka(),Q=Array.isArray(A==null?void 0:A.coppers)?A.coppers:[];d.value=a(Q)}catch{}}async function I(){if(!p.value)return;if(Number(p.value.level||0)>=5){alert("");return}const K=p.value.id,A=$L(K);if(!A||A.type!=="success"){alert(A&&A.content?A.content:"");return}try{await _();const Q=ka(),F=Array.isArray(Q==null?void 0:Q.coppers)?Q.coppers:[];d.value=a(F);const D=d.value.find(X=>X.id===K);D&&(p.value=D)}catch{}}const U=`url('${ee("@assets/ui/panel2.png")}')`,R=`url('${ee("@assets/ui/panel3.png")}')`,M=`url('${ee("@assets/ui/panel4.png")}')`,B=`url('${ee("@assets/ui/panel5.png")}')`,de=`url('${ee("@assets/frontend_resource/Gemini_Generated_Image_e03q5oe03q5oe03q.png")}')`,oe=se(null),be=ee("assets/warehouse.mp3");return(K,A)=>(W(),te("div",fI,[h("div",hI,[(W(!0),te(ht,null,Zn(u.value,Q=>(W(),te("div",{class:"resource-item",key:Q.name},[h("div",gI,[h("img",{src:Q.icon,alt:Q.name},null,8,bI)]),h("div",yI,ae(Q.value),1),h("div",wI,ae(Q.name),1)]))),128))]),k.value?Ie("",!0):(W(),te("div",vI,[h("div",SI,[A[2]||(A[2]=h("div",{class:"warehouse__title"},"",-1)),h("div",kI,[(W(!0),te(ht,null,Zn(d.value,(Q,F)=>{var D;return W(),te("div",{class:St(["puppet-card",{"puppet-card--selected":((D=p.value)==null?void 0:D.id)===Q.id,"puppet-card--pulse":g.value===F,"puppet-card--hover":v.value===F}]),key:Q.id,ref_for:!0,ref:X=>y(X,F),onClick:X=>w(Q,F),onMouseenter:X=>v.value=F,onMouseleave:A[0]||(A[0]=X=>v.value=null)},[h("div",CI,ae(Q.level),1),h("div",xI,[h("img",{src:Q.image,alt:Q.name},null,8,PI)]),h("div",LI,[h("div",II,ae(Q.name)+ae(Q.suffix),1),h("div",TI,ae(Q.level)+"",1)])],42,MI)}),128)),h("div",{class:"puppet-card puppet-card--add",onClick:L},[...A[1]||(A[1]=[h("div",{class:"puppet-card__add-icon"},"+",-1),h("div",{class:"puppet-card__add-text"},"",-1)])])])]),h("div",{class:"warehouse__detail",ref_key:"detailWrap",ref:m},[Pt(Lb,{name:"fade-slide",mode:"out-in"},{default:op(()=>{var Q,F,D,X;return[p.value?(W(),te("div",{class:"puppet-detail",key:((Q=p.value)==null?void 0:Q.id)||"none"},[h("div",EI,[h("h2",AI,ae(p.value.name),1)]),h("div",GI,[h("div",RI,[h("div",OI,[Pt(mI,{puppet:p.value},null,8,["puppet"])]),h("div",DI,ae(p.value.description),1)]),h("div",NI,[h("div",jI,[h("div",HI,[h("div",FI,[A[3]||(A[3]=h("span",{class:"stat-label"},":",-1)),h("span",UI,ae(p.value.stats.health),1)]),h("div",BI,[A[4]||(A[4]=h("span",{class:"stat-label"},":",-1)),h("span",zI,ae(p.value.stats.level),1)]),h("div",VI,[A[5]||(A[5]=h("span",{class:"stat-label"},":",-1)),h("span",qI,ae(p.value.stats.live_left),1)]),h("div",WI,[A[6]||(A[6]=h("span",{class:"stat-label"},":",-1)),h("span",KI,ae(p.value.stats.attack.base),1)]),h("div",JI,[A[7]||(A[7]=h("span",{class:"stat-label"},":",-1)),h("span",XI,ae(p.value.stats.defense.base),1)]),h("div",YI,[A[8]||(A[8]=h("span",{class:"stat-label"},":",-1)),h("span",ZI,ae(p.value.stats.dodge.base)+"% ",1)]),h("div",QI,[A[9]||(A[9]=h("span",{class:"stat-label"},":",-1)),h("span",e8,ae(p.value.stats.class),1)])])]),h("div",t8,[A[10]||(A[10]=h("h4",{class:"section-title"},"",-1)),h("div",n8,[(W(!0),te(ht,null,Zn(p.value.equipment,(q,he)=>(W(),te("div",{key:he,class:St(["equipment-slot",{"equipment-slot--empty":!q.equipped&&!q.locked,"equipment-slot--locked":q.locked}])},[q.equipped&&q.icon&&(q.icon.startsWith("/")||q.icon.startsWith("http"))?(W(),te("img",{key:0,src:q.icon,alt:q.name,class:"equipment-icon"},null,8,s8)):q.locked?(W(),te("img",{key:1,src:we(ee)("@assets/ui/lock.png"),alt:"",class:"equipment-icon"},null,8,o8)):q.icon===""?(W(),te("img",{key:2,src:we(ee)("@assets/ui/jia.png"),alt:"",class:"equipment-icon"},null,8,i8)):(W(),te("span",r8,ae(q.icon),1))],2))),128))])])]),((D=(F=p.value)==null?void 0:F.stats)==null?void 0:D.class)!==""?(W(),te("div",a8,[A[11]||(A[11]=h("h4",{class:"section-title"},"",-1)),h("div",c8,[h("div",l8,[h("div",u8,ae(p.value.skill.name),1),h("div",_8," : "+ae(p.value.skill.cooldown),1),h("div",$8,ae(p.value.skill.effect),1)]),h("div",d8,[p.value.skill.icon&&(p.value.skill.icon.startsWith("/")||p.value.skill.icon.startsWith("http"))?(W(),te("img",{key:0,src:p.value.skill.icon,alt:p.value.skill.name,class:"skill-icon-img"},null,8,p8)):(W(),te("span",m8,ae(p.value.skill.icon),1))])])])):Ie("",!0)]),h("div",f8,[h("div",h8,[p.value.level<5?(W(),te("img",{key:0,src:we(Jn).SpiritalSpark.icon,alt:"",class:"cost-icon-img"},null,8,g8)):Ie("",!0),h("span",b8,ae(p.value.level>=5?"":"X "+p.value.upgradeCost),1)]),h("button",{class:"upgrade-btn",onClick:I,disabled:((X=p.value)==null?void 0:X.level)>=5},[h("img",{src:we(ee)("@assets/ui/upgrade.png"),class:"upgrade-icon",alt:""},null,8,w8)],8,y8)])])):(W(),te("div",v8,[...A[12]||(A[12]=[h("p",null,"",-1)])]))]}),_:1})],512)])),k.value?(W(),Mn(LL,{key:1,onDraw:G})):Ie("",!0),h("audio",{ref_key:"audioRef",ref:oe,src:we(be),loop:"",preload:"auto"},null,8,S8)]))}},M8=Vt(k8,[["__scopeId","data-v-6aa3978d"]]),C8={class:"panel",style:{left:"24px",right:"auto"}},x8=["title"],P8={key:0,width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},L8={key:1,width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},I8={class:"sr-only"},T8={__name:"TopLeftPanel",props:{musicOn:{type:Boolean,default:!0}},emits:["back","open-settings","toggle-music"],setup(e,{emit:t}){return(n,o)=>(W(),te("div",C8,[h("button",{class:"btn",onClick:o[0]||(o[0]=s=>n.$emit("back")),title:""},[...o[3]||(o[3]=[h("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[h("path",{d:"M15 18L9 12L15 6",stroke:"#ffffff","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1),h("span",{class:"sr-only"},"",-1)])]),h("button",{class:"btn",onClick:o[1]||(o[1]=s=>n.$emit("toggle-music")),title:e.musicOn?"":""},[e.musicOn?(W(),te("svg",P8,[...o[4]||(o[4]=[h("path",{d:"M9 18V5L21 3V16",stroke:"#ffffff","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),h("circle",{cx:"6",cy:"18",r:"3",stroke:"#ffffff","stroke-width":"2"},null,-1),h("circle",{cx:"18",cy:"16",r:"3",stroke:"#ffffff","stroke-width":"2"},null,-1)])])):(W(),te("svg",L8,[...o[5]||(o[5]=[h("path",{d:"M9 18V5L21 3V16",stroke:"#ffffff","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),h("circle",{cx:"6",cy:"18",r:"3",stroke:"#ffffff","stroke-width":"2"},null,-1),h("circle",{cx:"18",cy:"16",r:"3",stroke:"#ffffff","stroke-width":"2"},null,-1),h("line",{x1:"2",y1:"2",x2:"22",y2:"22",stroke:"#ffffff","stroke-width":"2","stroke-linecap":"round"},null,-1)])])),h("span",I8,ae(e.musicOn?"":""),1)],8,x8),h("button",{class:"btn",onClick:o[2]||(o[2]=s=>n.$emit("open-settings")),title:""},[...o[6]||(o[6]=[h("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[h("path",{d:"M12 15.5C13.933 15.5 15.5 13.933 15.5 12C15.5 10.067 13.933 8.5 12 8.5C10.067 8.5 8.5 10.067 8.5 12C8.5 13.933 10.067 15.5 12 15.5Z",stroke:"#ffffff","stroke-width":"2"}),h("path",{d:"M19.4 15A7.964 7.964 0 0 0 20 12C20 11.49 19.95 10.99 19.86 10.5L22 8.5L20 5.5L17.34 6.07C16.78 5.58 16.14 5.18 15.44 4.9L15 2H9L8.56 4.9C7.86 5.18 7.22 5.58 6.66 6.07L4 5.5L2 8.5L4.14 10.5C4.05 10.99 4 11.49 4 12C4 12.51 4.05 13.01 4.14 13.5L2 15.5L4 18.5L6.66 17.93C7.22 18.42 7.86 18.82 8.56 19.1L9 22H15L15.44 19.1C16.14 18.82 16.78 18.42 17.34 17.93L20 18.5L22 15.5L19.86 13.5C19.95 13.01 20 12.51 20 12",stroke:"#ffffff","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1),h("span",{class:"sr-only"},"",-1)])])]))}},cd=Vt(T8,[["__scopeId","data-v-8380a348"]]),E8=["automatic_loading_gun","charging_coil","heart_source_mineral_drill","mirro_light_refraction_tower","repair_workshop","resonance_alarm_bell","rivet_barrier","steam_mining_car","storm_anvil"];function A8(){const e=[],t=[{type:"arcanist",name:"bubble"},{type:"craftsman",name:"coil"},{type:"iron_wall",name:"bell"},{type:"mechanic",name:"gyro"},{type:"resonator",name:"clawster"}];for(const o of t){const s=pc(o.type,o.name);e.push(s)}const n=["goblin","guard","demon"];for(const o of n){const s=mc(o);e.push(s)}return f(`[ModelPreloadConfig]  ${e.length} URL`),e}function G8(){const e=[],t=[{type:"arcanist",name:"glimmer"},{type:"arcanist",name:"spark"},{type:"craftsman",name:"artifex"},{type:"craftsman",name:"wrench"},{type:"iron_wall",name:"chief"},{type:"iron_wall",name:"rocky"},{type:"mechanic",name:"karin"},{type:"mechanic",name:"tricky"},{type:"resonator",name:"diggs"},{type:"resonator",name:"hive"}];for(const o of t){const s=pc(o.type,o.name);e.push(s)}const n=["assassin","boxer","cruiser","devourer","glutton"];for(const o of n){const s=mc(o);e.push(s)}return f(`[ModelPreloadConfig]  ${e.length} URL`),e}function R8(){const e=[],t=[{type:"arcanist",name:"syrup"},{type:"arcanist",name:"turner"},{type:"craftsman",name:"drillbit"},{type:"craftsman",name:"quickhand"},{type:"iron_wall",name:"tumble"},{type:"iron_wall",name:"wesley"},{type:"mechanic",name:"pendulum"},{type:"mechanic",name:"yoyo"},{type:"resonator",name:"melody"},{type:"resonator",name:"murmur"}];for(const o of t){const s=pc(o.type,o.name);e.push(s)}const n=["horn","mirror","scout","shatra","variant"];for(const o of n){const s=mc(o);e.push(s)}for(const o of E8){const s=Vp(o);e.push(s)}return f(`[ModelPreloadConfig]  ${e.length} URL`),e}function O8(e=["high","medium"]){const t=[];for(const o of e)switch(o){case"high":t.push(...A8());break;case"medium":t.push(...G8());break;case"low":t.push(...R8());break}const n=[...new Set(t)];return f(`[ModelPreloadConfig]  ${e.join(", ")}  ${n.length} URL`),n}class D8{constructor(){this.isPreloading=!1,this.preloadProgress=0,this.preloadCallbacks=[]}async startPreload(t=["high","medium"],n=null){if(this.isPreloading){f("[ModelPreloadManager] ");return}this.isPreloading=!0,this.preloadProgress=0;try{const o=O8(t);f(`[ModelPreloadManager]  ${o.length}  (: ${t.join(", ")})`),n&&this.preloadCallbacks.push(n),await Gn.preloadModels(o,(s,i,r)=>{this.preloadProgress=r,this.notifyProgress(s,i,r)}),f("[ModelPreloadManager] ")}catch(o){f("[ModelPreloadManager] :",o)}finally{this.isPreloading=!1,this.preloadCallbacks=[]}}notifyProgress(t,n,o){this.preloadCallbacks.forEach(s=>{try{s(t,n,o)}catch(i){f("[ModelPreloadManager] :",i)}})}getStatus(){return{isPreloading:this.isPreloading,progress:this.preloadProgress,cacheStatus:Gn.getCacheStatus()}}isModelPreloaded(t){return Gn.isPreloaded(t)}async preloadModel(t){try{await Gn.loadModel(t,!0),f(`[ModelPreloadManager] : ${t}`)}catch(n){f(`[ModelPreloadManager] : ${t}`,n)}}async preloadModels(t){const n=t.map(o=>this.preloadModel(o));await Promise.all(n),f(`[ModelPreloadManager] : ${t.length} `)}}const ld=new D8,hh="mgpic_game_settings",ud={controlMode:"touchpad",mouseSensitivity:.002};function Vc(){try{const e=localStorage.getItem(hh);if(e){const t=JSON.parse(e);return{...ud,...t}}}catch(e){console.error("[GameSettings] :",e)}return{...ud}}function N8(e){try{return localStorage.setItem(hh,JSON.stringify(e)),!0}catch(t){return console.error("[GameSettings] :",t),!1}}function _d(e){return Vc()[e]}function gh(e,t){const n=Vc();return n[e]=t,N8(n)}const j8={class:"startmenu"},H8={key:0,class:"download-banner"},F8={key:1,class:"settings-local"},U8={class:"settings-local__card"},B8={class:"settings-local__content"},z8={class:"settings-local__row"},V8={class:"setting-options"},q8={__name:"StartMenu",props:{visible:{type:Boolean,default:!0}},emits:["started"],setup(e,{emit:t}){es(M=>({c38888f0:g}));const n=e,o=se(null);let s=null,i=null,r=null,a=null,c=null,l=1.2;const u=se(!1),_=se(!1),$=se(!1),d=se("touchpad"),p=se(!1),b=se(ee("ui/Gemini_Generated_Image_gtrehogtrehogtre (1).png")),g=`url('${ee("@assets/ui/panel4.png")}')`,m=t;Ln(()=>n.visible,M=>{M&&s&&c?k():M||w()});function v(){if(a=requestAnimationFrame(v),c){const M=Date.now()*.001;c.position.y=Math.sin(M*.8)*.1,c.rotation.y=Math.sin(M*.6)*.1;const B=l+Math.sin(M*1.2)*.04;c.scale.setScalar(B)}r&&r.render(s,i)}function y(){!r||!i||(i.aspect=window.innerWidth/window.innerHeight,i.updateProjectionMatrix(),r.setSize(window.innerWidth,window.innerHeight))}function w(){a&&(cancelAnimationFrame(a),a=null),r&&r.setAnimationLoop(null)}function k(){a||v()}function L(){try{w()}catch{}try{window.removeEventListener("resize",y)}catch{}try{s&&(s.traverse(M=>{if(M.isMesh){M.geometry&&M.geometry.dispose&&M.geometry.dispose();const B=M.material;Array.isArray(B)?B.forEach(de=>de&&de.dispose&&de.dispose()):B&&B.dispose&&B.dispose()}}),s.clear())}catch{}try{if(r){r.clear(!0,!0,!0),r.dispose();const M=r.getContext&&r.getContext(),B=M&&M.getExtension&&M.getExtension("WEBGL_lose_context");B&&B.loseContext&&B.loseContext()}}catch{}s=null,i=null,r=null,c=null}async function P(M=null){try{window.getAssetUrl=ee,window.precacheAllResources=Ql,window.getCacheStatus=s1}catch{}if(!s||!r){f("[StartMenu] Scene or renderer not initialized in onMounted");return}if(M&&M(0,100,20),!s.children.some(oe=>oe.isLight)){const oe=new nc(4210752,.4);s.add(oe);const be=new vs(16777215,12.5);be.position.set(-5,-2,1),s.add(be)}M&&M(0,100,50);const de=ee("logo.glb");try{M&&M(0,100,60),f("[StartMenu] Logo...");const oe=await Gn.loadModel(de,!0);M&&M(0,100,80),oe.position.set(0,0,0),s.add(oe);const K=new pn().setFromObject(oe).getCenter(new Be);oe.position.set(-K.x,-K.y,-K.z-.3);try{oe.scale.setScalar(l)}catch{}c=oe,M&&M(0,100,80),f("[StartMenu] Logo ...");try{await ld.startPreload(["high","medium"],(A,Q,F)=>{const D=80+F*.15;M&&M(0,100,Math.round(D)),f(`[StartMenu] : ${A}/${Q} (${F}%)`)}),f("[StartMenu] ")}catch(A){f("[StartMenu] :",A)}M&&M(0,100,100),u.value=!0,f("[StartMenu] "),_.value=!0}catch(oe){f("[StartMenu] 3D",oe);const be=new bs(1,1,1),K=new Bt({color:16096779}),A=new Mt(be,K);s.add(A),c=A,f("[StartMenu] ...");try{await ld.startPreload(["high","medium"],(Q,F,D)=>{const X=80+D*.15;M&&M(0,100,Math.round(X)),f(`[StartMenu] : ${Q}/${F} (${D}%)`)}),f("[StartMenu] ")}catch(Q){f("[StartMenu] :",Q)}M&&M(0,100,100),u.value=!0,f("[StartMenu] "),_.value=!0}window.__START_MENU_PAUSE__=()=>w(),window.__START_MENU_RESUME__=()=>k()}function G(){m("started"),w()}function I(){const M=Vc();d.value=M.controlMode,$.value=!0}function U(){$.value=!1}function R(M){d.value=M,gh("controlMode",M),window.updateControlMode&&window.updateControlMode(M),f(`[StartMenu] : ${M}`)}return gn(()=>{var M;_.value=!1,u.value=!1,p.value=typeof window<"u"&&(window.navigator.userAgent.toLowerCase().includes("electron")||((M=window.process)==null?void 0:M.type)==="renderer"||!!(window.require&&window.process&&window.process.versions&&window.process.versions.electron)),f("[StartMenu] ..."),f("[StartMenu] Electron :",p.value),!s&&o.value?(s=new ec,s.background=null,i=new Nr(50,window.innerWidth/window.innerHeight,.1,1e3),i.position.set(-3.655,.2,-.006),i.rotation.set(-1.618275,-1.538307,-1.6183,"XYZ"),r=new tc({antialias:!0,alpha:!0,canvas:o.value}),r.setSize(window.innerWidth,window.innerHeight),r.setPixelRatio(window.devicePixelRatio),r.setClearColor(0,0),window.addEventListener("resize",y),v(),f("[StartMenu] ")):s&&!c?f("[StartMenu] "):c&&(f("[StartMenu] Logo"),_.value=!0,u.value=!0),window.__INIT_THREE_SCENE__=async B=>{if(s&&c){f("[StartMenu] Logo"),_.value=!0,u.value=!0;return}f("[StartMenu] 3D..."),await P(B)}}),Is(()=>{L()}),(M,B)=>(W(),te("div",j8,[p.value?Ie("",!0):(W(),te("div",H8,[...B[2]||(B[2]=[h("span",{class:"download-banner__text"},"  ",-1),h("a",{href:"https://github.com/MGPIC-2025/Cross/releases",target:"_blank",rel:"noopener noreferrer",class:"download-banner__link"},"  ",-1)])])),h("div",{class:"startmenu__bg",style:zn({backgroundImage:`url('${b.value}')`})},null,4),h("canvas",{ref_key:"canvasRef",ref:o,class:"startmenu__canvas"},null,512),ip(h("div",{class:St(["startmenu-ui",{"fade-in":_.value}])},[h("button",{id:"start-btn",class:"startmenu-btn","aria-label":"",onClick:G},"  "),h("button",{id:"settings-btn",class:"startmenu-btn","aria-label":"",onClick:I},"  ")],2),[[Up,_.value]]),$.value?(W(),te("div",F8,[h("div",U8,[h("div",{class:"settings-local__header"},[B[3]||(B[3]=h("div",{class:"settings-local__title"},"",-1)),h("button",{class:"settings-local__close",onClick:U,"aria-label":""},"  ")]),h("div",B8,[h("div",z8,[B[6]||(B[6]=h("div",{class:"setting-label"},"",-1)),h("div",V8,[h("button",{class:St(["option-btn",{active:d.value==="touchpad"}]),onClick:B[0]||(B[0]=de=>R("touchpad"))},[...B[4]||(B[4]=[h("span",{class:"option-title"},"",-1),h("span",{class:"option-desc"},"",-1)])],2),h("button",{class:St(["option-btn",{active:d.value==="mouse"}]),onClick:B[1]||(B[1]=de=>R("mouse"))},[...B[5]||(B[5]=[h("span",{class:"option-title"},"",-1),h("span",{class:"option-desc"},"",-1)])],2)])])])])])):Ie("",!0)]))}},W8=Vt(q8,[["__scopeId","data-v-b236fd15"]]),$d={type:"change"},b_={type:"start"},bh={type:"end"},$a=new S0,dd=new Cd,K8=Math.cos(70*kd.DEG2RAD),Ht=new Be,wn=2*Math.PI,_t={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},El=1e-6;class J8 extends v0{constructor(t,n=null){super(t,n),this.state=_t.NONE,this.target=new Be,this.cursor=new Be,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.keyRotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:bi.ROTATE,MIDDLE:bi.DOLLY,RIGHT:bi.PAN},this.touches={ONE:gi.ROTATE,TWO:gi.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this._lastPosition=new Be,this._lastQuaternion=new Li,this._lastTargetPosition=new Be,this._quat=new Li().setFromUnitVectors(t.up,new Be(0,1,0)),this._quatInverse=this._quat.clone().invert(),this._spherical=new C_,this._sphericalDelta=new C_,this._scale=1,this._panOffset=new Be,this._rotateStart=new $n,this._rotateEnd=new $n,this._rotateDelta=new $n,this._panStart=new $n,this._panEnd=new $n,this._panDelta=new $n,this._dollyStart=new $n,this._dollyEnd=new $n,this._dollyDelta=new $n,this._dollyDirection=new Be,this._mouse=new $n,this._performCursorZoom=!1,this._pointers=[],this._pointerPositions={},this._controlActive=!1,this._onPointerMove=Y8.bind(this),this._onPointerDown=X8.bind(this),this._onPointerUp=Z8.bind(this),this._onContextMenu=iT.bind(this),this._onMouseWheel=tT.bind(this),this._onKeyDown=nT.bind(this),this._onTouchStart=sT.bind(this),this._onTouchMove=oT.bind(this),this._onMouseDown=Q8.bind(this),this._onMouseMove=eT.bind(this),this._interceptControlDown=rT.bind(this),this._interceptControlUp=aT.bind(this),this.domElement!==null&&this.connect(this.domElement),this.update()}connect(t){super.connect(t),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerUp),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.getRootNode().addEventListener("keydown",this._interceptControlDown,{passive:!0,capture:!0}),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerUp),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.stopListenToKeyEvents(),this.domElement.getRootNode().removeEventListener("keydown",this._interceptControlDown,{capture:!0}),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}getPolarAngle(){return this._spherical.phi}getAzimuthalAngle(){return this._spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(t){t.addEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=t}stopListenToKeyEvents(){this._domElementKeyEvents!==null&&(this._domElementKeyEvents.removeEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=null)}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}reset(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent($d),this.update(),this.state=_t.NONE}update(t=null){const n=this.object.position;Ht.copy(n).sub(this.target),Ht.applyQuaternion(this._quat),this._spherical.setFromVector3(Ht),this.autoRotate&&this.state===_t.NONE&&this._rotateLeft(this._getAutoRotationAngle(t)),this.enableDamping?(this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor,this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor):(this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi);let o=this.minAzimuthAngle,s=this.maxAzimuthAngle;isFinite(o)&&isFinite(s)&&(o<-Math.PI?o+=wn:o>Math.PI&&(o-=wn),s<-Math.PI?s+=wn:s>Math.PI&&(s-=wn),o<=s?this._spherical.theta=Math.max(o,Math.min(s,this._spherical.theta)):this._spherical.theta=this._spherical.theta>(o+s)/2?Math.max(o,this._spherical.theta):Math.min(s,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),this.enableDamping===!0?this.target.addScaledVector(this._panOffset,this.dampingFactor):this.target.add(this._panOffset),this.target.sub(this.cursor),this.target.clampLength(this.minTargetRadius,this.maxTargetRadius),this.target.add(this.cursor);let i=!1;if(this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{const r=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._scale),i=r!=this._spherical.radius}if(Ht.setFromSpherical(this._spherical),Ht.applyQuaternion(this._quatInverse),n.copy(this.target).add(Ht),this.object.lookAt(this.target),this.enableDamping===!0?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this.zoomToCursor&&this._performCursorZoom){let r=null;if(this.object.isPerspectiveCamera){const a=Ht.length();r=this._clampDistance(a*this._scale);const c=a-r;this.object.position.addScaledVector(this._dollyDirection,c),this.object.updateMatrixWorld(),i=!!c}else if(this.object.isOrthographicCamera){const a=new Be(this._mouse.x,this._mouse.y,0);a.unproject(this.object);const c=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),this.object.updateProjectionMatrix(),i=c!==this.object.zoom;const l=new Be(this._mouse.x,this._mouse.y,0);l.unproject(this.object),this.object.position.sub(l).add(a),this.object.updateMatrixWorld(),r=Ht.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),this.zoomToCursor=!1;r!==null&&(this.screenSpacePanning?this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(r).add(this.object.position):($a.origin.copy(this.object.position),$a.direction.set(0,0,-1).transformDirection(this.object.matrix),Math.abs(this.object.up.dot($a.direction))<K8?this.object.lookAt(this.target):(dd.setFromNormalAndCoplanarPoint(this.object.up,this.target),$a.intersectPlane(dd,this.target))))}else if(this.object.isOrthographicCamera){const r=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),r!==this.object.zoom&&(this.object.updateProjectionMatrix(),i=!0)}return this._scale=1,this._performCursorZoom=!1,i||this._lastPosition.distanceToSquared(this.object.position)>El||8*(1-this._lastQuaternion.dot(this.object.quaternion))>El||this._lastTargetPosition.distanceToSquared(this.target)>El?(this.dispatchEvent($d),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),!0):!1}_getAutoRotationAngle(t){return t!==null?wn/60*this.autoRotateSpeed*t:wn/60/60*this.autoRotateSpeed}_getZoomScale(t){const n=Math.abs(t*.01);return Math.pow(.95,this.zoomSpeed*n)}_rotateLeft(t){this._sphericalDelta.theta-=t}_rotateUp(t){this._sphericalDelta.phi-=t}_panLeft(t,n){Ht.setFromMatrixColumn(n,0),Ht.multiplyScalar(-t),this._panOffset.add(Ht)}_panUp(t,n){this.screenSpacePanning===!0?Ht.setFromMatrixColumn(n,1):(Ht.setFromMatrixColumn(n,0),Ht.crossVectors(this.object.up,Ht)),Ht.multiplyScalar(t),this._panOffset.add(Ht)}_pan(t,n){const o=this.domElement;if(this.object.isPerspectiveCamera){const s=this.object.position;Ht.copy(s).sub(this.target);let i=Ht.length();i*=Math.tan(this.object.fov/2*Math.PI/180),this._panLeft(2*t*i/o.clientHeight,this.object.matrix),this._panUp(2*n*i/o.clientHeight,this.object.matrix)}else this.object.isOrthographicCamera?(this._panLeft(t*(this.object.right-this.object.left)/this.object.zoom/o.clientWidth,this.object.matrix),this._panUp(n*(this.object.top-this.object.bottom)/this.object.zoom/o.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}_dollyOut(t){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale/=t:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_dollyIn(t){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale*=t:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_updateZoomParameters(t,n){if(!this.zoomToCursor)return;this._performCursorZoom=!0;const o=this.domElement.getBoundingClientRect(),s=t-o.left,i=n-o.top,r=o.width,a=o.height;this._mouse.x=s/r*2-1,this._mouse.y=-(i/a)*2+1,this._dollyDirection.set(this._mouse.x,this._mouse.y,1).unproject(this.object).sub(this.object.position).normalize()}_clampDistance(t){return Math.max(this.minDistance,Math.min(this.maxDistance,t))}_handleMouseDownRotate(t){this._rotateStart.set(t.clientX,t.clientY)}_handleMouseDownDolly(t){this._updateZoomParameters(t.clientX,t.clientX),this._dollyStart.set(t.clientX,t.clientY)}_handleMouseDownPan(t){this._panStart.set(t.clientX,t.clientY)}_handleMouseMoveRotate(t){this._rotateEnd.set(t.clientX,t.clientY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const n=this.domElement;this._rotateLeft(wn*this._rotateDelta.x/n.clientHeight),this._rotateUp(wn*this._rotateDelta.y/n.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()}_handleMouseMoveDolly(t){this._dollyEnd.set(t.clientX,t.clientY),this._dollyDelta.subVectors(this._dollyEnd,this._dollyStart),this._dollyDelta.y>0?this._dollyOut(this._getZoomScale(this._dollyDelta.y)):this._dollyDelta.y<0&&this._dollyIn(this._getZoomScale(this._dollyDelta.y)),this._dollyStart.copy(this._dollyEnd),this.update()}_handleMouseMovePan(t){this._panEnd.set(t.clientX,t.clientY),this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()}_handleMouseWheel(t){this._updateZoomParameters(t.clientX,t.clientY),t.deltaY<0?this._dollyIn(this._getZoomScale(t.deltaY)):t.deltaY>0&&this._dollyOut(this._getZoomScale(t.deltaY)),this.update()}_handleKeyDown(t){let n=!1;switch(t.code){case this.keys.UP:t.ctrlKey||t.metaKey||t.shiftKey?this.enableRotate&&this._rotateUp(wn*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,this.keyPanSpeed),n=!0;break;case this.keys.BOTTOM:t.ctrlKey||t.metaKey||t.shiftKey?this.enableRotate&&this._rotateUp(-wn*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,-this.keyPanSpeed),n=!0;break;case this.keys.LEFT:t.ctrlKey||t.metaKey||t.shiftKey?this.enableRotate&&this._rotateLeft(wn*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(this.keyPanSpeed,0),n=!0;break;case this.keys.RIGHT:t.ctrlKey||t.metaKey||t.shiftKey?this.enableRotate&&this._rotateLeft(-wn*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(-this.keyPanSpeed,0),n=!0;break}n&&(t.preventDefault(),this.update())}_handleTouchStartRotate(t){if(this._pointers.length===1)this._rotateStart.set(t.pageX,t.pageY);else{const n=this._getSecondPointerPosition(t),o=.5*(t.pageX+n.x),s=.5*(t.pageY+n.y);this._rotateStart.set(o,s)}}_handleTouchStartPan(t){if(this._pointers.length===1)this._panStart.set(t.pageX,t.pageY);else{const n=this._getSecondPointerPosition(t),o=.5*(t.pageX+n.x),s=.5*(t.pageY+n.y);this._panStart.set(o,s)}}_handleTouchStartDolly(t){const n=this._getSecondPointerPosition(t),o=t.pageX-n.x,s=t.pageY-n.y,i=Math.sqrt(o*o+s*s);this._dollyStart.set(0,i)}_handleTouchStartDollyPan(t){this.enableZoom&&this._handleTouchStartDolly(t),this.enablePan&&this._handleTouchStartPan(t)}_handleTouchStartDollyRotate(t){this.enableZoom&&this._handleTouchStartDolly(t),this.enableRotate&&this._handleTouchStartRotate(t)}_handleTouchMoveRotate(t){if(this._pointers.length==1)this._rotateEnd.set(t.pageX,t.pageY);else{const o=this._getSecondPointerPosition(t),s=.5*(t.pageX+o.x),i=.5*(t.pageY+o.y);this._rotateEnd.set(s,i)}this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const n=this.domElement;this._rotateLeft(wn*this._rotateDelta.x/n.clientHeight),this._rotateUp(wn*this._rotateDelta.y/n.clientHeight),this._rotateStart.copy(this._rotateEnd)}_handleTouchMovePan(t){if(this._pointers.length===1)this._panEnd.set(t.pageX,t.pageY);else{const n=this._getSecondPointerPosition(t),o=.5*(t.pageX+n.x),s=.5*(t.pageY+n.y);this._panEnd.set(o,s)}this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd)}_handleTouchMoveDolly(t){const n=this._getSecondPointerPosition(t),o=t.pageX-n.x,s=t.pageY-n.y,i=Math.sqrt(o*o+s*s);this._dollyEnd.set(0,i),this._dollyDelta.set(0,Math.pow(this._dollyEnd.y/this._dollyStart.y,this.zoomSpeed)),this._dollyOut(this._dollyDelta.y),this._dollyStart.copy(this._dollyEnd);const r=(t.pageX+n.x)*.5,a=(t.pageY+n.y)*.5;this._updateZoomParameters(r,a)}_handleTouchMoveDollyPan(t){this.enableZoom&&this._handleTouchMoveDolly(t),this.enablePan&&this._handleTouchMovePan(t)}_handleTouchMoveDollyRotate(t){this.enableZoom&&this._handleTouchMoveDolly(t),this.enableRotate&&this._handleTouchMoveRotate(t)}_addPointer(t){this._pointers.push(t.pointerId)}_removePointer(t){delete this._pointerPositions[t.pointerId];for(let n=0;n<this._pointers.length;n++)if(this._pointers[n]==t.pointerId){this._pointers.splice(n,1);return}}_isTrackingPointer(t){for(let n=0;n<this._pointers.length;n++)if(this._pointers[n]==t.pointerId)return!0;return!1}_trackPointer(t){let n=this._pointerPositions[t.pointerId];n===void 0&&(n=new $n,this._pointerPositions[t.pointerId]=n),n.set(t.pageX,t.pageY)}_getSecondPointerPosition(t){const n=t.pointerId===this._pointers[0]?this._pointers[1]:this._pointers[0];return this._pointerPositions[n]}_customWheelEvent(t){const n=t.deltaMode,o={clientX:t.clientX,clientY:t.clientY,deltaY:t.deltaY};switch(n){case 1:o.deltaY*=16;break;case 2:o.deltaY*=100;break}return t.ctrlKey&&!this._controlActive&&(o.deltaY*=10),o}}function X8(e){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(e.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),!this._isTrackingPointer(e)&&(this._addPointer(e),e.pointerType==="touch"?this._onTouchStart(e):this._onMouseDown(e)))}function Y8(e){this.enabled!==!1&&(e.pointerType==="touch"?this._onTouchMove(e):this._onMouseMove(e))}function Z8(e){switch(this._removePointer(e),this._pointers.length){case 0:this.domElement.releasePointerCapture(e.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.dispatchEvent(bh),this.state=_t.NONE;break;case 1:const t=this._pointers[0],n=this._pointerPositions[t];this._onTouchStart({pointerId:t,pageX:n.x,pageY:n.y});break}}function Q8(e){let t;switch(e.button){case 0:t=this.mouseButtons.LEFT;break;case 1:t=this.mouseButtons.MIDDLE;break;case 2:t=this.mouseButtons.RIGHT;break;default:t=-1}switch(t){case bi.DOLLY:if(this.enableZoom===!1)return;this._handleMouseDownDolly(e),this.state=_t.DOLLY;break;case bi.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(this.enablePan===!1)return;this._handleMouseDownPan(e),this.state=_t.PAN}else{if(this.enableRotate===!1)return;this._handleMouseDownRotate(e),this.state=_t.ROTATE}break;case bi.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(this.enableRotate===!1)return;this._handleMouseDownRotate(e),this.state=_t.ROTATE}else{if(this.enablePan===!1)return;this._handleMouseDownPan(e),this.state=_t.PAN}break;default:this.state=_t.NONE}this.state!==_t.NONE&&this.dispatchEvent(b_)}function eT(e){switch(this.state){case _t.ROTATE:if(this.enableRotate===!1)return;this._handleMouseMoveRotate(e);break;case _t.DOLLY:if(this.enableZoom===!1)return;this._handleMouseMoveDolly(e);break;case _t.PAN:if(this.enablePan===!1)return;this._handleMouseMovePan(e);break}}function tT(e){this.enabled===!1||this.enableZoom===!1||this.state!==_t.NONE||(e.preventDefault(),this.dispatchEvent(b_),this._handleMouseWheel(this._customWheelEvent(e)),this.dispatchEvent(bh))}function nT(e){this.enabled!==!1&&this._handleKeyDown(e)}function sT(e){switch(this._trackPointer(e),this._pointers.length){case 1:switch(this.touches.ONE){case gi.ROTATE:if(this.enableRotate===!1)return;this._handleTouchStartRotate(e),this.state=_t.TOUCH_ROTATE;break;case gi.PAN:if(this.enablePan===!1)return;this._handleTouchStartPan(e),this.state=_t.TOUCH_PAN;break;default:this.state=_t.NONE}break;case 2:switch(this.touches.TWO){case gi.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchStartDollyPan(e),this.state=_t.TOUCH_DOLLY_PAN;break;case gi.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchStartDollyRotate(e),this.state=_t.TOUCH_DOLLY_ROTATE;break;default:this.state=_t.NONE}break;default:this.state=_t.NONE}this.state!==_t.NONE&&this.dispatchEvent(b_)}function oT(e){switch(this._trackPointer(e),this.state){case _t.TOUCH_ROTATE:if(this.enableRotate===!1)return;this._handleTouchMoveRotate(e),this.update();break;case _t.TOUCH_PAN:if(this.enablePan===!1)return;this._handleTouchMovePan(e),this.update();break;case _t.TOUCH_DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchMoveDollyPan(e),this.update();break;case _t.TOUCH_DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchMoveDollyRotate(e),this.update();break;default:this.state=_t.NONE}}function iT(e){this.enabled!==!1&&e.preventDefault()}function rT(e){e.key==="Control"&&(this._controlActive=!0,this.domElement.getRootNode().addEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function aT(e){e.key==="Control"&&(this._controlActive=!1,this.domElement.getRootNode().removeEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}const cT={class:"startgame-modal"},lT={class:"card"},uT={class:"card__header"},_T=["src"],$T={class:"card__body"},dT={class:"card__content"},pT={key:0,class:"loading"},mT={key:1,class:"error"},fT={key:2,class:"list"},hT=["onClick"],gT={class:"item__img"},bT=["src","alt"],yT={class:"item__meta"},wT={class:"item__name"},vT={class:"item__level"},ST={class:"preview"},kT={class:"preview__info"},MT={key:0,class:"preview__empty"},CT={key:1,class:"preview__names"},xT={class:"preview__name-number"},PT={class:"preview__name-text"},LT={class:"card__footer"},IT=["disabled"],TT=["src"],ET={__name:"StartGame",props:{musicOn:{type:Boolean,default:!0},paused:{type:Boolean,default:!1}},emits:["confirm","close"],setup(e,{emit:t}){es(D=>({bbb41996:B,bbb2481a:oe,bbacd3a6:Q,baefcf7a:F,bbaf8de0:be,bbadbc64:A,bbb330d8:de,bbaea522:K}));const n=t,o=e,s=se(!0),i=se(""),r=se([]),a=se(new Set),c=se(null),l=se(null),u=ee("@assets/frontend_resource/startgame.mp3");let _,$,d,p,b;const g=new Map,m=Je(()=>a.value.size===3),v=Je(()=>r.value.filter(D=>a.value.has(D.id)));function y(){if(!c.value)return;_=new ec,_.background=new ls(1710618),$=new Nr(45,c.value.clientWidth/c.value.clientHeight,.1,100),$.position.set(0,3,8),d=new tc({antialias:!0}),d.setSize(c.value.clientWidth,c.value.clientHeight),d.setPixelRatio(window.devicePixelRatio),c.value.appendChild(d.domElement),p=new J8($,d.domElement),p.enableDamping=!0,p.dampingFactor=.05,p.target.set(0,1,0);const D=new nc(16777215,.5);_.add(D);const X=new vs(16777215,1);X.position.set(0,5,10),_.add(X);const q=new vs(11193599,.4);q.position.set(-5,3,5),_.add(q);const he=new vs(16764074,.4);he.position.set(5,3,5),_.add(he);const Ge=new vs(16777215,.3);Ge.position.set(0,5,-5),_.add(Ge);const qe=new fr(20,20),He=new Ut({color:2763306,side:Cn}),rt=new Mt(qe,He);rt.rotation.x=-Math.PI/2,rt.position.y=0,_.add(rt),b=new Bc;const bt=new zc;bt.setDecoderPath("https://www.gstatic.com/draco/versioned/decoders/1.5.6/"),b.setDRACOLoader(bt),w(),window.addEventListener("resize",k)}function w(){requestAnimationFrame(w),p&&p.update(),d&&_&&$&&d.render(_,$)}function k(){!c.value||!$||!d||($.aspect=c.value.clientWidth/c.value.clientHeight,$.updateProjectionMatrix(),d.setSize(c.value.clientWidth,c.value.clientHeight))}function L(D){const X=a.value;if(X.has(D))X.delete(D);else{if(X.size>=3)return;X.add(D)}a.value=new Set(X)}async function P(D,X){if(!_||!b)return;let q=D.modelUrl;f(`[StartGame] model_url: ${D.name}, URL: ${q}`);try{const he=await Gn.loadModel(q,!0);f(`[StartGame] : ${D.name}`);const qe=new pn().setFromObject(he).getSize(new Be),He=new ss;He.add(he);const rt=2.5,bt=-(v.value.length-1)*rt/2;He.position.set(bt+X*rt,0,0),He.scale.set(1,1,1),He.rotation.y=-Math.PI/2;const $t=new pn().setFromObject(He);He.position.y=-$t.min.y,_.add(He),g.set(D.id,He),f(`[StartGame] : ${D.name}`)}catch(he){f(`[StartGame] : ${D.name}`,he),G(D,X)}}function G(D,X){if(!_)return;const q=new bs(.8,.8,.8),he=new Ut({color:4491519}),Ge=new Mt(q,he),qe=2.5,He=-(v.value.length-1)*qe/2;Ge.position.set(He+X*qe,.8,0),Ge.rotation.y=-Math.PI/2,_.add(Ge),g.set(D.id,Ge)}function I(){_&&(g.forEach(D=>{_.remove(D),D.geometry&&D.geometry.dispose(),D.material&&(Array.isArray(D.material)?D.material.forEach(X=>X.dispose()):D.material.dispose())}),g.clear(),v.value.forEach((D,X)=>{P(D,X)}))}async function U(){s.value=!0,i.value="";try{const D=ka(),X=Array.isArray(D==null?void 0:D.coppers)?D.coppers:[];r.value=(X||[]).map((q,he)=>{var qe,He,rt,bt,$t,Dt;const Ge=(qe=q==null?void 0:q.copper_info)==null?void 0:qe.model_url;return f(`[StartGame] Copper ${((He=q==null?void 0:q.copper_info)==null?void 0:He.name)||he+1}: model_url=${Ge}`),{id:Number((q==null?void 0:q.id)??he+1),name:((rt=q==null?void 0:q.copper_info)==null?void 0:rt.name)||`#${he+1}`,icon:ee(((bt=q==null?void 0:q.copper_info)==null?void 0:bt.icon_url)||""),level:Number((q==null?void 0:q.level)??1),copperType:(q==null?void 0:q.copper_type)||"Arcanist",modelName:((Dt=($t=q==null?void 0:q.copper_info)==null?void 0:$t.name)==null?void 0:Dt.toLowerCase())||"",modelUrl:Ge?ee(Ge):""}})}catch(D){f("[StartGame] ",D),i.value=""}finally{s.value=!1}}async function R(){if(a.value.size!==3)return;const D=Array.from(a.value).map(X=>String(X));window.__ACTUAL_COPPER_IDS__=D,f("[StartGame] ID:",D),n("confirm",{ids:D})}function M(){n("close")}Ln(v,()=>{I()},{deep:!0}),gn(()=>{U(),setTimeout(()=>{y()},100),o.musicOn&&!o.paused&&l.value&&setTimeout(()=>{const X=l.value;if(X)if(X.readyState>=2)X.play().then(()=>{f("[StartGame] ")}).catch(q=>{f("[StartGame] :",q)});else{const q=()=>{const he=l.value;he&&(he.play().then(()=>{f("[StartGame] ")}).catch(Ge=>{f("[StartGame] :",Ge)}),he.removeEventListener("canplay",q))};X.addEventListener("canplay",q,{once:!0})}},200)}),Ln(()=>o.musicOn,D=>{const X=l.value;if(X)if(D&&!o.paused)if(X.readyState>=2)X.play().catch(q=>{f("[StartGame] :",q)});else{const q=()=>{const he=l.value;he&&(he.play().catch(Ge=>{f("[StartGame] :",Ge)}),he.removeEventListener("canplay",q))};X.addEventListener("canplay",q)}else X.pause()}),Ln(()=>o.paused,D=>{const X=l.value;if(X){if(D)X.pause(),f("[StartGame] ");else if(o.musicOn){if(X.readyState>=2)X.play().catch(q=>{f("[StartGame] :",q)});else{const q=()=>{const he=l.value;he&&(he.play().catch(Ge=>{f("[StartGame] :",Ge)}),he.removeEventListener("canplay",q))};X.addEventListener("canplay",q)}f("[StartGame] ")}}}),Is(()=>{window.removeEventListener("resize",k),l.value&&l.value.pause(),g.forEach(D=>{_&&_.remove(D)}),g.clear(),d&&d.dispose(),p&&p.dispose()});const B=`url('${ee("@assets/ui/panel1.png")}')`,de=`url('${ee("@assets/ui/panel2.png")}')`,oe=`url('${ee("@assets/ui/panel3.png")}')`,be=`url('${ee("@assets/ui/panel6.png")}')`,K=`url('${ee("@assets/ui/panel7.png")}')`,A=`url('${ee("@assets/ui/panel8.png")}')`,Q=`url('${ee("@assets/ui/panel9.png")}')`,F=`url('${ee("@assets/ui/panel10.png")}')`;return(D,X)=>(W(),te("div",cT,[h("div",lT,[h("div",uT,[X[0]||(X[0]=h("div",{class:"card__title"},"",-1)),h("button",{class:"card__close",onClick:M,"aria-label":""},[h("img",{src:we(ee)("@assets/ui/close.png"),alt:""},null,8,_T)])]),h("div",$T,[h("div",dT,[s.value?(W(),te("div",pT,"...")):i.value?(W(),te("div",mT,ae(i.value),1)):(W(),te("div",fT,[(W(!0),te(ht,null,Zn(r.value,q=>(W(),te("div",{key:q.id,class:St(["item",{"item--selected":a.value.has(q.id)}]),onClick:he=>L(q.id)},[h("div",gT,[h("img",{src:q.icon,alt:q.name},null,8,bT)]),h("div",yT,[h("div",wT,ae(q.name),1),h("div",vT,"Lv. "+ae(q.level),1)])],10,hT))),128))])),X[1]||(X[1]=h("div",{class:"hint"},"3",-1))]),h("div",ST,[X[2]||(X[2]=h("div",{class:"preview__title"},"",-1)),h("div",{ref_key:"previewContainer",ref:c,class:"preview__scene"},null,512),h("div",kT,[v.value.length===0?(W(),te("div",MT,"  ")):(W(),te("div",CT,[(W(!0),te(ht,null,Zn(v.value,(q,he)=>(W(),te("div",{key:q.id,class:"preview__name"},[h("span",xT,ae(he+1),1),h("span",PT,ae(q.name),1)]))),128))]))])])]),h("div",LT,[h("button",{class:"btn btn--primary",disabled:!m.value,onClick:R},"  ",8,IT),h("button",{class:"btn",onClick:M},"")])]),h("audio",{ref_key:"audioRef",ref:l,src:we(u),loop:"",preload:"auto"},null,8,TT)]))}},AT=Vt(ET,[["__scopeId","data-v-82ac7d58"]]),GT={:"spark",:"syrup",:"bubble",:"glimmer",:"turner",:"wrench",:"artifex",:"coil",:"drillbit",:"quickhand",:"rocky",:"wesley",:"bell",:"tumble",:"chief",:"gyro",:"tricky",:"pendulum",:"yoyo",:"karin",:"murmur",:"melody",:"clawster",:"diggs",:"hive"},RT={IronWall:"iron_wall",Arcanist:"arcanist",Mechanic:"mechanic",Resonator:"resonator",CraftsMan:"craftsman"};function OT(e){return GT[e]||e.toLowerCase()}function DT(e){return RT[e]||e.toLowerCase()}const NT={:"rivet_barrier",:"gear_arrow_tower",:"heart_source_mineral_drill",:"steam_mining_car",:"charging_coil",:"repair_workshop",:"mirro_light_refraction_tower",:"resonance_alarm_bell",:"storm_anvil",:"automatic_loading_gun"};function jT(e){return NT[e]||e.toLowerCase().replace(/\s+/g,"_")}function HT(e,t){const n=new Map;function o(l,u,_){if(n.has(l)){const k=n.get(l);k.maxHp=_,s(l,u,_);return}const $=1,d=.1,p=new fr($,d),b=new Bt({color:4456448,side:Cn,depthTest:!1,depthWrite:!1,transparent:!1,toneMapped:!1}),g=new Mt(p,b),m=new fr($,d),v=new Bt({color:i(u,_),side:Cn,depthTest:!1,depthWrite:!1,transparent:!1,toneMapped:!1}),y=new Mt(m,v);y.position.z=.001;const w=new ss;w.add(g),w.add(y),w.renderOrder=999,g.renderOrder=999,y.renderOrder=1e3,e.add(w),n.set(l,{bar:y,background:g,container:w,maxHp:_}),s(l,u,_)}function s(l,u,_){const $=n.get(l);if(!$)return;const{bar:d}=$,p=Math.max(0,Math.min(1,u/_));d.scale.x=p,d.position.x=-(1-p)*.5,d.material.color.setHex(i(u,_))}function i(l,u){const _=l/u;return _>.6?65280:_>.3?16776960:16711680}function r(l){const u=n.get(l);if(!u)return;const{bar:_,background:$,container:d}=u;_.geometry.dispose(),_.material.dispose(),$.geometry.dispose(),$.material.dispose(),e.remove(d),n.delete(l)}function a(l){n.forEach((u,_)=>{const $=l.find(d=>d.id===_);if($&&$.object){const{container:d}=u,p=$.object.position.clone();p.y+=1.5,d.position.copy(p),d.lookAt(t.position)}})}function c(){n.forEach((l,u)=>{r(u)}),n.clear()}return{healthBars:n,createOrUpdateHealthBar:o,updateHealthBarValue:s,removeHealthBar:r,updateHealthBarsPosition:a,dispose:c}}const FT={url:ee("@assets/ui/skybox.jpg"),radius:1e3,segments:32,hemisphere:!1},UT={ambient:{color:16777215,intensity:.5},mainDirectional:{color:16777215,intensity:1.2,position:{x:0,y:20,z:5},castShadow:!0},topLight:{color:16777215,intensity:.8,position:{x:0,y:30,z:0}},hemisphere:{skyColor:16777215,groundColor:4473924,intensity:.6,position:{x:0,y:20,z:0}}};function BT(){return{...FT}}const zT={fov:60,near:.1,far:2e3,position:{x:0,y:5,z:10}},VT={antialias:!0},qT={decoderPath:"https://www.gstatic.com/draco/versioned/decoders/1.5.6/"},WT={moveSpeed:.2,rotationSpeed:.003,focusLerpFactor:.08},KT={enabled:!0,units:[{id:1,name:"1",color:4491519,position:{x:.5,y:.4,z:.5},size:.8},{id:2,name:"2",color:16729156,position:{x:4.5,y:.4,z:4.5},size:.8}]},JT={enabled:!0,materialType:"standard",basic:{color:4868682,opacity:.8},standard:{color:5921386,roughness:.3,metalness:.7,opacity:.8},texture:{url:null,repeat:{x:1,y:1}},size:.95,height:.05,yOffset:-.02},XT={enabled:!1,size:100,materialType:"standard",texture:{url:null,repeat:{x:10,y:10},wrapS:"RepeatWrapping",wrapT:"RepeatWrapping"},color:{value:2763306},standard:{color:3815994,roughness:.8,metalness:.1,normalMap:null,normalScale:{x:1,y:1},roughnessMap:null,aoMap:null},position:{x:0,y:0,z:0},rotation:{x:-Math.PI/2,y:0,z:0}};function YT(){return{...UT}}function ZT(){return{...zT}}function QT(){return{...VT}}function eE(){return{...qT}}function pd(){return{...WT}}function tE(){return{...KT}}function nE(){return{...XT}}function yh(){return{...JT}}function sE(e){const t={move:[],attack:[],summon:[]},n=yh();function o(_={}){var d;const $={...n,..._};if(!$.enabled)return new Bt({transparent:!0,opacity:0});if($.materialType==="texture"&&$.texture.url){const b=new Ii().load($.texture.url);return b.colorSpace=nn,b.wrapS=Vs,b.wrapT=Vs,b.repeat.set($.texture.repeat.x,$.texture.repeat.y),new Ut({map:b,side:Cn,transparent:!0,opacity:((d=$.standard)==null?void 0:d.opacity)||1})}else return $.materialType==="standard"?new Ut({color:$.standard.color,roughness:$.standard.roughness,metalness:$.standard.metalness,side:Cn,transparent:!0,opacity:$.standard.opacity}):new Bt({color:$.basic.color,side:Cn,transparent:!0,opacity:$.basic.opacity})}const s={move:{color:4521796,opacity:.6},attack:{color:16729156,opacity:.6},summon:{color:16776960,opacity:.6}};function i(_,$="move"){const[d,p]=_,b=s[$]||s.move,g=n.size||.9,m=n.height||.08,v=new fr(g,g),y=new Bt({color:b.color,side:Cn,transparent:!0,opacity:b.opacity}),w=new Mt(v,y);return w.rotation.x=-Math.PI/2,w.position.set(d,m,p),w.userData={position:_,type:$},e.add(w),t[$].push(w),w}function r(_){const[$,d]=_;let p=!1;return Object.keys(t).forEach(b=>{const g=t[b].findIndex(m=>{const v=m.userData.position;return v[0]===$&&v[1]===d});if(g!==-1){const m=t[b][g];e.remove(m),m.geometry.dispose(),m.material.dispose(),t[b].splice(g,1),p=!0}}),p}function a(_){t[_]&&(t[_].forEach($=>{e.remove($),$.geometry.dispose(),$.material.dispose()}),t[_]=[])}function c(){Object.keys(t).forEach(_=>{a(_)})}function l(_,$){var b;const[d,p]=_;return(b=t[$])==null?void 0:b.some(g=>{const m=g.userData.position;return m[0]===d&&m[1]===p})}function u(){c()}return{indicators:t,createIndicator:i,createCellMaterial:o,clearIndicatorAt:r,clearIndicators:a,clearAllIndicators:c,hasIndicatorAt:l,dispose:u}}function oE(){const e={geometries:[],materials:[],meshes:[],maxSize:10},t={geometries:[],materials:[],meshes:[],maxSize:10};function n(a){let c;if(e.meshes.length>0)c=e.meshes.pop(),c.geometry.dispose(),c.geometry=new Ca(.05,.05,a,8),c.material.opacity=.9;else{const l=new Ca(.05,.05,a,8),u=new Bt({color:16729156,transparent:!0,opacity:.9,emissive:16729156,emissiveIntensity:.5});c=new Mt(l,u)}return c}function o(a){e.meshes.length<e.maxSize?e.meshes.push(a):(a.geometry.dispose(),a.material.dispose())}function s(){let a;if(t.meshes.length>0)a=t.meshes.pop(),a.scale.set(1,1,1),a.material.opacity=.8;else{const c=new Dl(.2,.4,32),l=new Bt({color:16711680,side:Cn,transparent:!0,opacity:.8,emissive:16711680,emissiveIntensity:.5});a=new Mt(c,l),a.rotation.x=-Math.PI/2}return a}function i(a){t.meshes.length<t.maxSize?t.meshes.push(a):(a.geometry.dispose(),a.material.dispose())}function r(){e.meshes.forEach(a=>{a.geometry.dispose(),a.material.dispose()}),e.meshes=[],e.geometries=[],e.materials=[],t.meshes.forEach(a=>{a.geometry.dispose(),a.material.dispose()}),t.meshes=[],t.geometries=[],t.materials=[]}return{getAttackRay:n,recycleAttackRay:o,getExplosionRing:s,recycleExplosionRing:i,dispose:r}}function iE(e){const t=oE();function n(i,r){const a=new Be(i[0],.5,i[1]),c=new Be(r[0],.5,r[1]),l=a.distanceTo(c),u=t.getAttackRay(l),_=new Be().addVectors(a,c).multiplyScalar(.5);u.position.copy(_);const $=new Be().subVectors(c,a).normalize(),d=new Li;d.setFromUnitVectors(new Be(0,1,0),$),u.quaternion.copy(d),e.add(u);let p=.9;const b=()=>{p-=.05,u.material.opacity=p,p<=0?(e.remove(u),t.recycleAttackRay(u)):requestAnimationFrame(b)};setTimeout(b,300);const g=t.getExplosionRing();g.position.set(r[0],.1,r[1]),e.add(g);let m=1,v=.8;const y=()=>{m+=.1,v-=.08,g.scale.set(m,m,1),g.material.opacity=v,v<=0?(e.remove(g),t.recycleExplosionRing(g)):requestAnimationFrame(y)};y()}function o(i,r){const a=Object.entries(r).filter(([w,k])=>k>0).map(([w,k])=>{const L=en(w);return`+${k} ${L}`});if(a.length===0)return;const c=a.join(`
`),l=document.createElement("canvas"),u=l.getContext("2d");l.width=512,l.height=256,u.fillStyle="rgba(0, 0, 0, 0)",u.fillRect(0,0,l.width,l.height),u.font="bold 48px Arial",u.fillStyle="#ffff00",u.strokeStyle="#000000",u.lineWidth=4,u.textAlign="center",u.textBaseline="middle";const _=c.split(`
`),$=60,d=l.height/2-(_.length-1)*$/2;_.forEach((w,k)=>{const L=d+k*$;u.strokeText(w,l.width/2,L),u.fillText(w,l.width/2,L)});const p=new k0(l),b=new M0({map:p,transparent:!0,opacity:1}),g=new C0(b);g.scale.set(2,1,1),g.position.set(i[0],1.5,i[1]),e.add(g);let m=1.5,v=1;const y=()=>{m+=.02,v-=.01,g.position.y=m,g.material.opacity=v,v<=0?(e.remove(g),g.material.map.dispose(),g.material.dispose()):requestAnimationFrame(y)};y()}function s(){t.dispose()}return{createAttackEffect:n,createResourceGainEffect:o,dispose:s}}const rE={gameScene:ee("@assets/frontend_resource/gamescene.mp3")},aE={move:ee("@assets/frontend_resource/move.mp3"),moveEnemy:ee("@assets/frontend_resource/move_enemy.mp3"),attack:ee("@assets/frontend_resource/attack.mp3"),attackEnemy:ee("@assets/frontend_resource/attack_enemy.mp3"),meHurt:ee("@assets/frontend_resource/me_hurt.mp3"),enemyHurt:ee("@assets/frontend_resource/enemy_hurt.mp3")};function cE(e){return rE[e]||""}function _i(e){return aE[e]||""}let Gt=null;function lE(e,t,n={}){const{radius:o=1e3,segments:s=32,hemisphere:i=!1}=n;Gt&&(e.remove(Gt),Gt.geometry&&Gt.geometry.dispose(),Gt.material&&(Gt.material.map&&Gt.material.map.dispose(),Gt.material.dispose()),Gt=null),new Ii().load(t,a=>{a.colorSpace=nn;const c=i?new Nl(o,s,s,0,Math.PI*2,0,Math.PI/2):new Nl(o,s,s),l=new Bt({map:a,side:P0,depthWrite:!1});Gt=new Mt(c,l),Gt.position.set(0,0,0),e.add(Gt),f(`[SceneUtils] ${i?"":""}${o}`)},void 0,a=>{f("[SceneUtils] ",a),e.background=new ls(2236962)})}function uE(e,t){if(!t||!t.url){e.background=new ls(2236962);return}lE(e,t.url,{radius:t.radius||1e3,segments:t.segments||32,hemisphere:t.hemisphere||!1})}function _E(e,t){const n=new nc(t.ambient.color,t.ambient.intensity);e.add(n);const o=new vs(t.mainDirectional.color,t.mainDirectional.intensity);o.position.set(t.mainDirectional.position.x,t.mainDirectional.position.y,t.mainDirectional.position.z),o.castShadow=t.mainDirectional.castShadow,e.add(o);const s=new vs(t.topLight.color,t.topLight.intensity);s.position.set(t.topLight.position.x,t.topLight.position.y,t.topLight.position.z),e.add(s);const i=new x0(t.hemisphere.skyColor,t.hemisphere.groundColor,t.hemisphere.intensity);i.position.set(t.hemisphere.position.x,t.hemisphere.position.y,t.hemisphere.position.z),e.add(i)}function $E(e={}){const t={...ZT(),...e},n=window.innerWidth/window.innerHeight,o=new Nr(t.fov,n,t.near,t.far);return o.position.set(t.position.x,t.position.y,t.position.z),o}function dE(e,t={}){const n={...QT(),...t},o=t.width||window.innerWidth,s=t.height||window.innerHeight,i=new tc({antialias:n.antialias});return i.setSize(o,s),i.setPixelRatio(window.devicePixelRatio),e.appendChild(i.domElement),i}function pE(e=null){const t=eE(),n=e||t.decoderPath,o=new Bc,s=new zc;return s.setDecoderPath(n),o.setDRACOLoader(s),o}function mE(e,t){const n=tE();n.enabled&&(n.units.forEach(o=>{const s=new bs(o.size,o.size,o.size),i=new Ut({color:o.color}),r=new Mt(s,i);r.position.set(o.position.x,o.position.y,o.position.z),e.add(r),t.push({id:o.id,object:r,name:o.name,type:"test"})}),f("[SceneUtils] :",t.map(o=>`ID=${o.id}`)))}function fE(e,t={}){const n={...nE(),...t};if(!n.enabled)return null;const o=new fr(n.size,n.size);let s;if(n.materialType==="texture"&&n.texture.url){const a=new Ii().load(n.texture.url);a.colorSpace=nn,a.wrapS=x_[n.texture.wrapS]||Vs,a.wrapT=x_[n.texture.wrapT]||Vs,a.repeat.set(n.texture.repeat.x,n.texture.repeat.y),s=new Ut({map:a,side:Cn})}else if(n.materialType==="color")s=new Bt({color:n.color.value,side:Cn});else{const r={color:n.standard.color,roughness:n.standard.roughness,metalness:n.standard.metalness,side:Cn},a=new Ii;if(n.standard.normalMap){const c=a.load(n.standard.normalMap);c.colorSpace=nn,r.normalMap=c,r.normalScale=new $n(n.standard.normalScale.x,n.standard.normalScale.y)}if(n.standard.roughnessMap){const c=a.load(n.standard.roughnessMap);c.colorSpace=nn,r.roughnessMap=c}if(n.standard.aoMap){const c=a.load(n.standard.aoMap);c.colorSpace=nn,r.aoMap=c}s=new Ut(r)}const i=new Mt(o,s);return i.position.set(n.position.x,n.position.y,n.position.z),i.rotation.set(n.rotation.x,n.rotation.y,n.rotation.z),i.renderOrder=-200,e.add(i),f(`[SceneUtils] ${n.materialType}${n.size}`),i}function hE(e){Gt&&e&&(e.remove(Gt),Gt.geometry&&Gt.geometry.dispose(),Gt.material&&(Gt.material.map&&Gt.material.map.dispose(),Gt.material.dispose()),Gt=null)}const gE={key:0,class:"diamond-name"},bE={class:"diamond-row diamond-row--top"},yE=["title","aria-disabled"],wE={class:"diamond border-orange-red"},vE={class:"diamond-content"},SE={class:"diamond-text"},kE={class:"diamond-value"},ME={class:"diamond-row diamond-row--bottom"},CE={class:"diamond border-orange-red"},xE={class:"diamond-content"},PE={class:"diamond-text"},LE={class:"diamond-value"},IE={class:"diamond border-green"},TE={class:"diamond-content"},EE={class:"diamond-text"},AE={class:"diamond-value"},GE={class:"diamond border-blue"},RE={class:"diamond-content"},OE={class:"diamond-text"},DE={class:"diamond-value"},NE={__name:"DiamondPanel",props:{copperInfo:{type:Object,required:!0},inventoryItems:{type:Array,default:()=>[]},inventoryCapacity:{type:Number,default:5}},emits:["inventory-click"],setup(e,{emit:t}){es(m=>({e06679e6:$,bff86908:n,ec019c62:o,v7deac64f:s}));const n=`url('${ee("ui/border-blue.png")}')`,o=`url('${ee("ui/border-green.png")}')`,s=`url('${ee("ui/border-orange-red.png")}')`,i=e,r=t,a=Je(()=>{var m;return(((m=i.copperInfo)==null?void 0:m.name)||"").trim()}),c=Je(()=>{var m,v;return((m=i.copperInfo)==null?void 0:m.isOwnedEnemy)===!0||((v=i.copperInfo)==null?void 0:v.isEnemy)===!0}),l=Je(()=>c.value&&a.value!==""),u=Je(()=>{var v;const m=(v=i.copperInfo)==null?void 0:v.position;return!Array.isArray(m)||m.length<2?"--":`${m[0]},${m[1]}`}),_=Je(()=>c.value===!0),$=`url('${ee("@assets/ui/panel4.png")}')`,d=se({SpiritalSpark:0,RecallGear:0,ResonantCrystal:0,RefinedCopper:0,HeartCrystalDust:0});async function p(){try{const m=Uc();m&&Object.keys(d.value).forEach(v=>{d.value[v]=m[v]||0})}catch(m){console.error("[DiamondPanel] :",m)}}Je(()=>Object.values(d.value).filter(m=>m>0).length);function b(){_.value||r("inventory-click")}const g=se(null);return gn(async()=>{if(p(),hc(Sn.UPDATE_RESOURCES,p),!g.value)return;function m(y){return new Promise((w,k)=>{const L=new Image;L.onload=()=>w(L),L.onerror=()=>k(),L.src=y})}function v(y,w){g.value&&g.value.style.setProperty(y,String(w))}try{const[y,w,k]=await Promise.all([m(ee("ui/border-blue.png")),m(ee("ui/border-green.png")),m(ee("ui/border-orange-red.png"))]),L=Math.max(3,Math.round(y.naturalHeight/4)),P=Math.max(3,Math.round(w.naturalHeight/4)),G=Math.max(3,Math.round(k.naturalHeight/4));v("--border-blue-slice",L),v("--border-green-slice",P),v("--border-orange-red-slice",G)}catch{v("--border-blue-slice","8"),v("--border-green-slice","8"),v("--border-orange-red-slice","8")}}),(m,v)=>(W(),te("div",{ref_key:"diamondPanelRef",ref:g,class:"diamond-panel"},[l.value?(W(),te("div",gE,ae(a.value),1)):Ie("",!0),h("div",bE,[h("div",{class:St(["diamond","border-blue",{"diamond--disabled":_.value}]),onClick:b,title:_.value?"":"","aria-disabled":_.value?"true":"false"},[...v[0]||(v[0]=[h("div",{class:"diamond-content"},[h("div",{class:"diamond-text"},[h("div",{class:"diamond-label"},"")])],-1)])],10,yE),h("div",wE,[h("div",vE,[h("div",SE,[v[1]||(v[1]=h("div",{class:"diamond-label"},"",-1)),h("div",kE,ae(u.value),1)])])])]),h("div",ME,[h("div",CE,[h("div",xE,[h("div",PE,[v[2]||(v[2]=h("div",{class:"diamond-label"},"",-1)),h("div",LE,ae(e.copperInfo.attack),1)])])]),h("div",IE,[h("div",TE,[h("div",EE,[v[3]||(v[3]=h("div",{class:"diamond-label"},"",-1)),h("div",AE,ae(e.copperInfo.defense),1)])])]),h("div",GE,[h("div",RE,[h("div",OE,[v[4]||(v[4]=h("div",{class:"diamond-label"},"",-1)),h("div",DE,ae(e.copperInfo.speed),1)])])])])],512))}},jE=Vt(NE,[["__scopeId","data-v-fb57740a"]]),HE={class:"minecraft-inventory"},FE={class:"inventory-layout"},UE={class:"inventory-section"},BE={class:"equipment-header-mc"},zE={class:"copper-name"},VE={class:"inventory-grid"},qE={class:"slot-icon"},WE=["src","alt"],KE=["src"],JE=["src"],XE={key:3,class:"equipment-icon"},YE={class:"slot-tooltip"},ZE={class:"tooltip-name"},QE={__name:"InventoryModal",props:{visible:{type:Boolean,default:!1},copperName:{type:String,default:""},equipment:{type:Array,default:()=>[]}},emits:["close"],setup(e,{emit:t}){const n=e,o=Je(()=>n.equipment||[]),s=t;function i(){s("close")}return(r,a)=>e.visible?(W(),te("div",{key:0,class:"inventory-modal",onClick:Bs(i,["self"])},[h("div",HE,[h("div",FE,[h("div",UE,[h("div",BE,[h("h4",null,[h("span",zE,ae(e.copperName),1),a[0]||(a[0]=Wo("  ",-1))])]),h("div",VE,[(W(),te(ht,null,Zn(2,(c,l)=>{var u,_,$,d,p,b,g,m,v,y;return h("div",{key:l,class:St(["inv-slot",{"has-item":l<o.value.length&&((u=o.value[l])==null?void 0:u.equipped),"slot-locked":(_=o.value[l])==null?void 0:_.locked}])},[l<o.value.length?(W(),te(ht,{key:0},[h("div",qE,[($=o.value[l])!=null&&$.equipped&&((d=o.value[l])!=null&&d.icon)&&o.value[l].icon!==""&&(o.value[l].icon.startsWith("/")||o.value[l].icon.startsWith("http")||o.value[l].icon.includes("."))?(W(),te("img",{key:0,src:o.value[l].icon,alt:((p=o.value[l])==null?void 0:p.name)||"",class:"equipment-icon"},null,8,WE)):(b=o.value[l])!=null&&b.locked?(W(),te("img",{key:1,src:we(ee)("@assets/ui/lock.png"),alt:"",class:"equipment-icon"},null,8,KE)):((g=o.value[l])==null?void 0:g.icon)===""?(W(),te("img",{key:2,src:we(ee)("@assets/ui/jia.png"),alt:"",class:"equipment-icon"},null,8,JE)):(W(),te("span",XE,ae(((m=o.value[l])==null?void 0:m.icon)||""),1))]),h("div",YE,[h("div",ZE,ae(((v=o.value[l])==null?void 0:v.name)||((y=o.value[l])!=null&&y.locked?"":"")),1)])],64)):Ie("",!0)],2)}),64))])])])])])):Ie("",!0)}},eA=Vt(QE,[["__scopeId","data-v-10271215"]]),tA={class:"health-bar","aria-label":"Health Bar"},nA={class:"health-bar__border"},sA={class:"health-bar__border-left"},oA=["src"],iA={class:"health-bar__border-right"},rA=["src"],aA={class:"health-bar__text"},cA={__name:"HealthBar",props:{hp:{type:Number,default:0},maxHp:{type:Number,default:100}},setup(e){es(c=>({v3bf30af6:s,v3ceb41be:i}));const t=e,n=ee("ui/blood-border-left.png"),o=ee("ui/blood-border-right.png"),s=`url('${ee("ui/blood-border-middle.png")}')`,i=`url('${ee("ui/blood-bar.png")}')`,r=Je(()=>{if(!t.maxHp||t.maxHp===0)return 0;const l=Math.max(0,Math.min(t.hp,t.maxHp))/t.maxHp*100;return Math.max(0,Math.min(100,l))}),a=Je(()=>{const c=Math.max(0,Math.min(t.hp,t.maxHp)),l=t.maxHp||100;return`${Math.round(c)}/${Math.round(l)}`});return(c,l)=>(W(),te("div",tA,[h("div",nA,[h("div",sA,[h("img",{src:we(n),alt:""},null,8,oA)]),l[0]||(l[0]=h("div",{class:"health-bar__border-middle"},null,-1)),h("div",iA,[h("img",{src:we(o),alt:""},null,8,rA)]),h("div",{class:"health-bar__fill",style:zn({width:`calc(${r.value}% + 20px)`})},null,4),h("div",aA,ae(a.value),1)])]))}},lA=Vt(cA,[["__scopeId","data-v-7b5f9ec2"]]),uA={class:"tri-panel"},_A={class:"diamond","aria-label":""},$A=["src"],dA=["src"],pA=["title"],mA=["src"],fA=["src"],hA=["title"],gA=["src"],bA=["src","alt"],yA={__name:"TriPanel",props:{copperType:{type:String,default:""},canMove:{type:Boolean,default:!0},canAttack:{type:Boolean,default:!0},canSummon:{type:Boolean,default:!1}},emits:["move","wait","attack","summon","build"],setup(e,{emit:t}){const n=e,o=t,s=Je(()=>n.copperType==="CraftsMan"?"build":n.copperType==="Resonator"?"summon":"attack"),i=Je(()=>s.value==="build"?n.canSummon?"":"":s.value==="summon"?n.canSummon?"":"":n.canAttack?"":""),r=Je(()=>s.value==="build"||s.value==="summon"?!n.canSummon:!n.canAttack),a=ee("ui/your-image.png"),c=ee("ui/boot.png"),l=ee("ui/mushroom.png"),u=ee("ui/sword.png"),_=ee("@assets/ui/summon.png"),$=ee("@assets/ui/build.png");function d(){n.canMove&&o("move")}function p(){o("wait")}function b(){if(s.value==="build"){if(!n.canSummon)return;o("build")}else if(s.value==="summon"){if(!n.canSummon)return;o("summon")}else{if(!n.canAttack)return;o("attack")}}return(g,m)=>(W(),te("div",uA,[h("div",_A,[h("div",{class:"hex top",title:"",onClick:p},[h("img",{class:"hex-bg",src:we(a),alt:""},null,8,$A),h("img",{class:"hex-icon",src:we(c),alt:""},null,8,dA)]),h("div",{class:St(["hex left",{"is-locked":e.canMove===!1}]),title:e.canMove?"":"",onClick:d},[h("img",{class:"hex-bg",src:we(a),alt:""},null,8,mA),h("img",{class:"hex-icon",src:we(l),alt:""},null,8,fA)],10,pA),h("div",{class:St(["hex right",{"is-locked":r.value}]),title:i.value,onClick:b},[h("img",{class:"hex-bg",src:we(a),alt:""},null,8,gA),h("img",{class:"hex-icon",src:s.value==="build"?we($):s.value==="summon"?we(_):we(u),alt:s.value==="build"?"":s.value==="summon"?"":""},null,8,bA)],10,hA)])]))}},wA=Vt(yA,[["__scopeId","data-v-38a09e87"]]),vA={class:"modal-header"},SA=["src"],kA={class:"modal-info"},MA={class:"info-text"},CA={class:"copper-name"},xA={class:"modal-body"},PA={class:"structure-list"},LA=["onClick"],IA={class:"structure-header"},TA={class:"structure-name-row"},EA={class:"structure-name"},AA={class:"structure-type"},GA={class:"structure-stats"},RA={class:"stat"},OA={class:"stat-value"},DA={class:"stat"},NA={class:"stat-value"},jA={class:"stat"},HA={class:"stat-value"},FA={class:"stat"},UA={class:"stat-value"},BA={class:"structure-cost"},zA={class:"cost-value"},VA={class:"structure-desc"},qA={key:0,class:"selected-badge"},WA={class:"modal-footer"},KA=["disabled"],JA={__name:"BuildModal",props:{visible:{type:Boolean,default:!1},copperName:{type:String,default:""},structureList:{type:Array,default:()=>[]},position:{type:Array,default:null}},emits:["close","build"],setup(e,{emit:t}){es(g=>({b71f15e0:_,v26ebd2fa:p,v26e918c0:d,v26ea017e:$,b71e2d22:b}));const n=e,o=t,s=se(null),i=Je(()=>[...n.structureList].sort((g,m)=>{const v=y=>{var k;const w=((k=y.cost)==null?void 0:k.cost)||y.cost;return!Array.isArray(w)||w.length===0?0:Array.isArray(w[0])?w[0][1]:w[0].count};return v(g)-v(m)}));function r(g){s.value=g}function a(){if(!s.value){f("[BuildModal] ");return}f("[BuildModal] :",s.value.name),o("build",s.value.name),c()}function c(){s.value=null,o("close")}function l(g){return{:"",:"",:"",:""}[g]||""}function u(g){if(!g)return"";const m=g.cost||g;return!Array.isArray(m)||m.length===0?"":m.map(v=>{var y;if(Array.isArray(v)){const w=v[0],k=v[1];return`${((y=Jn[w])==null?void 0:y.name)||w} x${k}`}return`${fc(v)} x${v.count}`}).join(", ")}const _=`url('${ee("@assets/ui/panel11.png")}')`,$=`url('${ee("@assets/ui/panel7.png")}')`,d=`url('${ee("@assets/ui/panel8.png")}')`,p=`url('${ee("@assets/ui/panel5.png")}')`,b=`url('${ee("@assets/ui/panel12.png")}')`;return(g,m)=>(W(),Mn(lp,{to:"body"},[e.visible?(W(),te("div",{key:0,class:"modal-overlay",onClick:Bs(c,["self"])},[h("div",{class:"build-modal",onClick:m[0]||(m[0]=Bs(()=>{},["stop"]))},[h("div",vA,[m[1]||(m[1]=h("h2",{class:"modal-title"}," ",-1)),h("button",{class:"close-btn",onClick:c,title:""},[h("img",{src:we(ee)("@assets/ui/close.png"),alt:""},null,8,SA)])]),h("div",kA,[h("p",MA,[h("span",CA,ae(e.copperName),1),m[2]||(m[2]=Wo("  ",-1))]),m[3]||(m[3]=h("p",{class:"tip-text"},"   ",-1))]),h("div",xA,[h("div",PA,[(W(!0),te(ht,null,Zn(i.value,v=>{var y,w,k;return W(),te("div",{key:v.name,class:St(["structure-card",{selected:((y=s.value)==null?void 0:y.name)===v.name}]),onClick:L=>r(v)},[h("div",IA,[h("div",TA,[h("span",EA,ae(v.name),1)]),h("span",AA,ae(l(v.name)),1)]),h("div",GA,[h("div",RA,[m[4]||(m[4]=h("span",{class:"stat-label"},"",-1)),h("span",OA,ae(v.health),1)]),h("div",DA,[m[5]||(m[5]=h("span",{class:"stat-label"},"",-1)),h("span",NA,ae(((w=v.attribute)==null?void 0:w.attack)||""),1)]),h("div",jA,[m[6]||(m[6]=h("span",{class:"stat-label"},"",-1)),h("span",HA,ae(v.has_storage?"":""),1)]),h("div",FA,[m[7]||(m[7]=h("span",{class:"stat-label"},"",-1)),h("span",UA,ae(v.attack_range||""),1)])]),h("div",BA,[m[8]||(m[8]=h("span",{class:"cost-label"}," ",-1)),h("span",zA,ae(u(v.cost)),1)]),h("div",VA,ae(v.description),1),((k=s.value)==null?void 0:k.name)===v.name?(W(),te("div",qA,"  ")):Ie("",!0)],10,LA)}),128))])]),h("div",WA,[h("button",{class:"btn btn-cancel",onClick:c},""),h("button",{class:"btn btn-confirm",disabled:!s.value,onClick:a},"  ",8,KA)])])])):Ie("",!0)]))}},XA=Vt(JA,[["__scopeId","data-v-96b14c10"]]),YA={key:0,class:"copper-panel-parent"},ZA={key:0,class:"minimized-content"},QA=["src"],eG={class:"minimized-info"},tG={class:"minimized-name"},nG={class:"minimized-action"},sG=["src"],oG={class:"panel-content"},iG={key:0,class:"resources"},rG={class:"resources-list"},aG=["onClick"],cG={class:"resource-name"},lG={class:"resource-count"},uG={key:2,class:"enemy-info-tip"},_G={__name:"ActionPanel",props:{copper:{type:Object,default:null},resources:{type:Array,default:()=>[]},hasAttackTargets:{type:Boolean,default:!0},onSelectCopper:{type:Function,default:null}},emits:["close","action","selectCopper"],setup(e,{expose:t,emit:n}){es(F=>({v9d0cc038:i.value,v4d912a72:r.value,dc9c48e6:a.value,d8c1fd80:c.value,v64ea23bc:u.value,v065590d6:l.value}));const o=e,s=n,i=Je(()=>`url('${ee("ui/sword.png")}')`),r=Je(()=>`url('${ee("ui/red.png")}')`),a=Je(()=>`url('${ee("ui/boot.png")}')`),c=Je(()=>`url('${ee("ui/green.png")}')`),l=Je(()=>`url('${ee("@assets/ui/build.png")}')`),u=Je(()=>`url('${ee("@assets/ui/summon.png")}')`),_=ee("@assets/ui/close.png"),$=se("full"),d=se(null),p=se(!1),b=se(!1),g=se([]),m=Je(()=>{var D,X,q,he,Ge,qe,He,rt,bt,$t,Dt,x,T,z,N,Z,J,ue,le,ie,Y,Se,fe,ve,Te,Re,Xe,Me,Ye,ye,dt,pt,Yt,Hn,It;if(!o.copper)return null;const F=((X=(D=o.copper.copper)==null?void 0:D.copper_info)==null?void 0:X.name)||((he=(q=o.copper.enemy)==null?void 0:q.enemy_base)==null?void 0:he.name)||((Ge=o.copper.enemy_base)==null?void 0:Ge.name)||o.copper.name||` #${o.copper.id}`;return{id:o.copper.id,name:F,level:((qe=o.copper.copper)==null?void 0:qe.level)??((He=o.copper.enemy)==null?void 0:He.level)??((rt=o.copper.enemy_base)==null?void 0:rt.level)??1,hp:o.copper.now_health,maxHp:(($t=(bt=o.copper.copper)==null?void 0:bt.attribute)==null?void 0:$t.health)??((x=(Dt=o.copper.enemy)==null?void 0:Dt.enemy_base)==null?void 0:x.health)??((T=o.copper.enemy_base)==null?void 0:T.health)??100,attack:((N=(z=o.copper.copper)==null?void 0:z.attribute)==null?void 0:N.attack)??((J=(Z=o.copper.enemy)==null?void 0:Z.enemy_base)==null?void 0:J.attack)??((ue=o.copper.enemy_base)==null?void 0:ue.attack)??0,defense:((ie=(le=o.copper.copper)==null?void 0:le.attribute)==null?void 0:ie.defense)??((Se=(Y=o.copper.enemy)==null?void 0:Y.enemy_base)==null?void 0:Se.defense)??((fe=o.copper.enemy_base)==null?void 0:fe.defense)??0,speed:((Te=(ve=o.copper.copper)==null?void 0:ve.attribute)==null?void 0:Te.speed)??((Xe=(Re=o.copper.enemy)==null?void 0:Re.enemy_base)==null?void 0:Xe.speed)??((Me=o.copper.enemy_base)==null?void 0:Me.speed)??0,canMove:o.copper.can_move,canAttack:o.copper.can_attack,canSummon:o.copper.can_summon,position:Array.isArray(o.copper.position)&&o.copper.position.length>=2?o.copper.position:Array.isArray((Ye=o.copper.enemy)==null?void 0:Ye.position)&&o.copper.enemy.position.length>=2?o.copper.enemy.position:Array.isArray((ye=o.copper.enemy_base)==null?void 0:ye.position)&&o.copper.enemy_base.position.length>=2?o.copper.enemy_base.position:[0,0],inventoryCapacity:((dt=o.copper.inventory)==null?void 0:dt.capacity)||0,copperType:((pt=o.copper.copper)==null?void 0:pt.copper_type)||((Hn=(Yt=o.copper.enemy)==null?void 0:Yt.enemy_base)==null?void 0:Hn.enemy_type)||((It=o.copper.enemy_base)==null?void 0:It.enemy_type)||"",isOwnedEnemy:o.copper.isOwnedEnemy===!0,isEnemy:o.copper.isEnemy===!0}}),v=Je(()=>{var q,he,Ge,qe,He;if(!o.copper)return[];const F=((q=o.copper.copper)==null?void 0:q.equipment_slot)||{},D=(F==null?void 0:F.slot1)||null,X=(F==null?void 0:F.slot2)||null;return[D?{name:((he=D.equipment_base)==null?void 0:he.name)||"",icon:ee(((Ge=D.equipment_base)==null?void 0:Ge.resource_url)||""),equipped:!0,locked:!1}:{name:"",icon:"",equipped:!1,locked:!1},F!=null&&F.is_slot2_locked?{name:"",icon:"",equipped:!1,locked:!0}:X?{name:((qe=X.equipment_base)==null?void 0:qe.name)||"",icon:ee(((He=X.equipment_base)==null?void 0:He.resource_url)||""),equipped:!0,locked:!1}:{name:"",icon:"",equipped:!1,locked:!1}]});Ln(()=>{var F;return(F=o.copper)==null?void 0:F.id},(F,D)=>{F!==D&&($.value="full",d.value=null,p.value=!1,b.value=!1)});async function y(){if(!m.value.canMove)return;f("[ActionPanel] ");const F=o.copper.isOwnedEnemy===!0,D=F?"on_enemy_move_start":"on_move_start";f(`[ActionPanel] : ${F?"":""}, : ${D}`);const X=JSON.stringify({type:D,content:{id:String(m.value.id)}});Ue(X),$.value="minimized",d.value="moving",s("action",{type:"moveStart",copperId:m.value.id})}async function w(){if(f("[ActionPanel] ",{canAttack:m.value.canAttack,copperId:m.value.id,name:m.value.name}),!m.value.canAttack){f("[ActionPanel] : ");return}f("[ActionPanel] ");const F=o.copper.isOwnedEnemy===!0,D=F?"on_enemy_attack_start":"on_attack_start";f(`[ActionPanel] : ${F?"":""}, : ${D}`);const X=JSON.stringify({type:D,content:{id:String(m.value.id)}});Ue(X),$.value="minimized",d.value="attacking",s("action",{type:"attackStart",copperId:m.value.id})}async function k(){if(f("[ActionPanel] ",{canSummon:m.value.canSummon,copperId:m.value.id,name:m.value.name}),!m.value.canSummon){f("[ActionPanel] : ");return}f("[ActionPanel] ");const F=JSON.stringify({type:"on_summon_start",content:{id:String(m.value.id)}});Ue(F),$.value="minimized",d.value="summoning",s("action",{type:"summonStart",copperId:m.value.id})}async function L(){if(f("[ActionPanel] ",{copperId:m.value.id,name:m.value.name}),!m.value.canSummon){f("[ActionPanel] : /");return}s("action",{type:"buildRequest",copperId:m.value.id})}function P(F){f("[ActionPanel] ",(F==null?void 0:F.length)||0,""),g.value=F||[],b.value=!0}async function G(F){f("[ActionPanel] :",F),b.value=!1;const D=JSON.stringify({type:"on_structure_build_start",content:{id:String(m.value.id),name:F}});Ue(D),$.value="minimized",d.value="building",s("action",{type:"buildStart",copperId:m.value.id,structureName:F})}function I(){f("[ActionPanel] "),p.value=!0}async function U(F){f(`[ActionPanel] : index=${F}`);const D=JSON.stringify({type:"on_copper_pick_up",content:{id:String(m.value.id),index:String(F)}});Ue(D),await B()}async function R(){f("[ActionPanel] ");const F=JSON.stringify({type:"on_copper_craft",content:{id:String(m.value.id)}});Ue(F),await B()}async function M(){await R()}async function B(){const D=o.copper.isOwnedEnemy===!0?"on_click_enemy":"on_click_copper",X=JSON.stringify({type:D,content:{id:String(m.value.id)}});Ue(X)}function de(){f("[ActionPanel] "),s("action",{type:"wait",copperId:m.value.id})}function oe(){$.value="full",d.value=null,p.value=!1,s("close")}function be(){p.value=!1}function K(){$.value="full",d.value=null,s("action",{type:"cancel",copperId:m.value.id})}function A(){K(),oe()}async function Q(F){o.onSelectCopper?await o.onSelectCopper(F):s("selectCopper",F)}return t({cancelAction:K,handleSelectCopper:Q,showBuildMenu:P}),(F,D)=>{var X,q,he,Ge,qe,He,rt,bt;return W(),te(ht,null,[e.copper?(W(),te("div",YA,[Pt(jE,{"copper-info":m.value,"inventory-items":[],"inventory-capacity":5,onInventoryClick:I},null,8,["copper-info"]),Pt(lA,{hp:((X=m.value)==null?void 0:X.hp)||0,"max-hp":((q=m.value)==null?void 0:q.maxHp)||100},null,8,["hp","max-hp"]),$.value==="minimized"||e.resources&&e.resources.length>0&&$.value==="full"?(W(),te("div",{key:0,class:St(["copper-panel",{"copper-panel--minimized":$.value==="minimized","copper-panel--min-attack":$.value==="minimized"&&d.value==="attacking","copper-panel--min-move":$.value==="minimized"&&d.value==="moving","copper-panel--min-summon":$.value==="minimized"&&d.value==="summoning","copper-panel--min-build":$.value==="minimized"&&d.value==="building"}]),onClick:D[0]||(D[0]=Bs(()=>{},["stop"]))},[$.value==="minimized"?(W(),te("div",ZA,[h("button",{class:"minimized-close",type:"button",onClick:A,title:""},[h("img",{src:we(_),alt:""},null,8,QA)]),h("div",eG,[h("span",tG,ae(m.value.name),1),h("span",nG,ae(d.value==="moving"?"...":d.value==="attacking"?"...":d.value==="summoning"?"...":d.value==="building"?"...":""),1)])])):(W(),te(ht,{key:1},[h("button",{class:"close-btn",onClick:oe,title:""},[h("img",{src:we(_),alt:""},null,8,sG)]),h("div",oG,[e.resources&&e.resources.length>0?(W(),te("div",iG,[D[3]||(D[3]=h("div",{class:"resources-header"}," ",-1)),h("div",rG,[(W(!0),te(ht,null,Zn(e.resources,($t,Dt)=>(W(),te("div",{key:Dt,class:"resource-item",onClick:x=>U(Dt),title:""},[h("span",cG,ae(we(fc)($t)),1),h("span",lG,"x"+ae($t.count||1),1),D[2]||(D[2]=h("span",{class:"resource-pickup"},"",-1))],8,aG))),128))])])):Ie("",!0)])],64))],2)):Ie("",!0),o.copper.isEnemy?Ie("",!0):(W(),Mn(wA,{key:1,"copper-type":(he=m.value)==null?void 0:he.copperType,"can-move":((Ge=m.value)==null?void 0:Ge.canMove)!==!1,"can-attack":((qe=m.value)==null?void 0:qe.canAttack)!==!1,"can-summon":((He=m.value)==null?void 0:He.canSummon)!==!1,onMove:y,onWait:de,onAttack:w,onSummon:k,onBuild:L},null,8,["copper-type","can-move","can-attack","can-summon"])),o.copper.isEnemy?(W(),te("div",uG,[...D[4]||(D[4]=[h("span",null," ",-1)])])):Ie("",!0)])):Ie("",!0),Pt(eA,{visible:p.value,"copper-name":((rt=m.value)==null?void 0:rt.name)||"",equipment:v.value,onClose:be,onCraft:M},null,8,["visible","copper-name","equipment"]),Pt(XA,{visible:b.value,"copper-name":((bt=m.value)==null?void 0:bt.name)||"","structure-list":g.value,onClose:D[1]||(D[1]=$t=>b.value=!1),onBuild:G},null,8,["visible","copper-name","structure-list"])],64)}}},$G=Vt(_G,[["__scopeId","data-v-5073d991"]]),dG={class:"panel"},pG={class:"panel-inner"},mG={class:"section section-header"},fG=["aria-label"],hG={class:"section section-body"},gG={class:"current-doll",role:"status","aria-live":"polite"},bG={key:0},yG={class:"section section-choices",role:"group","aria-label":"Character Queue"},wG=["aria-pressed","data-copper-id","title","onClick"],vG=["alt","src","data-default-src","data-selected-src"],SG={class:"actions"},kG=["disabled"],MG=["disabled"],CG={__name:"TurnSystem",props:{currentCopperId:{type:Number,default:null},copperList:{type:Array,default:()=>[]},roundNumber:{type:Number,default:1},isEnemyMoving:{type:Boolean,default:!1}},emits:["nextCopper","endRound","selectCopper"],setup(e,{emit:t}){es(v=>({v13e8edbe:a,a5a1de32:l,v6d6dcd30:c,dca1506e:u,v0788e5d0:_,d6662956:$,v5e671a9e:d}));const n=e,o=t,s=se(null),i=ee("ui/choice.png"),r=ee("ui/choice-active.png"),a=`url('${ee("ui/ribbon-left.png")}')`,c=`url('${ee("ui/ribbon-middle.png")}')`,l=`url('${ee("ui/ribbon-right.png")}')`,u=`url('${ee("ui/panel.png")}')`,_=`url('${ee("ui/round1.png")}')`,$=`url('${ee("ui/currentcupper.png")}')`,d=`url('${ee("ui/btn.png")}')`,p=Je(()=>{if(!n.currentCopperId)return null;const v=n.copperList.find(y=>y.id===n.currentCopperId);return v?{id:v.id,name:v.name||` #${v.id}`,level:v.level??0,isSummon:v.type==="summon"}:null});function b(){o("nextCopper")}async function g(){const v=JSON.stringify({type:"on_game_round_pass"});Ue(v),o("endRound")}function m(v){o("selectCopper",v)}return gn(async()=>{if(!s.value)return;function v(w){return new Promise((k,L)=>{const P=new Image;P.onload=()=>k(P),P.onerror=G=>{f(":",w,G),L(G)},P.src=w})}function y(w,k){s.value&&(s.value.style.setProperty(w,String(k)),f(` CSS  ${w} = ${k}`))}try{const[w,k,L]=await Promise.all([v(ee("ui/panel.png")),v(ee("ui/btn.png")),v(ee("ui/currentcupper.png"))]),P=Math.max(4,Math.round(w.naturalHeight/4)),G=Math.max(3,Math.round(k.naturalHeight/3)),I=Math.max(3,Math.round(L.naturalHeight/4));f(":",{panelSlice:P,btnSlice:G,currentSlice:I,currentImgSize:`${L.naturalWidth}x${L.naturalHeight}`}),y("--panel-slice",P),y("--btn-slice",G),y("--current-slice",I),setTimeout(()=>{const U=getComputedStyle(s.value);f("CSS :",{"--current-slice":U.getPropertyValue("--current-slice"),"--panel-slice":U.getPropertyValue("--panel-slice"),"--btn-slice":U.getPropertyValue("--btn-slice")})},100)}catch(w){f(":",w),y("--panel-slice","8"),y("--btn-slice","11"),y("--current-slice","8")}}),(v,y)=>(W(),te("div",{ref_key:"turnSystemRef",ref:s,class:"turn-system"},[y[0]||(y[0]=h("div",{class:"ribbon","aria-hidden":"true"},[h("div",{class:"ribbon-cap left"}),h("div",{class:"ribbon-fill"},"CONTROL"),h("div",{class:"ribbon-cap right"})],-1)),h("div",dG,[h("div",pG,[h("section",mG,[h("div",{class:"round-header",role:"img","aria-label":`Round ${e.roundNumber}`}," Round "+ae(e.roundNumber),9,fG)]),h("section",hG,[h("div",gG,[h("span",null,ae(p.value?`${p.value.name||` #${e.currentCopperId}`}`:""),1),p.value&&!p.value.isSummon?(W(),te("span",bG," Lv."+ae(p.value.level??0)+" ",1)):Ie("",!0)])]),h("section",yG,[(W(!0),te(ht,null,Zn(e.copperList,w=>(W(),te("button",{key:w.id,class:"choice",type:"button","aria-pressed":String(w.id===e.currentCopperId),"data-copper-id":w.id,title:w.name||` #${w.id}`,onClick:k=>m(w.id)},[h("img",{alt:w.name||`Character ${w.id}`,src:w.id===e.currentCopperId?we(r):we(i),"data-default-src":we(i),"data-selected-src":we(r)},null,8,vG)],8,wG))),128))])])]),h("div",SG,[h("button",{class:"btn btn-primary",onClick:b,disabled:!e.currentCopperId||e.isEnemyMoving},"  ",8,kG),h("button",{class:"btn btn-secondary",onClick:g,disabled:e.isEnemyMoving},"  ",8,MG)])],512))}},xG=Vt(CG,[["__scopeId","data-v-bbcf8c05"]]),PG={class:"modal-info"},LG={class:"info-text"},IG={class:"copper-name"},TG={class:"modal-body"},EG={class:"enemy-list"},AG=["onClick"],GG={class:"enemy-header"},RG={class:"enemy-name-row"},OG={class:"enemy-name"},DG={class:"enemy-level"},NG={class:"enemy-type"},jG={class:"enemy-stats"},HG={class:"stat"},FG={class:"stat-value"},UG={class:"stat"},BG={class:"stat-value"},zG={class:"stat"},VG={class:"stat-value"},qG={class:"stat"},WG={class:"stat-value"},KG={class:"stat"},JG={class:"stat-value"},XG={class:"enemy-cost"},YG={class:"cost-value"},ZG={class:"enemy-desc"},QG={key:0,class:"selected-badge"},eR={class:"modal-footer"},tR=["disabled"],nR={__name:"SummonModal",props:{visible:{type:Boolean,default:!1},copperName:{type:String,default:""},enemyList:{type:Array,default:()=>[]},position:{type:Array,default:null}},emits:["close","summon"],setup(e,{emit:t}){es($=>({bad9e2a0:n}));const n=`url('${ee("@assets/ui/panel6.png")}')`,o=e,s=t,i=se(null),r=Je(()=>[...o.enemyList].sort(($,d)=>$.level-d.level));function a($){i.value=$}function c(){if(!i.value){f("[SummonModal] ");return}f("[SummonModal] :",i.value.name),s("summon",i.value.name),l()}function l(){i.value=null,s("close")}function u($){return{goblin:"",cruiser:"",scout:"",boxer:"",horn:"",assassin:"",devourer:"",mirror:"",guard:"",demon:"",variant:"",shatra:"BOSS",glutton:"BOSS"}[$]||$}function _($){if(!$)return"";const d=$.cost||$;return!Array.isArray(d)||d.length===0?"":d.map(p=>{var b;if(Array.isArray(p)){const g=p[0],m=p[1];return`${((b=Jn[g])==null?void 0:b.name)||g} x${m}`}return`${fc(p)} x${p.count}`}).join(", ")}return($,d)=>(W(),Mn(lp,{to:"body"},[e.visible?(W(),te("div",{key:0,class:"modal-overlay",onClick:Bs(l,["self"])},[h("div",{class:"summon-modal",onClick:d[0]||(d[0]=Bs(()=>{},["stop"]))},[h("div",{class:"modal-header"},[d[1]||(d[1]=h("h2",{class:"modal-title"}," ",-1)),h("button",{class:"close-btn",onClick:l,title:""},"")]),h("div",PG,[h("p",LG,[h("span",IG,ae(e.copperName),1),d[2]||(d[2]=Wo("  ",-1))])]),h("div",TG,[h("div",EG,[(W(!0),te(ht,null,Zn(r.value,p=>{var b,g;return W(),te("div",{key:p.name,class:St(["enemy-card",{selected:((b=i.value)==null?void 0:b.name)===p.name}]),onClick:m=>a(p)},[h("div",GG,[h("div",RG,[h("span",OG,ae(p.name),1),h("span",DG,"Lv."+ae(p.level),1)]),h("span",NG,ae(u(p.enemy_type)),1)]),h("div",jG,[h("div",HG,[d[3]||(d[3]=h("span",{class:"stat-label"},"",-1)),h("span",FG,ae(p.health),1)]),h("div",UG,[d[4]||(d[4]=h("span",{class:"stat-label"},"",-1)),h("span",BG,ae(p.attack),1)]),h("div",zG,[d[5]||(d[5]=h("span",{class:"stat-label"},"",-1)),h("span",VG,ae(p.defense),1)]),h("div",qG,[d[6]||(d[6]=h("span",{class:"stat-label"},"",-1)),h("span",WG,ae(p.attack_range),1)]),h("div",KG,[d[7]||(d[7]=h("span",{class:"stat-label"},"",-1)),h("span",JG,ae(p.move_range),1)])]),h("div",XG,[d[8]||(d[8]=h("span",{class:"cost-label"}," ",-1)),h("span",YG,ae(_(p.summon_cost)),1)]),h("div",ZG,ae(p.description),1),((g=i.value)==null?void 0:g.name)===p.name?(W(),te("div",QG,"   ")):Ie("",!0)],10,AG)}),128))])]),h("div",eR,[h("button",{class:"btn btn-cancel",onClick:l},""),h("button",{class:"btn btn-confirm",disabled:!i.value,onClick:c},"  ",8,tR)])])])):Ie("",!0)]))}},sR=Vt(nR,[["__scopeId","data-v-2e41e79c"]]),oR={key:0,class:"minimized-content"},iR={class:"minimized-info"},rR={class:"minimized-name"},aR={class:"minimized-action"},cR={key:1},lR={class:"structure-panel__header"},uR={class:"structure-panel__title"},_R={class:"structure-panel__body"},$R={class:"structure-panel__health"},dR={class:"structure-panel__health-bar"},pR={class:"structure-panel__health-text"},mR={key:0,class:"structure-panel__storage"},fR={class:"structure-panel__storage-content"},hR={key:0,class:"structure-panel__storage-item"},gR={class:"structure-panel__storage-name"},bR={class:"structure-panel__storage-count"},yR={key:1,class:"structure-panel__storage-empty"},wR={key:1,class:"structure-panel__ground-resources"},vR={class:"structure-panel__ground-list"},SR={class:"structure-panel__resource-name"},kR={class:"structure-panel__resource-count"},MR={key:2,class:"structure-panel__actions"},CR={__name:"StructurePanel",props:{structure:{type:Object,required:!0},resources:{type:Array,default:()=>[]},actionMode:{type:String,default:null}},emits:["close","action","cancel"],setup(e,{emit:t}){es(w=>({v31b4b180:p}));const n=e,o=t,s=Je(()=>{var w;return((w=n.structure.structure_base)==null?void 0:w.name)||""}),i=Je(()=>n.structure.owned||!1),r=Je(()=>{var w;return((w=n.structure.structure_base)==null?void 0:w.has_storage)||!1}),a=Je(()=>n.structure.storage||null),c=Je(()=>n.structure.can_move||!1),l=Je(()=>n.structure.can_attack||!1),u=Je(()=>n.structure.now_health||0),_=Je(()=>{var w;return((w=n.structure.structure_base)==null?void 0:w.health)||100}),$=Je(()=>_.value===0?0:Math.max(0,Math.min(100,u.value/_.value*100))),d=Je(()=>{const w=$.value;return w>60?"#4ade80":w>30?"#facc15":"#ef4444"});ee("@assets/ui/panel.png");const p=`url('${ee("@assets/ui/panel11.png")}')`,b=Je(()=>n.actionMode!==null),g=Je(()=>n.actionMode==="move"?"...":n.actionMode==="attack"?"...":n.actionMode==="extract"?"...":n.actionMode==="transfer"?"...":"");function m(w){f(`[StructurePanel] : ${w}`),o("action",{type:w})}function v(){f("[StructurePanel] "),o("cancel")}function y(){o("close")}return(w,k)=>(W(),te("div",{class:St(["structure-panel",{"structure-panel--minimized":b.value}])},[b.value?(W(),te("div",oR,[h("div",iR,[h("span",rR,ae(s.value),1),h("span",aR,ae(g.value),1)]),h("div",{class:"minimized-actions"},[h("button",{class:"mini-btn mini-btn--cancel",onClick:v,title:""},"  ")])])):(W(),te("div",cR,[h("div",lR,[h("div",uR,[Wo(ae(s.value)+" ",1),h("span",{class:St(["structure-panel__badge",{"structure-panel__badge--owned":i.value}])},ae(i.value?"":""),3)]),h("button",{class:"structure-panel__close",onClick:y,"aria-label":""},"  ")]),h("div",_R,[h("div",$R,[k[4]||(k[4]=h("div",{class:"structure-panel__health-label"},"",-1)),h("div",dR,[h("div",{class:"structure-panel__health-fill",style:zn({width:$.value+"%",backgroundColor:d.value})},null,4)]),h("div",pR,ae(Math.ceil(u.value))+" / "+ae(Math.ceil(_.value)),1)]),r.value?(W(),te("div",mR,[k[5]||(k[5]=h("div",{class:"structure-panel__storage-label"},"",-1)),h("div",fR,[a.value?(W(),te("div",hR,[h("span",gR,ae(we(fc)(a.value)),1),h("span",bR,"x"+ae(a.value.count||0),1)])):(W(),te("div",yR,""))])])):Ie("",!0),e.resources&&e.resources.length>0?(W(),te("div",wR,[k[6]||(k[6]=h("div",{class:"structure-panel__ground-label"},"",-1)),h("div",vR,[(W(!0),te(ht,null,Zn(e.resources,(L,P)=>(W(),te("div",{key:P,class:"structure-panel__ground-item"},[h("span",SR,ae(L.name||""),1),h("span",kR,"x"+ae(L.count||0),1)]))),128))])])):Ie("",!0),i.value?(W(),te("div",MR,[c.value?(W(),te("button",{key:0,class:"structure-panel__action-btn structure-panel__action-btn--move",onClick:k[0]||(k[0]=L=>m("move"))},"  ")):Ie("",!0),l.value?(W(),te("button",{key:1,class:"structure-panel__action-btn structure-panel__action-btn--attack",onClick:k[1]||(k[1]=L=>m("attack"))},"  ")):Ie("",!0),r.value&&a.value?(W(),te("button",{key:2,class:"structure-panel__action-btn structure-panel__action-btn--transfer",onClick:k[2]||(k[2]=L=>m("transfer"))},"  ")):Ie("",!0),r.value?(W(),te("button",{key:3,class:"structure-panel__action-btn structure-panel__action-btn--extract",onClick:k[3]||(k[3]=L=>m("extract"))},"  ")):Ie("",!0)])):Ie("",!0)])]))],2))}},xR=Vt(CR,[["__scopeId","data-v-c3c198e2"]]),PR={class:"resource-panel"},LR={class:"resource-list"},IR={class:"resource-layout"},TR={class:"row row-top"},ER=["title"],AR=["src","alt"],GR={class:"resource-count"},RR={class:"resource-tooltip"},OR=["title"],DR=["src","alt"],NR={class:"resource-count"},jR={class:"resource-tooltip"},HR={class:"row row-middle"},FR=["title"],UR=["src","alt"],BR={class:"resource-count"},zR={class:"resource-tooltip"},VR={class:"row row-bottom"},qR=["title"],WR=["src","alt"],KR={class:"resource-count"},JR={class:"resource-tooltip"},XR=["title"],YR=["src","alt"],ZR={class:"resource-count"},QR={class:"resource-tooltip"},e9={class:"crafting-section"},t9={class:"crafting-grid"},n9=["src"],s9={class:"craft-count"},o9={class:"craft-arrow-group"},i9=["src","alt"],r9={class:"craft-result"},a9={class:"recipe-display"},c9=["src"],l9={class:"craft-count"},u9={__name:"ResourcePanel",setup(e,{expose:t}){es(_=>({a63b29f0:o}));const o=`url('${ee("@assets/ui/panel5.png")}')`,s=se({SpiritalSpark:0,RecallGear:0,ResonantCrystal:0,RefinedCopper:0,HeartCrystalDust:0}),i=["HeartCrystalDust","RecallGear","ResonantCrystal","RefinedCopper"],r=se(!1),a=se({visible:!1,success:!0,text:""});function c(_,$=!0,d=1500){a.value={visible:!0,success:$,text:_},window.clearTimeout(c._timer),c._timer=window.setTimeout(()=>{a.value.visible=!1},d)}async function l(){if(!r.value){r.value=!0;try{const _=_L();jo(Sn.UPDATE_RESOURCES),(_==null?void 0:_.type)==="error"?(console.warn("[ResourcePanel] :",(_==null?void 0:_.content)||_),c("",!1)):(console.log("[ResourcePanel] :",_),c("",!0))}catch(_){console.error("[ResourcePanel] :",_),c("",!1)}finally{r.value=!1}}}async function u(){try{const _=Uc();if(_){const $={},d={};return Object.keys(s.value).forEach(p=>{const b=s.value[p],g=_[p]||0;d[p]=g;const m=g-b;m>0&&($[p]=m)}),s.value=d,jo(Sn.RESOURCES_UPDATED,$),$}}catch(_){console.error("[ResourcePanel] :",_)}return{}}return gn(()=>{u(),hc(Sn.UPDATE_RESOURCES,u)}),Is(()=>{Fu(Sn.UPDATE_RESOURCES,u)}),t({updateResources:u}),(_,$)=>{var d;return W(),te("div",PR,[$[0]||($[0]=h("div",{class:"resource-header"},[h("span",{class:"header-text"},"")],-1)),h("div",LR,[h("div",IR,[h("div",TR,[h("div",{class:"resource-slot small",title:we(en)("RecallGear")},[we(ds)("RecallGear")?(W(),te("img",{key:0,src:we(ds)("RecallGear"),alt:we(en)("RecallGear"),class:"resource-icon"},null,8,AR)):Ie("",!0),h("div",GR,ae(s.value.RecallGear||0),1),h("div",RR,ae(we(en)("RecallGear")),1)],8,ER),h("div",{class:"resource-slot small",title:we(en)("HeartCrystalDust")},[we(ds)("HeartCrystalDust")?(W(),te("img",{key:0,src:we(ds)("HeartCrystalDust"),alt:we(en)("HeartCrystalDust"),class:"resource-icon"},null,8,DR)):Ie("",!0),h("div",NR,ae(s.value.HeartCrystalDust||0),1),h("div",jR,ae(we(en)("HeartCrystalDust")),1)],8,OR)]),h("div",HR,[h("div",{class:"resource-slot large",title:we(en)("SpiritalSpark")},[we(ds)("SpiritalSpark")?(W(),te("img",{key:0,src:we(ds)("SpiritalSpark"),alt:we(en)("SpiritalSpark"),class:"resource-icon"},null,8,UR)):Ie("",!0),h("div",BR,ae(s.value.SpiritalSpark||0),1),h("div",zR,ae(we(en)("SpiritalSpark")),1)],8,FR)]),h("div",VR,[h("div",{class:"resource-slot small",title:we(en)("ResonantCrystal")},[we(ds)("ResonantCrystal")?(W(),te("img",{key:0,src:we(ds)("ResonantCrystal"),alt:we(en)("ResonantCrystal"),class:"resource-icon"},null,8,WR)):Ie("",!0),h("div",KR,ae(s.value.ResonantCrystal||0),1),h("div",JR,ae(we(en)("ResonantCrystal")),1)],8,qR),h("div",{class:"resource-slot small",title:we(en)("RefinedCopper")},[we(ds)("RefinedCopper")?(W(),te("img",{key:0,src:we(ds)("RefinedCopper"),alt:we(en)("RefinedCopper"),class:"resource-icon"},null,8,YR)):Ie("",!0),h("div",ZR,ae(s.value.RefinedCopper||0),1),h("div",QR,ae(we(en)("RefinedCopper")),1)],8,XR)])])]),h("div",e9,[h("div",t9,[(W(),te(ht,null,Zn(i,(p,b)=>{var g;return h("div",{class:"craft-slot",key:b},[(g=we(Jn)[p])!=null&&g.icon?(W(),te("img",{key:0,src:we(Jn)[p].icon,class:"craft-icon"},null,8,n9)):Ie("",!0),h("div",s9,ae(s.value[p]||0),1)])}),64))]),h("div",o9,[h("img",{class:St(["craft-arrow-img",{disabled:r.value}]),src:we(ee)("@assets/ui/upgrade.png"),alt:r.value?"":"",onClick:l},null,10,i9),a.value.visible?(W(),te("div",{key:0,class:St(["craft-toast",{success:a.value.success,error:!a.value.success}])},ae(a.value.text),3)):Ie("",!0)]),h("div",r9,[h("div",a9,[(d=we(Jn).SpiritalSpark)!=null&&d.icon?(W(),te("img",{key:0,src:we(Jn).SpiritalSpark.icon,class:"recipe-icon"},null,8,c9)):Ie("",!0),h("div",l9,ae(s.value.SpiritalSpark||0),1)])])])])}}},_9=Vt(u9,[["__scopeId","data-v-5ca294fa"]]),$9={class:"game-scene"},d9={key:1,class:"top-left-actions"},p9={key:6,class:"info-panel"},m9={key:7,class:"game-over-overlay"},f9={key:8,class:"game-over-overlay"},h9={key:9,class:"credits-overlay"},g9={key:10,class:"game-over-overlay"},b9={class:"game-over-dialog"},y9={class:"game-over-message"},w9={key:11,class:"game-over-overlay"},v9=["src"],S9=["src"],k9=["src"],M9=["src"],C9=["src"],x9=["src"],P9=["src"],L9={__name:"GameScene",props:{isGameMode:{type:Boolean,default:!1},musicOn:{type:Boolean,default:!0}},emits:["back"],setup(e,{emit:t}){es(O=>({c26972a4:Vh,c26889e6:qh}));const n=e,o=se(null),s=t,i=se(null),r=cE("gameScene"),a=se(null),c=se(null),l=se(null),u=se(null),_=se(null),$=se(null),d=_i("move"),p=_i("moveEnemy"),b=_i("attack"),g=_i("attackEnemy"),m=_i("meHurt"),v=_i("enemyHurt");let y,w,k,L,P=[],I={focusPosition:null,focusTarget:null,lerpFactor:pd().focusLerpFactor},U=null,R=new $n,M=null,B=null,de=null;const oe=new Map,be={w:!1,a:!1,s:!1,d:!1,shift:!1,space:!1},A=pd().moveSpeed,Q=se(_d("controlMode")||"touchpad"),F=se(_d("mouseSensitivity")||.002);window.updateControlMode=O=>{Q.value=O,f(`[GameScene] : ${O}`)},window.updateMouseSensitivity=O=>{F.value=O};function D(O){const j=O.key.toLowerCase();j==="w"||j==="a"||j==="s"||j==="d"?be[j]=!0:j==="shift"?be.shift=!0:j===" "?(be.space=!0,O.preventDefault()):j==="escape"&&document.pointerLockElement&&document.exitPointerLock()}function X(O){const j=O.key.toLowerCase();j==="w"||j==="a"||j==="s"||j==="d"?be[j]=!1:j==="shift"?be.shift=!1:j===" "&&(be.space=!1)}let q=!1,he=0,Ge=0,qe=0,He=0,rt=!1;function bt(O){O.button===0&&(Q.value==="mouse"&&o.value&&o.value.requestPointerLock(),q=!0,he=O.clientX,Ge=O.clientY)}function $t(){q=!1}function Dt(O){if(Q.value==="touchpad"){if(!q)return;const j=O.clientX-he,$e=O.clientY-Ge;He-=j*F.value,qe-=$e*F.value,he=O.clientX,Ge=O.clientY}else if(Q.value==="mouse"&&rt){const j=O.movementX||0,$e=O.movementY||0;He-=j*F.value,qe-=$e*F.value}qe=Math.max(-Math.PI/2,Math.min(Math.PI/2,qe)),w.rotation.order="YXZ",w.rotation.y=He,w.rotation.x=qe}function x(){rt=document.pointerLockElement===o.value,f(rt?"[GameScene] ":"[GameScene] ")}function T(){f("[GameScene] ")}function z(){w&&(w.position.set(0,10,15),w.lookAt(0,0,0),He=w.rotation.y,qe=w.rotation.x,I.focusPosition=null,I.focusTarget=null,f("[GameScene] "))}const N=se(null),Z=se([]),J=se(null),ue=se(!1),le=se([]),ie=se([]),Y=se(null),Se=se(null),fe=se(!1),ve=se(null),Te=se([]),Re=se(null),Xe=se(1),Me=se([]),Ye=se(-1),ye=se(null),dt=se(!1),pt=se(new Set),Yt=se(!1),Hn=new Map,It=se(!1),Zt=se(!1),Fn=se(!1),Os=se(!1),Di=se(!1),Ni=se(""),qc=Je(()=>{if(Me.value.length===0||Ye.value<0||Ye.value>=Me.value.length)return null;const O=Me.value[Ye.value];return O?O.id:null});gn(async()=>{var O;if(f("[GameScene] "),oi(),n.isGameMode&&z(),f("[GameScene] "),ri(),f("[GameScene] "),(O=Fe.sceneContext)!=null&&O.setTestMode&&Fe.sceneContext.setTestMode("eventloop"),window.__ACTUAL_COPPER_IDS__){const j=window.__ACTUAL_COPPER_IDS__;f("[GameScene] ID:",j);const $e=JSON.stringify({type:"on_game_start",content:{ids:j}});Ue($e),delete window.__ACTUAL_COPPER_IDS__}else f("[GameScene] ID");window.addEventListener("keydown",D),window.addEventListener("keyup",X),window.addEventListener("mousedown",bt),window.addEventListener("mouseup",$t),window.addEventListener("mousemove",Dt),document.addEventListener("pointerlockchange",x),document.addEventListener("pointerlockerror",T),Kr(),n.musicOn&&i.value&&setTimeout(()=>{if(i.value.readyState>=2)i.value.play().then(()=>{f("[GameScene] ")}).catch($e=>{f("[GameScene] :",$e)});else{const $e=()=>{i.value.play().then(()=>{f("[GameScene] ")}).catch(me=>{f("[GameScene] :",me)}),i.value.removeEventListener("canplay",$e)};i.value.addEventListener("canplay",$e,{once:!0})}},200)}),Ln(()=>n.musicOn,O=>{if(i.value)if(O)if(i.value.readyState>=2)i.value.play().catch(j=>{f("[GameScene] :",j)});else{const j=()=>{i.value.play().catch($e=>{f("[GameScene] :",$e)}),i.value.removeEventListener("canplay",j)};i.value.addEventListener("canplay",j)}else i.value.pause()}),Is(()=>{window.removeEventListener("resize",Wr),window.removeEventListener("click",Jr),window.removeEventListener("keydown",D),window.removeEventListener("keyup",X),window.removeEventListener("mousedown",bt),window.removeEventListener("mouseup",$t),window.removeEventListener("mousemove",Dt),document.removeEventListener("pointerlockchange",x),document.removeEventListener("pointerlockerror",T),document.pointerLockElement&&document.exitPointerLock(),i.value&&i.value.pause(),M&&M.dispose(),B&&B.dispose(),de&&de.dispose(),y&&hE(y),k&&k.dispose()});function oi(){y=new ec;const O=BT();uE(y,O),w=$E(),U=new P_,k=dE(o.value),L=null;const j=YT();_E(y,j),fE(y),pE(),n.isGameMode&&window.addEventListener("click",Jr),mE(y,P),M=HT(y,w),B=sE(y),de=iE(y),f("[GameScene] "),f('[GameScene] - /(ID=1,2)""'),f("[GameScene] - EventLoop"),window.addEventListener("resize",Wr)}async function Wc(O,j,$e,me=1){const Ee=pc(O,j);try{const C=await Gn.loadModel(Ee,!0);f(`[GameScene] : ${j}`);const E=C.clone(!0);E.traverse(Pe=>{Pe.material&&(Array.isArray(Pe.material)?Pe.material=Pe.material.map(Le=>Le.clone()):Pe.material=Pe.material.clone())});const _e=new pn().setFromObject(E).getSize(new Be),pe=new ss;pe.add(E),pe.position.set($e[0],0,$e[1]),pe.scale.set(me,me,me),pe.rotation.y=0;const xe=new pn().setFromObject(pe);return pe.position.y=-xe.min.y,f(`[GameScene] : ${j}, URL: ${Ee}`),pe}catch(C){return f(`[GameScene] : ${j}`,C),null}}async function Kc(O,j,$e=1,me="model"){try{const Ee=await Gn.loadModel(O,!0);f(`[GameScene] : ${me}, url=${O}`);const C=Ee.clone(!0);C.traverse(pe=>{pe.material&&(Array.isArray(pe.material)?pe.material=pe.material.map(xe=>xe.clone()):pe.material=pe.material.clone())});const V=new pn().setFromObject(C).getSize(new Be),_e=new ss;return _e.add(C),_e.position.set(j[0],0,j[1]),_e.scale.set($e,$e,$e),_e}catch(Ee){return f(`[GameScene] : ${me}, url=${O}, error=${Ee}`),null}}async function Jc(O,j,$e=1){const me=mc(O);try{const Ee=await Gn.loadModel(me,!0);f(`[GameScene] : ${O}`);const C=Ee.clone(!0);C.traverse(Pe=>{Pe.material&&(Array.isArray(Pe.material)?Pe.material=Pe.material.map(Le=>Le.clone()):Pe.material=Pe.material.clone())});const V=new pn().setFromObject(C).getSize(new Be),_e=new ss;_e.add(C),_e.position.set(j[0],0,j[1]),_e.scale.set($e,$e,$e),_e.rotation.y=0;const pe=new pn().setFromObject(_e);_e.position.y=-pe.min.y;const xe=new hi(16729156,2.5,12);return xe.position.set(0,V.y*$e*.8,0),_e.add(xe),f(`[GameScene] : ${O}, URL: ${me}`),_e}catch(Ee){return f(`[GameScene] : ${O}`,Ee),null}}let ii=null;function ri(){const O=new Map,j=new Map,$e=new Map;function me(C,E,V){const _e=P.find(Le=>Le.id===C);if(!_e||!_e.object)return;let pe,xe;E==="move"?(pe=65280,xe=.8):E==="attack"?(pe=16711680,xe=1):E==="summon"?(pe=16776960,xe=1.2):(pe=16777215,xe=1),O.has(C)||O.set(C,{});const Pe=O.get(C);if(Pe[E]&&(y.remove(Pe[E]),Pe[E].geometry.dispose(),Pe[E].material.dispose(),delete Pe[E]),V){const Le=new Dl(xe-.1,xe,32),Ve=new Bt({color:pe,side:Cn,transparent:!0,opacity:.6}),We=new Mt(Le,Ve);We.rotation.x=-Math.PI/2,We.position.set(_e.object.position.x,.1,_e.object.position.z),y.add(We),Pe[E]=We}}const Ee=C=>{if(P.forEach(E=>{E.object&&(E.object.scale.set(1,1,1),E.object.traverse(V=>{var _e;V.material&&((_e=V.material.emissive)==null||_e.setHex(0),V.material.emissiveIntensity!==void 0&&(V.material.emissiveIntensity=0))}))}),C!==null){const E=P.find(V=>V.id===C);if(E){E.object.scale.set(1.1,1.1,1.1),E.object.traverse(_e=>{_e.material&&_e.material.emissive&&(_e.material.emissive.setHex(16755200),_e.material.emissiveIntensity=.5)});const V=E.type==="summon"?"":E.type==="copper"?"":"";f(`[GameScene] ${V}: ${E.name} (ID=${C})`)}}};ii=(C,E)=>{const V=P.find(Rt=>Rt.id===C);if(!V)return;const _e=new Map;V.object.traverse(Rt=>{Rt.material&&Rt.material.emissive&&(_e.set(Rt,{color:Rt.material.emissive.getHex(),intensity:Rt.material.emissiveIntensity||0}),Rt.material.emissive.setHex(16711680),Rt.material.emissiveIntensity=.8)}),setTimeout(()=>{_e.forEach((Rt,ns)=>{ns.material&&ns.material.emissive&&(ns.material.emissive.setHex(Rt.color),ns.material.emissiveIntensity=Rt.intensity)})},500);const pe=new Be(V.object.position.x,.5,V.object.position.z),xe=new Be(E[0],.5,E[1]),Pe=new Be().subVectors(xe,pe),Le=Pe.length(),Ve=new Be().addVectors(pe,xe).multiplyScalar(.5),We=new Ca(.05,.05,Le,8),Ne=new Bt({color:16729156,transparent:!0,opacity:.9,emissive:16729156,emissiveIntensity:.5}),Ke=new Mt(We,Ne);Ke.position.copy(Ve),Ke.quaternion.setFromUnitVectors(new Be(0,1,0),Pe.normalize()),y.add(Ke);const st=new Dl(.2,.4,32),ct=new Bt({color:16711680,side:Cn,transparent:!0,opacity:.8,emissive:16711680,emissiveIntensity:.5}),Qt=new Mt(st,ct);Qt.rotation.x=-Math.PI/2,Qt.position.copy(xe),y.add(Qt);const Co=performance.now(),Nt=300;function jt(){const ns=(performance.now()-Co)/Nt;if(ns<1){const Hi=1-ns;Ne&&(Ne.opacity=Hi),ct&&(ct.opacity=Hi),Qt.scale.set(1+ns*2,1+ns*2,1),requestAnimationFrame(jt)}else y.remove(Ke),y.remove(Qt),We.dispose(),Ne.dispose(),st.dispose(),ct.dispose()}jt(),f(`[GameScene] : ID=${C}, =${pe.x.toFixed(1)},${pe.z.toFixed(1)}  [${E[0]},${E[1]}]`)},Fe.setSceneContext({scene:y,camera:w,controls:L,models:P,gridCellSize:1,focusState:I,focusOnModel:Xc,onShowCopperInfo:(C,E,V)=>{var pe,xe,Pe,Le,Ve,We,Ne,Ke,st,ct,Qt;f(`[GameScene] onShowCopperInfo : type=${(pe=C.copper)==null?void 0:pe.copper_type}, can_build=${C.can_build}, can_summon=${C.can_summon}`),((xe=C.copper)==null?void 0:xe.copper_type)==="CraftsMan"&&C.id!==void 0&&Hn.set(C.id,C.can_build===!0);const _e=((Le=(Pe=C.copper)==null?void 0:Pe.copper_info)==null?void 0:Le.name)||C.name||((We=(Ve=C.enemy)==null?void 0:Ve.enemy_base)==null?void 0:We.name)||((Ke=(Ne=C.enemy)==null?void 0:Ne.enemy_base)==null?void 0:Ke.enemy_type)||((st=C.enemy_base)==null?void 0:st.name)||((ct=C.enemy_base)==null?void 0:ct.enemy_type)||` #${C.id}`;((Qt=C.copper)==null?void 0:Qt.copper_type)==="CraftsMan"?(f(`[GameScene]  can_build=${C.can_build}  can_summon`),N.value={...C,name:_e,can_summon:C.can_build===!0}):N.value={...C,name:_e},Z.value=E||[],ue.value=V||!1,f(`[GameScene] : ID=${N.value.id}, has_attack_targets=${ue.value}, can_summon=${N.value.can_summon}`)},onShowStructureInfo:(C,E)=>{var V;Y.value=C,Se.value={structure:C,resources:E},f(`[GameScene] : ID=${C.id}, =${(V=C.structure_base)==null?void 0:V.name}, =${C.now_health}/${C.structure_base.health}`)},highlightSelectedCopper:Ee,createAttackEffect:ii,onMoveStart:(C,E)=>{n.isGameMode&&dt.value&&(E==null?void 0:E.type)==="enemy"&&!(E!=null&&E.isOwned)&&(f(`[GameScene]  ${C} `),pt.value.add(C))},onMoveComplete:C=>{if(!n.isGameMode)return;const E=P.find(xe=>xe.id===C);if((E==null?void 0:E.type)==="structure"){f("[GameScene] "),ye.value=null,Yt.value=!1,setTimeout(async()=>{await ji(C)},300);return}if((E==null?void 0:E.type)==="enemy"&&!(E!=null&&E.isOwned)){dt.value&&pt.value.has(C)?(f(`[GameScene]  ${C} `),pt.value.delete(C),pt.value.size===0&&(f("[GameScene] "),dt.value=!1)):f(`[GameScene]  ${C} `);return}const _e=Me.value.some(xe=>xe.id===C),pe=(E==null?void 0:E.type)==="summon"||(E==null?void 0:E.isOwned);!_e&&!pe||(Yt.value=!1,f("[GameScene] "),ye.value=null,J.value&&J.value.cancelAction(),setTimeout(async()=>{(E==null?void 0:E.type)==="summon"?await Xr(C,!1):await Mo(C),setTimeout(()=>{if(Z.value&&Z.value.length>0){f("[GameScene] ");return}w_()},100)},300))},onCraftResult:(C,E)=>{f(`[GameScene] : ${C?"":""} - ${E}`),alert(E)},onResourceNotEnough:C=>{f(`[GameScene] : ${C}`),Ni.value=C,Di.value=!0,ye.value=null,Re.value=null,fe.value=!1,ve.value=null},onSummonFailed:C=>{f(`[GameScene] : ${C}`),alert(` ${C}`),ye.value=null,fe.value=!1,ve.value=null},onShowSummonMenu:C=>{f("[GameScene] :",C),Te.value=C||[]},onShowStructureMenu:C=>{var E;f("[GameScene] ",(C==null?void 0:C.length)||0,""),(E=J.value)!=null&&E.showBuildMenu?J.value.showBuildMenu(C||[]):f("[GameScene]  copperActionPanelRef.value.showBuildMenu ")},onRemoveCopper:C=>{const E=Me.value.findIndex(V=>V.id===C);E>-1&&(f(`[GameScene] : ID=${C}`),Me.value.splice(E,1),N.value&&N.value.id===C&&tl(),Me.value.length===0||Ye.value===E?Ye.value=-1:Ye.value>E?Ye.value-=1:Ye.value>=Me.value.length&&(Ye.value=Me.value.length-1))},onShowResourceGain:(C,E)=>{f("[GameScene] :",C,E),de&&Object.keys(E).length>0&&de.createResourceGainEffect(C,E)},onGameOver:()=>{f("[GameScene] "),It.value=!0},onGameSuccess:()=>{f("[GameScene] "),Zt.value=!0},onAttackComplete:C=>{if(!n.isGameMode)return;const E=P.find(_e=>_e.id===C);if((E==null?void 0:E.type)==="structure"){f("[GameScene] "),ye.value=null,setTimeout(async()=>{await ji(C)},300);return}if(!Me.value.some(_e=>_e.id===C)){f("[GameScene] ");return}f("[GameScene] "),ye.value=null,J.value&&J.value.cancelAction(),setTimeout(async()=>{(E==null?void 0:E.type)==="summon"?await Xr(C,!1):await Mo(C),setTimeout(()=>{if(Z.value&&Z.value.length>0){f("[GameScene] ");return}w_()},100)},300)},onSetMoveBlock:C=>{B&&B.createIndicator(C,"move"),f(`[GameScene] : =${C}`)},onSetAttackBlock:C=>{if(ye.value==="transferring"){le.value.push(C);const E=P.find(V=>{if(V.type==="copper"&&V.object){const _e=V.object.position;return Math.abs(_e.x-C[0])<.1&&Math.abs(_e.z-C[1])<.1}return!1});if(E){const V=Me.value.find(pe=>pe.id===E.id);ie.value.find(pe=>pe.id===E.id)||(ie.value.push({id:E.id,name:E.name||(V?V.name:` #${E.id}`)||` #${E.id}`,position:C}),f(`[GameScene] : ${E.name||E.id} (ID=${E.id}), =${ie.value.length}`))}else f(`[GameScene]  ${C} `)}else B&&B.createIndicator(C,"attack"),ue.value=!0,f(`[GameScene] : ${C}`)},onSetCanSummonBlock:C=>{B&&B.createIndicator(C,"summon"),f(`[GameScene] : =${C}`)},onClearBlock:C=>{B&&B.clearIndicatorAt(C)},onSetCopper:async(C,E,V)=>{var Ne,Ke,st,ct,Qt,Co;if(f(`[GameScene] : id=${V.id}, pos=${E}`),P.find(Nt=>Nt.id===V.id)){f(`[GameScene] ID=${V.id}`);return}if(((Ne=V.copper)==null?void 0:Ne.copper_type)==="CraftsMan"&&(Hn.set(V.id,V.can_build===!0),f(`[GameScene]  can_build : id=${V.id}, can_build=${V.can_build}`)),n.isGameMode){const Nt={id:V.id,name:((Ke=V.copper.copper_info)==null?void 0:Ke.name)||` #${V.id}`,level:Number(((st=V.copper)==null?void 0:st.level)??0),turnDone:!1};Me.value.find(jt=>jt.id===V.id)||(Me.value.push(Nt),f(`[GameScene] : ${Nt.name}`))}const pe=V.copper.copper_type||"Arcanist",xe=((ct=V.copper.copper_info)==null?void 0:ct.name)||"default",Pe=(Qt=V.copper.copper_info)==null?void 0:Qt.model_url;let Le=1;switch(pe){case"IronWall":Le=1.2;break;case"Arcanist":Le=1;break;case"Mechanic":Le=1.1;break;case"Resonator":Le=1;break;case"CraftsMan":Le=1;break;default:Le=1}let Ve;if(Pe&&Pe.includes("/enemy/")){const Nt=ee(Pe);if(f(`[GameScene] URL: ${Pe} -> ${Nt}`),Ve=await Kc(Nt,E,Le,xe),Ve){const Rt=new pn().setFromObject(Ve).getSize(new Be),ns=new pn().setFromObject(Ve);Ve.position.y=-ns.min.y;const Hi=new hi(4474111,2.5,12);Hi.position.set(0,Rt.y*Le*.8,0),Ve.add(Hi)}}else{const Nt=OT(xe),jt=DT(pe);f(`[GameScene] : =${xe}, =${Nt}, type=${pe}, typeFolder=${jt}`),Ve=await Wc(jt,Nt,E,Le)}if(!Ve){f(`[GameScene] : ${xe}`);const Nt=new bs(.8,.8,.8);let jt=4491519;switch(pe){case"IronWall":jt=8947848;break;case"Arcanist":jt=16729224;break;case"Mechanic":jt=4521864;break;case"Resonator":jt=16755268;break;case"CraftsMan":jt=4474111;break}const Rt=new Ut({color:jt});Ve=new Mt(Nt,Rt),Ve.position.set(E[0],.4,E[1])}Ve.userData.modelId=V.id,y.add(Ve);const We={id:V.id,object:Ve,name:((Co=V.copper.copper_info)==null?void 0:Co.name)||`Copper_${V.id}`,type:"copper"};P.push(We),f(`[GameScene] : ${We.name} (ID=${V.id})`)},onSetEnemy:async(C,E,V)=>{var Ke,st,ct,Qt,Co;const _e=V.id,pe=V.owned||!1;if(f(`[GameScene] : id=${_e}, pos=${E}, owned=${pe}`),P.find(Nt=>Nt.id===_e)){f(`[GameScene] ID=${_e}`);return}const Le=(((Ke=V.enemy_base)==null?void 0:Ke.enemy_type)||"").toLowerCase()||"goblin";let Ve=1;switch(Le){case"demon":case"glutton":case"devourer":Ve=1.5;break;case"guard":case"horn":Ve=1.2;break;default:Ve=1}const We={id:_e,object:null,name:((st=V.enemy_base)==null?void 0:st.enemy_type)||`Enemy_${_e}`,type:pe?"summon":"enemy",position:E,isOwned:pe,isLoading:!0};P.push(We);let Ne=await Jc(Le,E,Ve);if(!Ne){f(`[GameScene] : ${Le}`);const Nt=new bs(.8,.8,.8),jt=new Ut({color:pe?4474111:16711680});Ne=new Mt(Nt,jt),Ne.position.set(E[0],.4,E[1])}if(pe&&Ne){const jt=new pn().setFromObject(Ne).getSize(new Be),Rt=new hi(4474111,2.5,12);Rt.position.set(0,jt.y*Ve*.8,0),Ne.add(Rt),f(`[GameScene] : ${Le}`)}Ne.userData.modelId=_e,y.add(Ne),We.object=Ne,We.isLoading=!1,V.now_health!==void 0&&((ct=V.enemy_base)==null?void 0:ct.health)!==void 0&&M&&(M.createOrUpdateHealthBar(_e,V.now_health,V.enemy_base.health),f(`[GameScene] : ${Le} (${V.now_health}/${V.enemy_base.health})`)),pe&&(Me.value.push({id:_e,name:((Qt=V.enemy_base)==null?void 0:Qt.name)||Le,type:"summon",enemy:V}),f(`[GameScene] : ${Le} (ID=${_e})`)),f(`[GameScene] : ${((Co=V.enemy_base)==null?void 0:Co.enemy_type)||_e}, owned=${pe}`)},onSetMaterial:async(C,E,V)=>{var Ve,We,Ne;if(f(`[GameScene] : id=${C}, pos=${E}, name=${(Ve=V.material_base)==null?void 0:Ve.name}`),P.find(Ke=>Ke.id===C)){f(`[GameScene] ID=${C}`);return}const pe=((We=V.material_base)==null?void 0:We.name)||"",xe=(Ne=V.material_base)==null?void 0:Ne.model_url;if(!xe){f("[GameScene] model_url");const Ke=new bs(.5,.5,.5),st=new Ut({color:16755200,metalness:.3,roughness:.7}),ct=new Mt(Ke,st);ct.position.set(E[0],.25,E[1]),ct.userData.modelId=C,y.add(ct),P.push({id:C,object:ct,name:pe||`Material_${C}`,type:"material"});return}const Pe=o1(xe);let Le=null;try{const Ke=await Gn.loadModel(Pe,!0),st=new ss;st.add(Ke),st.position.set(E[0],0,E[1]),st.scale.set(1,1,1),st.rotation.y=0;const ct=new pn().setFromObject(st);st.position.y=-ct.min.y,Le=st,f(`[GameScene] : ${pe}, URL: ${Pe}`)}catch(Ke){f(`[GameScene] : ${pe}`,Ke);const st=new bs(.5,.5,.5),ct=new Ut({color:16755200,metalness:.3,roughness:.7});Le=new Mt(st,ct),Le.position.set(E[0],.25,E[1])}Le.userData.modelId=C,y.add(Le),P.push({id:C,object:Le,name:pe||`Material_${C}`,type:"material"}),f(`[GameScene] : ${pe}`)},onSetStructure:async(C,E,V)=>{var Ve,We;if(f(`[GameScene] : id=${C}, pos=${E}`),P.find(Ne=>Ne.id===C)){f(`[GameScene] ID=${C}`);return}const pe=((Ve=V.structure_base)==null?void 0:Ve.name)||"",xe=jT(pe),Pe=Vp(xe);let Le=null;try{const Ne=await Gn.loadModel(Pe,!0),Ke=new ss;Ke.add(Ne),Ke.position.set(E[0],0,E[1]),Ke.scale.set(1,1,1),Ke.rotation.y=0;const st=new pn().setFromObject(Ke);Ke.position.y=-st.min.y,Le=Ke,f(`[GameScene] : ${pe}, URL: ${Pe}`)}catch(Ne){f(`[GameScene] : ${pe}`,Ne);const Ke=new bs(.9,1.2,.9),st=new Ut({color:6710886,metalness:.5,roughness:.6});Le=new Mt(Ke,st),Le.position.set(E[0],.6,E[1])}Le.userData.modelId=C,y.add(Le),P.push({id:C,object:Le,name:pe||`Structure_${C}`,type:"structure"}),f(`[GameScene] : ${pe}`),V.now_health!==void 0&&((We=V.structure_base)!=null&&We.health)&&M&&(M.createOrUpdateHealthBar(C,V.now_health,V.structure_base.health),f(`[GameScene] : ${pe} (${V.now_health}/${V.structure_base.health})`))},onPutResourceMarker:C=>{const E=`${C[0]},${C[1]}`;if($e.has(E)){const st=$e.get(E);y.remove(st),st.traverse(ct=>{ct.geometry&&ct.geometry.dispose(),ct.material&&(Array.isArray(ct.material)?ct.material.forEach(Qt=>Qt.dispose()):ct.material.dispose())}),$e.delete(E)}const V=new ss,_e=new Ca(.15,.2,.25,8),pe=new Ut({color:16766720,emissive:16755200,emissiveIntensity:.6,metalness:.7,roughness:.3}),xe=new Mt(_e,pe);xe.position.y=.125,V.add(xe);const Pe=new Nl(.08,8,8),Le=new Ut({color:16776960,emissive:16776960,emissiveIntensity:1}),Ve=new Mt(Pe,Le);Ve.position.y=.3,V.add(Ve);const We=C[0],Ne=C[1];V.position.set(We,.15,Ne);const Ke=new hi(16766720,1.5,3);Ke.position.set(0,.3,0),V.add(Ke),y.add(V),$e.set(E,V)},onClearResourceMarker:C=>{const E=`${C[0]},${C[1]}`;if($e.has(E)){const V=$e.get(E);y.remove(V),V.traverse(_e=>{_e.geometry&&_e.geometry.dispose(),_e.material&&(Array.isArray(_e.material)?_e.material.forEach(pe=>pe.dispose()):_e.material.dispose())}),$e.delete(E)}},onDisplayCanMove:(C,E)=>{f(`[GameScene] : id=${C}, show=${E}`),me(C,"move",E),N.value&&N.value.id===C&&(N.value={...N.value,can_move:E},f(`[GameScene] selectedCopper.can_move=${E}`))},onDisplayCanAttack:(C,E)=>{f(`[GameScene] : id=${C}, show=${E}`),me(C,"attack",E),N.value&&N.value.id===C&&(N.value={...N.value,can_attack:E},f(`[GameScene] selectedCopper.can_attack=${E}`))},onDisplayCanSummon:(C,E)=>{var xe;let V=E,_e=!1,pe=!1;N.value&&N.value.id===C?(_e=((xe=N.value.copper)==null?void 0:xe.copper_type)==="CraftsMan",pe=N.value.can_build===!0):Hn.has(C)&&(_e=!0,pe=Hn.get(C)),_e&&(V=pe,f(`[GameScene] : id=${C}, can_build=${V}`)),f(`[GameScene] /: id=${C}, show=${V}`),me(C,"summon",V),N.value&&N.value.id===C&&(N.value={...N.value,can_summon:V},f(`[GameScene] selectedCopper.can_summon=${V}`))},onClearState:C=>{if(f(`[GameScene] : id=${C}`),O.has(C)){const E=O.get(C);E.move&&(y.remove(E.move),E.move.geometry.dispose(),E.move.material.dispose(),delete E.move),E.attack&&(y.remove(E.attack),E.attack.geometry.dispose(),E.attack.material.dispose(),delete E.attack),E.summon&&(y.remove(E.summon),E.summon.geometry.dispose(),E.summon.material.dispose(),delete E.summon),O.delete(C)}},onUpdateHealth:(C,E,V)=>{f(`[GameScene] : id=${C}, hp=${E}/${V}`);const _e=oe.get(C);if(_e!==void 0&&E<_e&&E>0){const pe=P.find(xe=>xe.id===C);if(pe){const xe=pe.type==="copper",Pe=xe?_.value:$.value;Pe&&(Pe.currentTime=0,Pe.play().catch(Le=>{f(`[GameScene]  (${xe?"":""}):`,Le)}),f(`[GameScene] : ${xe?"":""} (ID=${C})`))}}oe.set(C,E),M&&M.createOrUpdateHealthBar(C,E,V)},onRemoveHealthBar:C=>{f(`[GameScene] : id=${C}`),M&&M.removeHealthBar(C),oe.delete(C)},onPutMapBlock:C=>{const E=`${C[0]},${C[1]}`;if(j.has(E)){const We=j.get(E);y.remove(We),We.geometry.dispose(),We.material&&(We.material.map&&We.material.map.dispose(),Array.isArray(We.material)?We.material.forEach(Ne=>{Ne.map&&Ne.map.dispose(),Ne.dispose()}):We.material.dispose())}const V=yh();if(!V.enabled)return;const _e=V.size||.9,pe=.05,xe=new bs(_e,pe,_e);let Pe;if(V.materialType==="texture"&&V.texture.url){const Ne=new Ii().load(V.texture.url);Ne.colorSpace=nn,Ne.wrapS=Vs,Ne.wrapT=Vs,Ne.repeat.set(V.texture.repeat.x,V.texture.repeat.y);const Ke=1;Pe=new Ut({map:Ne,transparent:!1,opacity:Ke,depthTest:!0,depthWrite:!0})}else V.materialType==="standard"?Pe=new Ut({color:V.standard.color,roughness:V.standard.roughness,metalness:V.standard.metalness,transparent:!1,opacity:1,depthTest:!0,depthWrite:!0}):Pe=new Bt({color:V.basic.color,transparent:!1,opacity:1,depthTest:!0,depthWrite:!0});const Le=new Mt(xe,Pe);Le.renderOrder=-100;const Ve=V.yOffset||0;Le.position.set(C[0],pe/2+Ve,C[1]),y.add(Le),j.set(E,Le)},animateModelMove:(C,E,V)=>{if(!C||!C.object)return;const _e=C.type==="enemy",pe=_e?c.value:a.value;pe&&(pe.currentTime=0,pe.play().catch(Ne=>{f(`[GameScene]  (${_e?"":""}):`,Ne)})),C.isMoving=!0;const xe=C.object.position.clone(),Pe=new Be(E.x,E.y,E.z),Le=500,Ve=performance.now();function We(){if(!C||!C.object){V&&V();return}const Ne=performance.now()-Ve,Ke=Math.min(Ne/Le,1),st=1-Math.pow(1-Ke,2);C.object.position.lerpVectors(xe,Pe,st),Ke<1?requestAnimationFrame(We):(C.object.position.copy(Pe),C.isMoving=!1,V&&V())}We()},setTestMode:C=>{f(`[GameScene] ${C==="backend"?"":"EventLoop"}`),P.forEach(E=>{E.type==="test"?E.object.visible=C==="backend":(E.type==="copper"||E.type==="enemy")&&(E.object.visible=C==="eventloop")}),f(`[GameScene] ${C==="backend"?"":""}${C==="eventloop"?"":""}EventLoop`)}}),f("[GameScene] ")}function Xc(O,j,$e){const me=new Be;O.getWorldPosition(me);const Ee=window.cameraFocusDistance||8,C=window.cameraFocusHeight||6,E=0,V=Ee;return{focusPosition:new Be(me.x+E,me.y+C,me.z+V).clone(),focusTarget:me.clone(),lerpFactor:.1}}function Wr(){w.aspect=window.innerWidth/window.innerHeight,w.updateProjectionMatrix(),k.setSize(window.innerWidth,window.innerHeight)}function Kr(){if(requestAnimationFrame(Kr),be.w||be.a||be.s||be.d||be.shift||be.space){const O=new Be;be.w&&(O.z-=1),be.s&&(O.z+=1),be.a&&(O.x-=1),be.d&&(O.x+=1),be.shift&&(O.y-=1),be.space&&(O.y+=1),O.applyQuaternion(w.quaternion),O.y=be.shift?-1:be.space?1:0,w.position.add(O.multiplyScalar(A))}I.focusPosition&&I.focusTarget&&(w.position.lerp(I.focusPosition,I.lerpFactor),w.lookAt(I.focusTarget),He=w.rotation.y,qe=w.rotation.x,w.position.distanceTo(I.focusPosition)<.5&&(f("[GameScene] "),I.focusPosition=null,I.focusTarget=null)),M&&M.updateHealthBarsPosition(P),k.render(y,w)}function Jr(O){if(O.target.tagName!=="CANVAS")return;if(R.x=O.clientX/window.innerWidth*2-1,R.y=-(O.clientY/window.innerHeight)*2+1,U.setFromCamera(R,w),ye.value==="moving"||ye.value==="attacking"||ye.value==="summoning"||ye.value==="building"||ye.value==="transferring"||ye.value==="structureMoving"||ye.value==="structureAttacking"||ye.value==="structureExtract"||ye.value==="structureTransfer"){ai(R);return}const j=P.filter(me=>(me.type==="copper"||me.type==="summon"||me.type==="enemy"||me.type==="structure")&&me.object).map(me=>me.object),$e=U.intersectObjects(j,!0);if($e.length>0){let me=$e[0].object;for(;me.parent&&!me.userData.modelId;)me=me.parent;const Ee=me.userData.modelId;if(Ee!==void 0){const C=P.find(_e=>_e.id===Ee),V={copper:"",summon:"",enemy:"",structure:""}[C==null?void 0:C.type]||"";f(`[GameScene] ${V}ID:`,Ee),(C==null?void 0:C.type)==="summon"||(C==null?void 0:C.type)==="enemy"?Xr(Ee,(C==null?void 0:C.type)==="enemy"):(C==null?void 0:C.type)==="structure"?ji(Ee):Mo(Ee)}}else N.value=null,Y.value=null}async function ai(O){const j=new Cd(new Be(0,1,0),0),$e=new P_;if($e.setFromCamera(O,w),ye.value==="moving"&&Yt.value){f("[GameScene] ");return}const me=new Be;if($e.ray.intersectPlane(j,me),me){const Ee=Math.round(me.x),C=Math.round(me.z);f(`[GameScene] : (${Ee}, ${C})`);const E={moving:"move",attacking:"attack",summoning:"summon",building:"summon",structureMoving:"move",structureAttacking:"attack",structureExtract:"attack",structureTransfer:"attack"}[ye.value];if(!B||!B.hasIndicatorAt([Ee,C],E)){f(`[GameScene]  (${Ee}, ${C}) `);return}ye.value==="moving"?await Yc(Ee,C):ye.value==="attacking"?await Zc(Ee,C):ye.value==="summoning"?await Qc(Ee,C):ye.value==="building"?await el(Ee,C):ye.value==="structureMoving"?await Ih(Ee,C):ye.value==="structureAttacking"?await Th(Ee,C):ye.value==="structureExtract"?await Eh(Ee,C):ye.value==="structureTransfer"&&await Ah(Ee,C)}}async function Yc(O,j){if(!N.value)return;if(Yt.value){f("[GameScene] ");return}const $e=N.value.isOwnedEnemy===!0,me=$e?"on_enemy_move_apply":"on_move_apply";f(`[GameScene] : (${O}, ${j}), =${$e?"":""}, =${me}`);const Ee=JSON.stringify({type:me,content:{id:String(N.value.id),position:{x:String(O),y:String(j)}}});Yt.value=!0,await Ue(Ee)}async function Zc(O,j){if(!N.value)return;const $e=N.value.isOwnedEnemy===!0,me=$e?"on_enemy_attack_apply":"on_attack_apply";f(`[GameScene] : (${O}, ${j}), =${$e?"":""}, =${me}`);const Ee=N.value.id,C=P.find(V=>V.id===Ee);if(C){const V=C.type==="enemy",_e=V?u.value:l.value;_e&&(_e.currentTime=0,_e.play().catch(pe=>{f(`[GameScene]  (${V?"":""}):`,pe)})),ii&&ii(Ee,[O,j])}const E=JSON.stringify({type:me,content:{id:String(N.value.id),position:{x:String(O),y:String(j)}}});await Ue(E)}async function Qc(O,j){if(!N.value)return;f(`[GameScene] : (${O}, ${j})`),ve.value=[O,j];const $e=JSON.stringify({type:"on_get_summon_menu"});await Ue($e),await new Promise(me=>setTimeout(me,100)),fe.value=!0}async function el(O,j){if(!N.value||!Re.value)return;f(`[GameScene]  ${Re.value} : (${O}, ${j})`);const $e=N.value.id,me=JSON.stringify({type:"on_structure_build_apply",content:{id:String($e),position:{x:String(O),y:String(j)},name:Re.value}});await Ue(me),ye.value=null,Re.value=null,J.value&&J.value.cancelAction(),await new Promise(Ee=>setTimeout(Ee,100)),f("[GameScene] "),await Mo($e)}async function vh(O){if(!N.value||!ve.value)return;const[j,$e]=ve.value;f(`[GameScene]  ${O} : (${j}, ${$e})`);try{const me=JSON.stringify({type:"on_summon_apply",content:{id:String(N.value.id),position:{x:String(j),y:String($e)},name:O}});await Ue(me)}catch(me){f("[GameScene] :",me)}finally{fe.value=!1,ye.value=null,ve.value=null,J.value&&J.value.cancelAction();try{const me=JSON.stringify({type:"on_summon_end"});await Ue(me)}catch(me){f("[GameScene] :",me)}}}function Sh(){fe.value=!1,ve.value=null,ye.value=null;const O=JSON.stringify({type:"on_summon_end"});Ue(O).catch(j=>{f("[GameScene] ",j)})}function y_(){if(f("[GameScene] "),ye.value==="structureMoving"){const O=JSON.stringify({type:"on_structure_move_end"});Ue(O).catch(j=>{f("[GameScene] ",j)})}else if(ye.value==="structureAttacking"){const O=JSON.stringify({type:"on_structure_attack_end"});Ue(O).catch(j=>{f("[GameScene] ",j)})}else if(ye.value==="structureExtract"){const O=JSON.stringify({type:"on_structure_extract_end"});Ue(O).catch(j=>{f("[GameScene] ",j)})}else if(ye.value==="structureTransfer"){const O=JSON.stringify({type:"on_structure_transfer_end"});Ue(O).catch(j=>{f("[GameScene] ",j)})}ye.value=null}function kh(){y_(),Y.value=null,Se.value=null,f("[GameScene] ")}async function Mh(O){if(!Y.value)return;const j=Y.value.id;switch(f(`[GameScene] : ${O.type}, ID=${j}`),O.type){case"move":await Ch(j);break;case"attack":await xh(j);break;case"transfer":await Lh(j);break;case"extract":await Ph(j);break;default:f("[GameScene] :",O.type)}}async function Ch(O){f(`[GameScene]  ${O} `);const j=JSON.stringify({type:"on_structure_move_start",content:{id:String(O)}});await Ue(j),ye.value="structureMoving"}async function xh(O){f(`[GameScene]  ${O} `);const j=JSON.stringify({type:"on_structure_attack_start",content:{id:String(O)}});await Ue(j),ye.value="structureAttacking"}async function Ph(O){f(`[GameScene]  ${O} `);const j=JSON.stringify({type:"on_structure_extract_start",content:{id:String(O)}});await Ue(j),ye.value="structureExtract"}async function Lh(O){f(`[GameScene]  ${O} `);const j=JSON.stringify({type:"on_structure_transfer_start",content:{id:String(O)}});await Ue(j),ye.value="structureTransfer"}async function Ih(O,j){if(!Y.value)return;f(`[GameScene]  ${Y.value.id}  (${O}, ${j})`);const $e=JSON.stringify({type:"on_structure_move_apply",content:{id:String(Y.value.id),position:{x:String(O),y:String(j)}}});await Ue($e),ye.value=null}async function Th(O,j){if(!Y.value)return;f(`[GameScene]  ${Y.value.id}  (${O}, ${j})`);const $e=JSON.stringify({type:"on_structure_attack_apply",content:{id:String(Y.value.id),position:{x:String(O),y:String(j)}}});await Ue($e),ye.value=null}async function Eh(O,j){if(!Y.value)return;f(`[GameScene]  ${Y.value.id}  (${O}, ${j}) `);const $e=Y.value.id,me=JSON.stringify({type:"on_structure_extract_apply",content:{id:String($e),position:{x:String(O),y:String(j)}}});await Ue(me),f("[GameScene] ");const Ee=JSON.stringify({type:"on_structure_extract_end"});await Ue(Ee),await new Promise(C=>setTimeout(C,100)),f("[GameScene] "),ye.value=null,setTimeout(async()=>{f("[GameScene] "),await ji($e)},300)}async function Ah(O,j){if(!Y.value)return;f(`[GameScene]  ${Y.value.id}  (${O}, ${j}) `);const $e=Y.value.id,me=JSON.stringify({type:"on_structure_transfer_apply",content:{id:String($e),position:{x:String(O),y:String(j)}}});await Ue(me),f("[GameScene] ");const Ee=JSON.stringify({type:"on_structure_transfer_end"});await Ue(Ee),await new Promise(C=>setTimeout(C,100)),f("[GameScene] "),ye.value=null,setTimeout(async()=>{f("[GameScene] "),await ji($e)},300)}async function Mo(O){const j=Me.value.findIndex(me=>me.id===O);j!==-1&&(Ye.value=j),Y.value=null;const $e=JSON.stringify({type:"on_click_copper",content:{id:String(O)}});await Ue($e)}async function ji(O){f(`[GameScene] : ID=${O}`),N.value=null;const j=JSON.stringify({type:"on_click_structure",content:{id:String(O)}});await Ue(j)}async function Xr(O,j=!1){if(j)Ye.value=-1,tl();else{const me=Me.value.findIndex(Ee=>Ee.id===O);me!==-1&&(Ye.value=me)}Y.value=null;const $e=JSON.stringify({type:"on_click_enemy",content:{id:String(O)}});await Ue($e)}function tl(){N.value=null,Z.value=[],ye.value=null}async function Gh(O){if(f("[GameScene] :",O),O.type==="moveStart")ye.value="moving";else if(O.type==="attackStart")ye.value="attacking";else if(O.type==="summonStart")ye.value="summoning";else if(O.type==="buildRequest"){f("[GameScene] ");const j=JSON.stringify({type:"on_get_structure_menu"});await Ue(j)}else if(O.type==="buildStart")ye.value="building",Re.value=O.structureName||null;else if(O.type==="transferring"||O.type==="transferStart")ye.value="transferring",le.value=[],ie.value=[];else if(O.type==="transferComplete")ye.value=null,le.value=[],ie.value=[];else if(O.type==="cancel"){const j=ye.value;if(j==="moving"){const $e=JSON.stringify({type:"on_move_end"});Ue($e).catch(me=>{f("[GameScene] ",me)})}else if(j==="attacking"){const $e=JSON.stringify({type:"on_attack_end"});Ue($e).catch(me=>{f("[GameScene] ",me)})}else if(j==="transferring"){const $e=JSON.stringify({type:"on_transfer_end"});Ue($e).catch(me=>{f("[GameScene] ",me)}),le.value=[],ie.value=[]}else if(j==="summoning"){const $e=JSON.stringify({type:"on_summon_end"});Ue($e).catch(me=>{f("[GameScene] ",me)}),fe.value=!1}else if(j==="building"){const $e=JSON.stringify({type:"on_structure_build_end"});Ue($e).catch(me=>{f("[GameScene] ",me)}),Re.value=null,ve.value=null}ye.value=null}else O.type==="wait"&&(f("[GameScene] "),nl())}function w_(){if(Me.value.length!==0){if(N.value){const O=N.value.can_move,j=N.value.can_attack,$e=N.value.can_summon;if(f(`[GameScene] : ID=${N.value.id}, can_move=${O}, can_attack=${j}, can_summon=${$e}, hasAttackTargets=${ue.value}`),O||j&&ue.value||$e){f("[GameScene] ");return}}f("[GameScene] "),nl()}}async function nl(){var $e,me,Ee;if(Me.value.length===0)return;N.value=null,ye.value=null,Ye.value;let O=0;const j=Me.value.length;for(;O<j;){Ye.value=(Ye.value+1)%Me.value.length;const C=Me.value[Ye.value];f(`[GameScene] : ${C.name||C.id} ( ${O+1}/${j})`),await new Promise(xe=>{setTimeout(async()=>{const Pe=P.find(Ve=>Ve.id===C.id);(Pe==null?void 0:Pe.type)==="summon"?await Xr(C.id,!1):await Mo(C.id),xe()},300)}),await new Promise(xe=>setTimeout(xe,200));const E=(($e=N.value)==null?void 0:$e.can_move)||!1,V=((me=N.value)==null?void 0:me.can_attack)||!1,_e=((Ee=N.value)==null?void 0:Ee.can_summon)||!1,pe=E||V&&ue.value||_e;if(f(`[GameScene]  ${C.name}: can_move=${E}, can_attack=${V}, can_summon=${_e}, hasTargets=${ue.value}, valid=${pe}`),N.value&&pe){f(`[GameScene] : ${C.name||C.id}`);return}O++}f("[GameScene] "),N.value=null,n.isGameMode&&f('[GameScene] ""')}function Rh(){Xe.value++,Ye.value=-1,N.value=null,ye.value=null,Me.value.forEach(j=>j.turnDone=!1),f(`[GameScene]  ${Xe.value}`);const O=P.filter(j=>j.type==="enemy"&&!j.isOwned);if(f(`[GameScene]  ${O.length} `),O.length===0)f("[GameScene] "),dt.value=!1;else{dt.value=!0,pt.value.clear(),f("[GameScene] ");let j=setTimeout(()=>{dt.value&&pt.value.size>0&&(f("[GameScene] "),dt.value=!1,pt.value.clear())},3e3),$e=setInterval(()=>{dt.value||(clearTimeout(j),clearInterval($e))},100);setTimeout(()=>{dt.value&&pt.value.size===0&&(f("[GameScene] "),dt.value=!1,clearTimeout(j),clearInterval($e))},1e3)}}async function Oh(){f("[GameScene] "),It.value=!1;const O=JSON.stringify({type:"on_game_over"});await Ue(O),s("back")}async function Dh(){f("[GameScene] game over"),Zt.value=!1;const O=JSON.stringify({type:"on_game_over"});await Ue(O),Nh()}function Nh(){f("[GameScene] "),Fn.value=!0,setTimeout(()=>{f("[GameScene] "),Fn.value=!1,s("back")},5e3)}function jh(){f("[GameScene] "),Fn.value=!1,s("back")}function Hh(){f("[GameScene] "),Os.value=!0}function Fh(){f("[GameScene] "),Os.value=!1}async function Uh(){f("[GameScene]  game_over "),Os.value=!1;const O=JSON.stringify({type:"on_game_over"});await Ue(O),s("back")}function Bh(){f("[GameScene] "),Di.value=!1,Ni.value=""}function zh(){z()}const Vh=`url('${ee("@assets/ui/panel7.png")}')`,qh=`url('${ee("@assets/ui/panel8.png")}')`;return(O,j)=>{var $e,me,Ee,C;return W(),te("div",$9,[h("div",{ref_key:"container",ref:o,class:"scene-container"},null,512),e.isGameMode?(W(),Mn(xG,{key:0,currentCopperId:qc.value,copperList:Me.value,roundNumber:Xe.value,isEnemyMoving:dt.value,onNextCopper:nl,onEndRound:Rh,onSelectCopper:Mo},null,8,["currentCopperId","copperList","roundNumber","isEnemyMoving"])):Ie("",!0),e.isGameMode?(W(),te("div",d9,[h("button",{class:"withdraw-button",onClick:Hh},""),h("button",{class:"reset-button",onClick:zh,title:""},"  ")])):Ie("",!0),e.isGameMode?(W(),Mn(_9,{key:2})):Ie("",!0),e.isGameMode&&N.value?(W(),Mn($G,{key:3,ref_key:"copperActionPanelRef",ref:J,copper:N.value,resources:Z.value,hasAttackTargets:ue.value,transferTargets:ie.value,onSelectCopper:Mo,onClose:tl,onAction:Gh},null,8,["copper","resources","hasAttackTargets","transferTargets"])):Ie("",!0),e.isGameMode?(W(),Mn(sR,{key:4,visible:fe.value,"copper-name":((Ee=(me=($e=N.value)==null?void 0:$e.copper)==null?void 0:me.copper_info)==null?void 0:Ee.name)||"","enemy-list":Te.value,position:ve.value,onClose:Sh,onSummon:vh},null,8,["visible","copper-name","enemy-list","position"])):Ie("",!0),e.isGameMode&&Y.value?(W(),Mn(xR,{key:5,structure:Y.value,resources:((C=Se.value)==null?void 0:C.resources)||[],"action-mode":ye.value==="structureMoving"?"move":ye.value==="structureAttacking"?"attack":ye.value==="structureExtract"?"extract":ye.value==="structureTransfer"?"transfer":null,onClose:kh,onAction:Mh,onCancel:y_},null,8,["structure","resources","action-mode"])):Ie("",!0),e.isGameMode?Ie("",!0):(W(),te("div",p9,[...j[0]||(j[0]=[Ra('<h3 data-v-199b8400>3D</h3><p style="color:#ffd700;font-weight:600;" data-v-199b8400> </p><div style="margin:8px 0;padding:8px;background:rgba(255, 255, 255, 0.1);border-radius:6px;" data-v-199b8400><p style="font-weight:600;" data-v-199b8400> </p><p style="font-size:12px;" data-v-199b8400>  = ID:1</p><p style="font-size:12px;" data-v-199b8400>  = ID:2</p></div><div style="margin:8px 0;padding:8px;background:rgba(255, 255, 255, 0.1);border-radius:6px;" data-v-199b8400><p style="font-weight:600;" data-v-199b8400> EventLoop</p><p style="font-size:12px;" data-v-199b8400>1.   EventLoop</p><p style="font-size:12px;" data-v-199b8400>2. &quot; &quot;</p><p style="font-size:12px;" data-v-199b8400>3. 3</p><p style="font-size:11px;" data-v-199b8400>  =IronWall  =Arcanist  =CraftsMan </p></div>',4)])])),It.value?(W(),te("div",m9,[h("div",{class:"game-over-dialog"},[j[1]||(j[1]=h("h2",{class:"game-over-title"},"",-1)),j[2]||(j[2]=h("p",{class:"game-over-message"},"",-1)),h("button",{class:"game-over-button",onClick:Oh},"  ")])])):Ie("",!0),Zt.value?(W(),te("div",f9,[h("div",{class:"game-over-dialog success-dialog"},[j[3]||(j[3]=h("h2",{class:"success-title"},"  ",-1)),j[4]||(j[4]=h("p",{class:"game-over-message"},"",-1)),h("button",{class:"game-over-button success-button",onClick:Dh},"  ")])])):Ie("",!0),Fn.value?(W(),te("div",h9,[h("div",{class:"credits-container"},[j[5]||(j[5]=Ra('<h1 class="credits-title" data-v-199b8400></h1><div class="credits-content" data-v-199b8400><div class="credits-section" data-v-199b8400><h2 data-v-199b8400></h2><p data-v-199b8400>MGPIC Team</p></div><div class="credits-section" data-v-199b8400><h2 data-v-199b8400></h2><p data-v-199b8400>Backend Developer</p><p data-v-199b8400>Frontend Developer</p></div><div class="credits-section" data-v-199b8400><h2 data-v-199b8400></h2><p data-v-199b8400>3D Artist</p><p data-v-199b8400>UI Designer</p></div><div class="credits-section" data-v-199b8400><h2 data-v-199b8400></h2><p data-v-199b8400>Sound Designer</p></div><div class="credits-section" data-v-199b8400><h2 data-v-199b8400></h2><p data-v-199b8400></p></div></div>',2)),h("button",{class:"skip-credits-button",onClick:jh},"")])])):Ie("",!0),Di.value?(W(),te("div",g9,[h("div",b9,[j[6]||(j[6]=h("h2",{class:"withdraw-title"},"",-1)),h("p",y9,ae(Ni.value),1),h("div",{class:"dialog-buttons"},[h("button",{class:"dialog-button confirm-button",onClick:Bh},"  ")])])])):Ie("",!0),Os.value?(W(),te("div",w9,[h("div",{class:"game-over-dialog"},[j[7]||(j[7]=h("h2",{class:"withdraw-title"},"",-1)),j[8]||(j[8]=h("p",{class:"game-over-message"},[Wo(""),h("br"),Wo("")],-1)),h("div",{class:"dialog-buttons"},[h("button",{class:"dialog-button cancel-button",onClick:Fh},"  "),h("button",{class:"dialog-button confirm-button",onClick:Uh},"  ")])])])):Ie("",!0),h("audio",{ref_key:"audioRef",ref:i,src:we(r),loop:"",preload:"auto"},null,8,v9),h("audio",{ref_key:"moveSoundRef",ref:a,src:we(d),preload:"auto"},null,8,S9),h("audio",{ref_key:"moveEnemySoundRef",ref:c,src:we(p),preload:"auto"},null,8,k9),h("audio",{ref_key:"attackSoundRef",ref:l,src:we(b),preload:"auto"},null,8,M9),h("audio",{ref_key:"attackEnemySoundRef",ref:u,src:we(g),preload:"auto"},null,8,C9),h("audio",{ref_key:"meHurtSoundRef",ref:_,src:we(m),preload:"auto"},null,8,x9),h("audio",{ref_key:"enemyHurtSoundRef",ref:$,src:we(v),preload:"auto"},null,8,P9)])}}},I9=Vt(L9,[["__scopeId","data-v-199b8400"]]),T9={class:"stage"},E9={key:0,style:{position:"relative",width:"100%",height:"100%"}},A9={key:2,class:"modal"},G9={class:"modal-title"},R9={key:2,class:"overlay",style:{"z-index":"30000","align-items":"flex-start","justify-content":"flex-start",background:"rgba(0, 0, 0, 0.25)"}},O9={class:"settings"},D9={class:"settings__header"},N9=["src"],j9={class:"settings__content"},H9={class:"settings__section"},F9={class:"settings__control-options"},U9={__name:"App",setup(e){const t=se(!1),n=se(null),o=se(!1),s=se(null),i=se([]);se(0);const r=se(!0),a=se(!1),c=se("touchpad"),l=se(!1);let u=null;function _(R){n.value!==R&&(i.value.push(n.value),n.value=R),window.__START_MENU_PAUSE__&&window.__START_MENU_PAUSE__(),t.value=!0}function $(){window.open("https://www.bilibili.com/video/BV19UCwBzE1Z/","_blank"),f("[App] ")}function d(){r.value=!1,u&&clearTimeout(u),u=setTimeout(()=>{r.value||(f("[App] StartMenu"),l.value=!0)},5*60*1e3)}function p(){n.value=null,i.value=[],window.__START_MENU_RESUME__&&window.__START_MENU_RESUME__(),t.value=!1}function b(R){f("[App] ID:",R.ids),p(),a.value=!0,f("[App] ")}function g(){a.value=!1}function m(){const R=Vc();c.value=R.controlMode,o.value=!0,t.value=!0}function v(){o.value=!1,n.value||(window.__START_MENU_RESUME__&&window.__START_MENU_RESUME__(),t.value=!1)}function y(R){c.value=R,gh("controlMode",R),window.updateControlMode&&window.updateControlMode(R),f(`[App] : ${R}`)}function w(){if(o.value){v();return}if(n.value){if(n.value==="warehouse"&&s.value&&s.value.handleBack&&s.value.handleBack())return;const R=i.value.pop()??null;n.value=R,R||(t.value=!1);return}if(!r.value){u&&(clearTimeout(u),u=null),l.value&&(l.value=!1,f("[App] StartMenu")),r.value=!0,setTimeout(()=>{window.__INIT_THREE_SCENE__?window.__INIT_THREE_SCENE__().then(()=>{window.__START_MENU_RESUME__&&window.__START_MENU_RESUME__()}).catch(()=>{window.__START_MENU_RESUME__&&window.__START_MENU_RESUME__()}):window.__START_MENU_RESUME__&&window.__START_MENU_RESUME__()},100),t.value=!1;return}}const k=se(!0),L=se(null);function P(){k.value=!k.value,f("[App] :",k.value?"":"")}async function G(){try{f("[App] ...");const R=pL();if(R.type==="error"){f("[App] :",R.content),alert(": "+R.content);return}f("[App] ...");const M=new Blob([JSON.stringify(R,null,2)],{type:"application/json"}),B=document.createElement("a");B.href=URL.createObjectURL(M);const de=new Date().toISOString().replace(/[:.]/g,"-").slice(0,-5);B.download=`mgpic-save-${de}.json`,B.click(),URL.revokeObjectURL(B.href),f("[App] ")}catch(R){f("[App] :",R),alert("")}}function I(){try{L.value&&L.value.click()}catch{}}async function U(R){try{const M=R.target&&R.target.files&&R.target.files[0];if(!M)return;f("[App] ...");const B=new FileReader;B.onload=async()=>{try{const de=String(B.result||"{}"),oe=JSON.parse(de);f("[App] ..."),dL(de),f("[App] "),alert("")}catch(de){f("[App] :",de),alert(": "+de.message)}R.target.value=""},B.onerror=()=>{f("[App] "),alert(""),R.target.value=""},B.readAsText(M)}catch(M){f("[App] :",M),alert("")}}return gn(()=>{ph(R=>{})}),Is(()=>{u&&(clearTimeout(u),u=null)}),(R,M)=>(W(),te("div",T9,[a.value?(W(),Mn(I9,{key:0,isGameMode:!0,"music-on":k.value,onBack:g},null,8,["music-on"])):Ie("",!0),a.value?Ie("",!0):(W(),te(ht,{key:1},[l.value?Ie("",!0):ip((W(),Mn(W8,{key:0,visible:r.value,onStarted:d},null,8,["visible"])),[[Up,r.value]]),r.value?Ie("",!0):(W(),Mn(cd,{key:1,"music-on":k.value,onBack:w,onOpenSettings:m,onToggleMusic:P},null,8,["music-on"])),Pt(c1,{"music-on":k.value,paused:n.value==="start"||n.value==="warehouse"||a.value,onStartGame:M[0]||(M[0]=B=>_("start")),onOpenWarehouse:M[1]||(M[1]=B=>_("warehouse")),onOpenTutorial:$,onOpenEncyclopedia:M[2]||(M[2]=B=>_("encyclopedia")),onToggleMusic:P},null,8,["music-on","paused"]),n.value?(W(),te("div",{key:2,class:St(["overlay",{"overlay--warehouse":n.value==="warehouse"}])},[n.value==="warehouse"?(W(),te("div",E9,[Pt(cd,{"music-on":k.value,onBack:w,onOpenSettings:m,onToggleMusic:P},null,8,["music-on"]),Pt(M8,{ref_key:"warehouseRef",ref:s,"music-on":k.value},null,8,["music-on"])])):n.value==="start"?(W(),Mn(AT,{key:1,"music-on":k.value,paused:a.value,onClose:p,onConfirm:b},null,8,["music-on","paused"])):(W(),te("div",A9,[h("h2",G9,ae(n.value==="warehouse"?"  Copper Warehouse":n.value==="tutorial"?"  Tutorial":n.value==="encyclopedia"?"  Game Encyclopedia":"  Start Game"),1),M[5]||(M[5]=h("p",{class:"modal-body"},"",-1)),h("button",{class:"close-btn",onClick:p},"")]))],2)):Ie("",!0)],64)),o.value?(W(),te("div",R9,[h("div",O9,[h("div",D9,[M[6]||(M[6]=h("div",{class:"settings__title"},"",-1)),h("button",{class:"settings__close",onClick:v,"aria-label":""},[h("img",{src:we(ee)("@assets/ui/close.png"),alt:""},null,8,N9)])]),h("div",j9,[h("div",H9,[M[9]||(M[9]=h("div",{class:"settings__section-title"},"",-1)),h("div",F9,[h("button",{class:St(["settings__control-btn",{active:c.value==="touchpad"}]),onClick:M[3]||(M[3]=B=>y("touchpad"))},[...M[7]||(M[7]=[h("span",{class:"control-title"},"",-1),h("span",{class:"control-desc"},"",-1)])],2),h("button",{class:St(["settings__control-btn",{active:c.value==="mouse"}]),onClick:M[4]||(M[4]=B=>y("mouse"))},[...M[8]||(M[8]=[h("span",{class:"control-title"},"",-1),h("span",{class:"control-desc"},"",-1)])],2)])]),h("button",{class:"settings__item",onClick:G},[...M[10]||(M[10]=[Ra('<span class="settings__icon" data-v-a39aa6b9><svg width="44" height="44" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-a39aa6b9><path d="M12 3v12m0 0l-4-4m4 4l4-4" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-a39aa6b9></path><path d="M4 19h16" stroke="#fff" stroke-width="2" stroke-linecap="round" data-v-a39aa6b9></path></svg></span><span class="settings__label" data-v-a39aa6b9></span>',2)])]),h("button",{class:"settings__item",onClick:I},[...M[11]||(M[11]=[Ra('<span class="settings__icon" data-v-a39aa6b9><svg width="44" height="44" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-a39aa6b9><path d="M12 21V9m0 0l4 4m-4-4L8 13" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-a39aa6b9></path><path d="M4 5h16" stroke="#fff" stroke-width="2" stroke-linecap="round" data-v-a39aa6b9></path></svg></span><span class="settings__label" data-v-a39aa6b9></span>',2)])]),h("input",{ref_key:"fileInput",ref:L,type:"file",accept:".json",onChange:U,style:{display:"none"}},null,544)])])])):Ie("",!0)]))}},md=Vt(U9,[["__scopeId","data-v-a39aa6b9"]]);function B9(){const e=navigator.userAgent;return/Safari/.test(e)&&!/Chrome/.test(e)&&!/Chromium/.test(e)}function z9(){const e=document.getElementById("safari-warning"),t=document.getElementById("loading-screen");e.style.display="flex",t.style.display="none",document.getElementById("download-local").addEventListener("click",()=>{window.open("https://github.com/MGPIC-2025/Cross/releases","_blank")}),document.getElementById("continue-safari").addEventListener("click",()=>{e.style.display="none",t.style.display="flex",wh()}),document.getElementById("download-chrome").addEventListener("click",()=>{window.open("https://www.google.com/chrome/","_blank")})}function Al(e,t,n,o=""){const s=document.getElementById("progress-bar"),i=document.getElementById("progress-text"),r=document.querySelector(".loading-subtitle");s&&(s.style.width=n+"%"),i&&(e===0&&t===0?i.textContent=`${n}%`:i.textContent=`${e} / ${t} (${n}%)`),r&&o&&(r.textContent=o)}function fd(){const e=document.getElementById("loading-screen");e&&(e.classList.add("fade-out"),setTimeout(()=>{e.style.display="none"},500))}async function wh(){try{f("..."),await Ql(Al,["high"]),f(""),Al(0,100,100,"..."),_$(md).mount("#app"),await new Promise(t=>setTimeout(t,200)),window.__INIT_THREE_SCENE__&&await window.__INIT_THREE_SCENE__((t,n,o)=>{Al(0,0,o,`3D... ${o}%`)}),f(""),setTimeout(()=>{fd()},300),setTimeout(async()=>{try{f("..."),await Ql(null,["medium"]),f("")}catch(t){f(":",t)}},1e3)}catch(e){f(":",e),_$(md).mount("#app"),fd()}}B9()?(f("Safari"),z9()):(f("Safari"),wh());
