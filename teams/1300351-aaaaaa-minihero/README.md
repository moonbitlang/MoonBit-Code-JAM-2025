# minihero
## 游戏简介
### 创作背景
想做个接入ai的动态背景的肉鸽, 然后加了很多《猫国建设者》.以及好像有点做不完了！

### 玩法目标
玩家扮演勇者, 消灭魔物和魔物巢穴, 带领人类发展壮大, 于此同时获得更多的金币。

### 设计理念
尽可能操作简单

### 控制方式
WASD移动,攻击和交互。Q切换大世界和小区域
有一些按钮可以点击.

### 游戏流程
WASD移动,攻击和交互。交互人类会回血。

可以攻击怪物和怪物的巢穴。

Q切换大世界和小区域, 大世界用颜色表示势力, 有四个国家, 无主地绿色, 以及象征魔物占领地黑色。

小区域内也可以从地图边缘回到大世界, 小区域里水域不可建造和移动。

你是拯救世界的勇者之一, 在你所在的附近会不断出现新的人物和魔物。

消灭魔物和怪物巢穴会获得功绩。满1000点功绩进入自己国度的村镇会自动消耗并成为当地的领主, 获得经济建筑营利的税收。

带领人类发展壮大, 消灭魔物吧。

当然, 也可以尽可能多地刷金币! 

这个世界在自然演化中。每隔几天会出现一个怪物巢穴, 怪物巢穴每天会生成不离开区域的魔物。

世界上有若干国家。每个国家初始有若干城市。有许多种建筑，需要消耗经济值建造(点击建造按钮然后点击地图), 建筑处派驻空闲人口会产出经济值/食物等等, 而人物被派驻到建筑会获得相应的职业得到加成。可以创建英雄，英雄可以分配某个种类的士兵并叠加此单位的攻击力(比升级提升战斗力要快)。这些城市也会在其领主的决策下自动建造建筑，分配人口，招募英雄。城墙可以提升区域的防御值, 敌对的单位只有削减完区域的防御值才能从大地图进入城市。人物游荡时可能离开小区域前往大世界, 从而可能前往其他小区域, 荒野区域中, 游荡的人口数量超过5则可能建立新的城镇。

国家之间会有小概率发生战争从而改变城市的归属。魔物/英雄/士兵/武装起来的普通职业者都会自动寻找并攻击城市内的敌对单位和建筑。最终大世界会持续地动态地变化填色(荒野的绿色, 魔物巢穴的黑色, 以及四个国家的四种颜色)。

除此之外, 我们接入了大模型, ai可以扮演各个国家, 经济值建造各种经营性和人口建筑, 宣战和谈, 军事调拨。

任意静态网页端可以在请求参数后加一个 chat=moda 从而用上魔搭上的大模型.(为了方便, moonbit这边的静态网页我们默认会使用魔搭, 可以chat=任意非moda的值来取消)

最新版我们会持续在 https://www.modelscope.cn/studios/ewbraent/mini111/summary 处更新



## 技术特色

使用 selene 引擎开发.

新增了一个 Widget 系统更方便保持 UI 的显示状态.

大世界和小区域切换.

动态的势力发展与演化, 四国演义, 同时对抗魔物。各区域自行规划增长人口的房屋, 和增长经济用于建筑消耗的工坊, 提升单位战斗力获取作战单位的军营等.

FFI提供了提供环境信息给JS端, 并从JS获取产生的动作的接口.

接入大模型, 通过大模型做规划, 让ai扮演四个国家, 消耗国库资金建造各种经营建筑和人口建筑, 宣战和谈, 军事调拨.页面底部可以看到ai具体的决策, 有时候它还会给出思考过程。

因为上一步的世界状态(324个城市内经济, 建筑, 各方兵力统计等)比较大, 而且除了印证旧决策外几乎无用, 所以我们在和llm通信的时候, 会移除前面所有步的状态, 只保留一份最新的状态, 和ai的所有历史决策。此外, 对话长度达到一定token量之后会让ai做一次总结, 根据总结的信息重置对话。(问就是一会会烧掉几百块的教训)。

## 其他
使用了 CC0 的 MiniWorldSprites 的素材
使用了 ThaleahFat.ttf 字体

## 部署指南

进入目录后  ./build.sh  来进行构建

此时可以访问http://localhost:7999?chat=moda,  从而使用我们在魔搭上提供的llm api。大模型接入也可以使用Dockerfile来本地部署。 

使用  `DASHSCOPE_API_KEY` 来作为模型的key, 暂限定deepseek。

使用  `AI_BASE_URL` 作为请求大模型的地址, 当为`http://localhost:8000/v1` 的时候, 会下载并部署qwen3 到本地。

也可以中断  build.sh 的执行。然后 uvicorn local-llm:app 启动本地qwen3大模型。然后进入electron 目录, 

export AI_BASE_URL=http://localhost:8000/v1 然后node server.js 提供静态文件和中间层。然后访问localhost:7860 即可。

此时的关系为 浏览器   <-> (静态文件, /chat请求)express <-> (llm访问) fastapi。

可以调整server.js填入api key, 使用大模型提供的服务, 而不适用本地大模型(deepseek官方的api当然会比本地跑的qwen3-0.6b效果要好)。



## 团队信息
团队名称： aaaaaa

成员名单：

faaaa - 编程
洛清贫 - 策划


游戏介绍视频链接：【minihero-哔哩哔哩】 https://www.bilibili.com/video/BV1FWCtBXEVX/


联系方式：ahafaaa@163.com
