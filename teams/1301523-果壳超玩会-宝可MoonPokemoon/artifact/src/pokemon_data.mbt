///|
// Pokemon Data Reader - å†…å­˜ä¸­å­˜å‚¨å®å¯æ¢¦ä¿¡æ¯
// ç›´æ¥åœ¨ä»£ç ä¸­å®šä¹‰å®å¯æ¢¦æ•°æ®ï¼Œæ— éœ€æ–‡ä»¶ I/O

///|
// ===== å®å¯æ¢¦æ•°æ®ç»“æ„ =====

/// å®å¯æ¢¦æ•°æ®é›†åˆ
pub struct PokemonDatabase {
  pokemons: Array[Pokemon];
  last_updated: String
}

///|
// ===== å®å¯æ¢¦æ•°æ®å®šä¹‰ =====

/// è·å–æ‰€æœ‰å®å¯æ¢¦æ•°æ®
fn get_pokemon_data() -> Array[Pokemon] {
  [
    Pokemon::{
      id: 1,
      name: "PythonèŸ’è›‡",
      level: 8,
      hp: 65,
      max_hp: 65,
      attack: 55,
      defense: 60,
      speed: 70,
      types: [PokemonType::Grass, PokemonType::Dragon],
      moves: ["è—¤è”“ç¼ ç»•", "æ•°æ®æµ", "ä¼˜é›…ç¼–ç¨‹", "ç®€æ´ä»£ç "]
    },
    Pokemon::{
      id: 2,
      name: "Javaå’–å•¡æ¯",
      level: 7,
      hp: 80,
      max_hp: 80,
      attack: 50,
      defense: 75,
      speed: 45,
      types: [PokemonType::Fire, PokemonType::Steel],
      moves: ["çƒ­å’–å•¡", "ä¼ä¸šçº§æ”»å‡»", "æŒä¹…æˆ˜", "è·¨å¹³å°"]
    },
    Pokemon::{
      id: 3,
      name: "C++é½¿è½®å…½",
      level: 9,
      hp: 70,
      max_hp: 70,
      attack: 85,
      defense: 65,
      speed: 55,
      types: [PokemonType::Steel, PokemonType::Dark],
      moves: ["æŒ‡é’ˆæ”»å‡»", "å†…å­˜æ³„æ¼", "æ¨¡æ¿ç¼–ç¨‹", "é½¿è½®åˆ‡å‰²"]
    },
    Pokemon::{
      id: 4,
      name: "JavaScriptç”µç²¾çµ",
      level: 6,
      hp: 40,
      max_hp: 40,
      attack: 60,
      defense: 35,
      speed: 95,
      types: [PokemonType::Electric, PokemonType::Fairy],
      moves: ["å¼‚æ­¥é—ªç”µ", "åŸå‹é“¾", "å›è°ƒæ”»å‡»", "åŠ¨æ€ç±»å‹"]
    },
    Pokemon::{
      id: 5,
      name: "C#éŸ³ç¬¦éª‘å£«",
      level: 8,
      hp: 75,
      max_hp: 75,
      attack: 70,
      defense: 70,
      speed: 60,
      types: [PokemonType::Steel, PokemonType::Electric],
      moves: ["éŸ³ç¬¦å†²å‡»", "LINQæŸ¥è¯¢", "å±æ€§æ”»å‡»", "å§”æ‰˜æŠ€èƒ½"]
    },
    Pokemon::{
      id: 6,
      name: "Goåœ°é¼ ",
      level: 5,
      hp: 55,
      max_hp: 55,
      attack: 45,
      defense: 50,
      speed: 80,
      types: [PokemonType::Normal, PokemonType::Ground],
      moves: ["å¹¶å‘æŒ–æ˜", "åç¨‹", "å¿«é€Ÿç¼–è¯‘", "åƒåœ¾å›æ”¶"]
    },
    Pokemon::{
      id: 7,
      name: "RustèƒèŸ¹",
      level: 8,
      hp: 85,
      max_hp: 85,
      attack: 75,
      defense: 90,
      speed: 50,
      types: [PokemonType::Water, PokemonType::Steel],
      moves: ["æ‰€æœ‰æƒæ”»å‡»", "å€Ÿç”¨æ£€æŸ¥", "å†…å­˜å®‰å…¨", "é›¶æˆæœ¬æŠ½è±¡"]
    },
    Pokemon::{
      id: 8,
      name: "Rubyçº¢å®çŸ³é¾™",
      level: 7,
      hp: 60,
      max_hp: 60,
      attack: 65,
      defense: 55,
      speed: 75,
      types: [PokemonType::Fire, PokemonType::Fairy],
      moves: ["å®çŸ³é—ªè€€", "å…ƒç¼–ç¨‹", "ä¼˜é›…è¯­æ³•", "åŠ¨æ€æ–¹æ³•"]
    },
    Pokemon::{
      id: 9,
      name: "PHPä¼é¹…",
      level: 4,
      hp: 50,
      max_hp: 50,
      attack: 40,
      defense: 60,
      speed: 35,
      types: [PokemonType::Water, PokemonType::Ice],
      moves: ["æœåŠ¡å™¨å®ˆæŠ¤", "Webå¼€å‘", "æ•°æ®åº“è¿æ¥", "é¡½å¼ºç”Ÿå­˜"]
    },
    Pokemon::{
      id: 10,
      name: "Moonbitæœˆå…”",
      level: 10,
      hp: 90,
      max_hp: 90,
      attack: 70,
      defense: 80,
      speed: 85,
      types: [PokemonType::Psychic, PokemonType::Fairy],
      moves: ["æœˆå…‰ç¼–è¯‘", "ä»£ç å¹»è±¡", "æ˜Ÿè¾°è·ƒå‡»", "è¿…æ·è·ƒæ­¥"]
    }
  ]
}

/// åˆ›å»ºå®å¯æ¢¦æ•°æ®åº“
pub fn create_pokemon_database() -> PokemonDatabase {
  PokemonDatabase::{
    pokemons: get_pokemon_data(),
    last_updated: "2024-01-01"
  }
}

///|
// ===== å®å¯æ¢¦æŸ¥è¯¢åŠŸèƒ½ =====

/// æ ¹æ® ID æŸ¥æ‰¾å®å¯æ¢¦
pub fn find_pokemon_by_id(db: PokemonDatabase, id: Int) -> Option[Pokemon] {
  let mut result: Option[Pokemon] = None
  let mut i = 0
  while i < db.pokemons.length() {
    let pokemon = db.pokemons[i]
    if pokemon.id == id {
      result = Some(pokemon)
      break
    }
    i = i + 1
  }
  result
}

/// æ ¹æ®åç§°æŸ¥æ‰¾å®å¯æ¢¦
pub fn find_pokemon_by_name(db: PokemonDatabase, name: String) -> Option[Pokemon] {
  let mut result: Option[Pokemon] = None
  let mut i = 0
  while i < db.pokemons.length() {
    let pokemon = db.pokemons[i]
    if pokemon.name == name {
      result = Some(pokemon)
      break
    }
    i = i + 1
  }
  result
}

/// æ ¹æ®ç±»å‹æŸ¥æ‰¾å®å¯æ¢¦
pub fn find_pokemon_by_type(db: PokemonDatabase, pokemon_type: PokemonType) -> Array[Pokemon] {
  let mut result: Array[Pokemon] = []
  let mut i = 0
  while i < db.pokemons.length() {
    let pokemon = db.pokemons[i]
    let mut found = false
    let mut j = 0
    while j < pokemon.types.length() {
      if pokemon.types[j] == pokemon_type {
        found = true
        break
      }
      j = j + 1
    }
    if found {
      result = result + [pokemon]
    }
    i = i + 1
  }
  result
}

/// è·å–æ‰€æœ‰å®å¯æ¢¦
pub fn get_all_pokemons(db: PokemonDatabase) -> Array[Pokemon] {
  db.pokemons
}

/// è·å–å®å¯æ¢¦æ•°é‡
pub fn get_pokemon_count(db: PokemonDatabase) -> Int {
  db.pokemons.length()
}

///|
// ===== æ˜¾ç¤ºåŠŸèƒ½ =====

/// æ˜¾ç¤ºå®å¯æ¢¦ä¿¡æ¯
pub fn display_pokemon_info(pokemon: Pokemon) -> Unit {
  println("=== " + pokemon.name + " ===")
  println("ID: " + pokemon.id.to_string())
  println("ç­‰çº§: " + pokemon.level.to_string())
  println("HP: " + pokemon.hp.to_string() + "/" + pokemon.max_hp.to_string())
  println("æ”»å‡»: " + pokemon.attack.to_string())
  println("é˜²å¾¡: " + pokemon.defense.to_string())
  println("é€Ÿåº¦: " + pokemon.speed.to_string())
  println("å±æ€§1: " + pokemon.types[0].to_string())
  match pokemon.types.length() {
    2 => println("å±æ€§2: " + pokemon.types[1].to_string())
    _ => println("å±æ€§2: æ— ")
  }
  println("æŠ€èƒ½: " + pokemon.moves.join(", "))
  println("---")
}

/// æ˜¾ç¤ºæ‰€æœ‰å®å¯æ¢¦ä¿¡æ¯
pub fn display_all_pokemons(db: PokemonDatabase) -> Unit {
  println("=== å®å¯æ¢¦æ•°æ®åº“ ===")
  println("æœ€åæ›´æ–°: " + db.last_updated)
  println("å®å¯æ¢¦æ•°é‡: " + db.pokemons.length().to_string())
  
  let mut i = 0
  while i < db.pokemons.length() {
    display_pokemon_info(db.pokemons[i])
    i = i + 1
  }
}

///|
// ===== æ§åˆ¶å°æµ‹è¯•åŠŸèƒ½ =====

/// æµ‹è¯•å¹¶æ‰“å°æ‰€æœ‰å®å¯æ¢¦æ•°æ®
pub fn test_and_print_pokemon_data() -> Unit {
  println(" å¼€å§‹æµ‹è¯•å®å¯æ¢¦æ•°æ®è¯»å–...")
  println("==================================================")
  
  // åˆ›å»ºæ•°æ®åº“
  let db = create_pokemon_database()
  println("âœ… å®å¯æ¢¦æ•°æ®åº“åˆ›å»ºæˆåŠŸ")
  println("ğŸ“Š æ•°æ®åº“åŒ…å« " + get_pokemon_count(db).to_string() + " åªå®å¯æ¢¦")
  println("")
  
  // æ˜¾ç¤ºæ‰€æœ‰å®å¯æ¢¦
  display_all_pokemons(db)
  
  // æµ‹è¯•æŸ¥æ‰¾åŠŸèƒ½
  println("ğŸ” æµ‹è¯•æŸ¥æ‰¾åŠŸèƒ½:")
  println("")
  
  // æŒ‰IDæŸ¥æ‰¾
  match find_pokemon_by_id(db, 1) {
    Some(pokemon) => {
      println("âœ… æŒ‰IDæŸ¥æ‰¾æˆåŠŸ:")
      display_pokemon_info(pokemon)
    }
    None => println("âŒ æŒ‰IDæŸ¥æ‰¾å¤±è´¥")
  }
  
  // æŒ‰åç§°æŸ¥æ‰¾
  match find_pokemon_by_name(db, "Rubyçº¢å®çŸ³é¾™") {
    Some(pokemon) => {
      println("âœ… æŒ‰åç§°æŸ¥æ‰¾æˆåŠŸ:")
      display_pokemon_info(pokemon)
    }
    None => println("âŒ æŒ‰åç§°æŸ¥æ‰¾å¤±è´¥")
  }
  
  // æŒ‰ç±»å‹æŸ¥æ‰¾
  let fire_pokemons = find_pokemon_by_type(db, PokemonType::Fire)
  println("ğŸ”¥ ç«ç³»å®å¯æ¢¦ (" + fire_pokemons.length().to_string() + " åª):")
  let mut i = 0
  while i < fire_pokemons.length() {
    let pokemon = fire_pokemons[i]
    println("  - " + pokemon.name + " (Lv." + pokemon.level.to_string() + ")")
    i = i + 1
  }
  println("")
  
  // æŒ‰ç±»å‹æŸ¥æ‰¾è‰ç³»
  let grass_pokemons = find_pokemon_by_type(db, PokemonType::Grass)
  println(" è‰ç³»å®å¯æ¢¦ (" + grass_pokemons.length().to_string() + " åª):")
  let mut j = 0
  while j < grass_pokemons.length() {
    let pokemon = grass_pokemons[j]
    println("  - " + pokemon.name + " (Lv." + pokemon.level.to_string() + ")")
    j = j + 1
  }
  println("")
  
  println("ğŸ‰ å®å¯æ¢¦æ•°æ®æµ‹è¯•å®Œæˆ!")
  println("==================================================")
}

///|
// ===== æµ‹è¯•å‡½æ•° =====

test "test_pokemon_database_operations" {
  let db = create_pokemon_database()
  
  // æµ‹è¯•æŸ¥æ‰¾åŠŸèƒ½
  let bulbasaur = find_pokemon_by_id(db, 1)
  match bulbasaur {
    Some(p) => {
      assert_eq!(p.name, "PythonèŸ’è›‡")
      assert_eq!(p.types[0], PokemonType::Grass)
    }
    None => assert_false!(true)
  }
  
  // æµ‹è¯•åç§°æŸ¥æ‰¾
  let pikachu = find_pokemon_by_name(db, "Rubyçº¢å®çŸ³é¾™")
  match pikachu {
    Some(p) => {
      assert_eq!(p.id, 8)
      assert_eq!(p.types[0], PokemonType::Fire)
    }
    None => assert_false!(true)
  }
  
  // æµ‹è¯•ç±»å‹æŸ¥æ‰¾
  let fire_pokemons = find_pokemon_by_type(db, PokemonType::Fire)
  assert_eq!(fire_pokemons.length(), 2) // å°ç«é¾™å’Œå–·ç«é¾™
  
  // æµ‹è¯•æ•°é‡
  assert_eq!(get_pokemon_count(db), 9)
}