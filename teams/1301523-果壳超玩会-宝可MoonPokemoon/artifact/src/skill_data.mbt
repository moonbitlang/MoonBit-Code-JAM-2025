///|
// Skill Data - æŠ€èƒ½æ•°æ®åº“
// ç®¡ç†æ‰€æœ‰å®å¯æ¢¦æŠ€èƒ½çš„æ•°æ®å’Œå±æ€§

///|
// ===== æŠ€èƒ½æ•°æ®åº“ç»“æ„ =====

/// æŠ€èƒ½æ•°æ®åº“
pub struct SkillDatabase {
  skills: Array[Move];
  last_updated: String
}

///|
// ===== ç¼–ç¨‹è¯­è¨€ä¸»é¢˜æŠ€èƒ½æ•°æ® =====

/// è·å–æ‰€æœ‰æŠ€èƒ½æ•°æ®
fn get_skill_data() -> Array[Move] {
  [
    // PythonèŸ’è›‡æŠ€èƒ½
    Move::{
      name: "è—¤è”“ç¼ ç»•",
      power: 60,
      accuracy: 95,
      move_type: MoveType::Physical,
      element_type: "Grass",
      pp: 20,
      max_pp: 20
    },
    Move::{
      name: "æ•°æ®æµ",
      power: 70,
      accuracy: 100,
      move_type: MoveType::Special,
      element_type: "Dragon",
      pp: 15,
      max_pp: 15
    },
    Move::{
      name: "ä¼˜é›…ç¼–ç¨‹",
      power: 80,
      accuracy: 90,
      move_type: MoveType::Special,
      element_type: "Grass",
      pp: 10,
      max_pp: 10
    },
    Move::{
      name: "ç®€æ´ä»£ç ",
      power: 50,
      accuracy: 100,
      move_type: MoveType::Status,
      element_type: "Normal",
      pp: 25,
      max_pp: 25
    },
    
    // Javaå’–å•¡æ¯æŠ€èƒ½
    Move::{
      name: "çƒ­å’–å•¡",
      power: 65,
      accuracy: 100,
      move_type: MoveType::Special,
      element_type: "Fire",
      pp: 20,
      max_pp: 20
    },
    Move::{
      name: "ä¼ä¸šçº§æ”»å‡»",
      power: 90,
      accuracy: 85,
      move_type: MoveType::Physical,
      element_type: "Steel",
      pp: 10,
      max_pp: 10
    },
    Move::{
      name: "æŒä¹…æˆ˜",
      power: 0,
      accuracy: 100,
      move_type: MoveType::Status,
      element_type: "Steel",
      pp: 15,
      max_pp: 15
    },
    Move::{
      name: "è·¨å¹³å°",
      power: 75,
      accuracy: 95,
      move_type: MoveType::Special,
      element_type: "Fire",
      pp: 15,
      max_pp: 15
    },
    
    // C++é½¿è½®å…½æŠ€èƒ½
    Move::{
      name: "æŒ‡é’ˆæ”»å‡»",
      power: 85,
      accuracy: 90,
      move_type: MoveType::Physical,
      element_type: "Steel",
      pp: 15,
      max_pp: 15
    },
    Move::{
      name: "å†…å­˜æ³„æ¼",
      power: 0,
      accuracy: 100,
      move_type: MoveType::Status,
      element_type: "Dark",
      pp: 10,
      max_pp: 10
    },
    Move::{
      name: "æ¨¡æ¿ç¼–ç¨‹",
      power: 95,
      accuracy: 80,
      move_type: MoveType::Special,
      element_type: "Steel",
      pp: 8,
      max_pp: 8
    },
    Move::{
      name: "é½¿è½®åˆ‡å‰²",
      power: 70,
      accuracy: 100,
      move_type: MoveType::Physical,
      element_type: "Steel",
      pp: 20,
      max_pp: 20
    },
    
    // JavaScriptç”µç²¾çµæŠ€èƒ½
    Move::{
      name: "å¼‚æ­¥é—ªç”µ",
      power: 80,
      accuracy: 95,
      move_type: MoveType::Special,
      element_type: "Electric",
      pp: 15,
      max_pp: 15
    },
    Move::{
      name: "åŸå‹é“¾",
      power: 60,
      accuracy: 100,
      move_type: MoveType::Special,
      element_type: "Fairy",
      pp: 20,
      max_pp: 20
    },
    Move::{
      name: "å›è°ƒæ”»å‡»",
      power: 70,
      accuracy: 90,
      move_type: MoveType::Special,
      element_type: "Electric",
      pp: 15,
      max_pp: 15
    },
    Move::{
      name: "åŠ¨æ€ç±»å‹",
      power: 0,
      accuracy: 100,
      move_type: MoveType::Status,
      element_type: "Fairy",
      pp: 25,
      max_pp: 25
    },
    
    // C#éŸ³ç¬¦éª‘å£«æŠ€èƒ½
    Move::{
      name: "éŸ³ç¬¦å†²å‡»",
      power: 75,
      accuracy: 100,
      move_type: MoveType::Special,
      element_type: "Electric",
      pp: 15,
      max_pp: 15
    },
    Move::{
      name: "LINQæŸ¥è¯¢",
      power: 85,
      accuracy: 90,
      move_type: MoveType::Special,
      element_type: "Steel",
      pp: 12,
      max_pp: 12
    },
    Move::{
      name: "å±æ€§æ”»å‡»",
      power: 65,
      accuracy: 100,
      move_type: MoveType::Physical,
      element_type: "Steel",
      pp: 18,
      max_pp: 18
    },
    Move::{
      name: "å§”æ‰˜æŠ€èƒ½",
      power: 0,
      accuracy: 100,
      move_type: MoveType::Status,
      element_type: "Electric",
      pp: 20,
      max_pp: 20
    },
    
    // Goåœ°é¼ æŠ€èƒ½
    Move::{
      name: "å¹¶å‘æŒ–æ˜",
      power: 60,
      accuracy: 100,
      move_type: MoveType::Physical,
      element_type: "Ground",
      pp: 20,
      max_pp: 20
    },
    Move::{
      name: "åç¨‹",
      power: 0,
      accuracy: 100,
      move_type: MoveType::Status,
      element_type: "Normal",
      pp: 15,
      max_pp: 15
    },
    Move::{
      name: "å¿«é€Ÿç¼–è¯‘",
      power: 70,
      accuracy: 100,
      move_type: MoveType::Special,
      element_type: "Normal",
      pp: 15,
      max_pp: 15
    },
    Move::{
      name: "åƒåœ¾å›æ”¶",
      power: 0,
      accuracy: 100,
      move_type: MoveType::Status,
      element_type: "Ground",
      pp: 10,
      max_pp: 10
    },
    
    // RustèƒèŸ¹æŠ€èƒ½
    Move::{
      name: "æ‰€æœ‰æƒæ”»å‡»",
      power: 90,
      accuracy: 95,
      move_type: MoveType::Physical,
      element_type: "Steel",
      pp: 10,
      max_pp: 10
    },
    Move::{
      name: "å€Ÿç”¨æ£€æŸ¥",
      power: 0,
      accuracy: 100,
      move_type: MoveType::Status,
      element_type: "Water",
      pp: 15,
      max_pp: 15
    },
    Move::{
      name: "å†…å­˜å®‰å…¨",
      power: 0,
      accuracy: 100,
      move_type: MoveType::Status,
      element_type: "Steel",
      pp: 20,
      max_pp: 20
    },
    Move::{
      name: "é›¶æˆæœ¬æŠ½è±¡",
      power: 85,
      accuracy: 90,
      move_type: MoveType::Special,
      element_type: "Water",
      pp: 12,
      max_pp: 12
    },
    
    // Rubyçº¢å®çŸ³é¾™æŠ€èƒ½
    Move::{
      name: "å®çŸ³é—ªè€€",
      power: 80,
      accuracy: 100,
      move_type: MoveType::Special,
      element_type: "Fire",
      pp: 15,
      max_pp: 15
    },
    Move::{
      name: "å…ƒç¼–ç¨‹",
      power: 95,
      accuracy: 85,
      move_type: MoveType::Special,
      element_type: "Fairy",
      pp: 8,
      max_pp: 8
    },
    Move::{
      name: "ä¼˜é›…è¯­æ³•",
      power: 70,
      accuracy: 100,
      move_type: MoveType::Special,
      element_type: "Fire",
      pp: 18,
      max_pp: 18
    },
    Move::{
      name: "åŠ¨æ€æ–¹æ³•",
      power: 75,
      accuracy: 95,
      move_type: MoveType::Special,
      element_type: "Fairy",
      pp: 15,
      max_pp: 15
    },
    
    // PHPä¼é¹…æŠ€èƒ½
    Move::{
      name: "æœåŠ¡å™¨å®ˆæŠ¤",
      power: 0,
      accuracy: 100,
      move_type: MoveType::Status,
      element_type: "Water",
      pp: 20,
      max_pp: 20
    },
    Move::{
      name: "Webå¼€å‘",
      power: 60,
      accuracy: 100,
      move_type: MoveType::Special,
      element_type: "Water",
      pp: 20,
      max_pp: 20
    },
    Move::{
      name: "æ•°æ®åº“è¿æ¥",
      power: 0,
      accuracy: 100,
      move_type: MoveType::Status,
      element_type: "Ice",
      pp: 15,
      max_pp: 15
    },
    Move::{
      name: "é¡½å¼ºç”Ÿå­˜",
      power: 50,
      accuracy: 100,
      move_type: MoveType::Physical,
      element_type: "Water",
      pp: 25,
      max_pp: 25
    },
    
    // æœˆå…”æŠ€èƒ½
    Move::{
      name: "æœˆå…‰ç¼–è¯‘",
      power: 0,
      accuracy: 100,
      move_type: MoveType::Status,
      element_type: "Psychic",
      pp: 10,
      max_pp: 10
    },
    Move::{
      name: "ä»£ç å¹»è±¡",
      power: 75,
      accuracy: 100,
      move_type: MoveType::Special,
      element_type: "Psychic",
      pp: 10,
      max_pp: 10
    },
    Move::{
      name: "æ˜Ÿè¾°è·ƒå‡»",
      power: 95,
      accuracy: 90,
      move_type: MoveType::Special,
      element_type: "Fairy",
      pp: 8,
      max_pp: 8
    },
    Move::{
      name: "è¿…æ·è·ƒæ­¥",
      power: 60,
      accuracy: 100,
      move_type: MoveType::Physical,
      element_type: "Ground",
      pp: 20,
      max_pp: 20
    }
  ]
}

/// åˆ›å»ºæŠ€èƒ½æ•°æ®åº“
pub fn create_skill_database() -> SkillDatabase {
  SkillDatabase::{
    skills: get_skill_data(),
    last_updated: "2024-01-01"
  }
}

///|
// ===== æŠ€èƒ½æŸ¥è¯¢åŠŸèƒ½ =====

/// æ ¹æ®åç§°æŸ¥æ‰¾æŠ€èƒ½
pub fn find_skill_by_name(db: SkillDatabase, name: String) -> Option[Move] {
  let mut result: Option[Move] = None
  let mut i = 0
  while i < db.skills.length() {
    let skill = db.skills[i]
    if skill.name == name {
      result = Some(skill)
      break
    }
    i = i + 1
  }
  result
}

/// æ ¹æ®å±æ€§æŸ¥æ‰¾æŠ€èƒ½
pub fn find_skills_by_type(db: SkillDatabase, element_type: String) -> Array[Move] {
  let mut result: Array[Move] = []
  let mut i = 0
  while i < db.skills.length() {
    let skill = db.skills[i]
    if skill.element_type == element_type {
      result = result + [skill]
    }
    i = i + 1
  }
  result
}

/// æ ¹æ®æŠ€èƒ½ç±»å‹æŸ¥æ‰¾æŠ€èƒ½
pub fn find_skills_by_move_type(db: SkillDatabase, move_type: MoveType) -> Array[Move] {
  let mut result: Array[Move] = []
  let mut i = 0
  while i < db.skills.length() {
    let skill = db.skills[i]
    if skill.move_type == move_type {
      result = result + [skill]
    }
    i = i + 1
  }
  result
}

/// è·å–æ‰€æœ‰æŠ€èƒ½
pub fn get_all_skills(db: SkillDatabase) -> Array[Move] {
  db.skills
}

/// è·å–æŠ€èƒ½æ•°é‡
pub fn get_skill_count(db: SkillDatabase) -> Int {
  db.skills.length()
}

///|
// ===== æŠ€èƒ½ç®¡ç†åŠŸèƒ½ =====

/// å°†æŠ€èƒ½åç§°è½¬æ¢ä¸ºMoveç»“æ„ä½“ï¼ˆå…¼å®¹battle_system.mbtï¼‰
pub fn create_move_from_name(move_name: String) -> Move {
  let db = create_skill_database()
  match find_skill_by_name(db, move_name) {
    Some(skill) => skill
    None => {
      // å¦‚æœæ‰¾ä¸åˆ°ï¼Œè¿”å›é»˜è®¤æŠ€èƒ½
      Move::{
        name: move_name,
        power: 50,
        accuracy: 100,
        move_type: MoveType::Physical,
        element_type: "Normal",
        pp: 20,
        max_pp: 20
      }
    }
  }
}

/// ä»å®å¯æ¢¦è·å–æŠ€èƒ½åˆ—è¡¨ï¼ˆå…¼å®¹battle_system.mbtï¼‰
pub fn get_pokemon_moves(pokemon: Pokemon) -> Array[Move] {
  let moves: Array[Move] = []
  for move_name in pokemon.moves {
    moves.push(create_move_from_name(move_name))
  }
  moves
}

///|
// ===== æµ‹è¯•åŠŸèƒ½ =====

/// æµ‹è¯•å¹¶æ‰“å°æ‰€æœ‰æŠ€èƒ½æ•°æ®
pub fn test_and_print_skill_data() -> Unit {
  println(" å¼€å§‹æµ‹è¯•æŠ€èƒ½æ•°æ®è¯»å–...")
  println("==================================================")
  
  // åˆ›å»ºæ•°æ®åº“
  let db = create_skill_database()
  println("âœ… æŠ€èƒ½æ•°æ®åº“åˆ›å»ºæˆåŠŸ")
  println("ğŸ“Š æ•°æ®åº“åŒ…å« " + get_skill_count(db).to_string() + " ä¸ªæŠ€èƒ½")
  println("")
  
  // æ˜¾ç¤ºæ‰€æœ‰æŠ€èƒ½
  display_all_skills(db)
  
  // æµ‹è¯•æŸ¥æ‰¾åŠŸèƒ½
  println("ğŸ” æµ‹è¯•æŸ¥æ‰¾åŠŸèƒ½:")
  println("")
  
  // æŒ‰åç§°æŸ¥æ‰¾
  match find_skill_by_name(db, "è—¤è”“ç¼ ç»•") {
    Some(skill) => {
      println("âœ… æŒ‰åç§°æŸ¥æ‰¾æˆåŠŸ:")
      display_skill_info(skill)
    }
    None => println("âŒ æŒ‰åç§°æŸ¥æ‰¾å¤±è´¥")
  }
  
  // æŒ‰å±æ€§æŸ¥æ‰¾
  let fire_skills = find_skills_by_type(db, "Fire")
  println("ğŸ”¥ ç«ç³»æŠ€èƒ½ (" + fire_skills.length().to_string() + " ä¸ª):")
  let mut i = 0
  while i < fire_skills.length() {
    let skill = fire_skills[i]
    println("  - " + skill.name + " (å¨åŠ›:" + skill.power.to_string() + ")")
    i = i + 1
  }
  println("")
  
  // æŒ‰æŠ€èƒ½ç±»å‹æŸ¥æ‰¾
  let physical_skills = find_skills_by_move_type(db, MoveType::Physical)
  println("ï¿½ï¿½ ç‰©ç†æŠ€èƒ½ (" + physical_skills.length().to_string() + " ä¸ª):")
  let mut j = 0
  while j < physical_skills.length() {
    let skill = physical_skills[j]
    println("  - " + skill.name + " (å¨åŠ›:" + skill.power.to_string() + ")")
    j = j + 1
  }
  println("")
  
  println("ğŸ‰ æŠ€èƒ½æ•°æ®æµ‹è¯•å®Œæˆ!")
  println("==================================================")
}

/// æ˜¾ç¤ºæŠ€èƒ½ä¿¡æ¯
pub fn display_skill_info(skill: Move) -> Unit {
  println("=== " + skill.name + " ===")
  println("å¨åŠ›: " + skill.power.to_string())
  println("å‘½ä¸­ç‡: " + skill.accuracy.to_string() + "%")
  println("æŠ€èƒ½ç±»å‹: " + skill.move_type.to_string())
  println("å±æ€§: " + skill.element_type)
  println("PP: " + skill.pp.to_string() + "/" + skill.max_pp.to_string())
  println("---")
}

/// æ˜¾ç¤ºæ‰€æœ‰æŠ€èƒ½ä¿¡æ¯
pub fn display_all_skills(db: SkillDatabase) -> Unit {
  println("=== æŠ€èƒ½æ•°æ®åº“ ===")
  println("æœ€åæ›´æ–°: " + db.last_updated)
  println("æŠ€èƒ½æ•°é‡: " + db.skills.length().to_string())
  
  let mut i = 0
  while i < db.skills.length() {
    display_skill_info(db.skills[i])
    i = i + 1
  }
}

///|
// ===== æµ‹è¯•å‡½æ•° =====

test "test_skill_database_operations" {
  let db = create_skill_database()
  
  // æµ‹è¯•æŸ¥æ‰¾åŠŸèƒ½
  let python_skill = find_skill_by_name(db, "è—¤è”“ç¼ ç»•")
  match python_skill {
    Some(s) => {
      assert_eq!(s.power, 60)
      assert_eq!(s.element_type, "Grass")
    }
    None => assert_false!(true)
  }
  
  // æµ‹è¯•å±æ€§æŸ¥æ‰¾
  let fire_skills = find_skills_by_type(db, "Fire")
  assert_eq!(fire_skills.length(), 4) // Javaå’ŒRubyçš„ç«ç³»æŠ€èƒ½
  
  // æµ‹è¯•æ•°é‡
  assert_eq!(get_skill_count(db), 36) // 9ä¸ªå®å¯æ¢¦ Ã— 4ä¸ªæŠ€èƒ½
}